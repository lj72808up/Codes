webpackJsonp([1],{"+cgv":function(e,t){},"+yLs":function(e,t){},"/1J+":function(e,t){},"/TiH":function(e,t){},0:function(e,t){},"0OYy":function(e,t){},"0eb/":function(e,t){},1:function(e,t){},10:function(e,t){},11:function(e,t){},12:function(e,t){},13:function(e,t){},14:function(e,t){},15:function(e,t){},16:function(e,t){},"1Bs2":function(e,t){},"1OoD":function(e,t){},2:function(e,t){},3:function(e,t){},"3f40":function(e,t){},"3ms8":function(e,t){},4:function(e,t){},"4/hK":function(e,t){},"4Vh3":function(e,t){e.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},"4qOc":function(e,t){},5:function(e,t){},6:function(e,t){},"6ZSt":function(e,t){e.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},7:function(e,t){},"71VQ":function(e,t,a){e.exports=a.p+"static/img/xiaopApply.c50181d.png"},"77iJ":function(e,t){},"7Hum":function(e,t){},"7Otq":function(e,t,a){e.exports=a.p+"static/img/logo.6837826.png"},8:function(e,t){},"8YCc":function(e,t){e.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},"8sJK":function(e,t){},9:function(e,t){},"90S2":function(e,t){},"94Yb":function(e,t){},"9M+g":function(e,t){},"AM+7":function(e,t,a){e.exports=a.p+"static/img/xiaopScan.5d696d9.jpeg"},AnPN:function(e,t){},BS6g:function(e,t){},Bjd3:function(e,t){},"ByB+":function(e,t){},DZ6j:function(e,t){},Dykd:function(e,t){},Fyu2:function(e,t){},GRjr:function(e,t,a){e.exports=a.p+"static/img/xiaopScan.5d696d9.jpeg"},HJqy:function(e,t){},"J+EJ":function(e,t,a){"use strict";t.e=n,t.l=i,t.m=function(e,t,a){var o=new Date;o.setDate(o.getDate()+a),document.cookie=e+"="+t+(null==a?"":";expires="+o.toGMTString())+";Path=/;domain=adtech.sogou;"},t.b=function(e){var t=new Date;t.setTime(t.getTime()-1);var a=n(e);null!=a&&(document.cookie=e+"="+a+";expires="+t.toGMTString())},t.j=function(e){return l.defaults.baseURL.replace(/jones/g,"")+"lvpi"+e},t.c=function(e){var t=e.getFullYear().toString(),a=(e.getMonth()+101).toString().substring(1),o=(e.getDate()+100).toString().substring(1);return t+a+o},t.d=function(e){var t=e.getFullYear().toString(),a=(e.getMonth()+101).toString().substring(1),o=(e.getDate()+100).toString().substring(1);return t+"-"+a+"-"+o},t.f=function(e){switch(void 0===e?"undefined":s()(e)){case"undefined":return!0;case"string":if(0===e.replace(/(^[ \t\n\r]*)|([ \t\n\r]*$)/g,"").length)return!0;break;case"boolean":if(!e)return!0;break;case"number":if(0===e||isNaN(e))return!0;break;case"object":if(null===e||0===e.length)return!0}return!1},t.g=function(e){return 3===e||6===e||12===e},t.h=function(e){return 22===e},t.n=function(e){return"无线_query"===e?"wap":"PC_query"===e?"pc":"无线搜索查询"===e?"wapTotal":"PC搜索查询"===e?"pcTotal":"yh"===e?"gala":"sql查询"===e?"sql":"工单"===e&&"jdbc"},t.i=function(e){return e===n("_adtech_user")},t.a=function(e){return/.*[\u4e00-\u9fa5]+.*/.test(e)},t.k=function(){var e=n("_adtech_local_token");null!==e&&""!==e&&void 0!==e&&i("_adtech_local_token",e,1);i("_adtech_last_ts",(new Date).getTime(),1)};var o=a("pFYg"),s=a.n(o);function n(e){var t,a=new RegExp("(^| )"+e+"=([^;]*)(;|$)");return(t=document.cookie.match(a))?t[2]:null}function i(e,t,a){var o=new Date;o.setDate(o.getDate()+a),document.cookie=e+"="+t+(null==a?"":";expires="+o.toGMTString())}var l=a("mtWM")},KYqO:function(e,t){e.exports={_from:"elliptic@^6.5.3",_id:"elliptic@6.5.3",_inBundle:!1,_integrity:"sha512-IMqzv5wNQf+E6aHeIqATs0tOLeOTwj1QKbRcS3jBbYkl5oLAserA8yJTT7/VyHUYG91PRmPyeQDObKLPpeS4dw==",_location:"/elliptic",_phantomChildren:{},_requested:{type:"range",registry:!0,raw:"elliptic@^6.5.3",name:"elliptic",escapedName:"elliptic",rawSpec:"^6.5.3",saveSpec:null,fetchSpec:"^6.5.3"},_requiredBy:["/browserify-sign","/create-ecdh"],_resolved:"https://registry.npmjs.org/elliptic/-/elliptic-6.5.3.tgz",_shasum:"cb59eb2efdaf73a0bd78ccd7015a62ad6e0f93d6",_spec:"elliptic@^6.5.3",_where:"/Users/liujie02/IdeaProjects/AStarFe/node_modules/browserify-sign",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},bundleDependencies:!1,dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0",inherits:"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},deprecated:!1,description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^3.0.8",grunt:"^1.0.4","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^9.0.1",istanbul:"^0.4.2",jscs:"^3.0.7",jshint:"^2.10.3",mocha:"^6.2.2"},files:["lib"],homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",name:"elliptic",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.5.3"}},"L+hA":function(e,t){},NHnr:function(e,t,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=a("7+uW"),s=a("Xxa5"),n=a.n(s),i=a("exGp"),l=a.n(i),r=a("J+EJ"),c=a("mtWM");a("jMfe");var d={name:"App",data:function(){return{validatePass:!1}},methods:{isNotExpire:function(e,t){return-12e4<=e-t<=12e4},parseToken:function(e){var t=this;return l()(n.a.mark(function a(){var o,s,i,l,r,d;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return console.log(e),o={pToken:e},s=-1,i="",l=(new Date).getTime(),r=c.defaults.baseURL.replace(/jones/g,"")+"xiaop/jone/parseToken",d={uid:-99999,name:"dummyUser",ts:-99999},t.next=9,c.post(r,o,{responseType:"json"}).then(function(e){var t=e.data;if(t.Res){var a=JSON.parse(t.Info);s=a.uid,i=a.name}d={uid:s,name:i,ts:l}}).catch(function(e){console.log(e),d={uid:-1,name:"",ts:l}});case 9:return t.abrupt("return",d);case 10:case"end":return t.stop()}},a,t)}))()},makeJumpUrl:function(){var e="http://datacenter.adtech.sogou/";-1!="BASE_API_REPLACE".search("pre")&&(e="http://pre.datacenter.adtech.sogou/");var t=decodeURI(Object(r.e)("_adtech_path"));return null!=t&&""!=t&&void 0!=t&&"null"!=t&&(e=e+"#"+t),e},getUserFromCookieAndValidDate:function(e){var t=Object(r.e)("_adtech_last_ts"),a=Object(r.e)("_adtech_user");return null!==a&&void 0!==a&&""!==a&&"-1"!=a&&this.isNotExpire(t,e)?a:null},postUserMapping:function(e,t){var a={uid:e,username:t};c.post("/auth/user/postUser",a,{responseType:"json"}).then(function(e){}).catch(function(e){console.error(e)})},checkLogin:function(){var e=this;return l()(n.a.mark(function t(){var a,o,s,i,l,d,u,p,m,f;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:if(a=e.makeJumpUrl(),o=(new Date).getTime(),null!==(s=e.getUserFromCookieAndValidDate(o))&&void 0!==s&&""!==s&&-1!=s){t.next=24;break}if(void 0,void 0,n="(^|&)"+"ptoken"+"=([^&]*)(&|$)",h=window.location.search.substr(1).match(n),null!==(i=null!=h?unescape(h[2]):null)&&""!==i&&void 0!==i){t.next=9;break}window.location.href="https://login.sogou-inc.com/?appid=1812&sso_redirect="+a,t.next=22;break;case 9:return t.next=11,e.parseToken(i);case 11:l=t.sent,console.log("解析pToken后"),d=l.uid,u=l.name,p=l.ts,Object(r.l)("_adtech_user",d,300),Object(r.l)("_adtech_user_name",encodeURI(u),300),Object(r.l)("_adtech_last_ts",p,1),m={uid:d,username:u},f=c.defaults.baseURL.replace(/jones/g,"")+"xiaop/auth/user/postUser",c.post(f,m,{responseType:"json"}).then(function(e){window.location.href=a}).catch(function(e){console.error(e)});case 22:t.next=26;break;case 24:e.validatePass=!0,e.refreshCache();case 26:case"end":return t.stop()}var n,h},t,e)}))()},refreshCache:function(){var e=(new Date).getTime();Object(r.l)("_adtech_last_ts",e,1)}},component:{},activated:function(){this.getCase()},created:function(){this.checkLogin()}},u={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[this.validatePass?t("router-view"):this._e()],1)},staticRenderFns:[]};var p=a("VU/8")(d,u,!1,function(e){a("qCpH")},null,null).exports,m=a("/ocq"),f={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("div",[o("div",{staticClass:"page-container"},[o("p",[e._v("403 Forbidden")]),e._v(" "),o("p",[e._v("您目前没有该系统查看权限！请先申请权限")]),e._v(" "),e._m(0),e._v(" "),o("div",{attrs:{align:"left"}},[o("el-col",{attrs:{span:15,offset:"9"}},[o("h6",[e._v("一 使用xiaoP扫描如下账号关注")]),e._v(" "),o("img",{attrs:{src:a("GRjr"),width:"40%"}}),e._v(" "),o("h6",[e._v('二 输入"申请权限"')]),e._v(" "),o("img",{attrs:{src:a("71VQ"),width:"40%"}}),e._v(" "),o("h6",[e._v("三 填写申请单, 等待审核通过")]),e._v(" "),o("img",{attrs:{src:a("yPeS"),width:"40%"}})])],1)])])},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("h6",[this._v("若已申请, 请转至"),t("a",{attrs:{href:"http://datacenter.adtech.sogou"}},[this._v("http://datacenter.adtech.sogou")])])}]};var h=a("VU/8")({name:""},f,!1,function(e){a("NPEC")},"data-v-152e315e",null).exports,v={render:function(){var e=this.$createElement;return(this._self._c||e)("p",{staticClass:"page-container"},[this._v("404 page not found")])},staticRenderFns:[]};var b=a("VU/8")(null,v,!1,function(e){a("uP3G")},"data-v-94b805d0",null).exports,g=a("BO1k"),y=a.n(g),_=a("d7EF"),w=a.n(_),k=a("W3Iv"),x=a.n(k),I=a("ifoU"),T=a.n(I),F=a("mvHQ"),S=a.n(F),D=a("ZVkR"),C=a.n(D),N=(a("JGZi"),a("8U58"),a("6S2o"),a("7bwT"),a("vq+x"),a("aGTD"),a("zdrL"),a("jQeI"),a("PgJU"),a("jGSh"),a("PsxY"),a("/TiH"),a("mtWM")),O={data:function(){return{onVerify:!1,searchFieldDataSource:{dsType:"",dsId:""},dataPathRoot:"",dataPathRootPaga:"",curTaskRes:{taskId:"",status:"",statusCode:"",errMsg:"",errDialogVisible:!1,dataPath:"",filePath:"",dataLoading:!1,contentCols:[],contentData:[],process:0,tableIdx:0},exploreResult:{maxRunningTask:3,runningTaskNum:0,taskTotalCnt:0,tasks:[]},isOnSubmit:!1,visibility:!1,nodeData:{label:""},datasource:{selectValue:"",options:[],mysqlOptions:[],typeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"},{name:"kylin"}],typeSelectValue:""},wsTree:"",activeRightTabs:"first",menuVisible:!1,saveOption:{showDialog:!1,wsShowName:"",wsName:""},tableForm:{tableName:"",tableType:"",database:"",location:"",compressMode:"",description:"",tid:"",creator:"",createTime:""},exploreData:{dataList:[],tableColumn:[],loading:!1},searchFieldName:"",form:{name:"",sql:""},fieldLoading:!1,fieldList:[],tableColumn:[],partitionDataList:[],curTab:"",explorerTable:{tableId:"",tableName:""},uploadTableName:"",rules:{sql:[{require:!0,message:"SQL语句不能为空",trigger:"blur"},{validator:function(e,t,a){!0===/drop/i.test(t)||!0===/delete/i.test(t)||!0===/truncate/i.test(t)||!0===/insert/i.test(t)?a(new Error("SQL中存在危险字符!")):a()},trigger:"blur"}]},isShowRes:!1,sqlLoading:!0,sqlQueryId:"",sqlData:[],sqlDataCols:[],treeData:"",fieldIndexData:"",defaultProps:{children:"children",label:"label"},curPid:"",filterText:"",wsFilterText:"",fileList:[],queryWordsPartition:"",exploreTableName:"",cmOptions:{tabSize:4,mode:"text/x-mysql",theme:"default",lineNumbers:!0,dragDrop:!1,line:!0,hintOptions:{tables:{},databases:{}},extraKeys:{Tab:"autocomplete",F12:function(e){console.log(e.getOption("fullScreen")),e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}},timer:null,curRedashQueryId:"",disableRedashCreteBtn:!1,viewAccess:!1,taskLoading:!1,taskCols:[],taskData:[],taskForm:{session:"",date:Object(r.d)(new Date),startDate:Object(r.d)(new Date((new Date).getTime()-6048e5)),status:""},historyErrMsg:"",historyDialogVisible:!1}},created:function(){var e=this;N.get("/task/log/rsync").then(function(t){e.dataPathRoot=t.data[0],e.dataPathRootPaga=t.data[1]}).catch(function(e){console.log(e)})},watch:{filterText:function(e){this.$refs.tree.filter(e)},wsFilterText:function(e){this.$refs.wsTree.filter(e)}},methods:{searchField:function(){var e={fieldName:this.searchFieldName},t=this;N.post("/dw/searchField",e,{responseType:"json"}).then(function(e){t.fieldIndexData=e.data.children}).catch(function(e){console.error(e)})},verifySql:function(){var e=this,t={sql:this.form.sql,sqlType:this.datasource.typeSelectValue,dsId:this.datasource.selectValue+""};this.onVerify=!0,N.post("/dw/sqlVerify",t,{responseType:"json"}).then(function(t){console.log(t.data);var a=t.data;e.onVerify=!1,a.Res?e.$message({message:"sql校验通过",type:"success"}):e.$alert(a.Info,"sql校验失败",{confirmButtonText:"确定"})}).catch(function(t){e.onVerify=!1,console.error(t)})},removeTab:function(){for(var e=this.curTaskRes.taskId,t=this.exploreResult.tasks,a=-1,o=0;o<t.length;o++)t[o].id===e&&(a=o);console.log("关闭:"+e+"; id:"+a),t.splice(a,1),this.exploreResult.tasks=t,this.curTaskRes.taskId=""},checkHistoryMessage:function(e){this.historyErrMsg="",this.historyDialogVisible=!0;var t=this,a={queryId:e.query_id};N.post("/task/checkException",a,{responseType:"json"}).then(function(e){t.historyErrMsg=e.data.res}).catch(function(e){console.error(e)})},checkMessage:function(){this.curTaskRes.errMsg="",this.curTaskRes.errDialogVisible=!0;var e=this,t={queryId:this.curTaskRes.taskId};N.post("/task/checkException",t,{responseType:"json"}).then(function(t){e.curTaskRes.errMsg=t.data.res}).catch(function(e){console.error(e)})},ProcessBarIncrease:function(){this.percentage+=10,this.percentage>100&&(this.percentage=100)},downloadTaskResult:function(){window.open(this.curTaskRes.filePath+"?op=OPEN")},onRightClickFields:function(e,t,a,o){var s=a.children[0].innerHTML;this.insertCodeMirror(s)},onChangeDSType:function(){var e=this;"hive"===this.datasource.typeSelectValue?this.visibility=!0:this.visibility=!1,this.treeData="",N.get("/dw/GetConnByPrivilege/"+this.datasource.typeSelectValue).then(function(t){e.datasource.selectValue="",e.datasource.options=t.data,e.datasource.selectValue=e.datasource.options[0].Dsid,e.onChangeDataSource()}).catch(function(t){e.datasource.selectValue="",e.datasource.options=[],console.log(t)})},closeDialog:function(){this.saveOption.wsName="",this.curPid="0",this.nodeData.label=""},onChangeDataSource:function(){var e=this.datasource.typeSelectValue,t=this.datasource.selectValue,a=this;console.log(e+":"+t);var o={dsType:e,dsId:t+""};N.post("/dw/meta/get",o,{responseType:"json"}).then(function(e){a.treeData=e.data.children}).catch(function(e){console.log(e)}),this.cmOptions.hintOptions.tables={},N.post("/dw/hint/getSqlHint",o,{responseType:"json"}).then(function(e){a.cmOptions.hintOptions.tables=e.data,console.log(a.cmOptions.hintOptions.tables),console.log("this is current codemirror object",a.codemirror),a.result="finish"}).catch(function(e){console.log(e)}),-1!==e.indexOf("hive")&&N.get("/dw/hint/getSqlUDF").then(function(e){var t=e.data;null!=t&&t.length>0&&t.forEach(function(e){a.cmOptions.hintOptions.tables[e]=[]})}).catch(function(e){console.log(e)}),console.log(a.cmOptions.hintOptions)},submitNewWs:function(){var e={creator:Object(r.e)("_adtech_user"),title:this.saveOption.wsName,template:this.form.sql,dsid:this.datasource.selectValue,pid:parseInt(this.curPid),description:""},t=this;N({method:"put",url:"/jdbc/template/put",data:e,responseType:"string"}).then(function(e){t.saveOption.showDialog=!1,t.$message({type:"success",message:"模板保存成功!"}),console.log(e.data)}).catch(function(e){console.log(e),t.$message({type:"error",message:"模板保存失败!"+e})})},treeAdd:function(e){console.log(this.nodeData),this.nodeData.pid+""!="0"?this.$message({type:"error",message:"只能在一级节点下创建模板"}):(this.curPid=this.nodeData.templateId,this.$message({type:"success",message:'已选择:"'+this.nodeData.label+'"('+this.curPid+")作为上级"}),this.saveOption.wsShowName=this.nodeData.label+" - "+this.saveOption.wsName)},onClickWSTree:function(e,t,a){"0"===e.pid&&(this.idEcho=!1,this.nodeData=e,this.curPid=this.nodeData.templateId,this.saveOption.wsShowName=this.nodeData.label+" - "+this.saveOption.wsName),console.log(e)},ondbClickWSTree:function(e,t,a,o){this.idEcho=!1,this.nodeData=t,this.menuVisible=!0;var s=document.querySelector("#menu");console.log("鼠标位置:"+e.clientX+","+e.clientY),s.style.cssText="position: fixed; left: "+(e.clientX-280)+"px; top: "+(e.clientY-105)+"px; z-index: 999; cursor:pointer;"},onClickSave:function(){this.saveOption.showDialog=!0;var e=this;N.get("/jdbc/template/getAllTemplate").then(function(t){e.wsTree=t.data}).catch(function(e){console.log(e)})},onExploreData:function(e,t,a){var o=this;console.log("explore data的参数: dsType:"+t+",dsId:"+a);var s,i=this;this.exploreData.dataList=[],(s=l()(n.a.mark(function s(){var l,r;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,console.log("开始获取"+e+"的数据"),i.exploreData.loading=!0,l={tableName:e,dsType:null!=t&&""!==t?t:o.datasource.typeSelectValue,dsId:null!=a&&""!==a?a:o.datasource.selectValue+""},s.next=6,N.post("/dw/explore",l,{responseType:"json"});case 6:r=s.sent,i.exploreData.loading=!1,i.exploreData.dataList=r.data.dataList,i.exploreData.tableColumn=r.data.tableColumn,s.next=15;break;case 12:s.prev=12,s.t0=s.catch(0),console.error(s.t0);case 15:case"end":return s.stop()}},s,o,[[0,12]])})),function(){return s.apply(this,arguments)})()},insertCodeMirror:function(e){var t=this.$refs.cmEditor.codemirror,a=t.getDoc(),o=a.getCursor(),s=o.line,n=o.ch;console.log(o);var i={line:s,ch:n};a.replaceRange(e,i),t.focus()},rightClickTree:function(e){clearTimeout(null),console.log("双击事件"),this.insertCodeMirror(e.tableName)},onClickSearchFieldTree:function(e){var t=this;if(console.log(e),""!==e.tableName){var a=e.tableType,o=e.dsid+"";t.searchFieldDataSource.dsType=a,t.searchFieldDataSource.dsId=o,t.explorerTable.tableName=e.label,t.explorerTable.tableId=e.tid,"数据预览"===t.curTab&&t.onExploreData(e.tableName,a,o),t.exploreTableName=e.tableName;var s={tableId:t.explorerTable.tableId+"",version:"latest"};N.post("/metaData/fields/getByVersion",s,{responseType:"json"}).then(function(e){t.tableColumn=e.data.tableColumn,t.fieldList=e.data.dataList,N.post("/metaData/fields/getPartitionByVersion",s,{responseType:"json"}).then(function(e){t.partitionDataList=e.data}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)});var n=e.tid;N.get("/metaData/getTableById/"+n,{responseType:"json"}).then(function(e){console.log(e.data),t.tableForm.tableName=e.data.TableName,t.tableForm.tableType=e.data.TableType,t.tableForm.database=e.data.DatabaseName,t.tableForm.location=e.data.Location,t.tableForm.compressMode=e.data.CompressMode,t.tableForm.description=e.data.Description,t.tableForm.creator=e.data.Creator,t.tableForm.createTime=e.data.CreateTime}).catch(function(e){console.log(e)})}},onClickTree:function(e){var t=this;if(console.log("单击事件"),console.log(e),""!==e.tableName){t.explorerTable.tableName=e.label,t.explorerTable.tableId=e.tid,"数据预览"===t.curTab&&t.onExploreData(e.tableName),t.exploreTableName=e.tableName;var a={tableId:t.explorerTable.tableId+"",version:"latest"};N.post("/metaData/fields/getByVersion",a,{responseType:"json"}).then(function(e){t.tableColumn=e.data.tableColumn,t.fieldList=e.data.dataList,N.post("/metaData/fields/getPartitionByVersion",a,{responseType:"json"}).then(function(e){t.partitionDataList=e.data}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)});var o=e.tid;N.get("/metaData/getTableById/"+o,{responseType:"json"}).then(function(e){console.log(e.data),t.tableForm.tableName=e.data.TableName,t.tableForm.tableType=e.data.TableType,t.tableForm.database=e.data.DatabaseName,t.tableForm.location=e.data.Location,t.tableForm.compressMode=e.data.CompressMode,t.tableForm.description=e.data.Description,t.tableForm.creator=e.data.Creator,t.tableForm.createTime=e.data.CreateTime}).catch(function(e){console.log(e)})}},getExploreTaskData:function(e){var t=this;if(console.log("getExploreTaskData"),console.log(e),console.log(this.curTaskRes.status),t.curTaskRes.tableIdx===e&&"任务完成"===this.curTaskRes.status){t.curTaskRes.dataLoading=!0;var a=new URLSearchParams;a.append("data_path",this.curTaskRes.dataPath),a.append("status",this.curTaskRes.statusCode),console.log(t.$refs.plTable[e]),void 0!==t.$refs.plTable[e]&&t.$refs.plTable[e].reloadData([]),console.log(a),N({method:"post",url:"/task/data/path",data:a}).then(function(a){var o=a.data;if(o.Res){var s=JSON.parse(o.Info);t.curTaskRes.contentCols=s.cols,t.curTaskRes.contentData=s.data,t.curTaskRes.dataLoading=!1,null!==s.data&&void 0!==s.data.length&&t.$refs.plTable[e].reloadData(t.curTaskRes.contentData)}else t.curTaskRes.dataLoading=!1,t.$message({message:o.Info,type:"error"})}).catch(function(e){t.curTaskRes.dataLoading=!1,t.$message({message:e,type:"error"}),console.log(e)})}},onClickTab:function(e){var t=this;if(this.curTab=e.label,e.index<4?t.curTaskRes.taskId="":t.curTaskRes.taskId=e.name,t.curTaskRes.status="",t.curTaskRes.status_code=0,t.curTaskRes.dataPath="",t.curTaskRes.filePath="",t.curTaskRes.dataLoading=!1,t.curTaskRes.errMsg="",t.curTaskRes.contentCols=[],t.curTaskRes.contentData=[],"数据预览"===e.label)if("second"===this.activeRightTabs){var a=this.searchFieldDataSource.dsType,o=this.searchFieldDataSource.dsId;""!==o&&null!=o&&void 0!=o&&this.onExploreData(this.exploreTableName,a,o)}else this.onExploreData(this.exploreTableName);else if("历史任务"===e.label)this.loadTaskData();else if(e.index>=4){e.label;console.log(e.index),t.curTaskRes.tableIdx=e.index-4,t.curTaskRes.process=t.exploreResult.tasks[t.curTaskRes.tableIdx].process,N.get("/task_god/query/"+t.curTaskRes.taskId).then(function(a){var o=a.data;t.curTaskRes.status=o.status,t.curTaskRes.statusCode=o.status_code,t.curTaskRes.dataPath=o.data_path,t.curTaskRes.filePath=t.dataPathRoot+"datacenter/"+t.curTaskRes.dataPath,console.log(t.curTaskRes),"任务完成"!==t.curTaskRes.status&&"任务取消"!==t.curTaskRes.status||(t.curTaskRes.process=100,t.exploreResult.tasks[t.curTaskRes.tableIdx].process=t.curTaskRes.process),t.getExploreTaskData(e.index-4)}).catch(function(e){console.log(e)})}},beforeUpload:function(e){var t=this,a=new FormData,o=Object(r.e)("_adtech_user");return a.append("file",e),a.append("username",o),N.post("/dw/upload/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log(e.data);var a=e.data;a=a.match(/part='(\S*)'/)[1],console.log(a),t.queryWordsPartition=a,t.uploadTableName=e.data,t.$message({type:"success",message:"提交成功,表名为:"+e.data})}).catch(function(e){console.log("失败"),console.log(e),t.$message({type:"success",message:"提交失败"+e})}),!1},onExceed:function(e,t){this.$set(t[0],"raw",e[0]),this.$set(t[0],"name",e[0].name),this.$refs.upload.clearFiles(),this.$refs.upload.handleStart(e[0])},formatCode:function(){var e=this.codemirror;console.log(e);var t=e.getValue();e.setValue(C.a.format(t))},handleFileUpload:function(){this.file=this.$refs.file.files[0],console.log(this.file)},submitFile:function(){var e=this;this.$confirm("请确保提交的文件中只包含查询词一列; 表生成完毕会产生提示, 分区名会在底部显示","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){e.$refs.upload.submit()})},onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(!e)return!1;t.$confirm("不正确的SQL查询会造成资源浪费，请反复校验查询语句。 是否提交?","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var e=new URLSearchParams;e.append("sql",t.form.sql),a.isOnSubmit=!0,N({method:"post",url:"/dw/sql/id",data:e,responseType:"string"}).then(function(e){a.sqlQueryId=e.data,a.isShowRes=!0,a.$options.methods.onTask.bind(a)(),a.isOnSubmit=!1}).catch(function(e){a.isOnSubmit=!1,this.$message({type:"error",message:e}),console.log(e)})})})},onReset:function(e){var t=this;this.$refs[e].resetFields(),this.$nextTick(function(){t.isShowRes=!1})},msgNotify:function(){this.$notify({message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},onTask:function(){var e=this,t=new URLSearchParams,a=this.form.name;""===a&&(a=this.sqlQueryId),t.append("name",a),t.append("sql",this.form.sql),t.append("queryId",this.sqlQueryId),t.append("queryWordsPartition",this.queryWordsPartition),t.append("sqlType",this.datasource.typeSelectValue),t.append("dsId",this.datasource.selectValue),N.post("/dw/sql/task",t,{responseType:"json"}).then(function(t){e.show=!0,t.data.Res?(e.$options.methods.msgNotify.bind(e)(),e.exploreResult.tasks.push({id:e.sqlQueryId,name:a,process:0})):e.$message({type:"error",message:t.data.Info})}).catch(function(t){e.$options.methods.errorNotify.bind(e)(),e.isShowRes=!1,console.log(t),e.$message({type:"error",message:t})})},onCreateSqlView:function(){if(!0!==this.disableRedashCreteBtn){this.disableRedashCreteBtn=!0;var e=this,t=new URLSearchParams,a=this.form.name;if(""===a)return this.$alert("请输入查询任务名称!"),void(this.disableRedashCreteBtn=!1);var o=this.datasource.typeSelectValue;if("mysql"!=o&&"clickhouse"!=o)return this.$alert("当前引擎不支持创建可视化！"),void(this.disableRedashCreteBtn=!1);t.append("name",a),t.append("sql",this.form.sql),t.append("queryId",this.sqlQueryId),t.append("queryWordsPartition",this.queryWordsPartition),t.append("sqlType",this.datasource.typeSelectValue),t.append("dsId",this.datasource.selectValue),e.$message({type:"success",message:"可视化SQL创建中..."}),N.post("/jdbc/sql/createQueryView",t,{responseType:"json"}).then(function(t){if(t.data.msg.indexOf("成功")>=0){e.curRedashQueryId=t.data.redash_query_id;var a="http://inner-redash.adtech.sogou/queries/"+e.curRedashQueryId+"/source";e.$router.push({name:"redashqueryshow",params:{queryid:e.curRedashQueryId,queryUrl:a}})}else e.$message({type:"error",message:t.data.msg}),e.disableRedashCreteBtn=!1}).catch(function(t){console.log(t),e.disableRedashCreteBtn=!1})}},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},errorNotify:function(){this.$notify.error({title:"错误",message:"SQL填写有误。请重新填写后查询！"})},loadHistory:function(){var e=this,t=sessionStorage.getItem("sub_history");if(sessionStorage.removeItem("sub_history"),t){var a=JSON.parse(t);try{e.form.sql=a.SqlStr,e.form.name=a.QueryName;var o=JSON.parse(a.QueryJson);e.datasource.typeSelectValue=o.sqlType,"hive"===e.datasource.typeSelectValue?e.visibility=!0:e.visibility=!1,e.treeData="",N.get("/dw/GetConnByPrivilege/"+this.datasource.typeSelectValue).then(function(t){e.datasource.options=t.data,e.datasource.selectValue=o.dsid,e.onChangeDataSource()}).catch(function(t){e.datasource.selectValue="",e.datasource.options=[],console.log(t)})}catch(e){this.onReset("form")}}},setProcessBar:function(){for(var e=this,t=this.curTaskRes.taskId,a=0;a<this.exploreResult.tasks.length;a++)this.exploreResult.tasks[a].id!==t?this.exploreResult.tasks[a].process<95&&(this.exploreResult.tasks[a].process+=Math.floor((10*Math.random()+0)%6/5)):(a,e.curTaskRes.process=this.exploreResult.tasks[a].process);100!==e.curTaskRes.process&&""!==e.curTaskRes.taskId&&N.get("/task_god/query/"+e.curTaskRes.taskId).then(function(a){var o=a.data;e.curTaskRes.taskId===t&&(e.curTaskRes.status=o.status,e.curTaskRes.statusCode=o.status_code,e.curTaskRes.dataPath=o.data_path,e.curTaskRes.filePath=e.dataPathRoot+"datacenter/"+e.curTaskRes.dataPath,console.log(e.curTaskRes),e.getExploreTaskData(e.curTaskRes.tableIdx),"任务完成"===e.curTaskRes.status||"任务取消"===e.curTaskRes.status?(e.curTaskRes.process=100,e.exploreResult.tasks[e.curTaskRes.tableIdx].process=e.curTaskRes.process):e.curTaskRes.process<95&&(e.curTaskRes.process+=Math.floor((10*Math.random()+0)%6/5),e.exploreResult.tasks[e.curTaskRes.tableIdx].process=e.curTaskRes.process),console.log(e.curTaskRes.process))}).catch(function(e){console.log(e)})},pathClick:function(e){var t=e.status_code,a=e.data_path;if(-1===a.indexOf("xlsx")&&(a+=".csv"),console.log(a),Object(r.g)(t)||Object(r.h)(t)){var o=this.dataPathRoot+"datacenter/"+a+"?op=OPEN";this.dataPathRoot;Object(r.h)(t)&&(o=this.dataPathRootPaga+a+"?op=OPEN",this.dataPathRootPaga+"\n"+a+"?op=OPEN"),window.open(o)}else this.$message({message:"任务没有正常完成，不支持查看！",type:"error"})},redirectClick:function(){Ss.push({path:"que"})},redirectHistoryTaskClick:function(e){var t=this,a=e.query_id,o=e.query_name;N.get("/task/queryLog/"+a).then(function(e){console.log(e.data),sessionStorage.setItem("sub_history",S()(e.data));for(var s=t.exploreResult.tasks,n=-1,i=0;i<s.length;i++)s[i].id===a&&(n=i);-1===n&&t.exploreResult.tasks.push({id:a,name:o,process:0}),t.loadHistory()}).catch(function(e){console.log(e)})},filterHistoryTask:function(e){for(var t=[],a=0;a<e.length;a++)console.log(e[a]),"sql查询"===e[a].type&&t.push(e[a]);return t},loadTaskData:function(){var e=this;e.taskLoading=!0,e.taskForm.session=Object(r.e)("_adtech_user");var t="/task/log/config?session="+this.taskForm.session+"&startDate="+this.taskForm.startDate+"&date="+this.taskForm.date+"&status="+this.taskForm.status;N.get(t).then(function(t){e.taskLoading=!1,e.taskCols=t.data.cols,e.taskData=e.filterHistoryTask(t.data.data)}).catch(function(e){console.log(e)})}},computed:{codemirror:function(){return console.log("计算了"),this.$refs.cmEditor.codemirror},verifyButtonText:function(){return this.onVerify?"校验中":"校验sql"}},mounted:function(){var e=this;N.get("/jdbc/template/getviewaccess").then(function(t){!0===t.data.viewaccess&&(e.viewAccess=!0),console.log("Access"),console.log(e.viewAccess)}).catch(function(e){console.log(e)}),$(document).ready(function(){var e=document.body.clientHeight;console.log(e);var t=document.getElementById("resize"),a=document.getElementById("top"),o=document.getElementById("down"),s=document.getElementById("box"),n=document.getElementById("treeDiv");s.style.height=e-120+"px",a.style.height=.5*(e-120)+"px",o.style.height=.5*(e-120)+"px",n.style.height=e-120+"px";var i=a.offsetHeight-120+"px";console.log("codemirror:"+i),console.log("top:"+a.style.height),$(".CodeMirror").css("height",i),t.onmousedown=function(e){var n=e.clientY;return t.top=t.offsetTop,document.onmousemove=function(e){var i=e.clientY,l=t.top+(i-n),r=s.clientHeight-t.offsetHeight;l<30&&(l=30),l>r-30&&(l=r-30),t.style.top=l,a.style.height=l+"px",o.style.height=s.clientHeight-l-5+"px";var c=a.offsetHeight-120+"px";$(".CodeMirror").css("height",c)},document.onmouseup=function(e){document.onmousemove=null,document.onmouseup=null,t.releaseCapture&&t.releaseCapture()},t.setCapture&&t.setCapture(),!1}}),this.loadHistory(),this.timer=setInterval(this.setProcessBar,4e3)},beforeDestroy:function(){clearInterval(this.timer)}},R={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("SQL查询API")]),e._v(" "),a("el-col",{staticStyle:{"padding-right":"5px"},attrs:{span:19}},[a("div",{attrs:{id:"box"}},[a("div",{attrs:{id:"top"}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-row",{staticStyle:{"margin-bottom":"-10px"}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-col",{attrs:{span:6}},[a("el-input",{attrs:{size:"small",placeholder:"请输入任务名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticStyle:{"margin-left":"5px"}},[a("el-select",{attrs:{placeholder:"请选择数据源类型",size:"small",clearable:"",filterable:""},on:{change:e.onChangeDSType},model:{value:e.datasource.typeSelectValue,callback:function(t){e.$set(e.datasource,"typeSelectValue",t)},expression:"datasource.typeSelectValue"}},e._l(e.datasource.typeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1)]),e._v(" "),a("el-col",{attrs:{span:7,offset:7}},[a("el-select",{attrs:{placeholder:"请选择数据源",size:"small",clearable:"",filterable:""},on:{change:e.onChangeDataSource},model:{value:e.datasource.selectValue,callback:function(t){e.$set(e.datasource,"selectValue",t)},expression:"datasource.selectValue"}},e._l(e.datasource.options,function(e){return a("el-option",{key:e.dsid,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onClickSave()}}},[e._v("保存")])],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{prop:"sql"}},[a("codemirror",{ref:"cmEditor",attrs:{options:e.cmOptions},model:{value:e.form.sql,callback:function(t){e.$set(e.form,"sql",t)},expression:"form.sql"}})],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"-7px"},attrs:{gutter:20}},[a("el-col",{attrs:{span:14}},[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("div",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"clickhouse"!==e.datasource.typeSelectValue,expression:"datasource.typeSelectValue!=='clickhouse'"}],staticStyle:{"margin-right":"13px"},attrs:{size:"small",disabled:e.onVerify},on:{click:e.verifySql}},[e._v("\n                  "+e._s(e.verifyButtonText)+"\n                ")])],1),e._v(" "),a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"dummyUrl",limit:1,"file-list":e.fileList,"auto-upload":!1,"before-upload":e.beforeUpload,"on-exceed":e.onExceed}},[e.visibility?a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选取查询词文件")]):e._e(),e._v(" "),e.visibility?a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitFile}},[e._v("上传到服务器\n                ")]):e._e(),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticStyle:{color:"#BDBDBD","font-size":"12px"}},[e._v(e._s(e.uploadTableName))])],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:10}},[a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.formatCode()}}},[e._v("格式化")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.onReset("form")}}},[e._v("重置")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",disabled:e.isOnSubmit},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.viewAccess,expression:"(viewAccess)"}],attrs:{size:"small",type:"primary",disabled:e.disableRedashCreteBtn},on:{click:function(t){return e.onCreateSqlView()}}},[e._v("\n              生成可视化\n            ")])],1)],1)],1),e._v(" "),a("div",{attrs:{id:"resize"}},[a("el-divider",[a("i",{staticClass:"el-icon-d-caret"})])],1),e._v(" "),a("div",{attrs:{id:"down"}},[a("span",{staticStyle:{display:"block","font-weight":"bold"}},[e._v("表预览 "+e._s(e.explorerTable.tableName))]),e._v(" "),a("el-tabs",{attrs:{"tab-position":"top",type:"border-card"},on:{"tab-click":e.onClickTab}},[a("el-tab-pane",{attrs:{label:"字段"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.fieldLoading,expression:"fieldLoading"}],staticStyle:{width:"80%"},attrs:{data:e.fieldList,stripe:"","default-sort":{prop:"",order:"descending"}},on:{"cell-dblclick":e.onRightClickFields}},[a("el-table-column",{key:"fieldName",attrs:{prop:"fieldName",label:"字段名称",sortable:"true"}}),e._v(" "),a("el-table-column",{key:"fieldType",attrs:{prop:"fieldType",label:"字段类型",sortable:"true"}}),e._v(" "),a("el-table-column",{key:"description",attrs:{prop:"description",label:"描述",sortable:"true"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.partitionDataList.length>0,expression:"partitionDataList.length>0"}]},[a("h4",[e._v("分区字段")]),e._v(" "),a("el-col",{attrs:{span:"15"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.partitionDataList,stripe:"","default-sort":{prop:"",order:"descending"}}},[a("el-table-column",{key:"fieldName",attrs:{prop:"fieldName",label:"字段名称",sortable:"true"}}),e._v(" "),a("el-table-column",{key:"fieldType",attrs:{prop:"fieldType",label:"字段类型",sortable:"true"}})],1)],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"表信息"}},[a("el-form",{ref:"tableForm",attrs:{model:e.tableForm,"label-width":"120px"}},[a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"表名称 : ",size:"small"}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.tableName,callback:function(t){e.$set(e.tableForm,"tableName",t)},expression:"tableForm.tableName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"所属库 : ",size:"small"}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.database,callback:function(t){e.$set(e.tableForm,"database",t)},expression:"tableForm.database"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"7"}},[a("el-form-item",{attrs:{label:"创建者 : ",size:"small"}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.creator,callback:function(t){e.$set(e.tableForm,"creator",t)},expression:"tableForm.creator"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:"7"}},[a("el-form-item",{attrs:{label:"创建时间 : ",size:"small"}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.createTime,callback:function(t){e.$set(e.tableForm,"createTime",t)},expression:"tableForm.createTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"表类型 : ",size:"small"}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.tableType,callback:function(t){e.$set(e.tableForm,"tableType",t)},expression:"tableForm.tableType"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"14"}},[a("el-form-item",{attrs:{label:"文件存储位置 : "}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.location,callback:function(t){e.$set(e.tableForm,"location",t)},expression:"tableForm.location"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:"7"}},[a("el-form-item",{attrs:{label:"压缩方式 : "}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.compressMode,callback:function(t){e.$set(e.tableForm,"compressMode",t)},expression:"tableForm.compressMode"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"21"}},[a("el-form-item",{attrs:{label:"描述 : "}},[a("el-input",{attrs:{readonly:!0},model:{value:e.tableForm.description,callback:function(t){e.$set(e.tableForm,"description",t)},expression:"tableForm.description"}})],1)],1)],1)],1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"数据预览"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.exploreData.loading,expression:"exploreData.loading"}],staticStyle:{width:"100%"},attrs:{"element-loading-text":"拼命加载中","element-loading-spinner":"el-icon-loading",data:e.exploreData.dataList,stripe:"","default-sort":{prop:"",order:"descending"}}},e._l(e.exploreData.tableColumn,function(e){return a("el-table-column",{key:e.field,attrs:{prop:e.field,label:e.title,sortable:!0}})}),1)],1),e._v(" "),a("el-tab-pane",{attrs:{label:"历史任务"}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.taskLoading,expression:"taskLoading"}],staticStyle:{width:"100%"},attrs:{data:e.taskData,stripe:"","default-sort":{prop:"last_update",order:"descending"}}},[e._l(e.taskCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"异常"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:4==t.row.status_code,expression:"scope.row.status_code==4"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.checkHistoryMessage(t.row)}}},[e._v("查看异常\n                  ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.pathClick(t.row)}}},[e._v("下载结果")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.redirectHistoryTaskClick(t.row)}}},[e._v("查看任务SQL")])]}}])})],2)],1),e._v(" "),e._l(e.exploreResult.tasks,function(t,o){return a("el-tab-pane",{key:t.id,attrs:{label:t.name,name:t.id}},[a("el-form",{ref:"curTaskRes",refInFor:!0,attrs:{model:e.curTaskRes}},[a("el-form-item",{staticStyle:{"margin-bottom":"1px"},attrs:{label:"任务id:"}},[e._v("\n                "+e._s(t.id)+"\n                "),a("el-button",{staticStyle:{"margin-left":"20px"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.removeTab()}}},[e._v("关闭")])],1),e._v(" "),a("el-form-item",{staticStyle:{"margin-bottom":"1px"},attrs:{label:"状态:"}},[e._v("\n                "+e._s(e.curTaskRes.status)+"\n\n                "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"任务取消"===e.curTaskRes.status,expression:"curTaskRes.status==='任务取消'"}],staticStyle:{"margin-left":"30px"},attrs:{size:"mini",type:"danger"},on:{click:function(t){return e.checkMessage()}}},[e._v("查看错误\n                ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"任务完成"===e.curTaskRes.status,expression:"curTaskRes.status==='任务完成'"}],staticStyle:{"margin-left":"30px"},attrs:{size:"small",type:"primary"},on:{click:function(t){return e.downloadTaskResult()}}},[e._v("下载结果\n                ")])],1)],1),e._v(" "),a("el-progress",{attrs:{"text-inside":!0,"stroke-width":24,percentage:e.curTaskRes.process,status:"success"}}),e._v(" "),a("pl-table",{directives:[{name:"loading",rawName:"v-loading",value:e.curTaskRes.dataLoading,expression:"curTaskRes.dataLoading"}],ref:"plTable",refInFor:!0,attrs:{selectTrClass:"selectTr","max-height":500,"use-virtual":!0,"header-drag-style":"",fixedColumnsRoll:"","inverse-current-row":""}},[a("template",{slot:"empty"},[e._v("\n                没有查询到符合条件的记录\n              ")]),e._v(" "),e._l(e.curTaskRes.contentCols,function(e){return a("pl-table-column",{key:e.id,attrs:{resizable:!0,"show-overflow-tooltip":!0,prop:e.prop,label:e.label,fixed:e.fixed}})})],2)],1)})],2)],1)])]),e._v(" "),a("el-col",{attrs:{span:5}},[a("div",{attrs:{id:"treeDiv"}},[a("el-tabs",{model:{value:e.activeRightTabs,callback:function(t){e.activeRightTabs=t},expression:"activeRightTabs"}},[a("el-tab-pane",{attrs:{label:"库表结构",name:"first"}},[e._v("\n          库表结构\n          "),a("el-input",{attrs:{placeholder:"输入关键字过滤",size:"small"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return a("span",{staticClass:"el-tree-node__content"},[a("span",{on:{click:function(t){return e.onClickTree(s)},dblclick:function(t){return e.rightClickTree(s)}}},[e._v(e._s(o.label))])])}}])})],1),e._v(" "),a("el-tab-pane",{attrs:{label:"字段索引",name:"second"}},[e._v("字段索引\n          "),a("el-row",[a("el-col",{staticStyle:{"padding-right":"-10px"},attrs:{span:19}},[a("el-input",{attrs:{placeholder:"查询包含该字段的表",size:"small"},nativeOn:{keydown:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.searchField(t)}},model:{value:e.searchFieldName,callback:function(t){e.searchFieldName=t},expression:"searchFieldName"}})],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.searchField}},[e._v("查询")])],1)],1),e._v(" "),a("el-tree",{ref:"indexFieldTree",attrs:{data:e.fieldIndexData,props:e.defaultProps,"filter-node-method":e.filterNode},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return a("span",{staticClass:"el-tree-node__content"},[a("span",{on:{click:function(t){return e.onClickSearchFieldTree(s)},dblclick:function(t){return e.rightClickTree(s)}}},[e._v(e._s(o.label))])])}}])})],1)],1)],1)]),e._v(" "),a("el-dialog",{attrs:{title:"保存至工单",visible:e.saveOption.showDialog},on:{"update:visible":function(t){return e.$set(e.saveOption,"showDialog",t)},close:function(t){return e.closeDialog()}}},[a("span",{staticStyle:{color:"red","font-size":"12px"}},[e._v(e._s(e.nodeData.label+"  -  "+e.saveOption.wsName))]),e._v(" "),a("el-row",{staticStyle:{"margin-bottom":"10px"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"输入存储名称",size:"small"},model:{value:e.saveOption.wsName,callback:function(t){e.$set(e.saveOption,"wsName",t)},expression:"saveOption.wsName"}})],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{attrs:{size:"mini",type:"primary"},on:{click:function(t){return e.submitNewWs()}}},[e._v("提交")])],1)],1),e._v(" "),a("div",{staticStyle:{height:"500px",overflow:"auto"}},[a("el-tree",{ref:"wsTree",attrs:{data:e.wsTree,props:e.defaultProps,"filter-node-method":e.filterNode,accordion:""},on:{"node-click":e.onClickWSTree}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.menuVisible,expression:"menuVisible"}],on:{mouseleave:function(t){e.menuVisible=!e.menuVisible}}},[a("button",{staticClass:"el-button el-button--small",attrs:{id:"menu"},on:{click:e.treeAdd}},[e._v("在该节点下创建模板")])])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"异常信息",visible:e.curTaskRes.errDialogVisible,width:"50%"},on:{"update:visible":function(t){return e.$set(e.curTaskRes,"errDialogVisible",t)}}},[a("el-input",{attrs:{type:"textarea",placeholder:"无异常内容显示",rows:20,"max-rows":30,readonly:!0},model:{value:e.curTaskRes.errMsg,callback:function(t){e.$set(e.curTaskRes,"errMsg",t)},expression:"curTaskRes.errMsg"}})],1),e._v(" "),a("el-dialog",{attrs:{title:"异常信息",visible:e.historyDialogVisible,width:"50%"},on:{"update:visible":function(t){e.historyDialogVisible=t}}},[a("el-input",{attrs:{type:"textarea",placeholder:"无异常内容显示",rows:20,"max-rows":30,readonly:!0},model:{value:e.historyErrMsg,callback:function(t){e.historyErrMsg=t},expression:"historyErrMsg"}})],1)],1)},staticRenderFns:[]};var E=a("VU/8")(O,R,!1,function(e){a("y82h")},"data-v-87958c06",null).exports,A=a("zL8q"),L=a.n(A),P=a("uXZL"),M=a.n(P),U=a("lDdF"),V=a.n(U),j=a("mtWM"),B={data:function(){return{taskSwitch:!1,taskCols:[],taskData:[],taskForm:{session:"",date:Object(r.d)(new Date),startDate:Object(r.d)(new Date((new Date).getTime()-6048e5)),status:""},contentCols:[],contentData:[],contentFiled:"",dialogTableVisible:!1,taskLoading:!1,dataLoading:!1,dataPathRoot:"",dataPathRootPaga:"",dialogVisible:!1,errMsg:"",maxHeight:""}},methods:{checkMessage:function(e){this.errMsg="",this.dialogVisible=!0;var t=this,a={queryId:e.query_id};j.post("/task/checkException",a,{responseType:"json"}).then(function(e){t.errMsg=e.data.res}).catch(function(e){console.error(e)})},thisType2route:function(e){var t=Object(r.n)(e);return console.log(t),t},pathClick:function(e){var t=e.status_code,a=e.data_path;if(-1===a.indexOf("xlsx")&&(a+=".csv"),console.log(a),Object(r.g)(t)||Object(r.h)(t)){var o=this.dataPathRoot+"datacenter/"+a+"?op=OPEN";this.dataPathRoot;Object(r.h)(t)&&(o=this.dataPathRootPaga+a+"?op=OPEN",this.dataPathRootPaga+"\n"+a+"?op=OPEN"),window.open(o)}else this.$message({message:"任务没有正常完成，不支持查看！",type:"error"})},dataClick:function(e){var t=this,a=e.status_code,o=e.data_path;if(Object(r.g)(a)||Object(r.h)(a)){t.dialogTableVisible=!0,t.dataLoading=!0;var s=new URLSearchParams;s.append("data_path",o),s.append("status",a),void 0!==t.$refs.plTable&&t.$refs.plTable.reloadData([]),j({method:"post",url:"/task/data/path",data:s}).then(function(e){var a=e.data;if(t.dataLoading=!1,a.Res){var o=JSON.parse(a.Info);t.contentCols=o.cols,t.contentData=o.data,null!==o.data&&void 0!==o.data.length&&t.$refs.plTable.reloadData(t.contentData)}else t.dataLoading=!1,t.$message({message:a.Info,type:"error"})}).catch(function(e){t.dataLoading=!1,t.$message({message:e,type:"error"}),console.log(e)})}else t.$message({message:"任务没有正常完成，不支持查看！",type:"error"})},killJobById:function(e){var t=this,a={queryId:e.query_id};t.$confirm("确认kill任务吗","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){j.post("/task/killByJobId",a,{responseType:"json"}).then(function(e){var a=e.data;console.log(a),a.Res?t.$message({message:"任务已被kill",type:"success"}):t.$message({message:a.Info,type:"error"})}).catch(function(e){t.$message({message:"重跑失败！"+e.toString(),type:"error"})})})},redirectClick:function(e){var t=e.query_id,a=Object(r.n)(e.type);if(a)switch(a){case"jdbc":j.get("/task/queryLog/"+t).then(function(e){console.log(e.data),sessionStorage.setItem("jdbc_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)});break;case"sql":j.get("/task/queryLog/"+t).then(function(e){console.log(e.data),sessionStorage.setItem("sub_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)});break;default:j.get("/task/log/query/"+t).then(function(e){sessionStorage.setItem("sub_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)})}else this.$message({message:"任务类型不支持查看配置！",type:"error"})},reRun:function(e){var t=this,a=e.query_id;console.log("queryId:"+a+", taskType:"+e.type);var o={queryId:a};j.post("/task/reRun",o,{responseType:"json"}).then(function(e){console.info(e.data.queryId),t.$confirm("重跑成功, 点击确定刷新页面","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){location.reload()})}).catch(function(e){t.$message({message:"重跑失败！"+e.toString(),type:"error"})})},exportExcel:function(){var e=M.a.utils.table_to_book(document.querySelector("#plTable")),t=M.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{V.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"查询结果表.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t},loadTaskData:function(){var e=this;e.taskLoading=!0,this.taskSwitch?e.taskForm.session="":e.taskForm.session=Object(r.e)("_adtech_user");var t="/task/log/config?session="+this.taskForm.session+"&startDate="+this.taskForm.startDate+"&date="+this.taskForm.date+"&status="+this.taskForm.status;j.get(t).then(function(t){e.taskLoading=!1,e.taskCols=t.data.cols,e.taskData=t.data.data}).catch(function(e){console.log(e)})}},mounted:function(){this.loadTaskData(),this.maxHeight=.8*document.body.clientHeight-100+"px",console.log(this.maxHeight)},created:function(){var e=this;j.get("/task/log/rsync").then(function(t){e.dataPathRoot=t.data[0],e.dataPathRootPaga=t.data[1]}).catch(function(e){console.log(e)})}},q={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("任务队列")]),e._v(" "),a("el-row",[a("el-form",{attrs:{inline:"","label-width":"75px"}},[a("el-form-item",{attrs:{label:"开始时间:"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:e.loadTaskData},model:{value:e.taskForm.startDate,callback:function(t){e.$set(e.taskForm,"startDate",t)},expression:"taskForm.startDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"结束时间:"}},[a("el-date-picker",{staticStyle:{width:"100%"},attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:e.loadTaskData},model:{value:e.taskForm.date,callback:function(t){e.$set(e.taskForm,"date",t)},expression:"taskForm.date"}})],1),e._v(" "),a("el-form-item",{staticStyle:{float:"right","margin-right":"25px"}},[a("el-select",{attrs:{size:"mini",placeholder:"选择任务状态"},on:{change:e.loadTaskData},model:{value:e.taskForm.status,callback:function(t){e.$set(e.taskForm,"status",t)},expression:"taskForm.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),a("el-option",{attrs:{label:"任务提交中",value:"0"}}),e._v(" "),a("el-option",{attrs:{label:"任务执行中",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"任务正在取消",value:"2"}}),e._v(" "),a("el-option",{attrs:{label:"任务完成",value:"3"}}),e._v(" "),a("el-option",{attrs:{label:"任务取消",value:"4"}})],1)],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.taskLoading,expression:"taskLoading"}],staticStyle:{width:"100%"},attrs:{data:e.taskData,stripe:"","default-sort":{prop:"last_update",order:"descending"}}},[e._l(e.taskCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"异常"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:4==t.row.status_code,expression:"scope.row.status_code==4"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.checkMessage(t.row)}}},[e._v("查看异常\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"210"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.pathClick(t.row)}}},[e._v("下载结果")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.dataClick(t.row)}}},[e._v("查看数据")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.redirectClick(t.row)}}},[e._v("查看配置")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.killJobById(t.row)}}},[e._v("kill任务")])]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:"异常信息",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-input",{attrs:{type:"textarea",placeholder:"无异常内容显示",rows:20,"max-rows":30,readonly:!0},model:{value:e.errMsg,callback:function(t){e.errMsg=t},expression:"errMsg"}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查询结果",visible:e.dialogTableVisible,width:"70%"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",[a("span",[e._v(" 该表为样例数据，最多展现5000条。")])]),e._v(" "),a("pl-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],ref:"plTable",attrs:{id:"resTable",selectTrClass:"selectTr","use-virtual":!0,"max-height":500,"header-drag-style":"",fixedColumnsRoll:"","inverse-current-row":""}},[a("template",{slot:"empty"},[e._v("\n        没有查询到符合条件的记录\n      ")]),e._v(" "),e._l(e.contentCols,function(e){return a("pl-table-column",{key:e.id,attrs:{resizable:!0,"show-overflow-tooltip":!0,prop:e.prop,label:e.label,fixed:e.fixed}})})],2)],1)],1)},staticRenderFns:[]};var H=a("VU/8")(B,q,!1,function(e){a("vPQN")},null,null).exports,z=new Date;z.setTime(z.getTime()-864e5);var J={yesterday:z,dateOptions:{shortcuts:[{text:"最近三天",onClick:function(e){var t=new Date,a=new Date;t.setTime(t.getTime()-864e5),a.setTime(a.getTime()-2592e5),e.$emit("pick",[a,t])}},{text:"最近一周",onClick:function(e){var t=new Date,a=new Date;t.setTime(t.getTime()-864e5),a.setTime(a.getTime()-6048e5),e.$emit("pick",[a,t])}},{text:"最近两周",onClick:function(e){var t=new Date,a=new Date;t.setTime(t.getTime()-864e5),a.setTime(a.getTime()-12096e5),e.$emit("pick",[a,t])}}]},dateRange:[Object(r.c)(z),Object(r.c)(z)],provincesChina:[{label:"华北地区",children:["北京","天津","河北","内蒙古","山西"]},{label:"东北地区",children:["黑龙江","吉林","辽宁"]},{label:"华东地区",children:["上海","福建","江苏","江西","山东","浙江"]},{label:"华中地区",children:["河南","湖北","湖南"]},{label:"华南地区",children:["广东","广西","海南"]},{label:"西南地区",children:["重庆","贵州","四川","西藏","云南"]},{label:"西北地区",children:["甘肃","宁夏","青海","陕西","新疆"]},{label:"其他地区",children:["港澳台及海外","无此地区"]},{label:"全国",children:["全国"]}],nameRule:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,message:"长度至少在 3 个字符",trigger:"blur"}]},strictRules:{name:[{required:!0,message:"请输入名称",trigger:"blur"},{min:3,message:"名称长度至少 3 个字符",trigger:"blur"}],dimensions:[{type:"array",required:!0,message:"请选择查询维度",trigger:"change"}],outputs:[{type:"array",required:!0,message:"请选择输出指标",trigger:"change"}]},abtestAdPosUp:["0","1","2","3","4","5","6","7"],abtestAdPosMid:["8","9"],abtestAdPosDown:["10","11","12","13","14","15"],abtestAdPosUpPc:["0","1","2","3","4","5","6","7","8","9","10"],abtestAdPosDownPc:["11","12","13","14","15"],abtestIP:{north:["10.134.115.72","10.134.115.73","10.134.115.74","10.134.89.114","10.139.17.51","10.139.17.52","10.139.17.53","10.139.17.54","10.139.20.72"],south:["10.135.8.67","10.135.8.68","10.135.8.69","10.135.8.70","10.135.8.71","10.135.8.72"],jiangsu:["10.140.19.110","10.140.19.123","10.140.20.22"],pc:["10.134.89.114","10.139.20.72","10.139.20.59","10.134.89.115","10.134.105.25","10.139.36.56","10.139.21.59","10.134.81.56","10.135.73.91","10.135.73.92","10.135.73.93","10.140.11.39","10.140.19.67","10.140.11.22"],wap:["10.139.17.51","10.139.20.71","10.134.73.35","10.139.35.58","10.134.89.67","10.139.20.52","10.134.104.119","10.134.105.24","10.139.36.101","10.135.8.67","10.135.66.32","10.135.66.41","10.135.73.41","10.135.73.90","10.140.19.110","10.140.11.23","10.140.26.80","10.140.26.81"]},wapBase:{"日期":"RQ","月份":"RQ_YUEFEN","季度":"RQ_JIDU","查询词":"CXC","一级查询词行业":"CXCHY_YIJI","二级查询词行业":"CXCHY_ERJI","一级渠道":"YJQD","二级渠道":"EJQD","网民区域":"WMQY"},wapBaseTotal:{"日期":"RQ","月份":"RQ_YUEFEN","季度":"RQ_JIDU","样式类别":"YSLB",PID:"PID","排位":"PW","深度":"SD","位置":"WZ","查询词":"CXC","查询词行业ID":"CXCID","一级查询词行业":"CXCHY_YIJI","二级查询词行业":"CXCHY_ERJI","一级渠道":"YJQD","二级渠道":"EJQD","二级业务类型":"EJYWLX","三级业务类型":"SJYWLX","业务类型ID":"YWLXID","大区":"DQ","网民区域":"WMQY"},wapGG:{"关键词ID":"GJCID","关键词":"GJC","创意ID":"CYID","客户ID":"KHID","计划ID":"JHID","计划名称":"JHMC","组ID":"ZID","组名称":"ZMC","广告类型":"GGLX"},wapKH:{"客户ID":"KHID","客户名称":"KHMC","客户属性":"KHSX","一级客户行业":"YJKHHY","二级客户行业":"EJKHHY","三级客户行业":"SJKHHY","客户类型":"KHLX","代理商ID":"DLSID","代理商名称":"DLSMC"},wapOutputs:{PV1:"PV1",PV2:"PV2",PV3:"PV3","点击":"DJ","消耗":"XH"},pcBase:{"日期":"RQ","月份":"RQ_YUEFEN","季度":"RQ_JIDU","查询词":"CXC","一级查询词行业":"CXCHY_YIJI","二级查询词行业":"CXCHY_ERJI","一级渠道":"YJQD","二级渠道":"EJQD","网民区域":"WMQY"},pcBaseTotal:{"日期":"RQ","月份":"RQ_YUEFEN","季度":"RQ_JIDU","一级渠道":"YJQD","二级渠道":"EJQD",PID:"PID","查询词":"CXC","查询词行业ID":"CXCID","一级查询词行业":"CXCHY_YIJI","二级查询词行业":"CXCHY_ERJI","二级业务类型":"EJYWLX","三级业务类型":"SJYWLX","业务类型ID":"YWLXID","大区":"DQ","网民区域":"WMQY","深度":"SD"},pcGG:{"关键词ID":"GJCID","关键词":"GJC","创意ID":"CYID","计划ID":"JHID","计划名称":"JHMC","组ID":"ZID","组名称":"ZMC","广告类型":"GGLX","样式类别":"YSLB","排位":"PW"},pcKH:{"客户ID":"KHID","客户名称":"KHMC","客户属性":"KHSX","客户类型":"KHLX","代理商ID":"DLSID","代理商名称":"DLSMC","一级客户行业":"YJKHHY","二级客户行业":"EJKHHY","三级客户行业":"SJKHHY"},pcOutputs:{PV1:"PV1",PV2:"PV2",PV3:"PV3","点击":"DJ","消耗":"XH"},galaxyBase:{"日期":"RQ",PID:"PID","查询词":"CXC","二级业务类型":"EJYWLX","三级业务类型":"SJYWLX","大区":"DQ","网民区域":"WMQY"},galaxyGG:{"关键词ID":"GJCID","关键词":"GJC","创意ID":"CYID","计划ID":"JHID","计划名称":"JHMC","组ID":"ZID","组名称":"ZMC"},galaxyKH:{"客户ID":"KHID","客户名称":"KHMC","客户类型":"KHLX","一级客户行业":"YJKHHY","二级客户行业":"EJKHHY","代理商ID":"DLSID","代理商名称":"DLSMC"}},G=a("VU/8")(J,null,!1,null,null,null).exports,Y=a("mtWM"),W={data:function(){return{isOnSubmit:!1,wapRules:G.strictRules,dateOptions:G.dateOptions,optionsBase:G.wapBase,optionsGG:G.wapGG,optionsKH:G.wapKH,optionsOutputs:G.wapOutputs,filterOptions:{cxchy_yiji_options:[],cxchy_erji_options:[],wmqy_options:G.provincesChina,yjkhhy_options:[],ejkhhy_options:[],sjkhhy_options:[],khlx_options:[],dq_options:[],ejywlx_options:[],sjywlx_options:[],yslb_options:[],yjqd_options:[],ejqd_options:[],wz_options:[],pw_options:[],sd_options:[],gglx_options:[],llpt_options:[],sjly_options:[]},wapForm:{date:G.dateRange,dimensions:[],filters:{DLSID:{name:"DLSID",values:[],type:"IN"},KHID:{name:"KHID",values:[],type:"IN"},CXC:{name:"CXC",values:[],type:"QW_AM"},JHID:{name:"JHID",values:[],type:"IN"},ZID:{name:"ZID",values:[],type:"IN"},PID:{name:"PID",values:[],type:"IN"},GJC:{name:"GJC",values:[],type:"IN"},GJCID:{name:"GJCID",values:[],type:"IN"},CXCHY_YIJI:{name:"CXCHY_YIJI",values:[],type:"IN"},CXCHY_ERJI:{name:"CXCHY_ERJI",values:[],type:"IN"},WMQY:{name:"WMQY",values:[],type:"IN"},YJKHHY:{name:"YJKHHY",values:[],type:"IN"},EJKHHY:{name:"EJKHHY",values:[],type:"IN"},SJKHHY:{name:"SJKHHY",values:[],type:"IN"},KHLX:{name:"KHLX",values:[],type:"IN"},DQ:{name:"DQ",values:[],type:"IN"},EJYWLX:{name:"EJYWLX",values:[],type:"IN"},SJYWLX:{name:"SJYWLX",values:[],type:"IN"},YSLB:{name:"YSLB",values:[],type:"IN"},YJQD:{name:"YJQD",values:[],type:"IN"},EJQD:{name:"EJQD",values:[],type:"IN"},WZ:{name:"WZ",values:[],type:"IN"},PW:{name:"PW",values:[],type:"IN"},SD:{name:"SD",values:[],type:"IN"},GGLX:{name:"GGLX",values:[],type:"IN"}},outputs:[],limitNumber:"",orderColumns:[],name:""},queryId:"",errorMsg:"",queryWordFile:"",orderOptions:[]}},methods:{isProcessing:function(){return this.isOnSubmit},changeOrderColumns:function(){var e=this.wapForm.outputs,t=this.optionsOutputs,a=[];e.forEach(function(e){for(var o in t)t[o]===e&&a.push({key:o,value:e})}),this.orderOptions=a},onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&t.$confirm("确认选择了所需的全部条件","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var e=[];for(var o in t.wapForm.filters)if(!Object(r.f)(t.wapForm.filters[o].values)){if("string"==typeof t.wapForm.filters[o].values){var s=t.wapForm.filters[o].values;t.wapForm.filters[o].values=s.split(",")}e.push(t.wapForm.filters[o])}var n=new FormData;n.append("typeName","无线_query"),n.append("qwFile",t.wapForm.filters.CXC.values);var i=[];for(var l in t.optionsOutputs)i.push(t.optionsOutputs[l]);console.log(i);var c=t.wapForm.outputs.sort(function(e,t){return i.indexOf(e)-i.indexOf(t)});n.append("queryJSON",S()({dimensions:t.wapForm.dimensions,filters:e,outputs:c,date:t.wapForm.date,name:t.wapForm.name,orderColumns:t.wapForm.orderColumns,limitNum:t.wapForm.limitNumber})),console.log(n),a.isOnSubmit=!0,Y.post("/jone/combination",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){a.queryId=e.data,a.$options.methods.msgNotify.bind(a)(),a.isOnSubmit=!1}).catch(function(e){a.errorMsg=e,a.$options.methods.errorNotify.bind(a)(),a.isOnSubmit=!1})})})},onReset:function(e){this.$refs[e].resetFields()},redirectClick:function(){Ss.push({path:"que"})},msgNotify:function(){this.$notify({title:this.queryId,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},errorNotify:function(){this.$notify.error({title:"错误",message:this.errorMsg})},beforeUploadDLSID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.DLSID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadKHID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.KHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadCXC:function(e){var t=this;this.queryWordFile=e;var a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.CXC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadJHID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.JHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadZID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.ZID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.PID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJC:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.GJC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJCID:function(e){var t=this,a=new FormData;return a.append("file",e),Y.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.GJCID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},getOptions:function(){var e=this;Y({method:"post",url:"dw/sql/options_wap/date",data:this.wapForm.date}).then(function(t){var a=t.data;for(var o in a)e.filterOptions[o]=a[o]}).catch(function(e){console.log(e)})},loadHistory:function(){var e=this,t=JSON.parse(sessionStorage.getItem("sub_history"));if(sessionStorage.removeItem("sub_history"),t)try{e.wapForm.dimensions=t.dimensions,e.wapForm.date=t.date,e.wapForm.outputs=t.outputs,e.wapForm.limitNumber=t.limitNum;var a=t.filters;e.changeOrderColumns(),e.wapForm.orderColumns=t.orderColumns,a.forEach(function(t){e.wapForm.filters[t.name].values=t.values,e.wapForm.filters[t.name].type=t.type})}catch(e){this.onReset("wapForm")}}},created:function(){this.getOptions()},computed:{onProcessing:function(){return this.isProcessing()},buttonText:function(){return this.isProcessing()?"提交中":"确定"},buttonIcon:function(){return this.isProcessing()?"el-icon-loading":""}},mounted:function(){this.loadHistory()}},K={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wap"},[a("el-form",{ref:"wapForm",attrs:{model:e.wapForm,size:"medium",rules:e.wapRules,"label-width":"110px"}},[a("h3",[e._v("无线查询维度")]),e._v(" "),a("el-form-item",{attrs:{prop:"dimensions","label-width":"0px"}},[a("el-checkbox-group",{model:{value:e.wapForm.dimensions,callback:function(t){e.$set(e.wapForm,"dimensions",t)},expression:"wapForm.dimensions"}},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("基本")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.optionsBase,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("筛选条件")]),e._v(" "),a("div",{staticClass:"filters"},[a("el-row",[a("el-form-item",{attrs:{label:"起止日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd","picker-options":e.dateOptions},on:{change:e.getOptions},model:{value:e.wapForm.date,callback:function(t){e.$set(e.wapForm,"date",t)},expression:"wapForm.date"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"查询词",prop:"filters.CXC.values"}},[a("el-input",{model:{value:e.wapForm.filters.CXC.values,callback:function(t){e.$set(e.wapForm.filters.CXC,"values",t)},expression:"wapForm.filters.CXC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.CXC.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.CXC.type,callback:function(t){e.$set(e.wapForm.filters.CXC,"type",t)},expression:"wapForm.filters.CXC.type"}},[a("el-option",{attrs:{label:"精确匹配",value:"QW_AM"}}),e._v(" "),a("el-option",{attrs:{label:"模糊匹配",value:"QW_FM"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"勾选提示"}},[a("div",[a("span",[e._v("选项太多找不到？直接搜索试试。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"一级查询词行业",prop:"filters.CXCHY_YIJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.CXCHY_YIJI.values,callback:function(t){e.$set(e.wapForm.filters.CXCHY_YIJI,"values",t)},expression:"wapForm.filters.CXCHY_YIJI.values"}},e._l(e.filterOptions.cxchy_yiji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"二级查询词行业",prop:"filters.CXCHY_ERJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.CXCHY_ERJI.values,callback:function(t){e.$set(e.wapForm.filters.CXCHY_ERJI,"values",t)},expression:"wapForm.filters.CXCHY_ERJI.values"}},e._l(e.filterOptions.cxchy_erji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"一级渠道",prop:"filters.YJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.YJQD.values,callback:function(t){e.$set(e.wapForm.filters.YJQD,"values",t)},expression:"wapForm.filters.YJQD.values"}},e._l(e.filterOptions.yjqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"二级渠道",prop:"filters.EJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.EJQD.values,callback:function(t){e.$set(e.wapForm.filters.EJQD,"values",t)},expression:"wapForm.filters.EJQD.values"}},e._l(e.filterOptions.ejqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"网民区域",prop:"filters.WMQY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.WMQY.values,callback:function(t){e.$set(e.wapForm.filters.WMQY,"values",t)},expression:"wapForm.filters.WMQY.values"}},e._l(e.filterOptions.wmqy_options,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.children,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("输出指标")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"基础指标",prop:"outputs"}},[a("el-col",[a("el-checkbox-group",{on:{change:e.changeOrderColumns},model:{value:e.wapForm.outputs,callback:function(t){e.$set(e.wapForm,"outputs",t)},expression:"wapForm.outputs"}},e._l(e.optionsOutputs,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"输出条数限制",prop:"limitNumber"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"不填表示没有限制"},model:{value:e.wapForm.limitNumber,callback:function(t){e.$set(e.wapForm,"limitNumber",t)},expression:"wapForm.limitNumber"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"指标排序",prop:"orderColumns"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.orderColumns,callback:function(t){e.$set(e.wapForm,"orderColumns",t)},expression:"wapForm.orderColumns"}},e._l(e.orderOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.key,value:e.value}})}),1),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"14px"}},[e._v("( 点击的顺序表示排序的指标顺序 )")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("任务信息")]),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.wapForm.name,callback:function(t){e.$set(e.wapForm,"name",t)},expression:"wapForm.name"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary",icon:e.buttonIcon,disabled:e.onProcessing},on:{click:function(t){return e.onSubmit("wapForm")}}},[e._v(e._s(e.buttonText))]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("wapForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},X=a("VU/8")(W,K,!1,null,null,null).exports,Q=a("mtWM"),Z=a.n(Q),ee={name:"",data:function(){return{activeIndex:"doc",isLimitWorkSheet:!1,urls:[],isCollapse:!1,userName:"",echoUser:"",userImg:"http://puboa.sogou-inc.com/moa/sylla/mapi/img?&s=1&w=128&id="+Object(r.e)("_adtech_user"),cacheMap:{},timer:null,imgHeight:"",imgs:["static/img/homePage1.png","static/img/homePage2.png"]}},methods:{cancelDrag:function(){document.getElementById("drag-div").onmousedown=null},drag:function(){var e=document.getElementById("drag-div");e.onmousedown=function(t){var a=t.clientX,o=document.getElementById("myLeft").offsetWidth;return document.onmousemove=function(e){var t=e.clientX-a;o+t>200&&o+t<500&&(document.getElementById("myLeft").style.width=o+t+"px")},document.onmouseup=function(t){document.onmousemove=null,document.onmouseup=null,e.releaseCapture&&e.releaseCapture()},e.setCapture&&e.setCapture(),!1}},_isMobile:function(){return navigator.userAgent.match(/(phone|pad|pod|iPhone|iPod|ios|iPad|Android|Mobile|BlackBerry|IEMobile|MQQBrowser|JUC|Fennec|wOSBrowser|BrowserNG|WebOS|Symbian|Windows Phone)/i)},setTestTime:function(){var e=this;Z.a.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){}),console.log("set timer sec186")},onSelect:function(e,t){if(console.log(e+":::"+t),e.startsWith("redashshow")){console.log("是报表");var a=e.split("/")[1],o=this.cacheMap[a];sessionStorage.setItem(a,o),console.log(a),this.$router.push({name:"redashshow",params:{redashname:a}})}else if(e.startsWith("dashboardshow")){console.log("是dashboard");var s=e.split("/")[1],n=this.cacheMap[s];sessionStorage.setItem(s,n),console.log(s),this.$router.push({name:"dashboardshow",params:{dashboardname:s}})}else e.startsWith("redashqueryshow")?console.log("--------------------jump to option web----------"):this.$router.push({name:e})},toggleCollapse:function(){this.isCollapse=!this.isCollapse,this.isCollapse?this.cancelDrag():this.drag()},loginOut:function(){Object(r.b)("SG_SSO"),this.$confirm("您确定要退出吗?","退出管理平台",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){Object(r.b)("_adtech_local_token"),Object(r.b)("_adtech_user");var e="http://datacenter.adtech.sogou/";-1!="BASE_API_REPLACE".search("pre")&&(e="http://pre.datacenter.adtech.sogou/"),window.location.href="https://login.sogou-inc.com/logout.jsp?appid=1812&sso_redirect="+e}).catch(function(e){console.log(e)})}},component:{Home:ae,SqlQuery:E,SecondComponent:H,NewJohn:X},computed:{isMobile:function(){return!!this._isMobile()}},mounted:function(){console.log(this.$route.path);var e=decodeURI(Object(r.e)("_adtech_user_name"));null!==e&&void 0!==e||(e=Object(r.e)("_adtech_user")),this.echoUser=e,this.userName=Object(r.e)("_adtech_user"),this.userImg="http://puboa.sogou-inc.com/moa/sylla/mapi/img?&s=1&w=128&id="+this.userName;var t=this.userName,a=this;function o(e){var t=JSON.parse(e),o=new T.a(x()(t)),s=!0,n=!1,i=void 0;try{for(var l,r=y()(o);!(s=(l=r.next()).done);s=!0){var c=l.value,d=w()(c,2),u=d[0],p=d[1];a.cacheMap[u]=p}}catch(e){n=!0,i=e}finally{try{!s&&r.return&&r.return()}finally{if(n)throw i}}}this.timer=setInterval(this.setTestTime,18e4),Z.a.get("/auth/labels/checked/"+t).then(function(e){a.urls=e.data;for(var t=0,s=e.data.length;t<s;t++){var n=e.data[t];if(null!==n.Info&&""!==n.Info&&o(n.Info),null!==n.Children&&0!==n.Children.length)for(var i=0,l=n.Children.length;i<l;i++){var r=n.Children[i];null!==r.Info&&""!==r.Info&&o(r.Info)}}}).catch(function(e){console.log(e)}),this.drag()},beforeDestroy:function(){clearInterval(this.timer)}},te={render:function(){var e=this,t=e.$createElement,o=e._self._c||t;return o("el-container",[o("el-aside",{directives:[{name:"show",rawName:"v-show",value:!e.isMobile,expression:"!isMobile"}],attrs:{width:"auto"}},[o("el-scrollbar",{staticStyle:{height:"100%"}},[o("el-row",[o("div",{staticStyle:{float:"right","margin-right":"25px","margin-top":"20px",cursor:"move"},attrs:{id:"drag-div"}},[o("i",{staticClass:"el-icon-s-unfold",staticStyle:{"font-size":"25px",color:"white"},on:{click:function(t){return e.toggleCollapse()}}})])]),e._v(" "),o("el-menu",{staticClass:"el-menu-vertical-demo",attrs:{"default-active":e.activeIndex,router:!1,collapse:e.isCollapse,"collapse-transition":!0,"background-color":"#304156","text-color":"#fff","active-text-color":"#ffd04b","unique-opened":!0,id:"myLeft"},on:{select:e.onSelect}},[e._l(e.urls,function(t,a){return[null!=t.Children&&t.Children.length>0?o("el-submenu",{attrs:{index:t.Index}},[o("template",{slot:"title"},[o("i",{class:t.Class}),e._v(" "),o("span",{attrs:{slot:"title"},slot:"title"},[e._v(e._s(t.Title))])]),e._v(" "),o("el-menu-item-group",[e._l(t.Children,function(t){return[o("el-menu-item",{attrs:{index:t.Index}},[e._v(e._s(t.Title))])]})],2)],2):e._e(),e._v(" "),null===t.Children||0===t.Children.length?o("el-menu-item",{attrs:{index:t.Index}},[o("i",{class:t.Class}),e._v(" "),o("span",[e._v(e._s(t.Title))])]):e._e()]})],2)],1)],1),e._v(" "),o("el-container",[o("el-header",{directives:[{name:"show",rawName:"v-show",value:!e.isMobile,expression:"!isMobile"}],attrs:{height:"60px"}},[o("div",{staticClass:"name"},[o("img",{attrs:{src:a("7Otq"),height:"40px",align:"left"}})]),e._v(" "),o("div",{staticClass:"logoutClass"},[o("el-dropdown",{staticClass:"avatar-container",attrs:{trigger:"click"}},[o("div",{staticClass:"avatar-wrapper"},[o("el-image",{staticClass:"avatar-inner",staticStyle:{width:"35px",height:"35px","border-radius":"50%"},attrs:{src:e.userImg,fit:"full"}}),e._v(" "),o("span",{staticClass:"avatar-inner"},[e._v(e._s(e.echoUser))]),e._v(" "),o("i",{staticClass:"fa fa-sort-desc avatar-inner"})],1),e._v(" "),o("el-dropdown-menu",{staticClass:"user-dropdown",attrs:{slot:"dropdown"},slot:"dropdown"},[o("router-link",{attrs:{to:"/doc"}},[o("el-dropdown-item",[e._v("\n                帮助\n              ")])],1),e._v(" "),o("span",{on:{click:e.loginOut}},[o("el-dropdown-item",[e._v("登出")])],1)],1)],1)],1)]),e._v(" "),o("el-main",["/"===this.$route.path?o("div",{staticStyle:{margin:"-18px"}},[o("el-carousel",{attrs:{"indicator-position":"outside",height:"580px"}},e._l(e.imgs,function(e){return o("el-carousel-item",{key:e},[o("img",{ref:"image",refInFor:!0,attrs:{src:e,width:"100%"}})])}),1),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10,offset:3}},[o("h2",[e._v("数据查询")]),e._v(" "),o("span",[e._v("支持 spark, mysql, clickhouse 等查询引擎 ")]),e._v(" "),o("br"),e._v(" "),o("span",[e._v("与元数据联通, 输入 sql 时进行全方位的提示")]),o("br"),e._v(" "),o("span",[e._v("支持自定义参数配置")])]),e._v(" "),o("el-col",{attrs:{span:11}},[o("img",{attrs:{src:"static/img/fine1.jpeg",width:"60%"}})])],1),e._v(" "),o("el-divider"),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10,offset:3}},[o("img",{attrs:{src:"static/img/fine2.jpeg",width:"60%"}})]),e._v(" "),o("el-col",{attrs:{span:11}},[o("h2",[e._v("数据图表")]),e._v(" "),o("span",[e._v("丰富的数据可视化操作, 让数据直观, 明确的展现给分析人员 ")]),e._v(" "),o("br"),e._v(" "),o("span",[e._v("支持结果对比高亮, 自定义数据更新周期等")]),o("br")])],1),e._v(" "),o("el-divider"),e._v(" "),o("el-row",[o("el-col",{attrs:{span:10,offset:3}},[o("h2",[e._v("自动数仓")]),e._v(" "),o("span",[e._v("一站式自建数仓方便用户创建自己的分析流程")]),o("br"),e._v(" "),o("span",[e._v("拖拽式工作流让创建更简单, 高效")]),o("br"),e._v(" "),o("span",[e._v("支持自定义邮件发送结果")]),o("br")]),e._v(" "),o("el-col",{attrs:{span:11}},[o("img",{attrs:{src:"static/img/fine3.jpeg",width:"60%"}})])],1),e._v(" "),o("el-divider"),e._v(" "),o("el-row",{staticStyle:{"background-color":"#1b1c1f"}},[o("div",{staticStyle:{"margin-top":"30px","background-color":"#1b1c1f"}},[o("div",{staticStyle:{"background-color":"#1b1c1f"}},[o("el-col",{staticStyle:{"background-color":"#1b1c1f"},attrs:{span:4,offset:8}},[o("el-row",{staticStyle:{"background-color":"#1b1c1f"},attrs:{align:"middle"}},[o("span",{staticStyle:{color:"white"}},[e._v("关于我们")])]),e._v(" "),o("ul",{staticStyle:{"list-style":"none","margin-left":"-50px",color:"white","font-size":"11px"}},[o("li",[e._v("商业数据产品")]),e._v(" "),o("li",[e._v("商业数据开发")])])],1),e._v(" "),o("el-col",{staticStyle:{"background-color":"#1b1c1f"},attrs:{span:6}},[o("el-row",{staticStyle:{"background-color":"#1b1c1f"}},[o("span",{staticStyle:{color:"white"}},[e._v("联系方式")])]),e._v(" "),o("img",{staticStyle:{"margin-left":"-5px"},attrs:{src:a("AM+7"),width:"20%"}})],1)],1),e._v(" "),o("div",{staticStyle:{"background-color":"#1b1c1f"}},[o("el-col",{staticStyle:{"background-color":"#1b1c1f"},attrs:{offset:10,span:8}},[o("span",{staticStyle:{"font-size":"11px",color:"#555"}},[e._v("ADTECH-数据平台")])])],1)])])],1):o("router-view")],1)],1)],1)},staticRenderFns:[]};var ae=a("VU/8")(ee,te,!1,function(e){a("BS6g")},null,null).exports,oe=a("mtWM"),se={data:function(){return{wapRules:G.strictRules,dateOptions:G.dateOptions,optionsBase:G.wapBaseTotal,optionsGG:G.wapGG,optionsKH:G.wapKH,optionsOutputs:G.wapOutputs,filterOptions:{cxchy_yiji_options:[],cxchy_erji_options:[],wmqy_options:G.provincesChina,yjkhhy_options:[],ejkhhy_options:[],sjkhhy_options:[],khlx_options:[],khsx_options:[],dq_options:[],ejywlx_options:[],sjywlx_options:[],yslb_options:[],yjqd_options:[],ejqd_options:[],wz_options:[],pw_options:[],sd_options:[],gglx_options:[],llpt_options:[],sjly_options:[]},beforeTransId:"",afterTransId:"",wapForm:{date:G.dateRange,dimensions:[],filters:{DLSID:{name:"DLSID",values:[],type:"IN"},KHID:{name:"KHID",values:[],type:"IN"},CXC:{name:"CXC",values:[],type:"QW_AM"},JHID:{name:"JHID",values:[],type:"IN"},ZID:{name:"ZID",values:[],type:"IN"},PID:{name:"PID",values:[],type:"IN"},GJC:{name:"GJC",values:[],type:"IN"},GJCID:{name:"GJCID",values:[],type:"IN"},CXCHY_YIJI:{name:"CXCHY_YIJI",values:[],type:"IN"},CXCHY_ERJI:{name:"CXCHY_ERJI",values:[],type:"IN"},WMQY:{name:"WMQY",values:[],type:"IN"},YJKHHY:{name:"YJKHHY",values:[],type:"IN"},EJKHHY:{name:"EJKHHY",values:[],type:"IN"},SJKHHY:{name:"SJKHHY",values:[],type:"IN"},KHLX:{name:"KHLX",values:[],type:"IN"},KHSX:{name:"KHSX",values:[],type:"IN"},DQ:{name:"DQ",values:[],type:"IN"},EJYWLX:{name:"EJYWLX",values:[],type:"IN"},SJYWLX:{name:"SJYWLX",values:[],type:"IN"},YSLB:{name:"YSLB",values:[],type:"IN"},YJQD:{name:"YJQD",values:[],type:"IN"},EJQD:{name:"EJQD",values:[],type:"IN"},WZ:{name:"WZ",values:[],type:"IN"},PW:{name:"PW",values:[],type:"IN"},SD:{name:"SD",values:[],type:"IN"},GGLX:{name:"GGLX",values:[],type:"IN"}},outputs:[],limitNumber:"",orderColumns:[],name:""},queryId:"",errorMsg:"",queryWordFile:"",orderOptions:[],isOnSubmit:!1}},computed:{onProcessing:function(){return this.isProcessing()},buttonText:function(){return this.isProcessing()?"提交中":"确定"},buttonIcon:function(){return this.isProcessing()?"el-icon-loading":""}},methods:{transId:function(e){var t=this.beforeTransId.replace(/(^\s*)|(\s*$)/g,""),a="";a=e?"'"+(a=t.replace(/\r/g,"").replace(/\n/g,"','"))+"'":t.replace(/\r/g,"").replace(/\n/g,","),this.afterTransId=a},isProcessing:function(){return this.isOnSubmit},changeOrderColumns:function(){var e=this.wapForm.outputs,t=this.optionsOutputs,a=[];e.forEach(function(e){for(var o in t)t[o]===e&&a.push({key:o,value:e})}),this.orderOptions=a},onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&t.$confirm("确认选择了所需的全部条件","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var e=[];for(var o in t.wapForm.filters)if(!Object(r.f)(t.wapForm.filters[o].values)){if("string"==typeof t.wapForm.filters[o].values){var s=t.wapForm.filters[o].values;t.wapForm.filters[o].values=s.split(",")}e.push(t.wapForm.filters[o])}var n=new FormData;n.append("typeName","无线搜索查询"),n.append("qwFile",t.wapForm.filters.CXC.values);var i=[];for(var l in t.optionsOutputs)i.push(t.optionsOutputs[l]);console.log(i);var c=t.wapForm.outputs.sort(function(e,t){return i.indexOf(e)-i.indexOf(t)});n.append("queryJSON",S()({dimensions:t.wapForm.dimensions,filters:e,outputs:c,date:t.wapForm.date,name:t.wapForm.name,orderColumns:t.wapForm.orderColumns,limitNum:t.wapForm.limitNumber})),console.log(n),a.isOnSubmit=!0,oe.post("/jone/combination",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){a.queryId=e.data,a.$options.methods.msgNotify.bind(a)(),a.isOnSubmit=!1}).catch(function(e){console.log(e),a.errorMsg=e,a.$options.methods.errorNotify.bind(a)(),a.isOnSubmit=!1})})})},onReset:function(e){this.$refs[e].resetFields()},redirectClick:function(){Ss.push({path:"que"})},msgNotify:function(){this.$notify({title:this.queryId,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},errorNotify:function(){this.$notify.error({title:"错误",message:this.errorMsg})},beforeUploadDLSID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.DLSID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadKHID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.KHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadCXC:function(e){var t=this;this.queryWordFile=e;var a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.CXC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadJHID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.JHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadZID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.ZID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.PID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJC:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.GJC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJCID:function(e){var t=this,a=new FormData;return a.append("file",e),oe.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.wapForm.filters.GJCID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},getOptions:function(){var e=this;oe({method:"post",url:"dw/sql/options_wap/date",data:this.wapForm.date}).then(function(t){var a=t.data;for(var o in a)e.filterOptions[o]=a[o]}).catch(function(e){console.log(e)})},loadHistory:function(){var e=this,t=JSON.parse(sessionStorage.getItem("sub_history"));if(sessionStorage.removeItem("sub_history"),console.log(t),t)try{e.wapForm.dimensions=t.dimensions,e.wapForm.date=t.date,e.wapForm.outputs=t.outputs,e.wapForm.limitNumber=t.limitNum,e.changeOrderColumns(),e.wapForm.orderColumns=t.orderColumns,t.filters.forEach(function(t){e.wapForm.filters[t.name].values=t.values,e.wapForm.filters[t.name].type=t.type})}catch(e){console.log(e),this.onReset("wapForm")}}},created:function(){this.getOptions()},mounted:function(){this.loadHistory()}},ne={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"wap"},[a("el-form",{ref:"wapForm",attrs:{model:e.wapForm,size:"medium",rules:e.wapRules,"label-width":"110px"}},[a("h3",[e._v("无线查询维度")]),e._v(" "),a("el-form-item",{attrs:{prop:"dimensions","label-width":"0px"}},[a("el-checkbox-group",{model:{value:e.wapForm.dimensions,callback:function(t){e.$set(e.wapForm,"dimensions",t)},expression:"wapForm.dimensions"}},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("基本")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.optionsBase,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("广告")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.optionsGG,function(t,o){return a("el-checkbox",{key:o,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("客户")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.optionsKH,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("筛选条件")]),e._v(" "),a("div",{staticClass:"filters"},[a("el-row",[a("el-form-item",{attrs:{label:"起止日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd","picker-options":e.dateOptions},on:{change:e.getOptions},model:{value:e.wapForm.date,callback:function(t){e.$set(e.wapForm,"date",t)},expression:"wapForm.date"}})],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-left":"42px","margin-top":"-10px","margin-bottom":"10px"}},[a("el-col",{attrs:{span:11}},[a("label",{staticClass:"el-form-item__label"},[e._v("账号ID格式化工具")]),e._v(" "),a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容 (使用回车分隔)",rows:4,"max-rows":4},model:{value:e.beforeTransId,callback:function(t){e.beforeTransId=t},expression:"beforeTransId"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:11}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!1)}}},[e._v("转换")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!0)}}},[e._v("转换字符串")]),e._v(" "),a("el-input",{attrs:{type:"textarea",rows:4,"max-rows":4},model:{value:e.afterTransId,callback:function(t){e.afterTransId=t},expression:"afterTransId"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"代理商ID",prop:"filters.DLSID.values"}},[a("el-input",{model:{value:e.wapForm.filters.DLSID.values,callback:function(t){e.$set(e.wapForm.filters.DLSID,"values",t)},expression:"wapForm.filters.DLSID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.DLSID.type"}},[a("el-select",{model:{value:e.wapForm.filters.DLSID.type,callback:function(t){e.$set(e.wapForm.filters.DLSID,"type",t)},expression:"wapForm.filters.DLSID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadDLSID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"客户ID",prop:"filters.KHID.values"}},[a("el-input",{model:{value:e.wapForm.filters.KHID.values,callback:function(t){e.$set(e.wapForm.filters.KHID,"values",t)},expression:"wapForm.filters.KHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.KHID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.KHID.type,callback:function(t){e.$set(e.wapForm.filters.KHID,"type",t)},expression:"wapForm.filters.KHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadKHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"查询词",prop:"filters.CXC.values"}},[a("el-input",{model:{value:e.wapForm.filters.CXC.values,callback:function(t){e.$set(e.wapForm.filters.CXC,"values",t)},expression:"wapForm.filters.CXC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.CXC.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.CXC.type,callback:function(t){e.$set(e.wapForm.filters.CXC,"type",t)},expression:"wapForm.filters.CXC.type"}},[a("el-option",{attrs:{label:"精确匹配",value:"QW_AM"}}),e._v(" "),a("el-option",{attrs:{label:"模糊匹配",value:"QW_FM"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"计划ID",prop:"filters.JHID.values"}},[a("el-input",{model:{value:e.wapForm.filters.JHID.values,callback:function(t){e.$set(e.wapForm.filters.JHID,"values",t)},expression:"wapForm.filters.JHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.JHID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.JHID.type,callback:function(t){e.$set(e.wapForm.filters.JHID,"type",t)},expression:"wapForm.filters.JHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadJHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"组ID",prop:"filters.ZID.values"}},[a("el-input",{model:{value:e.wapForm.filters.ZID.values,callback:function(t){e.$set(e.wapForm.filters.ZID,"values",t)},expression:"wapForm.filters.ZID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.ZID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.ZID.type,callback:function(t){e.$set(e.wapForm.filters.ZID,"type",t)},expression:"wapForm.filters.ZID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadZID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"PID",prop:"filters.PID.values"}},[a("el-input",{model:{value:e.wapForm.filters.PID.values,callback:function(t){e.$set(e.wapForm.filters.PID,"values",t)},expression:"wapForm.filters.PID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.PID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.PID.type,callback:function(t){e.$set(e.wapForm.filters.PID,"type",t)},expression:"wapForm.filters.PID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadPID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词",prop:"filters.GJC.values"}},[a("el-input",{model:{value:e.wapForm.filters.GJC.values,callback:function(t){e.$set(e.wapForm.filters.GJC,"values",t)},expression:"wapForm.filters.GJC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.GJC.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.GJC.type,callback:function(t){e.$set(e.wapForm.filters.GJC,"type",t)},expression:"wapForm.filters.GJC.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词ID",prop:"filters.GJCID.values"}},[a("el-input",{model:{value:e.wapForm.filters.GJCID.values,callback:function(t){e.$set(e.wapForm.filters.GJCID,"values",t)},expression:"wapForm.filters.GJCID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.GJCID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.wapForm.filters.GJCID.type,callback:function(t){e.$set(e.wapForm.filters.GJCID,"type",t)},expression:"wapForm.filters.GJCID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJCID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"勾选提示"}},[a("div",[a("span",[e._v("选项太多找不到？直接搜索试试。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:18}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级查询词行业",prop:"filters.CXCHY_YIJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.CXCHY_YIJI.values,callback:function(t){e.$set(e.wapForm.filters.CXCHY_YIJI,"values",t)},expression:"wapForm.filters.CXCHY_YIJI.values"}},e._l(e.filterOptions.cxchy_yiji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级查询词行业",prop:"filters.CXCHY_ERJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.CXCHY_ERJI.values,callback:function(t){e.$set(e.wapForm.filters.CXCHY_ERJI,"values",t)},expression:"wapForm.filters.CXCHY_ERJI.values"}},e._l(e.filterOptions.cxchy_erji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"网民区域",prop:"filters.WMQY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.WMQY.values,callback:function(t){e.$set(e.wapForm.filters.WMQY,"values",t)},expression:"wapForm.filters.WMQY.values"}},e._l(e.filterOptions.wmqy_options,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.children,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级客户行业",prop:"filters.YJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.YJKHHY.values,callback:function(t){e.$set(e.wapForm.filters.YJKHHY,"values",t)},expression:"wapForm.filters.YJKHHY.values"}},e._l(e.filterOptions.yjkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级客户行业",prop:"filters.EJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.EJKHHY.values,callback:function(t){e.$set(e.wapForm.filters.EJKHHY,"values",t)},expression:"wapForm.filters.EJKHHY.values"}},e._l(e.filterOptions.ejkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"三级客户行业",prop:"filters.SJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.SJKHHY.values,callback:function(t){e.$set(e.wapForm.filters.SJKHHY,"values",t)},expression:"wapForm.filters.SJKHHY.values"}},e._l(e.filterOptions.sjkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级业务类型",prop:"filters.EJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.EJYWLX.values,callback:function(t){e.$set(e.wapForm.filters.EJYWLX,"values",t)},expression:"wapForm.filters.EJYWLX.values"}},e._l(e.filterOptions.ejywlx_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"三级业务类型",prop:"filters.SJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.SJYWLX.values,callback:function(t){e.$set(e.wapForm.filters.SJYWLX,"values",t)},expression:"wapForm.filters.SJYWLX.values"}},e._l(e.filterOptions.sjywlx_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级渠道",prop:"filters.YJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.YJQD.values,callback:function(t){e.$set(e.wapForm.filters.YJQD,"values",t)},expression:"wapForm.filters.YJQD.values"}},e._l(e.filterOptions.yjqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级渠道",prop:"filters.EJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.EJQD.values,callback:function(t){e.$set(e.wapForm.filters.EJQD,"values",t)},expression:"wapForm.filters.EJQD.values"}},e._l(e.filterOptions.ejqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"大区",prop:"filters.DQ.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.DQ.values,callback:function(t){e.$set(e.wapForm.filters.DQ,"values",t)},expression:"wapForm.filters.DQ.values"}},e._l(e.filterOptions.dq_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:"客户类型",prop:"filters.KHLX.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.KHLX.values,callback:function(t){e.$set(e.wapForm.filters.KHLX,"values",t)},expression:"wapForm.filters.KHLX.values"}},e._l(e.filterOptions.khlx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:"客户属性",prop:"filters.KHSX.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.KHSX.values,callback:function(t){e.$set(e.wapForm.filters.KHSX,"values",t)},expression:"wapForm.filters.KHSX.values"}},e._l(e.filterOptions.khsx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"样式类别",prop:"filters.YSLB.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.YSLB.values,callback:function(t){e.$set(e.wapForm.filters.YSLB,"values",t)},expression:"wapForm.filters.YSLB.values"}},e._l(e.filterOptions.yslb_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"位置",prop:"filters.WZ.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.WZ.values,callback:function(t){e.$set(e.wapForm.filters.WZ,"values",t)},expression:"wapForm.filters.WZ.values"}},e._l(e.filterOptions.wz_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8,offset:1}},[a("el-form-item",{attrs:{label:"深度",prop:"filters.SD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.filters.SD.values,callback:function(t){e.$set(e.wapForm.filters.SD,"values",t)},expression:"wapForm.filters.SD.values"}},e._l(e.filterOptions.sd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"排位",prop:"filters.PW.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.PW.values,callback:function(t){e.$set(e.wapForm.filters.PW,"values",t)},expression:"wapForm.filters.PW.values"}},e._l(e.filterOptions.pw_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"广告类型",prop:"filters.GGLX.values"}},[a("el-checkbox-group",{model:{value:e.wapForm.filters.GGLX.values,callback:function(t){e.$set(e.wapForm.filters.GGLX,"values",t)},expression:"wapForm.filters.GGLX.values"}},e._l(e.filterOptions.gglx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n              ")])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("输出指标")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"基础指标",prop:"outputs"}},[a("el-col",[a("el-checkbox-group",{on:{change:e.changeOrderColumns},model:{value:e.wapForm.outputs,callback:function(t){e.$set(e.wapForm,"outputs",t)},expression:"wapForm.outputs"}},e._l(e.optionsOutputs,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"输出条数限制",prop:"limitNumber"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"不填表示没有限制"},model:{value:e.wapForm.limitNumber,callback:function(t){e.$set(e.wapForm,"limitNumber",t)},expression:"wapForm.limitNumber"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"指标排序",prop:"orderColumns"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.wapForm.orderColumns,callback:function(t){e.$set(e.wapForm,"orderColumns",t)},expression:"wapForm.orderColumns"}},e._l(e.orderOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.key,value:e.value}})}),1),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"14px"}},[e._v("( 点击的顺序表示排序的指标顺序 )")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("任务信息")]),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.wapForm.name,callback:function(t){e.$set(e.wapForm,"name",t)},expression:"wapForm.name"}})],1)],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary",icon:e.buttonIcon,disabled:e.onProcessing},on:{click:function(t){return e.onSubmit("wapForm")}}},[e._v(e._s(e.buttonText)+"\n        ")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("wapForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},ie=a("VU/8")(se,ne,!1,null,null,null).exports,le=a("mtWM"),re={data:function(){return{isOnSubmit:!1,pcBase:G.pcBase,pcGG:G.pcGG,pcKH:G.pcKH,pcOutputs:G.pcOutputs,pcRules:G.strictRules,pcDateOptions:G.dateOptions,filterOptions:{cxchy_yiji_options:[],cxchy_erji_options:[],wmqy_options:G.provincesChina,yjkhhy_options:[],ejkhhy_options:[],sjkhhy_options:[],khlx_options:[],dq_options:[],ejywlx_options:[],sjywlx_options:[],yjqd_options:[],ejqd_options:[],yslb_options:[],gglx_options:[],pw_options:[],sd_options:[],sjly_options:[]},pcForm:{date:G.dateRange,dimensions:[],filters:{DLSID:{name:"DLSID",values:[],type:"IN"},KHID:{name:"KHID",values:[],type:"IN"},CXC:{name:"CXC",values:[],type:"QW_AM"},CXCHY_YIJI:{name:"CXCHY_YIJI",values:[],type:"IN"},CXCHY_ERJI:{name:"CXCHY_ERJI",values:[],type:"IN"},JHID:{name:"JHID",values:[],type:"IN"},ZID:{name:"ZID",values:[],type:"IN"},PID:{name:"PID",values:[],type:"IN"},GJC:{name:"GJC",values:[],type:"IN"},GJCID:{name:"GJCID",values:[],type:"IN"},PCS:{name:"PCS",values:[],type:"IN"},YJQD:{name:"YJQD",values:[],type:"IN"},EJQD:{name:"EJQD",values:[],type:"IN"},WMQY:{name:"WMQY",values:[],type:"IN"},YJKHHY:{name:"YJKHHY",values:[],type:"IN"},EJKHHY:{name:"EJKHHY",values:[],type:"IN"},SJKHHY:{name:"SJKHHY",values:[],type:"IN"},KHLX:{name:"KHLX",values:[],type:"IN"},DQ:{name:"DQ",values:[],type:"IN"},EJYWLX:{name:"EJYWLX",values:[],type:"IN"},SJYWLX:{name:"SJYWLX",values:[],type:"IN"},YSLB:{name:"YSLB",values:[],type:"IN"},PW:{name:"PW",values:[],type:"IN"},SD:{name:"SD",values:[],type:"IN"},SJLY:{name:"SJLY",values:[],type:"IN"},GGLX:{name:"GGLX",values:[],type:"IN"}},outputs:[],limitNumber:"",orderColumns:[],name:""},queryId:"",errorMsg:"",queryWordFile:"",orderOptions:[]}},methods:{isProcessing:function(){return this.isOnSubmit},changeOrderColumns:function(){var e=this.pcForm.outputs,t=this.pcOutputs;console.log(t);var a=[];e.forEach(function(e){for(var o in t)t[o]===e&&a.push({key:o,value:e})}),this.orderOptions=a},onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&t.$confirm("确认选择了所需的全部条件","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){console.log("进入submit");var e=[];for(var o in t.pcForm.filters)if(!Object(r.f)(t.pcForm.filters[o].values)){if("string"==typeof t.pcForm.filters[o].values){var s=t.pcForm.filters[o].values;t.pcForm.filters[o].values=s.split(",")}e.push(t.pcForm.filters[o])}console.log("postFilters:"+e);var n=new FormData;n.append("qwFile",t.pcForm.filters.CXC.values);var i=[];for(var l in t.pcOutputs)i.push(t.pcOutputs[l]);var c=t.pcForm.outputs.sort(function(e,t){return i.indexOf(e)-i.indexOf(t)});console.log(c);var d=S()({dimensions:t.pcForm.dimensions,filters:e,outputs:c,date:t.pcForm.date,name:t.pcForm.name,orderColumns:t.pcForm.orderColumns,limitNum:t.pcForm.limitNumber});console.log("formData完成:"+d),n.append("queryJSON",d),n.append("typeName","PC_query"),a.isOnSubmit=!0,le.post("/jone/combination_pc",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){a.queryId=e.data,a.$options.methods.msgNotify.bind(a)(),a.isOnSubmit=!1}).catch(function(e){a.errorMsg=e,a.$options.methods.errorNotify.bind(a)(),a.isOnSubmit=!1})})})},onReset:function(e){this.$refs[e].resetFields()},redirectClick:function(){Ss.push({path:"que"})},msgNotify:function(){this.$notify({title:this.queryId,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},errorNotify:function(){this.$notify.error({title:"错误",message:this.errorMsg})},beforeUploadDLSID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.DLSID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadKHID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.KHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadCXC:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.CXC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadJHID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.JHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadZID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.ZID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.PID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJC:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.GJC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJCID:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.GJCID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPCS:function(e){var t=this,a=new FormData;return a.append("file",e),le.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.PCS.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},getOptions:function(){var e=this;le({method:"post",url:"dw/sql/options_pc/date",data:this.pcForm.date}).then(function(t){var a=t.data;for(var o in a)e.filterOptions[o]=a[o]}).catch(function(e){console.log(e)})},loadHistory:function(){var e=this,t=JSON.parse(sessionStorage.getItem("sub_history"));if(sessionStorage.removeItem("sub_history"),t)try{e.pcForm.dimensions=t.dimensions,e.pcForm.date=t.date,e.pcForm.limitNumber=t.limitNum,e.pcForm.outputs=t.outputs;var a=t.filters;e.changeOrderColumns(),e.pcForm.orderColumns=t.orderColumns,a.forEach(function(t){e.pcForm.filters[t.name].values=t.values,e.pcForm.filters[t.name].type=t.type})}catch(e){this.onReset("pcForm")}}},created:function(){this.getOptions()},computed:{onProcessing:function(){return this.isProcessing()},buttonText:function(){return this.isProcessing()?"提交中":"确定"},buttonIcon:function(){return this.isProcessing()?"el-icon-loading":""}},mounted:function(){this.loadHistory()}},ce={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("PC数据查询")]),e._v(" "),a("el-form",{ref:"pcForm",attrs:{model:e.pcForm,rules:e.pcRules,size:"medium","label-width":"110px"}},[a("el-form-item",{attrs:{prop:"dimensions","label-width":"0px"}},[a("el-checkbox-group",{model:{value:e.pcForm.dimensions,callback:function(t){e.$set(e.pcForm,"dimensions",t)},expression:"pcForm.dimensions"}},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("基本")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.pcBase,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("筛选条件")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"起止日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd","picker-options":e.pcDateOptions},on:{change:e.getOptions},model:{value:e.pcForm.date,callback:function(t){e.$set(e.pcForm,"date",t)},expression:"pcForm.date"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"查询词",prop:"filters.CXC.values"}},[a("el-input",{model:{value:e.pcForm.filters.CXC.values,callback:function(t){e.$set(e.pcForm.filters.CXC,"values",t)},expression:"pcForm.filters.CXC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4,prop:"filters.CXC.type"}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.CXC.type,callback:function(t){e.$set(e.pcForm.filters.CXC,"type",t)},expression:"pcForm.filters.CXC.type"}},[a("el-option",{attrs:{label:"精确匹配",value:"QW_AM"}}),e._v(" "),a("el-option",{attrs:{label:"模糊匹配",value:"QW_FM"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"勾选提示"}},[a("div",[a("span",[e._v("选项太多找不到？直接搜索试试。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"一级查询词行业",prop:"filters.CXCHY_YIJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.CXCHY_YIJI.values,callback:function(t){e.$set(e.pcForm.filters.CXCHY_YIJI,"values",t)},expression:"pcForm.filters.CXCHY_YIJI.values"}},e._l(e.filterOptions.cxchy_yiji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"二级查询词行业",prop:"filters.CXCHY_ERJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.CXCHY_ERJI.values,callback:function(t){e.$set(e.pcForm.filters.CXCHY_ERJI,"values",t)},expression:"pcForm.filters.CXCHY_ERJI.values"}},e._l(e.filterOptions.cxchy_erji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"一级渠道",prop:"filters.YJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.YJQD.values,callback:function(t){e.$set(e.pcForm.filters.YJQD,"values",t)},expression:"pcForm.filters.YJQD.values"}},e._l(e.filterOptions.yjqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"二级渠道",prop:"filters.EJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.EJQD.values,callback:function(t){e.$set(e.pcForm.filters.EJQD,"values",t)},expression:"pcForm.filters.EJQD.values"}},e._l(e.filterOptions.ejqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"网民区域",prop:"filters.WMQY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.WMQY.values,callback:function(t){e.$set(e.pcForm.filters.WMQY,"values",t)},expression:"pcForm.filters.WMQY.values"}},e._l(e.filterOptions.wmqy_options,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.children,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("输出指标")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"基础指标",prop:"outputs"}},[a("el-checkbox-group",{on:{change:e.changeOrderColumns},model:{value:e.pcForm.outputs,callback:function(t){e.$set(e.pcForm,"outputs",t)},expression:"pcForm.outputs"}},e._l(e.pcOutputs,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"输出条数限制",prop:"limitNumber"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"不填表示没有限制"},model:{value:e.pcForm.limitNumber,callback:function(t){e.$set(e.pcForm,"limitNumber",t)},expression:"pcForm.limitNumber"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"指标排序",prop:"orderColumns"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.orderColumns,callback:function(t){e.$set(e.pcForm,"orderColumns",t)},expression:"pcForm.orderColumns"}},e._l(e.orderOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.key,value:e.value}})}),1),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"14px"}},[e._v("( 点击的顺序表示排序的指标顺序 )")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("任务信息")]),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.pcForm.name,callback:function(t){e.$set(e.pcForm,"name",t)},expression:"pcForm.name"}})],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary",icon:e.buttonIcon,disabled:e.onProcessing},on:{click:function(t){return e.onSubmit("pcForm")}}},[e._v(e._s(e.buttonText))]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("pcForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},de=a("VU/8")(re,ce,!1,null,null,null).exports,ue=a("mtWM"),pe={data:function(){return{isOnSubmit:!1,pcBase:G.pcBaseTotal,pcGG:G.pcGG,pcKH:G.pcKH,pcOutputs:G.pcOutputs,pcRules:G.strictRules,pcDateOptions:G.dateOptions,filterOptions:{cxchy_yiji_options:[],cxchy_erji_options:[],wmqy_options:G.provincesChina,yjkhhy_options:[],ejkhhy_options:[],sjkhhy_options:[],khlx_options:[],khsx_options:[],dq_options:[],ejywlx_options:[],sjywlx_options:[],yjqd_options:[],ejqd_options:[],yslb_options:[],gglx_options:[],pw_options:[],sd_options:[],sjly_options:[]},pcForm:{date:G.dateRange,dimensions:[],filters:{DLSID:{name:"DLSID",values:[],type:"IN"},KHID:{name:"KHID",values:[],type:"IN"},CXC:{name:"CXC",values:[],type:"QW_AM"},CXCHY_YIJI:{name:"CXCHY_YIJI",values:[],type:"IN"},CXCHY_ERJI:{name:"CXCHY_ERJI",values:[],type:"IN"},JHID:{name:"JHID",values:[],type:"IN"},ZID:{name:"ZID",values:[],type:"IN"},PID:{name:"PID",values:[],type:"IN"},GJC:{name:"GJC",values:[],type:"IN"},GJCID:{name:"GJCID",values:[],type:"IN"},PCS:{name:"PCS",values:[],type:"IN"},YJQD:{name:"YJQD",values:[],type:"IN"},EJQD:{name:"EJQD",values:[],type:"IN"},WMQY:{name:"WMQY",values:[],type:"IN"},YJKHHY:{name:"YJKHHY",values:[],type:"IN"},EJKHHY:{name:"EJKHHY",values:[],type:"IN"},SJKHHY:{name:"SJKHHY",values:[],type:"IN"},KHLX:{name:"KHLX",values:[],type:"IN"},KHSX:{name:"KHSX",values:[],type:"IN"},DQ:{name:"DQ",values:[],type:"IN"},EJYWLX:{name:"EJYWLX",values:[],type:"IN"},SJYWLX:{name:"SJYWLX",values:[],type:"IN"},YSLB:{name:"YSLB",values:[],type:"IN"},PW:{name:"PW",values:[],type:"IN"},SD:{name:"SD",values:[],type:"IN"},SJLY:{name:"SJLY",values:[],type:"IN"},GGLX:{name:"GGLX",values:[],type:"IN"}},outputs:[],limitNumber:"",orderColumns:[],name:""},beforeTransId:"",afterTransId:"",queryId:"",errorMsg:"",queryWordFile:"",orderOptions:[]}},methods:{transId:function(e){var t=this.beforeTransId.replace(/(^\s*)|(\s*$)/g,""),a="";a=e?"'"+(a=t.replace(/\r/g,"").replace(/\n/g,"','"))+"'":t.replace(/\r/g,"").replace(/\n/g,","),this.afterTransId=a},isProcessing:function(){return this.isOnSubmit},changeOrderColumns:function(){var e=this.pcForm.outputs,t=this.pcOutputs;console.log(t);var a=[];e.forEach(function(e){for(var o in t)t[o]===e&&a.push({key:o,value:e})}),this.orderOptions=a},onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){e&&t.$confirm("确认选择了所需的全部条件","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){console.log("进入submit");var e=[];for(var o in t.pcForm.filters)if(!Object(r.f)(t.pcForm.filters[o].values)){if("string"==typeof t.pcForm.filters[o].values){var s=t.pcForm.filters[o].values;t.pcForm.filters[o].values=s.split(",")}e.push(t.pcForm.filters[o])}console.log("postFilters:"+e);var n=new FormData;n.append("qwFile",t.pcForm.filters.CXC.values);var i=[];for(var l in t.pcOutputs)i.push(t.pcOutputs[l]);var c=t.pcForm.outputs.sort(function(e,t){return i.indexOf(e)-i.indexOf(t)});console.log(c);var d=S()({dimensions:t.pcForm.dimensions,filters:e,outputs:c,date:t.pcForm.date,name:t.pcForm.name,orderColumns:t.pcForm.orderColumns,limitNum:t.pcForm.limitNumber});console.log("formData完成:"+d),n.append("queryJSON",d),n.append("typeName","PC搜索查询"),a.isOnSubmit=!0,ue.post("/jone/combination_pc",n,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){a.queryId=e.data,a.$options.methods.msgNotify.bind(a)(),a.isOnSubmit=!1}).catch(function(e){a.errorMsg=e,a.$options.methods.errorNotify.bind(a)(),a.isOnSubmit=!1})})})},onReset:function(e){this.$refs[e].resetFields()},redirectClick:function(){Ss.push({path:"que"})},msgNotify:function(){this.$notify({title:this.queryId,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},errorNotify:function(){this.$notify.error({title:"错误",message:this.errorMsg})},beforeUploadDLSID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.DLSID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadKHID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.KHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadCXC:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.CXC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadJHID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.JHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadZID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.ZID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.PID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJC:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.GJC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJCID:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.GJCID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPCS:function(e){var t=this,a=new FormData;return a.append("file",e),ue.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.pcForm.filters.PCS.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},getOptions:function(){var e=this;ue({method:"post",url:"dw/sql/options_pc/date",data:this.pcForm.date}).then(function(t){var a=t.data;for(var o in a)e.filterOptions[o]=a[o]}).catch(function(e){console.log(e)})},loadHistory:function(){var e=this,t=JSON.parse(sessionStorage.getItem("sub_history"));if(console.log(t),sessionStorage.removeItem("sub_history"),t)try{e.pcForm.dimensions=t.dimensions,e.pcForm.limitNumber=t.limitNum,e.pcForm.date=t.date,e.pcForm.outputs=t.outputs;var a=t.filters;e.changeOrderColumns(),e.pcForm.orderColumns=t.orderColumns,a.forEach(function(t){e.pcForm.filters[t.name].values=t.values,e.pcForm.filters[t.name].type=t.type})}catch(e){console.log(e),this.onReset("pcForm")}}},computed:{onProcessing:function(){return this.isProcessing()},buttonText:function(){return this.isProcessing()?"提交中":"确定"},buttonIcon:function(){return this.isProcessing()?"el-icon-loading":""}},created:function(){this.getOptions()},mounted:function(){this.loadHistory()}},me={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("PC数据查询")]),e._v(" "),a("el-form",{ref:"pcForm",attrs:{model:e.pcForm,rules:e.pcRules,size:"medium","label-width":"110px"}},[a("el-form-item",{attrs:{prop:"dimensions","label-width":"0px"}},[a("el-checkbox-group",{model:{value:e.pcForm.dimensions,callback:function(t){e.$set(e.pcForm,"dimensions",t)},expression:"pcForm.dimensions"}},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("基本")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.pcBase,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("广告")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.pcGG,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("客户")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.pcKH,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("筛选条件")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"起止日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd","picker-options":e.pcDateOptions},on:{change:e.getOptions},model:{value:e.pcForm.date,callback:function(t){e.$set(e.pcForm,"date",t)},expression:"pcForm.date"}})],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-left":"42px","margin-top":"-10px","margin-bottom":"10px"}},[a("el-col",{attrs:{span:11}},[a("label",{staticClass:"el-form-item__label"},[e._v("账号ID格式化工具")]),e._v(" "),a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容 (使用回车分隔)",rows:4,"max-rows":4},model:{value:e.beforeTransId,callback:function(t){e.beforeTransId=t},expression:"beforeTransId"}})],1),e._v(" "),a("el-col",{staticStyle:{"margin-left":"10px"},attrs:{span:11}},[a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!1)}}},[e._v("转换")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!0)}}},[e._v("转换字符串")]),e._v(" "),a("el-input",{attrs:{type:"textarea",rows:4,"max-rows":4},model:{value:e.afterTransId,callback:function(t){e.afterTransId=t},expression:"afterTransId"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"代理商ID",prop:"filters.DLSID.values"}},[a("el-input",{model:{value:e.pcForm.filters.DLSID.values,callback:function(t){e.$set(e.pcForm.filters.DLSID,"values",t)},expression:"pcForm.filters.DLSID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.DLSID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.DLSID.type,callback:function(t){e.$set(e.pcForm.filters.DLSID,"type",t)},expression:"pcForm.filters.DLSID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadDLSID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"客户ID",prop:"filters.KHID.values"}},[a("el-input",{model:{value:e.pcForm.filters.KHID.values,callback:function(t){e.$set(e.pcForm.filters.KHID,"values",t)},expression:"pcForm.filters.KHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.KHID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.KHID.type,callback:function(t){e.$set(e.pcForm.filters.KHID,"type",t)},expression:"pcForm.filters.KHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadKHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"查询词",prop:"filters.CXC.values"}},[a("el-input",{model:{value:e.pcForm.filters.CXC.values,callback:function(t){e.$set(e.pcForm.filters.CXC,"values",t)},expression:"pcForm.filters.CXC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4,prop:"filters.CXC.type"}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.CXC.type,callback:function(t){e.$set(e.pcForm.filters.CXC,"type",t)},expression:"pcForm.filters.CXC.type"}},[a("el-option",{attrs:{label:"精确匹配",value:"QW_AM"}}),e._v(" "),a("el-option",{attrs:{label:"模糊匹配",value:"QW_FM"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"计划ID",prop:"filters.JHID.values"}},[a("el-input",{model:{value:e.pcForm.filters.JHID.values,callback:function(t){e.$set(e.pcForm.filters.JHID,"values",t)},expression:"pcForm.filters.JHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4,prop:"filters.JHID.type"}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px"}},[a("el-select",{model:{value:e.pcForm.filters.JHID.type,callback:function(t){e.$set(e.pcForm.filters.JHID,"type",t)},expression:"pcForm.filters.JHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadJHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"组ID",prop:"filters.ZID.values"}},[a("el-input",{model:{value:e.pcForm.filters.ZID.values,callback:function(t){e.$set(e.pcForm.filters.ZID,"values",t)},expression:"pcForm.filters.ZID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.ZID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.ZID.type,callback:function(t){e.$set(e.pcForm.filters.ZID,"type",t)},expression:"pcForm.filters.ZID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadZID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"PID",prop:"filters.PID.values"}},[a("el-input",{model:{value:e.pcForm.filters.PID.values,callback:function(t){e.$set(e.pcForm.filters.PID,"values",t)},expression:"pcForm.filters.PID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.PID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.PID.type,callback:function(t){e.$set(e.pcForm.filters.PID,"type",t)},expression:"pcForm.filters.PID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadPID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词",prop:"filters.GJC.values"}},[a("el-input",{model:{value:e.pcForm.filters.GJC.values,callback:function(t){e.$set(e.pcForm.filters.GJC,"values",t)},expression:"pcForm.filters.GJC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.GJC.type"}},[a("el-select",{model:{value:e.pcForm.filters.GJC.type,callback:function(t){e.$set(e.pcForm.filters.GJC,"type",t)},expression:"pcForm.filters.GJC.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词ID",prop:"filters.GJCID.values"}},[a("el-input",{model:{value:e.pcForm.filters.GJCID.values,callback:function(t){e.$set(e.pcForm.filters.GJCID,"values",t)},expression:"pcForm.filters.GJCID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.GJCID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.pcForm.filters.GJCID.type,callback:function(t){e.$set(e.pcForm.filters.GJCID,"type",t)},expression:"pcForm.filters.GJCID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJCID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"勾选提示"}},[a("div",[a("span",[e._v("选项太多找不到？直接搜索试试。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:18}},[a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级查询词行业",prop:"filters.CXCHY_YIJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.CXCHY_YIJI.values,callback:function(t){e.$set(e.pcForm.filters.CXCHY_YIJI,"values",t)},expression:"pcForm.filters.CXCHY_YIJI.values"}},e._l(e.filterOptions.cxchy_yiji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级查询词行业",prop:"filters.CXCHY_ERJI.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.CXCHY_ERJI.values,callback:function(t){e.$set(e.pcForm.filters.CXCHY_ERJI,"values",t)},expression:"pcForm.filters.CXCHY_ERJI.values"}},e._l(e.filterOptions.cxchy_erji_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级客户行业",prop:"filters.YJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.YJKHHY.values,callback:function(t){e.$set(e.pcForm.filters.YJKHHY,"values",t)},expression:"pcForm.filters.YJKHHY.values"}},e._l(e.filterOptions.yjkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级客户行业",prop:"filters.EJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.EJKHHY.values,callback:function(t){e.$set(e.pcForm.filters.EJKHHY,"values",t)},expression:"pcForm.filters.EJKHHY.values"}},e._l(e.filterOptions.ejkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"三级客户行业",prop:"filters.SJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.SJKHHY.values,callback:function(t){e.$set(e.pcForm.filters.SJKHHY,"values",t)},expression:"pcForm.filters.SJKHHY.values"}},e._l(e.filterOptions.sjkhhy_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"网民区域",prop:"filters.WMQY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.WMQY.values,callback:function(t){e.$set(e.pcForm.filters.WMQY,"values",t)},expression:"pcForm.filters.WMQY.values"}},e._l(e.filterOptions.wmqy_options,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.children,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"一级渠道",prop:"filters.YJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.YJQD.values,callback:function(t){e.$set(e.pcForm.filters.YJQD,"values",t)},expression:"pcForm.filters.YJQD.values"}},e._l(e.filterOptions.yjqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级渠道",prop:"filters.EJQD.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.EJQD.values,callback:function(t){e.$set(e.pcForm.filters.EJQD,"values",t)},expression:"pcForm.filters.EJQD.values"}},e._l(e.filterOptions.ejqd_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"二级业务类型",prop:"filters.EJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.EJYWLX.values,callback:function(t){e.$set(e.pcForm.filters.EJYWLX,"values",t)},expression:"pcForm.filters.EJYWLX.values"}},e._l(e.filterOptions.ejywlx_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"三级业务类型",prop:"filters.SJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.SJYWLX.values,callback:function(t){e.$set(e.pcForm.filters.SJYWLX,"values",t)},expression:"pcForm.filters.SJYWLX.values"}},e._l(e.filterOptions.sjywlx_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:12}},[a("el-form-item",{attrs:{label:"大区"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.filters.DQ.values,callback:function(t){e.$set(e.pcForm.filters.DQ,"values",t)},expression:"pcForm.filters.DQ.values"}},e._l(e.filterOptions.dq_options,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:"客户类型",prop:"filters.KHLX.values"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.KHLX.values,callback:function(t){e.$set(e.pcForm.filters.KHLX,"values",t)},expression:"pcForm.filters.KHLX.values"}},e._l(e.filterOptions.khlx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n            ")])}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-form-item",{attrs:{label:"客户属性",prop:"filters.KHSX.values"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.KHSX.values,callback:function(t){e.$set(e.pcForm.filters.KHSX,"values",t)},expression:"pcForm.filters.KHSX.values"}},e._l(e.filterOptions.khsx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n          ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"样式类别"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.YSLB.values,callback:function(t){e.$set(e.pcForm.filters.YSLB,"values",t)},expression:"pcForm.filters.YSLB.values"}},e._l(e.filterOptions.yslb_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n            ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"广告类型"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.GGLX.values,callback:function(t){e.$set(e.pcForm.filters.GGLX,"values",t)},expression:"pcForm.filters.GGLX.values"}},e._l(e.filterOptions.gglx_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t)+"\n            ")])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"排位"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.PW.values,callback:function(t){e.$set(e.pcForm.filters.PW,"values",t)},expression:"pcForm.filters.PW.values"}},e._l(e.filterOptions.pw_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"深度"}},[a("el-checkbox-group",{model:{value:e.pcForm.filters.SD.values,callback:function(t){e.$set(e.pcForm.filters.SD,"values",t)},expression:"pcForm.filters.SD.values"}},e._l(e.filterOptions.sd_options,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("输出指标")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"基础指标",prop:"outputs"}},[a("el-checkbox-group",{on:{change:e.changeOrderColumns},model:{value:e.pcForm.outputs,callback:function(t){e.$set(e.pcForm,"outputs",t)},expression:"pcForm.outputs"}},e._l(e.pcOutputs,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"输出条数限制",prop:"limitNumber"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{placeholder:"不填表示没有限制"},model:{value:e.pcForm.limitNumber,callback:function(t){e.$set(e.pcForm,"limitNumber",t)},expression:"pcForm.limitNumber"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"指标排序",prop:"orderColumns"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.pcForm.orderColumns,callback:function(t){e.$set(e.pcForm,"orderColumns",t)},expression:"pcForm.orderColumns"}},e._l(e.orderOptions,function(e){return a("el-option",{key:e.key,attrs:{label:e.key,value:e.value}})}),1),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"14px"}},[e._v("( 点击的顺序表示排序的指标顺序 )")])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("任务信息")]),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.pcForm.name,callback:function(t){e.$set(e.pcForm,"name",t)},expression:"pcForm.name"}})],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary",icon:e.buttonIcon,disabled:e.onProcessing},on:{click:function(t){return e.onSubmit("pcForm")}}},[e._v(e._s(e.buttonText)+"\n        ")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("pcForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},fe=a("VU/8")(pe,me,!1,null,null,null).exports,he=a("mtWM"),ve={data:function(){return{galaxyBase:G.galaxyBase,galaxyGG:G.galaxyGG,galaxyKH:G.galaxyKH,galaxyRules:G.strictRules,galaxyDateOptions:G.dateOptions,wmqyOptions:G.provincesChina,yjkhhyOptions:[],ejkhhyOptions:[],sjkhhyOptions:[],khlxOptions:[],dqOptions:[],ejywlxOptions:[],sjywlxOptions:[],galaxyForm:{date:G.dateRange,dimensions:[],filters:{DLSID:{name:"DLSID",values:[],type:"IN"},KHID:{name:"KHID",values:[],type:"IN"},CXC:{name:"CXC",values:[],type:"IN"},JHID:{name:"JHID",values:[],type:"IN"},ZID:{name:"ZID",values:[],type:"IN"},PID:{name:"PID",values:[],type:"IN"},GJC:{name:"GJC",values:[],type:"IN"},GJCID:{name:"GJCID",values:[],type:"IN"},QDMC:{name:"QDMC",values:[],type:"IN"},WMQY:{name:"WMQY",values:[],type:"IN"},YJKHHY:{name:"YJKHHY",values:[],type:"IN"},EJKHHY:{name:"EJKHHY",values:[],type:"IN"},SJKHHY:{name:"SJKHHY",values:[],type:"IN"},KHLX:{name:"KHLX",values:[],type:"IN"},DQ:{name:"DQ",values:[],type:"IN"},EJYWLX:{name:"EJYWLX",values:[],type:"IN"},SJYWLX:{name:"SJYWLX",values:[],type:"IN"},YSLB:{name:"YSLB",values:[],type:"IN"},PW:{name:"PW",values:[],type:"IN"},CFLX:{name:"CFLX",values:[],type:"IN"}},outputs:[],name:""},queryId:"",errorMsg:""}},methods:{onSubmit:function(e){var t=this,a=this;this.$refs[e].validate(function(e){if(e){var o=[];for(var s in t.galaxyForm.filters)if(!Object(r.f)(t.galaxyForm.filters[s].values)){if("string"==typeof t.galaxyForm.filters[s].values){var n=t.galaxyForm.filters[s].values;t.galaxyForm.filters[s].values=n.split(",")}o.push(t.galaxyForm.filters[s])}t.galaxyForm.filters=o,he({method:"post",url:"/jone/combination_yh",data:S()(t.galaxyForm)}).then(function(e){a.queryId=e.data,a.$options.methods.msgNotify.bind(a)()}).catch(function(e){a.errorMsg=e,a.$options.methods.errorNotify.bind(a)()})}})},onReset:function(e){this.$refs[e].resetFields()},msgNotify:function(){this.$notify.info({title:this.queryId,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success"})},errorNotify:function(){this.$notify.error({title:"错误",message:this.errorMsg})},beforeUploadDLSID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.DLSID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadKHID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.KHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadCXC:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.CXC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadJHID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.JHID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadZID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.ZID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadPID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.PID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJC:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.GJC.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},beforeUploadGJCID:function(e){var t=this,a=new FormData;return a.append("file",e),he.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.galaxyForm.filters.GJCID.values=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},getOptions:function(){var e=this;he({method:"post",url:"dw/sql/options_yh/date",data:this.galaxyForm.date}).then(function(t){e.yjkhhyOptions=t.data.yjkhhy_options,e.ejkhhyOptions=t.data.ejkhhy_options,e.sjkhhyOptions=t.data.sjkhhy_options,e.ejywlxOptions=t.data.ejywlx_options,e.sjywlxOptions=t.data.sjywlx_options,e.qdmcOptions=t.data.qdmc_options,e.khlxOptions=t.data.khlx_options,e.dqOptions=t.data.dq_options}).catch(function(e){console.log(e)})},loadHistory:function(){var e=this,t=JSON.parse(sessionStorage.getItem("sub_history"));(sessionStorage.removeItem("sub_history"),t)&&(e.galaxyForm.dimensions=t.dimensions,e.galaxyForm.date=t.date,e.galaxyForm.outputs=t.outputs,t.filters.forEach(function(t){e.galaxyForm.filters[t.name].values=t.values,e.galaxyForm.filters[t.name].type=t.type}))}},created:function(){this.getOptions()},mounted:function(){this.loadHistory()}},be={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("银河数据查询")]),e._v(" "),a("el-form",{ref:"galaxyForm",attrs:{model:e.galaxyForm,rules:e.galaxyRules,size:"medium","label-width":"100px"}},[a("el-form-item",{attrs:{prop:"dimensions","label-width":"0px"}},[a("el-checkbox-group",{model:{value:e.galaxyForm.dimensions,callback:function(t){e.$set(e.galaxyForm,"dimensions",t)},expression:"galaxyForm.dimensions"}},[a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("基本")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.galaxyBase,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("广告")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.galaxyGG,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:2}},[a("el-tag",{attrs:{size:"medium"}},[e._v("客户")])],1),e._v(" "),a("el-col",{attrs:{span:22}},e._l(e.galaxyKH,function(t,o){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(o))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("筛选条件")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"起止日期",prop:"date"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd","picker-options":e.galaxyDateOptions},model:{value:e.galaxyForm.date,callback:function(t){e.$set(e.galaxyForm,"date",t)},expression:"galaxyForm.date"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"代理商ID",prop:"filters.DLSID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.DLSID.values,callback:function(t){e.$set(e.galaxyForm.filters.DLSID,"values",t)},expression:"galaxyForm.filters.DLSID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.DLSID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.DLSID.type,callback:function(t){e.$set(e.galaxyForm.filters.DLSID,"type",t)},expression:"galaxyForm.filters.DLSID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadDLSID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"客户ID",prop:"filters.KHID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.KHID.values,callback:function(t){e.$set(e.galaxyForm.filters.KHID,"values",t)},expression:"galaxyForm.filters.KHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.KHID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.KHID.type,callback:function(t){e.$set(e.galaxyForm.filters.KHID,"type",t)},expression:"galaxyForm.filters.KHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadKHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"查询词",prop:"filters.CXC.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.CXC.values,callback:function(t){e.$set(e.galaxyForm.filters.CXC,"values",t)},expression:"galaxyForm.filters.CXC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4,prop:"filters.CXC.type"}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.CXC.type,callback:function(t){e.$set(e.galaxyForm.filters.CXC,"type",t)},expression:"galaxyForm.filters.CXC.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"计划ID",prop:"filters.JHID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.JHID.values,callback:function(t){e.$set(e.galaxyForm.filters.JHID,"values",t)},expression:"galaxyForm.filters.JHID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4,prop:"filters.JHID.type"}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px"}},[a("el-select",{model:{value:e.galaxyForm.filters.JHID.type,callback:function(t){e.$set(e.galaxyForm.filters.JHID,"type",t)},expression:"galaxyForm.filters.JHID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadJHID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"组ID",prop:"filters.ZID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.ZID.values,callback:function(t){e.$set(e.galaxyForm.filters.ZID,"values",t)},expression:"galaxyForm.filters.ZID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.ZID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.ZID.type,callback:function(t){e.$set(e.galaxyForm.filters.ZID,"type",t)},expression:"galaxyForm.filters.ZID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadZID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"PID",prop:"filters.PID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.PID.values,callback:function(t){e.$set(e.galaxyForm.filters.PID,"values",t)},expression:"galaxyForm.filters.PID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.PID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.PID.type,callback:function(t){e.$set(e.galaxyForm.filters.PID,"type",t)},expression:"galaxyForm.filters.PID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadPID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词",prop:"filters.GJC.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.GJC.values,callback:function(t){e.$set(e.galaxyForm.filters.GJC,"values",t)},expression:"galaxyForm.filters.GJC.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"50px",prop:"filters.GJC.type"}},[a("el-select",{model:{value:e.galaxyForm.filters.GJC.type,callback:function(t){e.$set(e.galaxyForm.filters.GJC,"type",t)},expression:"galaxyForm.filters.GJC.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1),e._v(" "),a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"关键词ID",prop:"filters.GJCID.values"}},[a("el-input",{model:{value:e.galaxyForm.filters.GJCID.values,callback:function(t){e.$set(e.galaxyForm.filters.GJCID,"values",t)},expression:"galaxyForm.filters.GJCID.values"}})],1)],1),e._v(" "),a("el-col",{staticClass:"type",attrs:{span:4}},[a("el-form-item",{attrs:{label:"类型","label-width":"45px",prop:"filters.GJCID.type"}},[a("el-select",{attrs:{placeholder:""},model:{value:e.galaxyForm.filters.GJCID.type,callback:function(t){e.$set(e.galaxyForm.filters.GJCID,"type",t)},expression:"galaxyForm.filters.GJCID.type"}},[a("el-option",{attrs:{label:"黑名单",value:"NOTIN"}}),e._v(" "),a("el-option",{attrs:{label:"白名单",value:"IN"}})],1)],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadGJCID,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"勾选提示"}},[a("div",[a("span",[e._v("选项太多找不到？直接搜索试试。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"一级客户行业",prop:"filters.YJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.YJKHHY.values,callback:function(t){e.$set(e.galaxyForm.filters.YJKHHY,"values",t)},expression:"galaxyForm.filters.YJKHHY.values"}},e._l(e.yjkhhyOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("el-form-item",{attrs:{label:"二级客户行业",prop:"filters.EJKHHY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.EJKHHY.values,callback:function(t){e.$set(e.galaxyForm.filters.EJKHHY,"values",t)},expression:"galaxyForm.filters.EJKHHY.values"}},e._l(e.ejkhhyOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"网民区域",prop:"filters.WMQY.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.WMQY.values,callback:function(t){e.$set(e.galaxyForm.filters.WMQY,"values",t)},expression:"galaxyForm.filters.WMQY.values"}},e._l(e.wmqyOptions,function(t){return a("el-option-group",{key:t.label,attrs:{label:t.label}},e._l(t.children,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("el-form-item",{attrs:{label:"大区"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.DQ.values,callback:function(t){e.$set(e.galaxyForm.filters.DQ,"values",t)},expression:"galaxyForm.filters.DQ.values"}},e._l(e.dqOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"二级业务类型",prop:"filters.EJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.EJYWLX.values,callback:function(t){e.$set(e.galaxyForm.filters.EJYWLX,"values",t)},expression:"galaxyForm.filters.EJYWLX.values"}},e._l(e.ejywlxOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("el-form-item",{attrs:{label:"三级业务类型",prop:"filters.SJYWLX.values"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择"},model:{value:e.galaxyForm.filters.SJYWLX.values,callback:function(t){e.$set(e.galaxyForm.filters.SJYWLX,"values",t)},expression:"galaxyForm.filters.SJYWLX.values"}},e._l(e.sjywlxOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"客户类型",prop:"filters.KHLX.values"}},[a("el-checkbox-group",{model:{value:e.galaxyForm.filters.KHLX.values,callback:function(t){e.$set(e.galaxyForm.filters.KHLX,"values",t)},expression:"galaxyForm.filters.KHLX.values"}},e._l(e.khlxOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("输出指标")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"基础指标",prop:"outputs"}},[a("el-checkbox-group",{model:{value:e.galaxyForm.outputs,callback:function(t){e.$set(e.galaxyForm,"outputs",t)},expression:"galaxyForm.outputs"}},[a("el-checkbox",{attrs:{label:"DJ"}},[e._v("点击")]),e._v(" "),a("el-checkbox",{attrs:{label:"XH"}},[e._v("消耗")])],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h3",[e._v("任务信息")]),e._v(" "),a("el-row",[a("el-col",[a("el-form-item",{attrs:{label:"任务名称",prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入任务名称"},model:{value:e.galaxyForm.name,callback:function(t){e.$set(e.galaxyForm,"name",t)},expression:"galaxyForm.name"}})],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("galaxyForm")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("galaxyForm")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},ge=a("VU/8")(ve,be,!1,null,null,null).exports,ye={render:function(){var e=this.$createElement;return(this._self._c||e)("h3",[this._v("角色")])},staticRenderFns:[]},_e=a("VU/8")({data:function(){return{allRoutes:[],waitAddRoutes:[]}}},ye,!1,null,null,null).exports,we=a("mtWM"),ke={data:function(){return{isShowRes:!1,userInfo:"",transQueryId:"",transLoading:!0,transDataCols:[],transData:[]}},methods:{beforeUpload:function(e){var t=this,a=new FormData;return a.append("file",e),we.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.userInfo=e.data}).catch(function(e){console.log(e)}),!1},onTrans:function(){var e=this;this.$message({type:"success",message:"提交成功!"});var t=new URLSearchParams;t.append("sql",this.userInfo),we({method:"post",url:"/dw/sql/id",data:t,responseType:"string"}).then(function(t){e.transQueryId=t.data,e.isShowRes=!0,e.$options.methods.onTransTask.bind(e)()}).catch(function(e){this.$message({type:"danger",message:"任务失败!"}),console.log(e)})},onTransTask:function(){var e=new URLSearchParams;e.append("sql",this.userInfo),e.append("queryId",this.transQueryId),we.post("/dw/sql/custom",e,{responseType:"json"}).then(function(e){self.transDataCols=e.data.cols,self.transData=e.data.data,self.transLoading=!1}).catch(function(e){this.$message({type:"danger",message:"任务失败!"}),self.isShowRes=!1,console.log(e)})}}},xe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("一键转化工具")]),e._v(" "),a("el-row",[a("span",[e._v("转化前原始文件上传或填写。上传文件使用换行分隔，直接填写使用逗号分隔。")]),e._v(" "),a("span",[e._v("注意imei的前后不要有空格！")])]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:14}},[a("el-input",{model:{value:e.userInfo,callback:function(t){e.userInfo=t},expression:"userInfo"}})],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:2}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUpload,"show-file-list":"false"}},[a("i",{staticClass:"el-icon-upload"})])],1),e._v(" "),a("el-col",{attrs:{span:4,offset:1}},[a("el-button",{attrs:{type:"success"},on:{click:e.onTrans}},[e._v("转换")])],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.isShowRes,expression:"isShowRes"}]},[a("span",[e._v("您的提交的转化queryId: ")]),a("strong",[e._v(e._s(e.transQueryId))]),e._v(" "),a("h3",[e._v("查询结果")]),e._v(" "),e._m(0),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.transLoading,expression:"transLoading"}],staticStyle:{width:"100%"},attrs:{data:e.transData}},e._l(e.transDataCols,function(e){return a("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,sortable:e.sortable}})}),1)],1)],1)},staticRenderFns:[function(){var e=this.$createElement,t=this._self._c||e;return t("span",[t("i",{staticClass:"el-icon-bell"}),this._v(" 同步任务查询耗时较长。请耐心等待或转到任务队列查看。")])}]},Ie=a("VU/8")(ke,xe,!1,null,null,null).exports,Te=a("mtWM"),Fe={data:function(){return{taskCols:[],taskData:[],taskForm:{session:"",date:Object(r.d)(new Date),status:""},contentCols:[],contentData:[],contentFiled:"",dialogTableVisible:!1,taskLoading:!1,dataLoading:!1,dataPathRoot:"",dataPathRootPaga:"",dialogVisible:!1,errMsg:"",assignUserName:"",assignTaskId:"",assignUserVisible:!1,maxHeight:""}},methods:{deleteTask:function(e){var t=e.query_id,a=this;Te({method:"delete",url:"/task/deleteTaskRecoder/"+t}).then(function(e){e.data.Res?(a.$message({message:"删除成功",type:"success"}),a.loadTaskData()):a.$message({message:"删除失败:"+e.data.Info,type:"error"})}).catch(function(e){console.log(e)})},onClickAssign:function(){var e={assignUserName:this.assignUserName,assignTaskId:this.assignTaskId};console.log(e);var t=this;Te.post("/task/changeTaskUser",e,{responseType:"json"}).then(function(e){var a=e.data;a.Res?(t.$message({message:"指派成功",type:"success"}),t.loadTaskData()):t.$message({message:a.Info,type:"error"})}).catch(function(e){console.error(e)}),this.assignUserVisible=!1},checkMessage:function(e){this.errMsg="",this.dialogVisible=!0;var t=this,a={queryId:e.query_id};Te.post("/task/checkException",a,{responseType:"json"}).then(function(e){t.errMsg=e.data.res}).catch(function(e){console.error(e)})},thisType2route:function(e){var t=Object(r.n)(e);return console.log(t),t},pathClick:function(e){var t=this,a=this,o=e.status_code,s=e.data_path;if(-1===s.indexOf("xlsx")&&(s+=".csv"),console.log(s),Object(r.g)(o)||Object(r.h)(o)){var n=this.dataPathRoot+"datacenter/"+s+"?op=OPEN",i=this.dataPathRoot+"\ndatacenter/"+s+"?op=OPEN";Object(r.h)(o)&&(n=this.dataPathRootPaga+s+"?op=OPEN",i=this.dataPathRootPaga+"\n"+s+"?op=OPEN"),this.$confirm(i,"RSYNC路径",{confirmButtonText:"点我下载",cancelButtonText:"取消"}).then(function(){t.$copyText(n).then(function(){window.open(n)},function(){a.$message({message:"复制失败",type:"error"})})})}else a.$message({message:"任务没有正常完成，不支持查看！",type:"error"})},dataClick:function(e){var t=this,a=e.status_code,o=e.data_path;if(Object(r.g)(a)||Object(r.h)(a)){t.dialogTableVisible=!0,t.dataLoading=!0;var s=new URLSearchParams;s.append("data_path",o),s.append("status",a),void 0!==t.$refs.plTable&&t.$refs.plTable.reloadData([]),Te({method:"post",url:"/task/data/path",data:s}).then(function(e){var a=e.data;if(a.Res){var o=JSON.parse(a.Info);t.contentCols=o.cols,t.contentData=o.data,t.dataLoading=!1,null!==o.data&&void 0!==o.data.length&&t.$refs.plTable.reloadData(t.contentData)}else t.dataLoading=!1,t.$message({message:a.Info,type:"error"})}).catch(function(e){t.dataLoading=!1,t.$message({message:e,type:"error"}),console.log(e)})}else t.$message({message:"任务没有正常完成，不支持查看！",type:"error"})},assignUser:function(e){console.log(e),this.assignUserVisible=!0,this.assignTaskId=e.query_id},redirectClick:function(e){var t=e.query_id,a=Object(r.n)(e.type);if(a)switch(a){case"jdbc":Te.get("/task/queryLog/"+t).then(function(e){console.log(e.data),sessionStorage.setItem("jdbc_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)});break;case"sql":Te.get("/task/queryLog/"+t).then(function(e){console.log(e.data),sessionStorage.setItem("sub_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)});break;default:Te.get("/task/log/query/"+t).then(function(e){sessionStorage.setItem("sub_history",S()(e.data)),Ss.push({path:a})}).catch(function(e){console.log(e)})}else this.$message({message:"任务类型不支持查看配置！",type:"error"})},reRun:function(e){var t=this,a=e.query_id;console.log("queryId:"+a+", taskType:"+e.type);var o={queryId:a};Te.post("/task/reRun",o,{responseType:"json"}).then(function(e){console.info(e.data.queryId),t.$confirm("重跑成功, 点击确定刷新页面","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){location.reload()})}).catch(function(e){t.$message({message:"重跑失败！"+e.toString(),type:"error"})})},exportExcel:function(){var e=M.a.utils.table_to_book(document.querySelector("#resTable")),t=M.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{V.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"查询结果表.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t},loadTaskData:function(){var e=this;e.taskLoading=!0;var t="/task_god/log/config?session="+this.taskForm.session+"&date="+this.taskForm.date+"&status="+this.taskForm.status;Te.get(t).then(function(t){e.taskLoading=!1,e.taskCols=t.data.cols,e.taskData=t.data.data}).catch(function(e){console.log(e)})}},mounted:function(){this.loadTaskData(),this.maxHeight=.8*document.body.clientHeight-100+"px"},created:function(){var e=this;Te.get("/task/log/rsync").then(function(t){e.dataPathRoot=t.data[0],e.dataPathRootPaga=t.data[1]}).catch(function(e){console.log(e)})}},Se={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("任务队列")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-date-picker",{attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyy 年 MM 月 dd 日","value-format":"yyyy-MM-dd"},on:{change:e.loadTaskData},model:{value:e.taskForm.date,callback:function(t){e.$set(e.taskForm,"date",t)},expression:"taskForm.date"}})],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-select",{attrs:{size:"mini",placeholder:"选择任务状态"},on:{change:e.loadTaskData},model:{value:e.taskForm.status,callback:function(t){e.$set(e.taskForm,"status",t)},expression:"taskForm.status"}},[a("el-option",{attrs:{label:"全部",value:""}}),e._v(" "),a("el-option",{attrs:{label:"任务提交中",value:"0"}}),e._v(" "),a("el-option",{attrs:{label:"任务执行中",value:"1"}}),e._v(" "),a("el-option",{attrs:{label:"任务正在取消",value:"2"}}),e._v(" "),a("el-option",{attrs:{label:"任务完成",value:"3"}}),e._v(" "),a("el-option",{attrs:{label:"任务取消",value:"4"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:5}},[a("el-input",{attrs:{clearable:"",size:"mini",placeholder:"输入用户名"},on:{change:e.loadTaskData},model:{value:e.taskForm.session,callback:function(t){e.$set(e.taskForm,"session",t)},expression:"taskForm.session"}})],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.taskLoading,expression:"taskLoading"}],staticStyle:{width:"100%"},attrs:{data:e.taskData,stripe:"","default-sort":{prop:"create_time",order:"descending"}}},[e._l(e.taskCols,function(e){return a("el-table-column",{key:e.prop,attrs:{prop:e.prop,label:e.label,sortable:e.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"异常"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{directives:[{name:"show",rawName:"v-show",value:4==t.row.status_code,expression:"scope.row.status_code==4"}],attrs:{type:"text",size:"mini"},on:{click:function(a){return e.checkMessage(t.row)}}},[e._v("查看异常\n        ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.pathClick(t.row)}}},[e._v("路径")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.dataClick(t.row)}}},[e._v("数据")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.redirectClick(t.row)}}},[e._v("配置")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.assignUser(t.row)}}},[e._v("指派")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.deleteTask(t.row)}}},[e._v("删除")])]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:"异常信息",visible:e.dialogVisible,width:"50%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("el-input",{attrs:{type:"textarea",placeholder:"无异常内容显示",rows:20,"max-rows":30,readonly:!0},model:{value:e.errMsg,callback:function(t){e.errMsg=t},expression:"errMsg"}})],1),e._v(" "),a("el-dialog",{attrs:{title:"查询结果",visible:e.dialogTableVisible,width:"70%"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("el-row",[a("span",[e._v(" 该表为样例数据，最多展现5000条。")])]),e._v(" "),a("pl-table",{directives:[{name:"loading",rawName:"v-loading",value:e.dataLoading,expression:"dataLoading"}],ref:"plTable",attrs:{selectTrClass:"selectTr","max-height":500,"use-virtual":!0,"header-drag-style":"",fixedColumnsRoll:"","inverse-current-row":""}},[a("template",{slot:"empty"},[e._v("\n        没有查询到符合条件的记录\n      ")]),e._v(" "),e._l(e.contentCols,function(e){return a("pl-table-column",{key:e.id,attrs:{resizable:!0,"show-overflow-tooltip":!0,prop:e.prop,label:e.label,fixed:e.fixed}})})],2)],1),e._v(" "),a("el-dialog",{attrs:{title:"分发给用户",visible:e.assignUserVisible},on:{"update:visible":function(t){e.assignUserVisible=t}}},[a("el-form",[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.assignUserName,callback:function(t){e.assignUserName=t},expression:"assignUserName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onClickAssign()}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]};var De=a("VU/8")(Fe,Se,!1,function(e){a("wLEb"),a("kLPt")},null,null).exports,Ce=a("mtWM"),Ne={data:function(){return{dateOptions:G.dateOptions,ad_pos_up:G.abtestAdPosUp,ad_pos_mid:G.abtestAdPosMid,ad_pos_down:G.abtestAdPosDown,isIndeterminatePosUp:!0,isIndeterminatePosMid:!0,isIndeterminatePosDown:!0,checkAllPosUp:!1,checkAllPosMid:!1,checkAllPosDown:!1,ipNorth:G.abtestIP.north,ipSouth:G.abtestIP.south,ipJiangSu:G.abtestIP.jiangsu,ip:G.abtestIP.wap,ABrules:G.nameRule,ABform:{name:"",date_range:G.dateRange,type:"无线小流量任务",ad_pos_restrict_up:[],ad_pos_restrict_mid:[],ad_pos_restrict_down:[],ad_pos_restrict:[],ip_restrict:[],expr_flow:{pos:"",value:"",type:"equal"},ctrl_flow:{pos:"",value:"",type:"equal"},extend_reserve:{rshift:"",and:"",value:""},style_reserve:{rshift:"",and:"",value:"",pos:""},click_flag:{f_value:"",rshift:"",value:""}}}},methods:{handleCheckAllChangePosUp:function(e){this.ABform.ad_pos_restrict_up=e?this.ad_pos_up:[],this.isIndeterminatePosUp=!1},handleCheckedChangePosUp:function(e){var t=e.length;this.checkAllPosUp=t===this.ad_pos_up.length,this.isIndeterminatePosUp=t>0&&t<this.ad_pos_up.length},handleCheckAllChangePosMid:function(e){this.ABform.ad_pos_restrict_mid=e?this.ad_pos_mid:[],this.isIndeterminatePosMid=!1},handleCheckedChangePosMid:function(e){var t=e.length;this.checkAllPosMid=t===this.ad_pos_mid.length,this.isIndeterminatePosMid=t>0&&t<this.ad_pos_mid.length},handleCheckAllChangePosDown:function(e){this.ABform.ad_pos_restrict_down=e?this.ad_pos_down:[],this.isIndeterminatePosDown=!1},handleCheckedChangePosDown:function(e){var t=e.length;this.checkAllPosDown=t===this.ad_pos_down.length,this.isIndeterminatePosDown=t>0&&t<this.ad_pos_down.length},redirectClick:function(){Ss.push({path:"abproject"})},errorNotify:function(e){this.$notify.error({title:"错误",message:e})},onSubmit:function(e){var t=this;this.ABform.ad_pos_restrict=this.ABform.ad_pos_restrict_up.concat(this.ABform.ad_pos_restrict_mid,this.ABform.ad_pos_restrict_down),this.$refs[e].validate(function(e){e?Ce({method:"post",url:"/small/submit2ws",data:S()(t.ABform)}).then(function(e){t.$notify({title:e.data,message:"服务器接收到您的请求并分配查询ID。您可以转到查询页面查看项目！",type:"success",duration:2e3,onClick:t.redirectClick})}).catch(function(e){t.$options.methods.errorNotify(e)}):t.$options.methods.errorNotify("请补充内容后重提交！")})},onReset:function(e){this.$refs[e].resetFields()},getIp:function(){var e=this;Ce.get("small/ip/wap").then(function(t){var a=[];t.data.forEach(function(e){a=a.concat(e.ips)}),e.ip=a})},loadHistory:function(){var e=JSON.parse(sessionStorage.getItem("abtest_resubmit"));if(sessionStorage.removeItem("abtest_resubmit"),e)for(var t in e)this.ABform[t]=e[t]}},mounted:function(){this.loadHistory()},created:function(){this.getIp()}},Oe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("无线小流量监测工具申请")]),e._v(" "),a("el-form",{ref:"ABform",attrs:{model:e.ABform,rules:e.ABrules,"label-width":"80px"}},[a("h4",[e._v("项目配置")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.ABform.name,callback:function(t){e.$set(e.ABform,"name",t)},expression:"ABform.name"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"全局位置"}},[a("el-form-item",{attrs:{label:"",prop:"ad_pos_restrict_up"}},[a("el-col",{attrs:{span:3}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminatePosUp},on:{change:e.handleCheckAllChangePosUp},model:{value:e.checkAllPosUp,callback:function(t){e.checkAllPosUp=t},expression:"checkAllPosUp"}},[e._v("全选上方")])],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-checkbox-group",{on:{change:e.handleCheckedChangePosUp},model:{value:e.ABform.ad_pos_restrict_up,callback:function(t){e.$set(e.ABform,"ad_pos_restrict_up",t)},expression:"ABform.ad_pos_restrict_up"}},e._l(e.ad_pos_up,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"ad_pos_restrict_mid"}},[a("el-col",{attrs:{span:3}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminatePosMid},on:{change:e.handleCheckAllChangePosMid},model:{value:e.checkAllPosMid,callback:function(t){e.checkAllPosMid=t},expression:"checkAllPosMid"}},[e._v("全选中间")])],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-checkbox-group",{on:{change:e.handleCheckedChangePosMid},model:{value:e.ABform.ad_pos_restrict_mid,callback:function(t){e.$set(e.ABform,"ad_pos_restrict_mid",t)},expression:"ABform.ad_pos_restrict_mid"}},e._l(e.ad_pos_mid,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"ad_pos_restrict_down"}},[a("el-col",{attrs:{span:3}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminatePosDown},on:{change:e.handleCheckAllChangePosDown},model:{value:e.checkAllPosDown,callback:function(t){e.checkAllPosDown=t},expression:"checkAllPosDown"}},[e._v("全选下方")])],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-checkbox-group",{on:{change:e.handleCheckedChangePosDown},model:{value:e.ABform.ad_pos_restrict_down,callback:function(t){e.$set(e.ABform,"ad_pos_restrict_down",t)},expression:"ABform.ad_pos_restrict_down"}},e._l(e.ad_pos_down,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"全局IP",prop:"ip_restrict"}},[a("el-col",{attrs:{span:22}},[a("el-checkbox-group",{model:{value:e.ABform.ip_restrict,callback:function(t){e.$set(e.ABform,"ip_restrict",t)},expression:"ABform.ip_restrict"}},e._l(e.ip,function(e){return a("el-checkbox",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h4",[e._v("实验路样式判断")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"流量标签"}},[a("el-col",{attrs:{span:2}},[a("span",[e._v("$43字段第")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_flow.pos",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_flow.pos,callback:function(t){e.$set(e.ABform.expr_flow,"pos",t)},expression:"ABform.expr_flow.pos"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",[e._v("位")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_flow.type"}},[a("el-select",{attrs:{size:"mini"},model:{value:e.ABform.expr_flow.type,callback:function(t){e.$set(e.ABform.expr_flow,"type",t)},expression:"ABform.expr_flow.type"}},[a("el-option",{attrs:{label:"包含",value:"include"}}),e._v(" "),a("el-option",{attrs:{label:"等于",value:"equal"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-form-item",{attrs:{prop:"expr_flow.value",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_flow.value,callback:function(t){e.$set(e.ABform.expr_flow,"value",t)},expression:"ABform.expr_flow.value"}})],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"extend_reserve"}},[a("el-col",{attrs:{span:4,offset:1}},[a("span",[e._v("PV日志$32字段 rshift:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"extend_reserve.rshift"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.extend_reserve.rshift,callback:function(t){e.$set(e.ABform.extend_reserve,"rshift",t)},expression:"ABform.extend_reserve.rshift"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("and:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"extend_reserve.and"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.extend_reserve.and,callback:function(t){e.$set(e.ABform.extend_reserve,"and",t)},expression:"ABform.extend_reserve.and"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("value:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"extend_reserve.value"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.extend_reserve.value,callback:function(t){e.$set(e.ABform.extend_reserve,"value",t)},expression:"ABform.extend_reserve.value"}})],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"style_reserve"}},[a("el-col",{attrs:{span:4,offset:1}},[a("span",[e._v("PV日志$58字段 rshift:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"style_reserve.rshift"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.style_reserve.rshift,callback:function(t){e.$set(e.ABform.style_reserve,"rshift",t)},expression:"ABform.style_reserve.rshift"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("and:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"style_reserve.and"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.style_reserve.and,callback:function(t){e.$set(e.ABform.style_reserve,"and",t)},expression:"ABform.style_reserve.and"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("value:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"style_reserve.value"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.style_reserve.value,callback:function(t){e.$set(e.ABform.style_reserve,"value",t)},expression:"ABform.style_reserve.value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("span",[e._v("逗号分隔第")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"style_reserve.pos"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.style_reserve.pos,callback:function(t){e.$set(e.ABform.style_reserve,"pos",t)},expression:"ABform.style_reserve.pos"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("span",[e._v("位")])])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"点击标志"}},[a("el-col",{attrs:{span:4,offset:1}},[a("span",[e._v("CD日志$54字段 &0xFFFF:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"click_flag.f_value"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.click_flag.f_value,callback:function(t){e.$set(e.ABform.click_flag,"f_value",t)},expression:"ABform.click_flag.f_value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("rshift:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"click_flag.rshift"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.click_flag.rshift,callback:function(t){e.$set(e.ABform.click_flag,"rshift",t)},expression:"ABform.click_flag.rshift"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("value:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"click_flag.value"}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.click_flag.value,callback:function(t){e.$set(e.ABform.click_flag,"value",t)},expression:"ABform.click_flag.value"}})],1)],1)],1)],1),e._v(" "),a("hr"),e._v(" "),a("h4",[e._v("对照路样式判断")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"流量标签"}},[a("el-col",{attrs:{span:2}},[a("span",[e._v("$43字段第")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_flow.pos",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_flow.pos,callback:function(t){e.$set(e.ABform.ctrl_flow,"pos",t)},expression:"ABform.ctrl_flow.pos"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("span",[e._v("位")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_flow.type"}},[a("el-select",{attrs:{placeholder:"",size:"mini"},model:{value:e.ABform.ctrl_flow.type,callback:function(t){e.$set(e.ABform.ctrl_flow,"type",t)},expression:"ABform.ctrl_flow.type"}},[a("el-option",{attrs:{label:"包含",value:"include"}}),e._v(" "),a("el-option",{attrs:{label:"等于",value:"equal"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-form-item",{attrs:{prop:"ctrl_flow.value",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_flow.value,callback:function(t){e.$set(e.ABform.ctrl_flow,"value",t)},expression:"ABform.ctrl_flow.value"}})],1)],1)],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("ABform")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("ABform")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},Re=a("VU/8")(Ne,Oe,!1,null,null,null).exports,$e=a("mtWM");a("kZ1R");var Ee={data:function(){return{dateOptions:G.dateOptions,ad_pos_up:G.abtestAdPosUpPc,ad_pos_down:G.abtestAdPosDownPc,isIndeterminatePosUp:!0,isIndeterminatePosMid:!0,isIndeterminatePosDown:!0,checkAllPosUp:!1,checkAllPosMid:!1,checkAllPosDown:!1,ip:G.abtestIP.pc,ABrules:G.nameRule,ABform:{name:"",date_range:G.dateRange,type:"PC小流量任务",ad_pos_restrict_up:[],ad_pos_restrict_down:[],ad_pos_restrict:[],ip_restrict:[],expr_extend_reserve:{rshift:"",and:"",value:"",pos:""},ctrl_extend_reserve:{rshift:"",and:"",value:"",pos:""}}}},methods:{handleCheckAllChangePosUp:function(e){this.ABform.ad_pos_restrict_up=e?this.ad_pos_up:[],this.isIndeterminatePosUp=!1},handleCheckedChangePosUp:function(e){var t=e.length;this.checkAllPosUp=t===this.ad_pos_up.length,this.isIndeterminatePosUp=t>0&&t<this.ad_pos_up.length},handleCheckAllChangePosMid:function(e){this.ABform.ad_pos_restrict_mid=e?this.ad_pos_mid:[],this.isIndeterminatePosMid=!1},handleCheckedChangePosMid:function(e){var t=e.length;this.checkAllPosMid=t===this.ad_pos_mid.length,this.isIndeterminatePosMid=t>0&&t<this.ad_pos_mid.length},handleCheckAllChangePosDown:function(e){this.ABform.ad_pos_restrict_down=e?this.ad_pos_down:[],this.isIndeterminatePosDown=!1},handleCheckedChangePosDown:function(e){var t=e.length;this.checkAllPosDown=t===this.ad_pos_down.length,this.isIndeterminatePosDown=t>0&&t<this.ad_pos_down.length},redirectClick:function(){Ss.push({path:"abproject"})},errorNotify:function(e){this.$notify.error({title:"错误",message:e})},onSubmit:function(e){var t=this;this.ABform.ad_pos_restrict=this.ABform.ad_pos_restrict_up.concat(this.ABform.ad_pos_restrict_down),this.$refs[e].validate(function(e){e?$e({method:"post",url:"/small/submit2pc",data:S()(t.ABform)}).then(function(e){t.$notify({title:e.data,message:"服务器接收到您的请求并分配查询ID。您可以转到查询页面查看项目！",type:"success",duration:2e3,onClick:t.redirectClick})}).catch(function(e){t.$options.methods.errorNotify(e)}):t.$options.methods.errorNotify("请补充内容后重提交！")})},onReset:function(e){this.$refs[e].resetFields()},getIp:function(){var e=this;$e.get("small/ip/pc").then(function(t){var a=[];t.data.forEach(function(e){a=a.concat(e.ips)}),e.ip=a})},loadHistory:function(){var e=JSON.parse(sessionStorage.getItem("abtest_resubmit"));if(sessionStorage.removeItem("abtest_resubmit"),e)for(var t in e)this.ABform[t]=e[t]}},mounted:function(){this.loadHistory()},created:function(){this.getIp()}},Ae={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("PC小流量监测工具申请")]),e._v(" "),a("el-form",{ref:"ABform",attrs:{model:e.ABform,rules:e.ABrules,"label-width":"80px"}},[a("h4",[e._v("项目配置")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:18}},[a("el-form-item",{attrs:{label:"项目名称",prop:"name"}},[a("el-input",{attrs:{clearable:""},model:{value:e.ABform.name,callback:function(t){e.$set(e.ABform,"name",t)},expression:"ABform.name"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"全局位置"}},[a("el-form-item",{attrs:{label:"",prop:"ad_pos_restrict_up"}},[a("el-col",{attrs:{span:3}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminatePosUp},on:{change:e.handleCheckAllChangePosUp},model:{value:e.checkAllPosUp,callback:function(t){e.checkAllPosUp=t},expression:"checkAllPosUp"}},[e._v("全选上方")])],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-checkbox-group",{on:{change:e.handleCheckedChangePosUp},model:{value:e.ABform.ad_pos_restrict_up,callback:function(t){e.$set(e.ABform,"ad_pos_restrict_up",t)},expression:"ABform.ad_pos_restrict_up"}},e._l(e.ad_pos_up,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"",prop:"ad_pos_restrict_down"}},[a("el-col",{attrs:{span:3}},[a("el-checkbox",{attrs:{indeterminate:e.isIndeterminatePosDown},on:{change:e.handleCheckAllChangePosDown},model:{value:e.checkAllPosDown,callback:function(t){e.checkAllPosDown=t},expression:"checkAllPosDown"}},[e._v("全选下方")])],1),e._v(" "),a("el-col",{attrs:{span:20}},[a("el-checkbox-group",{on:{change:e.handleCheckedChangePosDown},model:{value:e.ABform.ad_pos_restrict_down,callback:function(t){e.$set(e.ABform,"ad_pos_restrict_down",t)},expression:"ABform.ad_pos_restrict_down"}},e._l(e.ad_pos_down,function(t){return a("el-checkbox",{key:t,attrs:{label:t}},[e._v(e._s(t))])}),1)],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"全局IP",prop:"ip_restrict"}},[a("el-col",{attrs:{span:22}},[a("el-checkbox-group",{model:{value:e.ABform.ip_restrict,callback:function(t){e.$set(e.ABform,"ip_restrict",t)},expression:"ABform.ip_restrict"}},e._l(e.ip,function(e){return a("el-checkbox",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1),e._v(" "),a("h4",[e._v("实验路样式判断")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"new_extend_reserve"}},[a("el-col",{attrs:{span:4,offset:2}},[a("span",[e._v("PV日志$61字段 rshift:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_extend_reserve.rshift",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_extend_reserve.rshift,callback:function(t){e.$set(e.ABform.expr_extend_reserve,"rshift",t)},expression:"ABform.expr_extend_reserve.rshift"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("and:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_extend_reserve.and",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_extend_reserve.and,callback:function(t){e.$set(e.ABform.expr_extend_reserve,"and",t)},expression:"ABform.expr_extend_reserve.and"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("value:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_extend_reserve.value",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_extend_reserve.value,callback:function(t){e.$set(e.ABform.expr_extend_reserve,"value",t)},expression:"ABform.expr_extend_reserve.value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("span",[e._v("逗号分隔第")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"expr_extend_reserve.pos",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.expr_extend_reserve.pos,callback:function(t){e.$set(e.ABform.expr_extend_reserve,"pos",t)},expression:"ABform.expr_extend_reserve.pos"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("span",[e._v("位")])])],1)],1),e._v(" "),a("hr"),e._v(" "),a("h4",[e._v("对照路样式判断")]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"new_extend_reserve"}},[a("el-col",{attrs:{span:4,offset:2}},[a("span",[e._v("PV日志$61字段 rshift:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_extend_reserve.rshift",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_extend_reserve.rshift,callback:function(t){e.$set(e.ABform.ctrl_extend_reserve,"rshift",t)},expression:"ABform.ctrl_extend_reserve.rshift"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("and:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_extend_reserve.and",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_extend_reserve.and,callback:function(t){e.$set(e.ABform.ctrl_extend_reserve,"and",t)},expression:"ABform.ctrl_extend_reserve.and"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("span",[e._v("value:")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_extend_reserve.value",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_extend_reserve.value,callback:function(t){e.$set(e.ABform.ctrl_extend_reserve,"value",t)},expression:"ABform.ctrl_extend_reserve.value"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("span",[e._v("逗号分隔第")])]),e._v(" "),a("el-col",{attrs:{span:2}},[a("el-form-item",{attrs:{prop:"ctrl_extend_reserve.pos",required:""}},[a("el-input",{attrs:{size:"mini",clearable:""},model:{value:e.ABform.ctrl_extend_reserve.pos,callback:function(t){e.$set(e.ABform.ctrl_extend_reserve,"pos",t)},expression:"ABform.ctrl_extend_reserve.pos"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("span",[e._v("位")])])],1)],1)],1),e._v(" "),a("div",{staticClass:"formCommit"},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onSubmit("ABform")}}},[e._v("立即提交")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("ABform")}}},[e._v("重置")])],1)],1)],1)],1)},staticRenderFns:[]},Le=a("VU/8")(Ee,Ae,!1,null,null,null).exports,Pe=a("mtWM"),Me={data:function(){return{readyLoading:!1,readyData:[],readyCols:[],projectLoading:!1,projectData:[],projectCols:[],offlineLoading:!1,offlineData:[],offlineCols:[]}},methods:{projectClick:function(e){sessionStorage.setItem("abtest_info",S()(e)),Ss.push({path:"abdata"})},projectResubmit:function(e){var t=this,a=e.task_id,o=e.task_type;Pe.get("/small/log/query/"+a).then(function(e){sessionStorage.setItem("abtest_resubmit",S()(e.data)),"无线小流量任务"!==o?Ss.push({path:"abpc"}):Ss.push({path:"abwap"})}).catch(function(e){t.errorNotify(e)})},loadReadyData:function(){var e=this;e.readyLoading=!0,Pe.get("/small/log/ready").then(function(t){e.readyLoading=!1,e.readyCols=t.data.cols,e.readyData=t.data.data})},loadProjectData:function(){var e=this;e.projectLoading=!0,Pe.get("/small/log/enable").then(function(t){e.projectLoading=!1,e.projectCols=t.data.cols,e.projectData=t.data.data})},loadOfflineData:function(){var e=this;e.offlineLoading=!0,Pe.get("/small/log/disable").then(function(t){e.offlineLoading=!1,e.offlineCols=t.data.cols,e.offlineData=t.data.data})},loadData:function(){this.loadReadyData(),this.loadProjectData(),this.loadOfflineData()},errorNotify:function(e){this.$notify.error({title:"错误",message:e})},projectOnline:function(e){var t=this,a=e.task_id,o=e.session;Object(r.i)(o)?Pe.get("/small/task/online/"+a).then(function(){t.loadData()}).catch(function(e){t.errorNotify(e)}):this.errorNotify("您不是项目所有者，无权操作！")},projectOffline:function(e){var t=this,a=e.task_id,o=e.session;Object(r.i)(o)?Pe.get("/small/task/offline/"+a).then(function(){t.loadData()}).catch(function(e){t.errorNotify(e)}):this.errorNotify("您不是项目所有者，无权操作！")}},mounted:function(){this.loadData()}},Ue={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("待上线项目")]),e._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.readyLoading,expression:"readyLoading"}],staticStyle:{width:"100%"},attrs:{data:e.readyData,stripe:"","default-sort":{prop:"",order:"descending"}}},[e._l(e.readyCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.projectOnline(t.row)}}},[e._v("上线")])]}}])})],2)],1),e._v(" "),a("h3",[e._v("上线项目")]),e._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.projectLoading,expression:"projectLoading"}],staticStyle:{width:"100%"},attrs:{data:e.projectData,stripe:"","default-sort":{prop:"lastUpdate",order:"descending"}}},[e._l(e.projectCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.projectClick(t.row)}}},[e._v("查看数据")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.projectResubmit(t.row)}}},[e._v("查看配置")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.projectOffline(t.row)}}},[e._v("下线")])]}}])})],2)],1),e._v(" "),a("h3",[e._v("下线项目")]),e._v(" "),a("el-row",[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.offlineLoading,expression:"offlineLoading"}],staticStyle:{width:"100%"},attrs:{data:e.offlineData,stripe:"","default-sort":{prop:"",order:"descending"}}},[e._l(e.offlineCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"200"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.projectOnline(t.row)}}},[e._v("重新上线")])]}}])})],2)],1)],1)},staticRenderFns:[]},Ve=a("VU/8")(Me,Ue,!1,null,null,null).exports,je=a("mtWM"),Be={data:function(){return{dataForm:{task_id:"",date_range:G.dateRange,custom_id:[],is_avg:!1,is_mobil_qq:!1,is_same:!1,is_custom:!1,query:"整体页面",download:"实验样式页面",type:0},resCols:[],resData:[],resLoading:!1}},methods:{changeSame:function(e){this.dataForm.is_same="实验样式同质页面"===e||"同质样式"===e},beforeUpload:function(e){var t=this,a=new FormData;return a.append("file",e),je.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.dataForm.custom_id=e.data}).catch(function(e){console.log(e)}),!1},redirectClick:function(){Ss.push({path:"que"})},msgNotify:function(e){this.$notify({title:e,message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},errorNotify:function(e){this.$notify.error({title:"错误",message:e})},submitDataForm:function(){var e=this;if(""===this.dataForm.custom_id&&(this.dataForm.custom_id=[]),"string"==typeof this.dataForm.custom_id){var t=this.dataForm.custom_id;this.dataForm.custom_id=t.split(",")}e.resLoading=!0,je({method:"post",url:"/small/query",data:S()(e.dataForm)}).then(function(t){e.resLoading=!1,e.resCols=t.data.cols,e.resData=t.data.data}).catch(function(t){e.errorNotify(t)})},downloadDataForm:function(){var e=this;if(""===this.dataForm.custom_id&&(this.dataForm.custom_id=[]),"string"==typeof this.dataForm.custom_id){var t=this.dataForm.custom_id;this.dataForm.custom_id=t.split(",")}je({method:"post",url:"/small/download",data:S()(e.dataForm)}).then(function(t){e.$options.methods.msgNotify.bind(e)(t.data)}).catch(function(t){e.errorNotify("出错了！请联系管理员。"),console.log(t)})},exportExcel:function(){var e=M.a.utils.table_to_book(document.querySelector("#abTable")),t=M.a.write(e,{bookType:"xlsx",bookSST:!0,type:"array"});try{V.a.saveAs(new Blob([t],{type:"application/octet-stream"}),"ABtestRes.xlsx")}catch(e){"undefined"!=typeof console&&console.log(e,t)}return t}},created:function(){var e=JSON.parse(sessionStorage.getItem("abtest_info"));e&&(this.dataForm.task_id=e.task_id)}},qe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("数据查询")]),e._v(" "),a("el-form",{ref:"dataForm",attrs:{model:e.dataForm,"label-width":"80px"}},[a("el-row",[a("el-col",{attrs:{span:14}},[a("el-form-item",{attrs:{label:"项目ID",prop:"name"}},[a("el-input",{attrs:{placeholder:"请输入",clearable:""},model:{value:e.dataForm.task_id,callback:function(t){e.$set(e.dataForm,"task_id",t)},expression:"dataForm.task_id"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"起止日期"}},[a("el-date-picker",{attrs:{type:"daterange",align:"right","unlink-panels":"","range-separator":"至","start-placeholder":"开始日期","end-placeholder":"结束日期","value-format":"yyyyMMdd"},model:{value:e.dataForm.date_range,callback:function(t){e.$set(e.dataForm,"date_range",t)},expression:"dataForm.date_range"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"上传提示"}},[a("div",[a("span",[e._v("请上传UTF8编码的纯文本文件，注意使用换行分隔。上传成功后内容会显示在输入框中。")])])])],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"客户ID"}},[a("el-input",{attrs:{type:"array",placeholder:'请注意使用","分隔',clearable:""},model:{value:e.dataForm.custom_id,callback:function(t){e.$set(e.dataForm,"custom_id",t)},expression:"dataForm.custom_id"}})],1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[a("el-upload",{staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUpload,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"结果筛选"}},[a("el-col",{attrs:{span:5}},[a("el-switch",{attrs:{"active-text":"手Q渠道结果"},model:{value:e.dataForm.is_mobil_qq,callback:function(t){e.$set(e.dataForm,"is_mobil_qq",t)},expression:"dataForm.is_mobil_qq"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-switch",{attrs:{"active-text":"同质结果"},model:{value:e.dataForm.is_same,callback:function(t){e.$set(e.dataForm,"is_same",t)},expression:"dataForm.is_same"}})],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-switch",{attrs:{"active-text":"分日结果"},model:{value:e.dataForm.is_avg,callback:function(t){e.$set(e.dataForm,"is_avg",t)},expression:"dataForm.is_avg"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"查询筛选"}},[a("el-radio-group",{attrs:{size:"small"},model:{value:e.dataForm.query,callback:function(t){e.$set(e.dataForm,"query",t)},expression:"dataForm.query"}},[a("el-radio-button",{attrs:{label:"整体页面"}}),e._v(" "),a("el-radio-button",{attrs:{label:"实验样式-样式"}}),e._v(" "),a("el-radio-button",{attrs:{label:"实验样式-页面"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"下载筛选"}},[a("el-radio-group",{attrs:{size:"small"},on:{change:function(t){return e.changeSame(e.dataForm.download)}},model:{value:e.dataForm.download,callback:function(t){e.$set(e.dataForm,"download",t)},expression:"dataForm.download"}},[a("el-radio-button",{attrs:{label:"实验样式页面"}}),e._v(" "),a("el-radio-button",{attrs:{label:"实验样式"}}),e._v(" "),a("el-radio-button",{attrs:{label:"实验样式同质页面"}}),e._v(" "),a("el-radio-button",{attrs:{label:"同质样式"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:6}},[a("el-button",{attrs:{type:"primary"},on:{click:e.submitDataForm}},[e._v("立即查询")]),e._v(" "),a("el-button",{on:{click:e.downloadDataForm}},[e._v("提交下载")])],1)],1)],1),e._v(" "),a("h3",[e._v("数据结果")]),e._v(" "),a("el-row",[a("span",[e._v("点击按钮即可下载数据表。")]),e._v(" "),a("el-button",{attrs:{type:"success",icon:"el-icon-download",circle:"",size:"mini"},on:{click:e.exportExcel}})],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.resLoading,expression:"resLoading"}],staticStyle:{width:"100%"},attrs:{id:"abTable",data:e.resData,stripe:""}},e._l(e.resCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),1)],1)},staticRenderFns:[]},He=a("VU/8")(Be,qe,!1,null,null,null).exports,ze=a("mtWM"),Je={data:function(){return{content:""}},methods:{handleRefreshingContent:function(){var e=this;ze.get("doc/gethtml").then(function(t){e.content=t.data}).catch(function(t){e.$notify.error({title:"错误",message:t})})},redirectClick:function(){Ss.push({path:"docedit"})}},created:function(){this.handleRefreshingContent()}},Ge={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("el-row",[t("h3",{staticClass:"inline-title"},[this._v("帮助与说明 ")]),this._v(" "),t("el-button",{attrs:{type:"text",icon:"el-icon-edit",circle:""},on:{click:this.redirectClick}})],1),this._v(" "),t("div",{domProps:{innerHTML:this._s(this.content)}})],1)},staticRenderFns:[]},Ye=a("VU/8")(Je,Ge,!1,null,null,null).exports,We=a("OS1Z"),Ke=(a("pw1w"),a("mw3O"),a("mtWM")),Xe={name:"editor",components:{mavonEditor:We.mavonEditor},data:function(){return{docForm:{content:"",html:"",submitter:"ADMIN"},img_file:[],code_style:"github"}},methods:{rndStr:function(e){for(var t="",a="abcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*a.length));return t},$imgAdd:function(e,t){var a=this;this.img_file[e]=t;var o="sign_encode1="+this.rndStr(16)+"&encode1="+encodeURIComponent(t.miniurl);fetch("/yuntu/http_upload?appid=201061",{method:"POST",headers:{"Content-Type":"application/x-www-form-urlencoded"},body:o}).then(function(e){return e.json()}).then(function(t){var o=t[0];a.$refs.md.$img2Url(e,o.url)}).catch(function(e){console.log(e)})},$imgDel:function(e){delete this.img_file[e]},$saveDoc:function(e,t){var a=this;a.docForm.content=e,a.docForm.html=t,Ke({url:"doc/submit",method:"post",data:this.docForm}).then(function(e){a.$notify.success({title:"提示",message:e.data})}).catch(function(e){a.$notify.error({title:"错误",message:e})})},handleRefreshingContent:function(){var e=this;Ke.get("doc/get").then(function(t){e.docForm.content=t.data}).catch(function(t){e.$notify.error({title:"错误",message:t})})},redirectClick:function(){Ss.push({path:"doc"})}},mounted:function(){this.handleRefreshingContent(),this.docForm.submitter=Object(r.e)("_adtech_user")}},Qe={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("h3",{staticClass:"inline-title"},[e._v("文档编辑")]),e._v(" "),a("span"),e._v(" "),a("el-button",{attrs:{type:"text",icon:"el-icon-view",circle:""},on:{click:e.redirectClick}})],1),e._v(" "),a("div",{attrs:{id:"editor"}},[a("mavon-editor",{ref:"md",staticStyle:{height:"100%"},attrs:{ishljs:!0},on:{imgAdd:e.$imgAdd,imgDel:e.$imgDel,save:e.$saveDoc},model:{value:e.docForm.content,callback:function(t){e.$set(e.docForm,"content",t)},expression:"docForm.content"}})],1)],1)},staticRenderFns:[]};var Ze=a("VU/8")(Xe,Qe,!1,function(e){a("1Bs2")},null,null).exports,et=a("mtWM"),tt={data:function(){return{distFolder:0,newFolderVisible:!1,isOnSubmit:!1,contextMenuTarget:null,cmOptions:{tabSize:4,mode:"text/x-mysql",theme:"default",lineNumbers:!0,dragDrop:!1,line:!0,hintOptions:{tables:{},databases:{}},extraKeys:{Tab:"autocomplete",F12:function(e){console.log(e.getOption("fullScreen")),e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}},readOnly:"nocursor"},cxcValues:[""],form:{name:"",sql:""},options:[],selectValue:"",canDirModify:!1,menuVisible:!1,rules:{name:[{required:!0,message:"请输入任务名称",trigger:"blur"},{min:3,message:"名称长度至少 3 个字符",trigger:"blur"}],sql:[{require:!0,message:"SQL语句不能为空",trigger:"blur"},{validator:function(e,t,a){!0===/drop/i.test(t)||!0===/delete/i.test(t)||!0===/truncate/i.test(t)||!0===/insert/i.test(t)?a(new Error("SQL中存在危险字符!")):a()},trigger:"blur"}]},sqlLoading:!0,sqlQueryId:"",sqlData:[],sqlDataCols:[],treeData:"",defaultProps:{children:"children",label:"label",templateId:"templateId",redashid:"redashid"},filterText:"",sqlText:"",isShow:!0,canModify:!1,onlyRead:!1,curTmplateId:"",curPid:"",description:"",paramNames:[],paramTypes:[],paramValues:[],paramOptions:[{label:"一般类型",value:"string",defaultValue:""},{label:"日期类型",value:"date",defaultValue:"19990101"},{label:"查询词文件分区",value:"qw_partition",defaultValue:""}],jsonParams:"",beforeTransId:"",afterTransId:"",queryWordsPartition:"",file:"",dataSourceIdNameMapping:{},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],dsTypeSelectValue:"",query_checked:!1,createFlag:!0,curRedashQueryId:0,viewAccess:!1,jumpAccess:!1,newFolderData:null}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},computed:{codemirror:function(){return console.log("计算了"),this.$refs.cmEditor.codemirror}},methods:{submitChangeDir:function(){var e=this.newFolderData,t={templateId:this.nodeData.templateId+"",folderId:e.templateId+""},a=this;et.post("/jdbc/template/ChangeTemplateAffiliation",t,{responseType:"json"}).then(function(e){e.data.Res?(a.$notify({message:"更改成功",type:"success"}),a.newFolderVisible=!1,a.getTreeData()):a.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})},selectDistFolder:function(e){this.nodeData.templateId;0!=e.pid?(this.$notify({message:"只能选择一级节点为父目录",type:"error",duration:2e3}),this.newFolderData=null):(this.$notify({message:'已选择 "'+e.label+'" 作为上层目录',type:"success",duration:2e3}),this.newFolderData=e)},onChangeDir:function(){var e=this.nodeData.pid;console.log("点击了:"+S()(this.nodeData)),"0"===e?this.$alert("不能更改目录所属, 只能更改工单所属的目录"):(this.menuVisible=!1,this.newFolderVisible=!0)},onDelJdbc:function(){var e=this,t={templateId:this.nodeData.templateId};this.$confirm("确认永久删除工单吗",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){et.post("/jdbc/template/deleteTemplateById",t,{responseType:"json"}).then(function(t){t.data.Res?e.$notify({message:"删除成功",type:"success"}):e.$notify({message:t.data.Info,type:"error"}),e.getTreeData()}).catch(function(e){console.log(e)})}),this.menuVisible=!1},onCreateRootDir:function(){this.onReset("form"),this.menuVisible=!1,this.$message({type:"success",message:"已选择根节点作为上级"})},getParamOptions:function(e){return-1!==e.search("\\.")?[{label:"一般类型.",value:"timeInterval",defaultValue:""}]:this.paramOptions},onChangeDSType:function(){var e=this;this.dsTypeSelectValue,et.get("/jdbc/template/getAllDataSources?connType="+this.dsTypeSelectValue).then(function(t){e.selectValue="",e.options=t.data}).catch(function(t){e.selectValue="",e.options=[],console.log(t)})},formatCode:function(){var e=this.codemirror;console.log(e);var t=e.getValue();e.setValue(C.a.format(t))},beforeUploadCXC:function(e){var t=this,a=new FormData;return a.append("file",e),et.post("task/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){t.cxcValues=e.data}).catch(function(e){t.errorMsg=e,t.$options.methods.errorNotify.bind(t)()}),!1},onChangeDataSource:function(){for(var e=this.selectValue,t="",a=0;a<this.options.length;a++)if(this.options[a].Dsid===e){t=this.options[a].DatasourceName;break}if(-1!==t.toLowerCase().search("spark")){console.log("当前选择的数据源中包含spark");for(var o=!1,s=0;s<this.paramOptions.length;s++)"qw_partition"===this.paramOptions[s].value&&(o=!0);o||this.paramOptions.push({label:"查询词文件分区",value:"qw_partition",defaultValue:""})}else for(var n=this.paramOptions.length-1;n>=0;n--)"qw_partition"===this.paramOptions[n].value&&this.paramOptions.splice(n,1)},handleFileUpload:function(){for(var e=0,t=0;t<this.paramTypes.length;t++)"qw_partition"===this.paramTypes[t]&&(e=t);console.log(this.$refs.file[e].files[0]),this.file=this.$refs.file[e].files[0]},submitFile:function(){var e=this,t=this;console.log(this.file),this.file?this.$confirm("请确保提交的文件中只包含查询词一列; 表生成完毕会产生提示, 分区名会在底部显示","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var a=new FormData,o=Object(r.e)("_adtech_user");a.append("file",e.file),a.append("username",o),et.post("/dw/upload/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){var a=e.data;a=a.match(/part='(\S*)'/)[1],console.log(a),t.queryWordsPartition=a,t.$message({type:"success",message:"提交成功,分区名为:"+e.data})}).catch(function(e){console.log(e),t.$message({type:"success",message:"提交失败"+e})})}):this.$confirm("请先选择带查询词的csv文件, 文件中只包含查询词一列;","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){})},makeParam:function(){for(var e=[],t=0;t<this.paramNames.length;t++)e.push({name:this.paramNames[t],type:this.paramTypes[t],value:this.paramValues[t]});console.log("paramsName:"+this.paramNames+"\nparamTypes:"+this.paramTypes+"\nparamValues:"+this.paramValues),this.jsonParams=S()(e),console.log("jsonParam:"+this.jsonParams)},redirectClick:function(){Ss.push({path:"que"})},onCreateSqlView:function(e){var t=this;t.curRedashQueryId=0;var a={templateId:t.curTmplateId};et.post("/jdbc/template/createQueryView",a,{responseType:"json"}).then(function(e){e.data.msg.indexOf("成功")>=0?(t.curRedashQueryId=e.data.redash_query_id,t.createFlag=!1,t.isShow=!1,t.$message({type:"success",message:e.data.msg})):t.$message({type:"error",message:e.data.msg})}).catch(function(e){t.$options.methods.saveUpdateNotify.bind(t)(),console.log(e)})},onJumpSqlView:function(e){var t=this;console.log("----------------------onJumpSqlView");var a={templateId:t.curTmplateId};et.post("/jdbc/template/getjumpaccess",a,{responseType:"json"}).then(function(e){if(1==e.data.jumpaccess){var a="http://inner-redash.adtech.sogou/queries/"+t.curRedashQueryId+"/source";t.$router.push({name:"redashqueryshow",params:{queryid:t.curRedashQueryId,queryUrl:a}})}else t.$message({type:"error",message:"可视化非本人创建,请在自助可视化中跳转!"});console.info(e.data)}).catch(function(e){t.$options.methods.saveUpdateNotify.bind(t)(),console.log(e)})},onChangeSql:function(e){var t=this,a={title:t.form.name,template:t.form.sql,templateId:t.curTmplateId,description:t.description};et.post("/jdbc/template/updateJdbcTemplate",a,{responseType:"json"}).then(function(e){t.$message({type:"success",message:"模板更新成功!"}),t.getTreeData()}).catch(function(e){t.$options.methods.saveUpdateNotify.bind(t)(),console.log(e)})},onCreate:function(e){var t=this,a=this,o=Object(r.e)("_adtech_user");this.$refs[e].validate(function(e){return!!e&&(console.log(o),console.log(a.query_checked),console.log(a.dsTypeSelectValue),1==a.query_checked&&"mysql"!=a.dsTypeSelectValue&&"clickhouse"!=a.dsTypeSelectValue?(t.$alert("当前引擎不支持创建可视化！"),!1):void t.$confirm("请确认sql语句正确, 是否创建模板?","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){t.$message({type:"success",message:"请求已提交!"});var e={creator:o,title:t.form.name,template:t.form.sql,dsid:t.selectValue,pid:parseInt(t.curPid),description:t.description,createredash:t.query_checked};console.log(t.query_checked),et({method:"put",url:"/jdbc/template/put",data:e,responseType:"string"}).then(function(e){console.log(e.data),e.data.indexOf("fail")>=0?a.$message({type:"error",message:e.data,duration:5e3}):a.$message({type:"success",message:"创建成功!"}),et.get("/jdbc/template/getAllTemplate").then(function(e){a.treeData=e.data}).catch(function(e){console.log(e)}),a.onReset("form")}).catch(function(e){console.log(e)})}))})},onSubmit:function(e){for(var t=this,a=this,o=0;o<this.paramNames.length;o++)"qw_partition"===this.paramTypes[o]&&(console.log(o),this.paramValues[o]=this.queryWordsPartition);this.makeParam(),this.$refs[e].validate(function(e){if(!e)return!1;t.$confirm("不正确的SQL查询会造成资源浪费，请反复校验查询语句。 是否提交?","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){console.info("dsid:"+t.selectValue);var e="";e="string"==typeof t.cxcValues?t.cxcValues:t.cxcValues.join(",");var o={templateId:t.curTmplateId+"",sql:t.form.sql,param:t.jsonParams,dsid:t.selectValue+"",queryName:t.form.name,queryWords:e};console.log(o),a.isOnSubmit=!0,et.post("/jdbc/template/run",o,{responseType:"json"}).then(function(e){console.log(e.data),a.sqlQueryId=e.data,a.show=!0,a.onReset("form"),e.data.Res?(a.$message({type:"success",message:"提交成功! ("+e.data.Info+")"}),a.$options.methods.msgNotify.bind(a)()):a.$message({type:"error",message:"提交失败: "+e.data.Info,duration:5e3}),a.isOnSubmit=!1}).catch(function(e){a.isOnSubmit=!1,a.$options.methods.errorNotify.bind(a)(),console.log(e),a.$message({type:"error",message:"提交失败!"})})})})},msgNotify:function(){this.$notify({message:"服务器接收到您的请求并分配查询ID。您可以转到任务队列页面查看结果！",type:"success",duration:2e3,onClick:this.redirectClick})},onChangeParamType:function(e){this.paramValues[e]="",console.log(this.paramTypes)},resetParam:function(){this.paramTypes=[],this.paramNames=[],this.paramValues=[],this.jsonParams="",this.createFlag=!0,this.curRedashQueryId=0},onParam:function(e){var t=this;this.resetParam();var a=this.form.sql.match(/\{\{(.+?)\}\}/g);console.log("originParams:"+a),a.forEach(function(e){var a=e.substring(2,e.length-2).trim();-1===t.paramNames.indexOf(a)&&t.paramNames.push(a)}),console.log("paramNames:"+this.paramNames);for(var o=0;o<this.paramNames.length;o++)this.paramValues.push(""),-1!==this.paramNames[o].toLowerCase().search("\\.")?this.paramTypes.push("timeInterval"):-1!==this.paramNames[o].toLowerCase().search("time")?this.paramTypes.push("date"):this.paramTypes.push("string")},onReset:function(e){this.resetParam(),this.$refs[e].resetFields(),this.$nextTick(function(){}),this.isShow=!0,this.selectValue="",this.curPid="",this.description=""},filterNode:function(e,t){if(!e)return!0;var a=e.toLowerCase();return-1!==t.label.toLowerCase().indexOf(a)},errorNotify:function(){this.$notify.error({title:"错误",message:"SQL填写有误。请重新填写后查询！"})},saveUpdateNotify:function(){this.$notify.error({title:"错误",message:"更新失败"})},loadHistory:function(){var e=sessionStorage.getItem("jdbc_history");if(sessionStorage.removeItem("jdbc_history"),e)try{var t=JSON.parse(e);this.form.sql=t.SqlStr,this.form.name=t.QueryName;var a=JSON.parse(t.QueryJson);this.selectValue=a.dsid,this.isShow=!1,this.jsonParams=a.param;for(var o=JSON.parse(this.jsonParams),s=0;s<o.length;s++)this.paramNames.push(o[s].name),this.paramTypes.push(o[s].type),this.paramValues.push(o[s].value);console.log("paramsName:"+this.paramNames+"\nparamTypes:"+this.paramTypes+"\nparamValues:"+this.paramValues),console.log("jsonParam:"+this.jsonParams)}catch(e){console.log(e),this.onReset("form")}},queryInfo:function(e){console.log(e),this.nodeData=e;var t=this;"0"!==e.pid?(this.resetParam(),0!=e.redashid&&(t.curRedashQueryId=e.redashid,t.createFlag=!1),t.isShow=!1,t.curTmplateId=e.templateId,console.log("templateId:"+e.templateId),console.log("label:"+e.label),et.get("/jdbc/template/getById/"+e.templateId).then(function(e){t.form.name=e.data.Title,t.form.sql=e.data.Template,t.selectValue=e.data.Dsid,t.onChangeDataSource(),t.description=e.data.Description}).catch(function(e){console.log(e)}),et.get("/jdbc/template/canModify/"+e.pid).then(function(e){console.log("当前工单可修改:"+e.data),t.canModify=e.data}).catch(function(e){console.log(e)})):(this.resetParam(),0!=e.redashid&&(t.curRedashQueryId=e.redashid,t.createFlag=!1),t.isShow=!1,t.curTmplateId=e.templateId,console.log("templateId:"+e.templateId),console.log("label:"+e.label),t.form.name=e.label,t.form.sql="",t.description="",et.get("/jdbc/template/canModify/"+e.templateId).then(function(e){console.log("当前工单可修改:"+e.data),t.canModify=e.data}).catch(function(e){console.log(e)}),et.get("/jdbc/template/canModify/"+e.templateId).then(function(e){console.log("当前工单目录可修改:"+e.data),t.canDirModify=e.data}).catch(function(e){console.log(e)}))},rightClick:function(e){console.log(e)},treeAdd:function(){this.nodeData.pid+""!="0"?this.$message({type:"error",message:"只能在一级节点下创建模板"}):(this.onReset("form"),this.curPid=this.nodeData.templateId,this.$message({type:"success",message:'已选择:"'+this.nodeData.label+'"('+this.curPid+")作为上级"}))},loadNode:function(e,t){0===e.level&&this.requestTree(t),e.level>=1&&this.getIndex(e,t)},getIndex:function(e,t){et.get("/jdbc/template/getAllTemplate/"+e.data.templateId).then(function(e){var a=e.data;t(a)}).catch(function(e){console.log(e)})},requestTree:function(e){et.get("/jdbc/template/getAllTemplate/0").then(function(t){var a=t.data;e(a)}).catch(function(e){console.log(e)})},transId:function(e){var t=this.beforeTransId.replace(/(^\s*)|(\s*$)/g,""),a="";a=e?"'"+(a=t.replace(/\r/g,"").replace(/\n/g,"','"))+"'":t.replace(/\r/g,"").replace(/\n/g,","),this.afterTransId=a},constructContextMenu:function(){var e=this;this.$nextTick(function(){e.contextMenuTarget=document.querySelector("#el-tree"),document.querySelectorAll('#el-tree [role="treeitem"]').forEach(function(e){e.addEventListener("contextmenu",function(e){e.target.click()})})})},getTreeData:function(){var e=this;et.get("/jdbc/template/getAllTemplate").then(function(t){e.treeData=t.data,e.constructContextMenu()}).catch(function(e){console.log(e)})}},mounted:function(){$(document).ready(function(){var e=document.body.clientHeight,t=e-370+"px";console.log("codemirror:"+t),$(".CodeMirror").css("height",t),document.getElementById("treeDiv").style.height=e-150+"px"}),this.loadHistory();var e=this;this.getTreeData(),et.get("/jdbc/template/getAllDataSources").then(function(t){e.options=t.data}).catch(function(e){console.log(e)}),et.get("/jdbc/template/getEdit").then(function(t){e.onlyRead=t.data.readOnly,e.cmOptions.readOnly=!!e.onlyRead&&"nocursor"}).catch(function(e){console.log(e)}),et.get("/jdbc/template/getviewaccess").then(function(t){e.viewAccess=t.data.viewaccess,console.log("Access"),console.log(e.viewAccess)}).catch(function(e){console.log(e)})}},at={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("SQL工单")]),e._v(" "),a("el-col",{attrs:{span:4}},[a("div",{staticStyle:{height:"700px",overflow:"auto"},attrs:{id:"treeDiv"}},[a("span",[e._v("库中的模板")]),e._v(" "),a("el-input",{attrs:{placeholder:"输入关键字过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,id:"el-tree"},on:{"node-click":e.queryInfo}}),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:e.canModify,expression:"canModify"}]},[a("context-menu",{staticClass:"right-menu",attrs:{target:e.contextMenuTarget,show:e.menuVisible},on:{"update:show":function(t){return e.menuVisible=t}}},[a("a",{attrs:{href:"javascript:"},on:{click:function(){e.treeAdd(),e.menuVisible=!1}}},[e._v("该节点下创建工单")]),e._v(" "),a("a",{attrs:{href:"javascript:"},on:{click:e.onCreateRootDir}},[e._v("根节点下创建新目录")]),e._v(" "),a("a",{attrs:{href:"javascript:"},on:{click:e.onDelJdbc}},[e._v("删除节点")]),e._v(" "),a("a",{attrs:{href:"javascript:"},on:{click:e.onChangeDir}},[e._v("更改工单所属目录")])])],1)],1)]),e._v(" "),a("el-col",{attrs:{span:14,offset:1}},[a("el-form",{ref:"form",attrs:{model:e.form,rules:e.rules}},[a("el-row",[a("el-form-item",{attrs:{prop:"name"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{placeholder:"请输入工单名称"},model:{value:e.form.name,callback:function(t){e.$set(e.form,"name",t)},expression:"form.name"}})],1),e._v(" "),a("el-col",{attrs:{span:4,offset:3}},[a("el-select",{directives:[{name:"show",rawName:"v-show",value:e.isShow&&!e.onlyRead,expression:"isShow  && (!onlyRead)"}],attrs:{placeholder:"请选择数据源类型",clearable:"",filterable:""},on:{change:e.onChangeDSType},model:{value:e.dsTypeSelectValue,callback:function(t){e.dsTypeSelectValue=t},expression:"dsTypeSelectValue"}},e._l(e.dsTypeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-select",{directives:[{name:"show",rawName:"v-show",value:e.isShow&&!e.onlyRead,expression:"isShow  && (!onlyRead)"}],attrs:{placeholder:"请选择工单所属的数据源"},on:{change:e.onChangeDataSource},model:{value:e.selectValue,callback:function(t){e.selectValue=t},expression:"selectValue"}},e._l(e.options,function(e){return a("el-option",{key:e.dsid,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("div",{staticStyle:{"margin-left":"5px"}},[a("span",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],staticStyle:{color:"#BDBDBD"}},[e._v(e._s(e.selectValue))])])])],1)],1),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.isShow&&e.canModify&&!e.onlyRead,expression:"(!isShow) && canModify && (!onlyRead)"}]},[a("span",{staticStyle:{color:"#BDBDBD","font-size":"12px"}},[e._v("若工单名称或工单sql已经修改, 请点击旁边的按钮保存")]),e._v(" "),a("el-button",{attrs:{type:"Dashed",size:"small"},on:{click:function(t){return e.onChangeSql("form")}}},[e._v("保存")])],1),e._v(" "),a("el-row",[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],attrs:{placeholder:"工单描述",rows:1,"max-rows":3,readonly:e.onlyRead},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}},[a("template",{slot:"prepend"},[e._v("工单备注:")])],2)],1),e._v(" "),a("el-form-item",{attrs:{prop:"sql"}},[a("codemirror",{ref:"cmEditor",attrs:{options:e.cmOptions},model:{value:e.form.sql,callback:function(t){e.$set(e.form,"sql",t)},expression:"form.sql"}})],1),e._v(" "),a("el-form-item",[a("el-col",{attrs:{span:"16"}},[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-button",{on:{click:function(t){return e.onParam("form")}}},[e._v("生成参数列表")])],1)],1),e._v(" "),a("el-col",{attrs:{span:"8"}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-checkbox",{directives:[{name:"show",rawName:"v-show",value:e.isShow&&!e.onlyRead,expression:"(isShow && (!onlyRead))"}],model:{value:e.query_checked,callback:function(t){e.query_checked=t},expression:"query_checked"}},[e._v("同步创建Redash_Query")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShow&&e.createFlag&&e.viewAccess,expression:"((!isShow) && createFlag && viewAccess)"}],attrs:{type:"primary"},on:{click:function(t){return e.onCreateSqlView("form")}}},[e._v("创建可视化Query\n            ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShow&&!e.createFlag&&e.viewAccess,expression:"((!isShow) && (!createFlag && viewAccess))"}],attrs:{type:"success"},on:{click:function(t){return e.onJumpSqlView("form")}}},[e._v("跳转可视化\n            ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isShow,expression:"!isShow"}],attrs:{type:"primary",disabled:e.isOnSubmit},on:{click:function(t){return e.onSubmit("form")}}},[e._v("提交执行\n            ")]),e._v(" "),a("el-button",{on:{click:function(t){return e.onReset("form")}}},[e._v("重置")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.isShow&&!e.onlyRead,expression:"(isShow && (!onlyRead))"}],attrs:{type:"primary"},on:{click:function(t){return e.onCreate("form")}}},[e._v("新建工单\n            ")])],1)],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4,offset:1}},[a("el-row",[a("label",[e._v("参数配置")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"参数用于提交的sql中, 不会保存在模板内",placement:"top-start"}},[a("i",{staticClass:"el-icon-question",on:{click:function(t){return e.makeParam()}}})]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],on:{click:function(t){return e.makeParam()}}},[e._v("显示参数")])],1),e._v(" "),e._l(e.paramNames,function(t,o){return[a("el-row",[a("span",[e._v("参数名: "+e._s(t))])]),e._v(" "),a("el-row",[a("el-select",{staticStyle:{width:"100%"},attrs:{placeholder:"请选择参数类型",size:"mini"},on:{change:function(t){return e.onChangeParamType(o)}},model:{value:e.paramTypes[o],callback:function(t){e.$set(e.paramTypes,o,t)},expression:"paramTypes[index]"}},e._l(e.getParamOptions(t),function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-row",[a("el-input",{directives:[{name:"show",rawName:"v-show",value:"string"===e.paramTypes[o]||"timeInterval"===e.paramTypes[o],expression:"(paramTypes[index]==='string')||(paramTypes[index]==='timeInterval')"}],attrs:{placeholder:"请输入",size:"mini"},model:{value:e.paramValues[o],callback:function(t){e.$set(e.paramValues,o,t)},expression:"paramValues[index]"}}),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"22"}},[a("el-input",{directives:[{name:"show",rawName:"v-show",value:"qw_partition"===e.paramTypes[o],expression:"paramTypes[index]==='qw_partition'"}],attrs:{size:"mini",placeholder:"上传查询词"},model:{value:e.cxcValues,callback:function(t){e.cxcValues=t},expression:"cxcValues"}})],1),e._v(" "),a("el-col",{attrs:{span:"1",offset:"1"}},[a("el-upload",{directives:[{name:"show",rawName:"v-show",value:"qw_partition"===e.paramTypes[o],expression:"paramTypes[index]==='qw_partition'"}],staticClass:"upload-demo",attrs:{action:"123","before-upload":e.beforeUploadCXC,"show-file-list":!1}},[a("i",{staticClass:"el-icon-upload2"})])],1)],1),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"qw_partition"===e.paramTypes[o],expression:"paramTypes[index]==='qw_partition'"}]},[a("span",{staticStyle:{color:"#BDBDBD","font-size":"12px"}},[e._v("0:精确匹配,1:模糊匹配")])]),e._v(" "),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:"date"===e.paramTypes[o],expression:"paramTypes[index]==='date'"}],staticStyle:{width:"100%"},attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyyMMdd","value-format":"yyyyMMdd"},model:{value:e.paramValues[o],callback:function(t){e.$set(e.paramValues,o,t)},expression:"paramValues[index]"}})],1)]}),e._v(" "),a("el-row",[a("el-divider",{attrs:{"content-position":"center"}}),e._v(" "),a("label",{staticStyle:{"font-size":"15px"}},[e._v("账号ID格式化工具")]),e._v(" "),a("el-input",{attrs:{type:"textarea",placeholder:"请输入内容 (使用回车分隔)",rows:8,"max-rows":8},model:{value:e.beforeTransId,callback:function(t){e.beforeTransId=t},expression:"beforeTransId"}}),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!1)}}},[e._v("转换")]),e._v(" "),a("el-button",{attrs:{size:"mini"},on:{click:function(t){return e.transId(!0)}}},[e._v("转换字符串")]),e._v(" "),a("el-input",{attrs:{type:"textarea",rows:3,"max-rows":3},model:{value:e.afterTransId,callback:function(t){e.afterTransId=t},expression:"afterTransId"}})],1),e._v(" "),a("el-dialog",{attrs:{title:"选择新目录",visible:e.newFolderVisible},on:{"update:visible":function(t){e.newFolderVisible=t}}},[a("div",{staticStyle:{height:"500px",overflow:"auto"},attrs:{id:"folderTreeDiv"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-tree",{ref:"folderTree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,id:"folderTree"},on:{"node-click":e.selectDistFolder}})],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{size:"small"},on:{click:e.submitChangeDir}},[e._v("确认目录更改")])],1)],1)],2)],1)},staticRenderFns:[]};var ot=a("VU/8")(tt,at,!1,function(e){a("L+hA")},null,null).exports,st=a("mtWM"),nt={data:function(){return{readOnly:!0,importSelection:["hive","clickhouse","mysql"],conditionSelect:{tableType:"",database:"",tableNameLike:""},importForm:{tableType:"",databaseName:"",tableName:"",importId:"",location:"",mysqlOptions:[],hdfsPlaceHolder:"请输入字段信息, 用逗号分隔: 字段名称,字段类型,业务信息描述",hdfsImportStr:"",privilegeRoles:[]},conditionOptions:{tableTypes:"",databases:""},tableForm:{loading:!0,data:[],cols:[]},newTableForm:[{tableName:"",tableType:"",database:"",location:"",compressMode:"",description:""}],tableSelect:{tid:0,tableName:"",tableType:"",database:"",location:"",compressMode:"",description:"",creator:"",createTime:""},dialogVisible:!1,curTid:"",pageParam:{currentPage:1,pageSize:10,totalItems:100},graphVisible:!1,tableTypes:[],showUrl:"",roleOptions:[]}},methods:{getRoleOptions:function(){var e=this;st.get("/auth/roles").then(function(t){e.roleOptions=t.data}).catch(function(e){console.log(e)})},onChangeImportId:function(e){console.log(e);var t=!0,a=!1,o=void 0;try{for(var s,n=y()(this.importForm.mysqlOptions);!(t=(s=n.next()).done);t=!0){var i=s.value;if(i.ImportId===e){this.showUrl=i.ConnectionUrl;break}}}catch(e){a=!0,o=e}finally{try{!t&&n.return&&n.return()}finally{if(a)throw o}}},onChangeImportType:function(){this.importForm.importId="",this.showUrl="";var e=this.importForm.tableType,t=this;st.get("/metaData/tableImport/getConnections?connType="+e).then(function(e){t.importForm.mysqlOptions=e.data}).catch(function(e){console.log(e)})},onImport:function(){console.log(this.importForm.tableType);var e=this,t={tableType:this.importForm.tableType,databaseName:this.importForm.databaseName,tableName:this.importForm.tableName,importId:this.importForm.importId+"",hdfsImportStr:this.importForm.hdfsImportStr,location:this.importForm.location,privilegeRoles:this.importForm.privilegeRoles.join(",")};console.log(t),st.post("metaData/import/single",t,{responseType:"json"}).then(function(t){console.log(t.data);var a="error";t.data.Res&&(a="success"),e.$message({type:a,message:e.importForm.tableType+{success:"导入成功",error:"导入失败"}[a]+"; "+t.data.Info}),e.reInitPageTable()}).catch(function(e){console.log(e)})},checkField:function(e){var t={tableId:e.tid};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"fieldMetaData"})},graphTable:function(e){console.log(e);var t={tableId:e.tid,tableName:e.table_name};sessionStorage.setItem("metaData_graph_tid",S()(t)),Ss.push({path:"tableGraph"})},editTable:function(e){console.log(e),this.curTid=e.tid,this.tableSelect.tid=this.curTid,this.tableSelect.tableName=e.table_name,this.tableSelect.tableType=e.table_type,this.tableSelect.database=e.database_name,this.tableSelect.location=e.location,this.tableSelect.compressMode=e.compress_mode,this.tableSelect.description=e.description,this.tableSelect.creator=e.creator,this.tableSelect.createTime=e.create_time;var t={tableId:e.tid};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},deleteTable:function(e){console.log("tid: "+e.tid);var t=this;this.$confirm("确定删除该表吗?","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"info",center:!0}).then(function(){st.get("/metaData/table/delete/"+e.tid).then(function(e){t.getTableTypes()}).catch(function(e){console.log(e)})})},clearData:function(){this.newTableForm=[{tableName:"",tableType:"",database:"",location:"",compressMode:"",description:""}],this.tableSelect={tid:0,tableName:"",tableType:"",database:"",location:"",compressMode:"",description:"",creator:"",create_time:""}},checkTableName:function(){return""!==this.importForm.tableName&&""!==this.importForm.tableType},onSubmitNewTables:function(){if(this.checkTableName()){console.log(this.importForm);var e=[{tableName:this.importForm.tableName,tableType:this.importForm.tableType,database:this.importForm.databaseName,location:this.importForm.location,compressMode:"",description:"",importId:this.importForm.importId+"",privilegeRoles:this.importForm.privilegeRoles.join(",")}],t=this;st.post("metaData/postTables",e,{responseType:"json"}).then(function(e){var a="error";e.data.Res&&(a="success"),t.$message({type:a,message:e.data.Info}),e.data.Res&&(t.getTableTypes(),t.clearData())}).catch(function(e){console.log(e)})}else this.$message({type:"error",message:"请确保表名不为空"})},removeNewTable:function(e){var t=this.newTableForm.indexOf(e);-1!==t&&this.newTableForm.splice(t,1)},addNewTable:function(){this.newTableForm.push({tableName:"",tableType:"",database:""})},onChangeTableType:function(){var e=this;this.pageParam.currentPage=1,""===e.conditionSelect.tableType?(e.conditionOptions.databases="",e.conditionSelect.database=""):st.get("metaData/getDataBaseByType/"+this.conditionSelect.tableType).then(function(t){e.conditionOptions.databases=t.data,e.conditionSelect.database=""}).catch(function(e){console.log(e)}),this.reInitPageTable()},onChangeDataBase:function(){this.pageParam.currentPage=1,this.reInitPageTable()},getTableTypes:function(){var e=this;st.get("metaData/tableTypes/get").then(function(t){e.conditionOptions.tableTypes=t.data,e.tableTypes=t.data}).catch(function(e){console.log(e)});var t={curPage:this.pageParam.currentPage+"",pageSize:this.pageParam.pageSize+""};st.post("metaData/getTableByConditions",t,{responseType:"json"}).then(function(t){e.tableForm.cols=t.data.cols,e.tableForm.data=t.data.data,e.tableForm.loading=!1}).catch(function(e){console.log(e)})},reInitPageTable:function(){var e=this;this.pageParam.currentPage=1,this.tableForm.loading=!0;var t={table_type:e.conditionSelect.tableType,database_name:e.conditionSelect.database,curPage:this.pageParam.currentPage+"",pageSize:this.pageParam.pageSize+"",tableNameLike:this.conditionSelect.tableNameLike};st.post("metaData/table/getNums",t,{responseType:"json"}).then(function(t){console.log("count:"+t.data.count),e.pageParam.totalItems=t.data.count,e.updateTableData(),this.tableForm.loading=!1}).catch(function(e){this.tableForm.loading=!1,console.log(e)})},initPageTable:function(){var e=this,t={table_type:e.conditionSelect.tableType,database_name:e.conditionSelect.database,curPage:this.pageParam.currentPage+"",pageSize:this.pageParam.pageSize+""};st.post("metaData/table/getNums",t,{responseType:"json"}).then(function(t){console.log("count:"+t.data.count),e.pageParam.totalItems=t.data.count,e.getTableTypes()}).catch(function(e){console.log(e)})},handleSizeChange:function(e){console.log("每页 "+e+" 条"),this.pageParam.pageSize=e,this.handleCurrentChange(1)},handleCurrentChange:function(e){console.log("当前页: "+e),this.pageParam.currentPage=e,this.tableForm.loading=!0,this.updateTableData()},updateTableData:function(){var e={curPage:this.pageParam.currentPage+"",pageSize:this.pageParam.pageSize+"",table_type:this.conditionSelect.tableType,database_name:this.conditionSelect.database,tableNameLike:this.conditionSelect.tableNameLike},t=this;st.post("metaData/getTableByConditions",e,{responseType:"json"}).then(function(e){t.tableForm.cols=e.data.cols,t.tableForm.data=e.data.data,t.tableForm.loading=!1}).catch(function(e){console.log(e)})}},mounted:function(){this.initPageTable(),this.getRoleOptions();var e=this;st.get("/metaData/getEdit").then(function(t){e.readOnly=t.data.readOnly,console.log(e.readOnly)}).catch(function(e){console.log(e)})}},it={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("元数据管理")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"9"}},[e._v("\n        类型:\n        "),a("el-select",{attrs:{placeholder:"请选择类型",size:"mini",filterable:"true",clearable:"true"},on:{change:function(t){return e.onChangeTableType()}},model:{value:e.conditionSelect.tableType,callback:function(t){e.$set(e.conditionSelect,"tableType",t)},expression:"conditionSelect.tableType"}},e._l(e.conditionOptions.tableTypes,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1),e._v(" "),a("span",[e._v("数据库:")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择数据库",size:"mini",filterable:"true",clearable:"true"},on:{change:function(t){return e.onChangeDataBase()}},model:{value:e.conditionSelect.database,callback:function(t){e.$set(e.conditionSelect,"database",t)},expression:"conditionSelect.database"}},e._l(e.conditionOptions.databases,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6,offset:"7"}},[e._v("\n        模糊查询:\n        "),a("el-input",{staticStyle:{width:"180px"},attrs:{size:"mini",clearable:"true"},on:{input:function(t){return e.reInitPageTable()}},model:{value:e.conditionSelect.tableNameLike,callback:function(t){e.$set(e.conditionSelect,"tableNameLike",t)},expression:"conditionSelect.tableNameLike"}})],1)],1),e._v(" "),a("el-form",{ref:"tableForm",attrs:{model:e.tableForm,inline:!0}},[a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.tableForm.loading,expression:"tableForm.loading"}],staticStyle:{width:"100%"},attrs:{data:e.tableForm.data,stripe:""}},[e._l(e.tableForm.cols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-row",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly&&t.row.is_owner,expression:"(!readOnly) && (scope.row.is_owner)"}],attrs:{icon:"el-icon-delete",type:"text",size:"small"},on:{click:function(a){return e.deleteTable(t.row)}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"small"},on:{click:function(a){return e.editTable(t.row)}}},[e._v("详情")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-printer",type:"text",size:"small"},on:{click:function(a){return e.graphTable(t.row)}}})],1)]}}])})],2),e._v(" "),a("el-pagination",{staticStyle:{"margin-top":"20px"},attrs:{"current-page":e.pageParam.currentPage,"page-sizes":[10,50,100],"page-size":e.pageParam.pageSize,layout:"total, sizes, prev, pager, next, jumper",total:e.pageParam.totalItems},on:{"size-change":e.handleSizeChange,"current-change":e.handleCurrentChange}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],staticStyle:{"margin-top":"80px"}},[a("h3",[e._v("新增元数据")]),e._v(" "),a("el-form",{ref:"importForm",attrs:{model:e.importForm,inline:!0,"label-width":"120px"}},[a("el-row",[a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{placeholder:"请选择类型",size:"mini",filterable:"true",clearable:"true"},on:{change:function(t){return e.onChangeImportType()}},model:{value:e.importForm.tableType,callback:function(t){e.$set(e.importForm,"tableType",t)},expression:"importForm.tableType"}},e._l(e.conditionOptions.tableTypes,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-row",[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"!==e.importForm.tableType,expression:"importForm.tableType !=='hdfs'"}],attrs:{label:"数据源:"}},[a("el-select",{attrs:{placeholder:"请选择数据源",size:"mini",filterable:"true",clearable:"true"},on:{change:e.onChangeImportId},model:{value:e.importForm.importId,callback:function(t){e.$set(e.importForm,"importId",t)},expression:"importForm.importId"}},e._l(e.importForm.mysqlOptions,function(e){return a("el-option",{key:e.ImportName,attrs:{label:e.ImportName,value:e.ImportId}})}),1),e._v(" "),a("span",{staticStyle:{color:"rgb(189, 189, 189)"}},[e._v(e._s(e.showUrl))])],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:""!==e.importForm.tableType&&"hdfs"!==e.importForm.tableType,expression:"importForm.tableType!=='' && importForm.tableType!=='hdfs'"}],attrs:{label:"输入数据库:"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.importForm.databaseName,callback:function(t){e.$set(e.importForm,"databaseName",t)},expression:"importForm.databaseName"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:""!==e.importForm.tableType&&"hdfs"!==e.importForm.tableType,expression:"importForm.tableType!=='' && importForm.tableType!=='hdfs'"}],attrs:{label:"输入表:"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.importForm.tableName,callback:function(t){e.$set(e.importForm,"tableName",t)},expression:"importForm.tableName"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.importForm.tableType,expression:"importForm.tableType==='hdfs'"}],attrs:{label:"文件名:"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.importForm.tableName,callback:function(t){e.$set(e.importForm,"tableName",t)},expression:"importForm.tableName"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.importForm.tableType,expression:"importForm.tableType==='hdfs'"}],attrs:{label:"文件存储位置:"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.importForm.location,callback:function(t){e.$set(e.importForm,"location",t)},expression:"importForm.location"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],attrs:{label:"有权使用的角色:"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.importForm.privilegeRoles,callback:function(t){e.$set(e.importForm,"privilegeRoles",t)},expression:"importForm.privilegeRoles"}},e._l(e.roleOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.importForm.tableType,expression:"importForm.tableType==='hdfs'"}]},[a("el-col",{attrs:{span:"18"}},[a("el-input",{attrs:{type:"textarea",rows:5,placeholder:e.importForm.hdfsPlaceHolder,size:"mini"},model:{value:e.importForm.hdfsImportStr,callback:function(t){e.$set(e.importForm,"hdfsImportStr",t)},expression:"importForm.hdfsImportStr"}})],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],staticStyle:{"margin-top":"20px"}},[a("el-row",[a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onImport()}}},[e._v("提交导入")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:"hdfs"!==e.importForm.tableType,expression:"importForm.tableType!=='hdfs'"}],attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmitNewTables()}}},[e._v("提交新增\n              ")])],1)],1)],1)],1)],1)],1)},staticRenderFns:[]};var lt=a("VU/8")(nt,it,!1,function(e){a("zIQl"),a("77iJ")},"data-v-c0f2f7f4",null).exports,rt=a("HSQo"),ct=a.n(rt),dt=a("fZjL"),ut=a.n(dt),pt=a("Gu7T"),mt=a.n(pt),ft=a("Icdr"),ht=a.n(ft),vt=a("O4Lo"),bt=a.n(vt),gt=a("472O"),yt=["theme","initOptions","autoresize"],_t=["manualUpdate","watchShallow"],wt={props:{options:Object,theme:[String,Object],initOptions:Object,group:String,autoresize:Boolean,watchShallow:Boolean,manualUpdate:Boolean},data:function(){return{lastArea:0}},watch:{group:function(e){this.chart.group=e}},methods:{mergeOptions:function(e,t,a){this.manualUpdate&&(this.manualOptions=e),this.chart?this.delegateMethod("setOption",e,t,a):this.init(e)},appendData:function(e){this.delegateMethod("appendData",e)},resize:function(e){this.delegateMethod("resize",e)},dispatchAction:function(e){this.delegateMethod("dispatchAction",e)},convertToPixel:function(e,t){return this.delegateMethod("convertToPixel",e,t)},convertFromPixel:function(e,t){return this.delegateMethod("convertFromPixel",e,t)},containPixel:function(e,t){return this.delegateMethod("containPixel",e,t)},showLoading:function(e,t){this.delegateMethod("showLoading",e,t)},hideLoading:function(){this.delegateMethod("hideLoading")},getDataURL:function(e){return this.delegateMethod("getDataURL",e)},getConnectedDataURL:function(e){return this.delegateMethod("getConnectedDataURL",e)},clear:function(){this.delegateMethod("clear")},dispose:function(){this.delegateMethod("dispose")},delegateMethod:function(e){var t;this.chart||this.init();for(var a=arguments.length,o=Array(a>1?a-1:0),s=1;s<a;s++)o[s-1]=arguments[s];return(t=this.chart)[e].apply(t,mt()(o))},delegateGet:function(e){return this.chart||this.init(),this.chart[e]()},getArea:function(){return this.$el.offsetWidth*this.$el.offsetHeight},init:function(e){var t=this;if(!this.chart){var a=ht.a.init(this.$el,this.theme,this.initOptions);this.group&&(a.group=this.group),a.setOption(e||this.manualOptions||this.options||{},!0),ut()(this.$listeners).forEach(function(e){var o=t.$listeners[e];0===e.indexOf("zr:")?a.getZr().on(e.slice(3),o):a.on(e,o)}),this.autoresize&&(this.lastArea=this.getArea(),this.__resizeHandler=bt()(function(){0===t.lastArea?(t.mergeOptions({},!0),t.resize(),t.mergeOptions(t.options||t.manualOptions||{},!0)):t.resize(),t.lastArea=t.getArea()},100,{leading:!0}),Object(gt.a)(this.$el,this.__resizeHandler)),ct()(this,{width:{configurable:!0,get:function(){return t.delegateGet("getWidth")}},height:{configurable:!0,get:function(){return t.delegateGet("getHeight")}},isDisposed:{configurable:!0,get:function(){return!!t.delegateGet("isDisposed")}},computedOptions:{configurable:!0,get:function(){return t.delegateGet("getOption")}}}),this.chart=a}},initOptionsWatcher:function(){var e=this;this.__unwatchOptions&&(this.__unwatchOptions(),this.__unwatchOptions=null),this.manualUpdate||(this.__unwatchOptions=this.$watch("options",function(t,a){!e.chart&&t?e.init():e.chart.setOption(t,t!==a)},{deep:!this.watchShallow}))},destroy:function(){this.autoresize&&Object(gt.b)(this.$el,this.__resizeHandler),this.dispose(),this.chart=null},refresh:function(){this.chart&&(this.destroy(),this.init())}},created:function(){var e=this;this.initOptionsWatcher(),yt.forEach(function(t){e.$watch(t,function(){e.refresh()},{deep:!0})}),_t.forEach(function(t){e.$watch(t,function(){e.initOptionsWatcher(),e.refresh()})})},mounted:function(){this.options&&this.init()},activated:function(){this.autoresize&&this.chart&&this.chart.resize()},destroyed:function(){this.chart&&this.destroy()},connect:function(e){"string"!=typeof e&&(e=e.map(function(e){return e.chart})),ht.a.connect(e)},disconnect:function(e){ht.a.disConnect(e)},registerMap:function(e,t,a){ht.a.registerMap(e,t,a)},registerTheme:function(e,t){ht.a.registerTheme(e,t)},graphic:ht.a.graphic},kt={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"echarts"})},staticRenderFns:[]};var xt=a("VU/8")(wt,kt,!1,function(e){a("rcGG")},null,null).exports,It=(a("4UDB"),a("LbEf"),a("1FNb"),a("mtWM")),Tt={data:function(){return{info:"csv内容形如: mysql,default_database,table1,field1,v0,我是描述",dialogVisible:!1,dataList:[],tableColumn:[],title:"",source_target:"",myOptions:{autoresize:!0,tooltip:{},animationDurationUpdate:1500,animationEasingUpdate:"quinticInOut",series:[{type:"graph",layout:"none",symbol:"rect",symbolSize:[80,40],roam:!0,label:{show:!0},edgeSymbol:["","arrow"],edgeSymbolSize:[10,20],edgeLabel:{fontSize:20},data:[],links:[],lineStyle:{opacity:.9,width:2,curveness:.2}}]}}},methods:{handleClose:function(){sessionStorage.removeItem("metaData_graph_tid"),Ss.push({path:"tableMetaData"})},onClick:function(e){if(console.log(e),"edge"===e.dataType){console.log("点到了边上");var t={source:e.data.source,target:e.data.target};this.source_target=e.data.source+" 和 "+e.data.target,this.dialogVisible=!0;var a=this;It.post("/metaData/graph/relation/check",t,{responseType:"json"}).then(function(e){console.log(e),a.tableColumn=e.data.tableColumn,a.dataList=e.data.dataList}).catch(function(e){console.log(e)})}else{var o={tableId:e.data.tableId};window.sessionStorage.setItem("metaData_table_id",S()(o)),window.location.href="#/tableInfo"}}},mounted:function(){var e=this,t=JSON.parse(sessionStorage.getItem("metaData_graph_tid"));console.log("tableId:"+t.tableId);var a=t.tableId;this.title=t.tableName+"的拓扑关系",It.get("metaData/graph/"+a).then(function(t){e.myOptions.series[0].data=t.data.data,e.myOptions.series[0].links=t.data.links}).catch(function(e){console.log(e)})}},Ft={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-row",[a("h3",[e._v("\n        "+e._s(e.title)+":\n      ")])]),e._v(" "),a("el-row",[a("div",{staticClass:"chart-wrapper"},[a("v-chart",{attrs:{options:e.myOptions},on:{click:e.onClick}})],1)]),e._v(" "),a("el-row",[a("el-button",{attrs:{type:"text",size:"small"},on:{click:function(t){return e.handleClose()}}},[e._v("回退")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.source_target,visible:e.dialogVisible,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[a("vxe-table",{ref:"xTable",attrs:{border:"","show-overflow":"","keep-source":"",data:e.dataList,"edit-config":{trigger:"click",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}}},[e._l(e.tableColumn,function(e,t){return[a("vxe-table-column",{attrs:{field:e.field,title:e.title,visible:e.visible,"edit-render":e.editRender}})]})],2)],1)],1)},staticRenderFns:[]};var St=a("VU/8")(Tt,Ft,!1,function(e){a("i5fM")},"data-v-2afb2430",null).exports,Dt=a("gOld"),Ct={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"app-container"},[a("el-form",{ref:"form",attrs:{model:e.form,"label-width":"120px"}},[a("h3",[e._v("基础信息")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"表名称",size:"small"}},[a("el-input",{attrs:{readonly:e.readOnly},model:{value:e.form.tableName,callback:function(t){e.$set(e.form,"tableName",t)},expression:"form.tableName"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"所属库",size:"small"}},[a("el-input",{attrs:{readonly:e.readOnly},model:{value:e.form.database,callback:function(t){e.$set(e.form,"database",t)},expression:"form.database"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"6"}},[a("el-form-item",{attrs:{label:"创建者",size:"small"}},[a("el-input",{attrs:{readonly:e.readOnly,type:""},model:{value:e.form.creator,callback:function(t){e.$set(e.form,"creator",t)},expression:"form.creator"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:"6"}},[a("el-form-item",{attrs:{label:"创建时间",size:"small"}},[a("el-input",{attrs:{readonly:e.readOnly,type:""},model:{value:e.form.createTime,callback:function(t){e.$set(e.form,"createTime",t)},expression:"form.createTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("el-form-item",{attrs:{label:"表类型",size:"small"}},[a("el-select",{attrs:{placeholder:"please select your zone"},model:{value:e.form.tableType,callback:function(t){e.$set(e.form,"tableType",t)},expression:"form.tableType"}},[a("el-option",{attrs:{label:"hive",value:"hive"}}),e._v(" "),a("el-option",{attrs:{label:"mysql",value:"mysql"}}),e._v(" "),a("el-option",{attrs:{label:"hdfs",value:"hdfs"}}),e._v(" "),a("el-option",{attrs:{label:"clickhouse",value:"clickhouse"}}),e._v(" "),a("el-option",{attrs:{label:"kylin",value:"kylin"}})],1)],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"12"}},[a("el-form-item",{attrs:{label:"文件存储位置"}},[a("el-input",{attrs:{readonly:e.readOnly,type:"",size:"small"},model:{value:e.form.location,callback:function(t){e.$set(e.form,"location",t)},expression:"form.location"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:"6"}},[a("el-form-item",{attrs:{label:"压缩方式"}},[a("el-input",{attrs:{readonly:e.readOnly,type:"",size:"small"},model:{value:e.form.compressMode,callback:function(t){e.$set(e.form,"compressMode",t)},expression:"form.compressMode"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"18"}},[a("el-form-item",{attrs:{label:"描述"}},[a("el-input",{attrs:{readonly:e.readOnly,type:"textarea",rows:"3",size:"small"},model:{value:e.form.description,callback:function(t){e.$set(e.form,"description",t)},expression:"form.description"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:7}},[a("el-form-item",{attrs:{label:"有权使用的角色",size:"small"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small",readonly:e.readOnly},model:{value:e.form.privilegeRoles,callback:function(t){e.$set(e.form,"privilegeRoles",t)},expression:"form.privilegeRoles"}},e._l(e.roleOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1)],1)],1),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],staticStyle:{width:"75%"},attrs:{type:"flex",justify:"end"}},[a("el-button",{staticStyle:{"margin-top":"-30px"},attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){return e.submitUpdate()}}},[e._v("提交修改")])],1),e._v(" "),a("div",{staticStyle:{"margin-top":"20px"}},[a("el-row",[a("el-col",{attrs:{span:"2"}},[e.totallyNew||null===e.versions||e.readOnly?a("h3",[e._v("查看元数据")]):a("h3",[e._v("编辑元数据")])]),e._v(" "),a("el-col",{attrs:{span:3}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.totallyNew&&null!==e.versions&&!e.readOnly,expression:"(!totallyNew)&&(versions !== null)&&(!readOnly)"}],staticStyle:{"margin-top":"20px"},attrs:{icon:"el-icon-circle-plus",size:"small"},on:{click:function(t){return e.onClickNewVersion()}}},[e._v(" 创建新版本\n        ")])],1)],1),e._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.totallyNew,expression:"!totallyNew"}],attrs:{inline:!0,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"已存在版本"}},[a("el-select",{attrs:{placeholder:"请选择版本",size:"mini"},on:{change:function(t){return e.onChangeVersion(e.curVersion)}},model:{value:e.curVersion,callback:function(t){e.curVersion=t},expression:"curVersion"}},e._l(e.versions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}]},[a("el-button",{attrs:{size:"small",icon:e.buttonIcon,type:"primary",plain:"",disabled:e.isUpdateFieldNow},on:{click:e.updateCurVersionField}},[e._v(e._s(e.buttonText)+"\n        ")])],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"版本更新描述"}},[a("el-input",{staticStyle:{width:"480px"},attrs:{readonly:e.readOnly,size:"small"},model:{value:e.curVersionDesc,callback:function(t){e.curVersionDesc=t},expression:"curVersionDesc"}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{size:"small"},on:{click:function(t){return e.updateVersionDesc()}}},[e._v("更新描述")])],1)],1),e._v(" "),a("div",{staticStyle:{"margin-left":"20px"}},[a("vxe-table",{ref:"xTable",attrs:{border:"inner","show-overflow":"","keep-source":"",stripe:"true",data:e.dataList,"edit-config":{trigger:"dblclick",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}}},[e._l(e.tableColumn,function(e,t){return[a("vxe-table-column",{attrs:{field:e.field,title:e.title,visible:e.visible,"edit-render":e.editRender,width:"description"===e.field?"40%":""}})]}),e._v(" "),e.readOnly?e._e():a("vxe-table-column",{attrs:{title:"操作",width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.row;return t.rowIndex,[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{icon:"el-icon-delete",type:"text",size:"mini"},on:{click:function(t){return e.deleteField(o)}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"mini"},on:{click:function(t){return e.editRelation(o)}}},[e._v("配置")])]}}],null,!1,4218746456)})],2),e._v(" "),a("el-row",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}]},[a("el-col",[a("vxe-toolbar",{scopedSlots:e._u([{key:"buttons",fn:function(){return[a("vxe-button",{on:{click:e.getUpdateEvent}},[e._v("提交字段修改")])]},proxy:!0}])})],1)],1)],1)],1),e._v(" "),a("el-row",[a("h4",[e._v("分区字段")]),e._v(" "),a("el-col",{staticStyle:{"margin-left":"20px"},attrs:{span:"15"}},[a("vxe-table",{ref:"partitionTable",attrs:{border:"inner","show-overflow":"","keep-source":"",stripe:"true",data:e.partitionDataList,"edit-config":{trigger:"dblclick",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}},on:{"edit-closed":e.updatePartitionField}},[a("vxe-table-column",{attrs:{field:"fid",title:"字段id",visible:!1}}),e._v(" "),a("vxe-table-column",{attrs:{field:"fieldName",title:"字段名称"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"fieldType",title:"字段类型"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"description",title:"描述","edit-render":{name:"input"}}})],1)],1)],1),e._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.totallyNew&&null!==e.versions&&!e.readOnly,expression:"(!totallyNew)&&(versions !== null)&&(!readOnly)"}],ref:"newFieldForm",attrs:{inline:!0,"label-width":"120px",rules:e.newFieldRules,model:e.newField}},[a("el-row",[a("div",{staticStyle:{"margin-bottom":"100px","margin-top":"30px"}},[a("el-col",{attrs:{span:4}},[a("h4",[e._v("当前版本下添加字段")])])],1)]),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"字段名称",prop:"fieldName"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"small"},model:{value:e.newField.fieldName,callback:function(t){e.$set(e.newField,"fieldName",t)},expression:"newField.fieldName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"字段类型",prop:"fieldType"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"small"},model:{value:e.newField.fieldType,callback:function(t){e.$set(e.newField,"fieldType",t)},expression:"newField.fieldType"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"业务信息描述"}},[a("el-input",{staticStyle:{width:"500px"},attrs:{readonly:e.readOnly,type:"textarea"},model:{value:e.newField.description,callback:function(t){e.$set(e.newField,"description",t)},expression:"newField.description"}})],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{size:"small"},on:{click:function(t){return e.addFieldInCurrentVersion()}}},[e._v("添加")])],1)],1),e._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:e.totallyNew,expression:"totallyNew"}],ref:"newVersionForm",attrs:{model:e.newVersionForm,inline:!0}},[a("el-row",[a("el-form-item",{attrs:{label:"数据物理表:"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"mini",disabled:""},model:{value:e.tableName,callback:function(t){e.tableName=t},expression:"tableName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"输入版本号:"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"mini"},model:{value:e.newVersionForm.Version,callback:function(t){e.$set(e.newVersionForm,"Version",t)},expression:"newVersionForm.Version"}})],1)],1),e._v(" "),a("el-row",e._l(e.newVersionForm.Fields,function(t,o){return a("el-form-item",{attrs:{label:"字段"+o,rules:{required:!0,message:"域名不能为空",trigger:"blur"}}},[a("el-row",[a("el-col",{attrs:{span:"4"}},[a("el-button",{staticStyle:{"font-size":"16px",color:"blue"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addTotallyNewField()}}}),e._v(" "),a("el-button",{staticStyle:{"font-size":"16px",color:"red"},attrs:{icon:"el-icon-remove-outline",type:"text"},on:{click:function(a){return a.preventDefault(),e.removeTotallyNewField(t)}}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"字段名称"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"small"},model:{value:t.fieldName,callback:function(a){e.$set(t,"fieldName",a)},expression:"totallyNewField.fieldName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"字段类型"}},[a("el-input",{attrs:{readonly:e.readOnly,size:"small"},model:{value:t.fieldType,callback:function(a){e.$set(t,"fieldType",a)},expression:"totallyNewField.fieldType"}})],1)],1),e._v(" "),a("el-row",[a("el-form-item",{attrs:{label:"业务信息描述"}},[a("el-input",{staticStyle:{width:"500px"},attrs:{readonly:e.readOnly,type:"textarea"},model:{value:t.description,callback:function(a){e.$set(t,"description",a)},expression:"totallyNewField.description"}})],1)],1)],1)}),1),e._v(" "),a("el-row",[a("el-form-item",[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:function(t){return e.onSubmitTotallyNewField()}}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"text"},on:{click:function(t){e.totallyNew=!e.totallyNew}}},[e._v("返回")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"配置字段的关联关系",width:"50%",visible:e.dialogVisible},on:{"update:visible":function(t){e.dialogVisible=t}}},[[a("div",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],staticClass:"container"},[a("div",{staticClass:"large-12 medium-12 small-12 cell"},[a("input",{ref:"file",attrs:{type:"file",id:"file"},on:{change:function(t){return e.handleFileUpload()}}}),e._v(" "),a("button",{on:{click:function(t){return e.submitFile()}}},[e._v("上传关系文件")]),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"12px"}},[e._v(e._s(e.info))])])])],e._v(" "),a("h2"),e._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],ref:"relationSelect",attrs:{model:e.relationSelect,rules:e.relationRules,inline:!0,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"类型:"}},[a("el-select",{attrs:{placeholder:"请选择类型",size:"mini",filterable:"true"},on:{change:function(t){return e.onChangeRelationTableType()}},model:{value:e.relationSelect.typeSelect,callback:function(t){e.$set(e.relationSelect,"typeSelect",t)},expression:"relationSelect.typeSelect"}},e._l(e.relationOptions.tableTypes,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"数据库:"}},[a("el-select",{attrs:{placeholder:"请选择数据库",size:"mini",filterable:"true"},on:{change:function(t){return e.onChangeRelationDataBase()}},model:{value:e.relationSelect.dataBaseSelect,callback:function(t){e.$set(e.relationSelect,"dataBaseSelect",t)},expression:"relationSelect.dataBaseSelect"}},e._l(e.relationOptions.databases,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"表:"}},[a("el-select",{attrs:{placeholder:"请选择表",size:"mini",filterable:"true"},on:{change:function(t){return e.onChangeRelationTable()}},model:{value:e.relationSelect.tableSelect,callback:function(t){e.$set(e.relationSelect,"tableSelect",t)},expression:"relationSelect.tableSelect"}},e._l(e.relationOptions.tables,function(e){return a("el-option",{key:e.Tid,attrs:{label:e.TableName,value:e.Tid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"版本:"}},[a("el-select",{attrs:{placeholder:"请选择版本",size:"mini",filterable:"true",clearable:""},on:{change:function(t){return e.onChangeRelationVersion()}},model:{value:e.relationSelect.versionSelect,callback:function(t){e.$set(e.relationSelect,"versionSelect",t)},expression:"relationSelect.versionSelect"}},e._l(e.relationOptions.versions,function(e){return a("el-option",{key:e.Version,attrs:{label:e.Version,value:e.Version}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"字段:"}},[a("el-select",{attrs:{placeholder:"请选择字段",size:"mini",filterable:"true"},on:{change:function(e){}},model:{value:e.relationSelect.fieldSelect,callback:function(t){e.$set(e.relationSelect,"fieldSelect",t)},expression:"relationSelect.fieldSelect"}},e._l(e.relationOptions.fields,function(e){return a("el-option",{key:e.fid,attrs:{label:e.fieldName,value:e.fid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"关系描述:"}},[a("el-input",{attrs:{readonly:e.readOnly},model:{value:e.relationSelect.relationDesc,callback:function(t){e.$set(e.relationSelect,"relationDesc",t)},expression:"relationSelect.relationDesc"}})],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:"5",offset:"19"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.readOnly,expression:"!readOnly"}],attrs:{round:"",type:"primary",size:"mini"},on:{click:function(t){return e.addRelation("relationSelect")}}},[e._v("添加\n            ")])],1)],1)],1),e._v(" "),a("el-table",{directives:[{name:"loading",rawName:"v-loading",value:e.relationTable.loading,expression:"relationTable.loading"}],staticStyle:{width:"100%"},attrs:{data:e.relationTable.data,stripe:""}},[e._l(e.relationTable.cols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"info",size:"mini",round:""},on:{click:function(a){return e.deleteRelation(t.row)}}})]}}])})],2)],2)],1)],1)},staticRenderFns:[]};var Nt=function(e){a("w5xR")},Ot=a("VU/8")(Dt.a,Ct,!1,Nt,"data-v-b0e9e25c",null).exports,Rt={name:"DatabasesContent",data:function(){return{myHeighgt:""}},methods:{},mounted:function(){var e=document.body.clientHeight;console.log(e),this.myHeighgt=e-15}},$t={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[t("div",{staticClass:"outDiv",style:{height:this.myHeighgt+"px"}},[t("iframe",{staticStyle:{height:"100%"},attrs:{id:"show-iframe",src:"http://redash.adtech.sogou/public/dashboards/8xfxxyHcF3AQNfbxmPZJ1PhGzxNh9FBhJOSUM16y?org_slug=default&refresh=1200",frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}})])])},staticRenderFns:[]};var Et=a("VU/8")(Rt,$t,!1,function(e){a("94Yb")},null,null).exports,At=a("mtWM"),Lt={data:function(){return{checkDuplicateRole:"",newRoleName:"",rolesData:[],curWorksheetGroup:"",rolesUsersTableVisible:!1,rolesUsersData:[],addRolesUsersName:"",rolesRoutesTableVisible:!1,rolesRoutesData:[],addrolesRoutesName:"",worksheetVisible:!1,worksheetData:[],checkedWorksheet:[5],tmpRole:"",urlVisible:!1,urlData:[],checkedURL:[],curURLGroup:"",writableURL:[]}},methods:{onCreateRole:function(){this.newRoleName;var e=this,t={role:this.newRoleName};At.post("/auth/roles/addRole",t,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},getRolesRoutes:function(e){var t=this,a="/auth/routes/role/"+e;At.get(a).then(function(a){var o=[];a.data.forEach(function(e){o.push({routeName:e})}),t.rolesRoutesData=o,console.log(o),t.rolesRoutesTableVisible=!0,t.tmpRole=e}).catch(function(e){console.log(e)})},addRolesRoutes:function(){var e=this;if(!Object(r.f)(this.addRolesRoutesName)){var t="/auth/roles/route/"+this.tmpRole,a=new URLSearchParams;a.append("rolename",this.tmpRole),a.append("route",this.addRolesRoutesName),At({method:"post",url:t,data:a}).then(function(){e.addRolesRoutesName="",e.rolesRoutesTableVisible=!1,e.$message("添加成功！")}).catch(function(e){console.log(e)})}},delRolesRoutes:function(e){var t=this,a="/auth/roles/route/"+this.tmpRole+"?route="+e;At({method:"delete",url:a}).then(function(){t.rolesRoutesTableVisible=!1,t.$message("删除成功！")}).catch(function(e){console.log(e)})},getRolesUsers:function(e){var t=this,a="/auth/users/role/"+e;At.get(a).then(function(a){var o=[];a.data.forEach(function(e){o.push({userName:e})}),t.rolesUsersData=o,t.rolesUsersTableVisible=!0,t.tmpRole=e}).catch(function(e){console.log(e)})},addRolesUsers:function(){var e=this;if(!Object(r.f)(this.addRolesUsersName)){var t="/auth/roles/user/"+this.tmpRole,a=new URLSearchParams;a.append("rolename",this.tmpRole),a.append("username",this.addRolesUsersName),a.append("checkDuplicate",this.checkDuplicateRole),At({method:"post",url:t,data:a}).then(function(t){t.data.Res?(e.$message({message:t.data.Info,type:"success"}),e.addRolesUsersName="",e.rolesUsersTableVisible=!1):e.$message({message:"该用户已存在角色 : "+t.data.Info,type:"error"})}).catch(function(e){console.log(e)})}},delRolesUsers:function(e){var t=this,a="/auth/roles/user/"+this.tmpRole+"?username="+e;At({method:"delete",url:a}).then(function(){t.rolesUsersTableVisible=!1,t.$message("删除成功！")}).catch(function(e){console.log(e)})},initGetRoles:function(){var e=this;At.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})}},created:function(){var e=this;At.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},Pt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加新角色")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入角色名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newRoleName,callback:function(t){e.newRoleName=t},expression:"newRoleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateRole()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("角色路由及用户的增删改查")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:""}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"用户操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getRolesUsers(t.row.roleName)}}},[e._v("查看所有用户")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"角色所有路由",visible:e.rolesRoutesTableVisible},on:{"update:visible":function(t){e.rolesRoutesTableVisible=t}}},[a("el-row",[a("el-col",[a("span",[e._v("删除、添加路由后不能立即更新用户列表！请关闭对话框后再次查看。")])]),e._v(" "),a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:"请输入添加的路由",size:"mini"},model:{value:e.addRolesRoutesName,callback:function(t){e.addRolesRoutesName=t},expression:"addRolesRoutesName"}})],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.addRolesRoutes()}}},[e._v("添加")])],1)],1),e._v(" "),a("el-table",{attrs:{data:e.rolesRoutesData}},[a("el-table-column",{attrs:{property:"routeName",label:"路由"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.delRolesRoutes(t.row.routeName)}}},[e._v("删除")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"角色所有用户",visible:e.rolesUsersTableVisible},on:{"update:visible":function(t){e.rolesUsersTableVisible=t}}},[a("el-row",[a("el-col",{attrs:{span:17}},[a("span",[e._v("删除、添加用户后不能立即更新用户列表！请关闭对话框后再次查看。")])]),e._v(" "),a("el-col",{attrs:{span:6,offset:1}},[a("el-checkbox",{attrs:{size:"mini"},model:{value:e.checkDuplicateRole,callback:function(t){e.checkDuplicateRole=t},expression:"checkDuplicateRole"}},[e._v("(去重用户组)")])],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:"请输入添加的用户名",size:"mini"},model:{value:e.addRolesUsersName,callback:function(t){e.addRolesUsersName=t},expression:"addRolesUsersName"}})],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.addRolesUsers()}}},[e._v("添加")])],1)],1),e._v(" "),a("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[a("el-table",{attrs:{data:e.rolesUsersData}},[a("el-table-column",{attrs:{property:"userName",label:"姓名"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.delRolesUsers(t.row.userName)}}},[e._v("删除")])]}}])})],1)],1)],1)],1)},staticRenderFns:[]},Mt=a("VU/8")(Lt,Pt,!1,null,null,null).exports,Ut=a("mtWM"),Vt={data:function(){return{batch:{roles:[],workSheetIds:[]},checkDuplicateRole:"",newRoleName:"",rolesData:[],curWorksheetGroup:"",rolesUsersTableVisible:!1,rolesUsersData:[],addRolesUsersName:"",batchWorksheetData:[],rolesRoutesTableVisible:!1,rolesRoutesData:[],addrolesRoutesName:"",worksheetVisible:!1,worksheetData:[],checkedWorksheet:[5],tmpRole:"",urlVisible:!1,urlData:[],checkedURL:[],curURLGroup:"",writableURL:[]}},methods:{onBatchInsert:function(){console.log(this.batch);var e=this,t={roles:this.batch.roles.join(","),worksheetIds:this.batch.workSheetIds.join(",")};Ut.post("/auth/jdbc/batchChangeWorkSheetMapping",t,{responseType:"json"}).then(function(t){e.$message({message:"创建成功！",type:"success"})}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},changeWorkSheetReadOnly:function(e){console.log(e)},onCreateRole:function(){this.newRoleName;var e=this,t={role:this.newRoleName};Ut.post("/auth/roles/addRole",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()):e.$message({message:"角色名不能为空",type:"error"})}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.worksheetTable.toggleRowSelection(e)}):this.$refs.worksheetTable.clearSelection()},updateRoleWorksheet:function(){var e=this,t=this.curWorksheetGroup;console.log(t);var a=this.checkedWorksheet;Ut.post("/auth/jdbc/changeWorkSheetMapping/"+t,a,{responseType:"json"}).then(function(t){e.worksheetVisible=!1,e.$message({type:"success",message:"模板权限更新成功!"}),console.info(t.data)}).catch(function(t){e.$options.methods.saveUpdateNotify.bind(e)(),console.log(t)})},handleSelectionChange:function(e){this.checkedWorksheet=e},getCheckedWorkSheet:function(e){console.log(e);var t=this;t.curWorksheetGroup=e,Ut.get("/auth/template/getAllWorksheetCategory/"+e).then(function(e){var a=[],o=[],s=0;e.data.forEach(function(e){a.push({worksheetName:e.worksheetName,worksheetId:e.worksheetId,canModify:e.canModify}),e.hasPrivilege&&o.push(s),s++}),t.worksheetData=a,t.worksheetVisible=!0;var n=[];o.forEach(function(e){n.push(t.worksheetData[e])}),t.$nextTick(function(){t.toggleSelection(n)})}).catch(function(e){console.log(e)})},initGetRoles:function(){var e=this;Ut.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},getAllWorkSheet:function(e){var t=this;Ut.get("/auth/template/getAllWorksheetCategory/"+e).then(function(e){var a=[];e.data.forEach(function(e){a.push({worksheetName:e.worksheetName,worksheetId:e.worksheetId,canModify:e.canModify})}),t.batchWorksheetData=a,console.log(t.batchWorksheetData)}).catch(function(e){console.log(e)})}},created:function(){var e=this;Ut.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a,e.getAllWorkSheet(a[0])}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},jt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加新角色")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入角色名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newRoleName,callback:function(t){e.newRoleName=t},expression:"newRoleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateRole()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("角色与工单的增删改查")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:""}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"工单权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getCheckedWorkSheet(t.row.roleName)}}},[e._v("查看工单权限\n          ")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"配置角色能看到的工单",visible:e.worksheetVisible},on:{"update:visible":function(t){e.worksheetVisible=t}}},[a("el-row",[a("div",{staticStyle:{"max-height":"500px",overflow:"auto"}},[a("el-table",{ref:"worksheetTable",attrs:{data:e.worksheetData,"row-key":"TemplateId"},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{property:"worksheetName",label:"工单目录"}}),e._v(" "),a("el-table-column",{attrs:{property:"worksheetName",label:"修改"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":!0,"inactive-value":!1,"active-color":"#02538C","inactive-color":"#B9B9B9"},on:{change:function(a){return e.changeWorkSheetReadOnly(t.row)}},model:{value:t.row.canModify,callback:function(a){e.$set(t.row,"canModify",a)},expression:"scope.row.canModify"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"selection",label:"请选择"}})],1)],1)]),e._v(" "),a("el-row",[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateRoleWorksheet()}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("h3",[e._v("批量添加")]),e._v(" "),a("label",{staticStyle:{"font-size":"14px"}},[e._v("请选择角色: ")]),e._v(" "),a("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.batch.roles,callback:function(t){e.$set(e.batch,"roles",t)},expression:"batch.roles"}},e._l(e.rolesData,function(e){return a("el-option",{key:e.roleName,attrs:{label:e.roleName,value:e.roleName}})}),1),e._v(" "),a("br"),e._v(" "),a("label",{staticStyle:{"font-size":"14px"}},[e._v("请选择工单: ")]),e._v(" "),a("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.batch.workSheetIds,callback:function(t){e.$set(e.batch,"workSheetIds",t)},expression:"batch.workSheetIds"}},e._l(e.batchWorksheetData,function(e){return a("el-option",{key:e.worksheetId,attrs:{label:e.worksheetName,value:e.worksheetId}})}),1),e._v(" "),a("el-button",{attrs:{size:"small",plain:"",type:"primary"},on:{click:e.onBatchInsert}},[e._v("添加")])],1)],1)},staticRenderFns:[]},Bt=a("VU/8")(Vt,jt,!1,null,null,null).exports,qt=a("mtWM"),Ht={data:function(){return{batch:{roles:[],labels:[]},checkDuplicateRole:"",newRoleName:"",rolesData:[],curWorksheetGroup:"",rolesUsersTableVisible:!1,rolesUsersData:[],addRolesUsersName:"",rolesRoutesTableVisible:!1,rolesRoutesData:[],addrolesRoutesName:"",worksheetVisible:!1,worksheetData:[],checkedWorksheet:[5],tmpRole:"",urlVisible:!1,urlData:[],batchUrlData:[],checkedURL:[],curURLGroup:"",writableURL:[]}},methods:{onBatchInsert:function(){console.log(this.batch);var e=this,t=[];this.batch.labels.forEach(function(e){-1!==e.search(" - ")?t.push(e.split(" - ")[1]):t.push(e)});var a={roles:this.batch.roles.join(","),labelNames:t.join(",")};qt.post("/auth/labels/addNewLabels",a,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},changeReadOnly:function(e){if(1===e.writable)this.writableURL.push(e.urlId+"");else for(var t=0;t<this.writableURL.length;t++)if(this.writableURL[t]===e.urlId+""){this.writableURL.splice(t,1);break}console.log(this.writableURL)},onCreateRole:function(){this.newRoleName;var e=this,t={role:this.newRoleName};qt.post("/auth/roles/addRole",t,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},getCheckedURL:function(e){console.log(e);var t=this;t.curURLGroup=e,qt.get("/auth/labels/"+e).then(function(e){var a=[],o=[],s=0;t.writableURL=[],e.data.forEach(function(e){a.push({urlName:e.Title,urlId:e.Lid,urlIndex:e.Index,nameSpace:e.NameSpace,writable:e.IsWritable}),1===e.IsWritable&&t.writableURL.push(e.Lid+""),e.HasPrivilege&&o.push(s),s++}),t.urlData=a,t.urlVisible=!0;var n=[];o.forEach(function(e){n.push(t.urlData[e])}),t.$nextTick(function(){n.forEach(function(e){t.$refs.urlTable.toggleRowSelection(e)})}),console.log("writableURL:"+t.writableURL)}).catch(function(e){console.log(e)})},toggleSelection:function(e){var t=this;e?e.forEach(function(e){t.$refs.worksheetTable.toggleRowSelection(e)}):this.$refs.worksheetTable.clearSelection()},updateRoleURL:function(){var e=this,t=this.curURLGroup,a=this.checkedURL;console.log(t+":"+a);var o={role:[t],ids:a,writableUrls:this.writableURL};qt.post("/auth/labels/update",o,{responseType:"json"}).then(function(t){e.urlVisible=!1,e.$message({type:"success",message:"URL权限更新成功!"}),console.info(t.data)}).catch(function(t){e.$options.methods.saveUpdateNotify.bind(e)(),console.log(t)})},handleURLSelectionChange:function(e){var t=[];e.forEach(function(e){t.push(e.urlId+"")}),this.checkedURL=t},initGetRoles:function(){var e=this;qt.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},getLabels:function(e){var t=this;qt.get("/auth/labels/"+e).then(function(e){var a=[];e.data.forEach(function(e){a.push({urlName:e.Title,urlId:e.Lid,urlIndex:e.Index,nameSpace:e.NameSpace})}),t.batchUrlData=a,console.log(t.batchUrlData)}).catch(function(e){console.log(e)})}},created:function(){var e=this;qt.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a,console.log(e.rolesData),e.getLabels(e.rolesData[0])}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},zt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加新角色")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入角色名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newRoleName,callback:function(t){e.newRoleName=t},expression:"newRoleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateRole()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("角色与顶栏标签的增删改查")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:""}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"顶栏标签权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getCheckedURL(t.row.roleName)}}},[e._v("查看顶栏标签")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.curURLGroup+" 的顶栏标签配置",visible:e.urlVisible},on:{"update:visible":function(t){e.urlVisible=t}}},[a("el-row",[a("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[a("el-table",{ref:"urlTable",attrs:{data:e.urlData,"row-key":"Lid"},on:{"selection-change":e.handleURLSelectionChange}},[a("el-table-column",{attrs:{property:"urlName",label:"URL目录"}}),e._v(" "),a("el-table-column",{attrs:{property:"urlIndex",label:"URL地址"}}),e._v(" "),a("el-table-column",{attrs:{property:"nameSpace",label:"命名空间"}}),e._v(" "),a("el-table-column",{attrs:{label:"写权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-switch",{attrs:{"active-value":1,"inactive-value":2,"active-color":"#02538C","inactive-color":"#B9B9B9"},on:{change:function(a){return e.changeReadOnly(t.row)}},model:{value:t.row.writable,callback:function(a){e.$set(t.row,"writable",a)},expression:"scope.row.writable"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"55",label:"请选择"}})],1)],1)]),e._v(" "),a("el-row",[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateRoleURL()}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("div",{staticStyle:{"margin-bottom":"20px"}},[a("h3",[e._v("批量添加")]),e._v(" "),a("label",{staticStyle:{"font-size":"14px"}},[e._v("请选择角色: ")]),e._v(" "),a("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.batch.roles,callback:function(t){e.$set(e.batch,"roles",t)},expression:"batch.roles"}},e._l(e.rolesData,function(e){return a("el-option",{key:e.roleName,attrs:{label:e.roleName,value:e.roleName}})}),1),e._v(" "),a("br"),e._v(" "),a("label",{staticStyle:{"font-size":"14px"}},[e._v("请选择标签: ")]),e._v(" "),a("el-select",{staticStyle:{width:"80%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.batch.labels,callback:function(t){e.$set(e.batch,"labels",t)},expression:"batch.labels"}},e._l(e.batchUrlData,function(e){return a("el-option",{key:e.urlId,attrs:{label:e.urlName,value:e.urlName}})}),1),e._v(" "),a("el-button",{attrs:{size:"small",plain:"",type:"primary"},on:{click:e.onBatchInsert}},[e._v("添加")])],1)],1)},staticRenderFns:[]},Jt=a("VU/8")(Ht,zt,!1,null,null,null).exports,Gt=a("mtWM"),Yt={data:function(){return{url_src:"",timestamp:0,sec186:0,iframe_loaded:!1,rolesData:[]}},methods:{initRedashURL:function(){var e=this;Gt.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},setInframeHeight:function(){var e=document.getElementById("show-iframe");if(e){var t=e.contentWindow||e.contentDocument.parentWindow;t.document.body&&(e.style.height=Number(t.document.documentElement.scrollHeight||t.document.body.scrollHeight)+"px",console.log(e.height))}this.iframe_loaded=!0}},created:function(){var e=this;console.log("created"),Gt.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)})},mounted:function(){var e=sessionStorage.getItem("redash_url");console.log("redashUrl:"+e),this.url_src=e;var t=document.getElementById("show-iframe"),a=(document.documentElement.clientWidth,document.documentElement.clientHeight);t.style.height=Number(a)-200+"px"}},Wt={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticStyle:{height:"100%","margin-left":"-20px","margin-right":"-20px","margin-top":"-5px"}},[t("iframe",{attrs:{id:"show-iframe",src:this.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}})])},staticRenderFns:[]};var Kt=a("VU/8")(Yt,Wt,!1,function(e){a("XhJX")},"data-v-52e2b342",null).exports,Xt=a("mtWM"),Qt={data:function(){return{redashName:"",redashURL:"",redashIndex:"",redashRefresh:3600,superiorDomain:"",superiorDomainOptions:[],newLid:-1,privilegeRoles:[],roleOptions:[],parentNode:"数据图表"}},methods:{getRoleOptions:function(){var e=this;Xt.get("/auth/roles").then(function(t){e.roleOptions=t.data}).catch(function(e){console.log(e)})},rndStr:function(e){for(var t=" ",a="abcdefghijklmnopqrstuvwxyz",o=0;o<e;o++)t+=a.charAt(Math.floor(Math.random()*a.length));return t},getSuperDomains:function(){var e=this,t=Xt.defaults.baseURL.replace(/jones/g,"")+"lvpi/getAllDomain";Xt.get(t).then(function(t){e.superiorDomainOptions=t.data}).catch(function(e){console.error(e)})},onInsertRedash:function(){var e=l()(n.a.mark(function e(){var t,a,o,s=this;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return a="",!1,(t=this).redashIndex=this.rndStr(8),a=""==this.redashRefresh?this.redashURL:this.redashURL+"&refresh="+this.redashRefresh,o={redashname:this.redashName,redashURL:a,redashIndex:this.redashIndex,privilegeRoles:this.privilegeRoles.join(","),type:this.parentNode,superiorDomain:this.superiorDomain+""},console.log("begin redash check -------------------"),e.next=9,Xt.post("/redash/redashcheck",o,{responseType:"json"}).then(function(e){if("0000"!=e.data.code){var t="URL与["+e.data.title+"]重复，确认添加吗?";0==confirm(t)?s.cancelFlag=!0:s.cancelFlag=!1}}).catch(function(e){t.$message({message:"查询失败！"+e.toString(),type:"error"})});case 9:if(1!=this.cancelFlag){e.next=11;break}return e.abrupt("return");case 11:return console.log("begin redash insert -------------------"),e.next=14,Xt.post("/redash/redashinsert",o,{responseType:"json"}).then(function(e){t.newLid=e.data,-1!=t.newLid?(t.$message({message:"添加成功！",type:"success"}),sessionStorage.setItem(o.redashIndex,o.redashURL)):t.$message({message:"添加失败！",type:"error"})}).catch(function(e){t.$message({message:"添加失败！"+e.toString(),type:"error"})});case 14:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},created:function(){console.log("created")},mounted:function(){console.log("mounted"),this.getRoleOptions(),this.getSuperDomains()}},Zt={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("新增图表展示")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"图表名称"}},[a("el-input",{attrs:{size:"small"},model:{value:e.redashName,callback:function(t){e.redashName=t},expression:"redashName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"上级域名"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择",size:"small"},model:{value:e.superiorDomain,callback:function(t){e.superiorDomain=t},expression:"superiorDomain"}},e._l(e.superiorDomainOptions,function(e){return a("el-option",{key:e.Did,attrs:{label:e.Name,value:e.Did}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onInsertRedash()}}},[e._v("添加")])],1)],1),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"刷新时间(秒) "}},[a("el-input",{attrs:{placeholder:"请输入秒:如120",number:"",type:"number",maxlength:"5",size:"small"},model:{value:e.redashRefresh,callback:function(t){e.redashRefresh=t},expression:"redashRefresh"}})],1),e._v(" "),a("el-form-item",{attrs:{"label-width":"200px",label:"(置为空,表示不自动刷新)"}})],1),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"图表来源URL"}},[a("el-input",{staticStyle:{width:"800px"},attrs:{size:"big"},model:{value:e.redashURL,callback:function(t){e.redashURL=t},expression:"redashURL"}})],1)],1),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],attrs:{label:"有权使用的角色:"}},[a("el-select",{attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.privilegeRoles,callback:function(t){e.privilegeRoles=t},expression:"privilegeRoles"}},e._l(e.roleOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1)],1),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"图表类型"}},[a("el-radio-group",{model:{value:e.parentNode,callback:function(t){e.parentNode=t},expression:"parentNode"}},[a("el-radio",{attrs:{label:"数据图表",border:""}},[e._v("数据图表")]),e._v(" "),a("el-radio",{attrs:{label:"波动图表",border:""}},[e._v("波动图表")])],1)],1)],1)],1)},staticRenderFns:[]},ea=a("VU/8")(Qt,Zt,!1,null,null,null).exports,ta=a("mtWM"),aa={data:function(){return{url_src:"",timestamp:0,sec186:0,isShowFrame:!1,rolesData:[],myHeighgt:"400"}},methods:{updateCookie:function(){var e=this;ta.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1),e.isShowFrame=!0}).catch(function(e){console.log(e)}),console.log("++++++++++++++++++")}},created:function(){console.log("created");var e=this;e.isShowFrame=!1,this.url_src=sessionStorage.getItem(e.$route.params.redashname),console.log("redashUrl:"+this.url_src),ta.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1),e.isShowFrame=!0}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted");var e=document.body.clientHeight;console.log(e),this.myHeighgt=e-80},beforeUpdate:function(){console.log("before update"),this.url_src=sessionStorage.getItem(this.$route.params.redashname)},updated:function(){console.log("updated")}},oa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"outDiv",style:{height:e.myHeighgt+"px"}},[e.isShowFrame?a("iframe",{staticStyle:{height:"100%"},attrs:{id:"show-iframe",src:e.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}}):e._e(),e._v(" "),a("h3",{staticStyle:{display:"none"}},[e._v("\n        This is redashshow/"+e._s(e.$route.params.redashname)+"\n    ")])])},staticRenderFns:[]};var sa=a("VU/8")(aa,oa,!1,function(e){a("HJqy")},"data-v-4379c318",null).exports,na=a("mtWM"),ia={data:function(){return{redashData:[],redashURL:"",redashIndex:""}},methods:{DeleteRedash:function(e,t){var a=this,o={redashIndex:t};0!=confirm("确定删除吗?")&&(console.log("begin delete this redash : "+t),na.post("/redash/redashdel",o,{responseType:"json"}).then(function(t){a.$message({message:"删除成功！",type:"success"}),a.redashData.splice(e,1),console.log(a.redashData)}).catch(function(e){a.$message({message:"删除失败！"+e.toString(),type:"error"})}))}},created:function(){var e=this;na.get("/redash/redashall").then(function(t){var a=[];t.data.forEach(function(e){console.log(e),a.push(e)}),e.redashData=a,console.log("------------------"),console.log(e.redashData)}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},la={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("删除图表")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.redashData,stripe:""}},[a("el-table-column",{attrs:{prop:"title",label:"图表名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"info",label:"图表URL"}}),e._v(" "),a("el-table-column",{attrs:{prop:"index",label:"图标索引"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.DeleteRedash(t.$index,t.row.index)}}},[e._v("删除")])]}}])})],1)],1)],1)},staticRenderFns:[]},ra=a("VU/8")(ia,la,!1,null,null,null).exports,ca=a("mtWM"),da={data:function(){return{labelData:[],labelPTitleToPid:{},labelFatherList:[]}},methods:{changeCount:function(e){console.log(e);var t={labelId:e.labelId+"",sortId:e.sortId+""},a=this;ca.post("/auth/label/updateSortId",t,{responseType:"json"}).then(function(e){a.$message({message:"排序ID更新成功！",type:"success"})}).catch(function(e){console.log(e)})},UpdateLabel:function(e){e.status=!0},CancelUpdateLabel:function(e){e.labelTitle2=e.labelTitle,e.labelClass2=e.labelClass,e.labelPid2=e.labelPid,e.labelPTitle2=e.labelPTitle,e.status=!1},choosePidTitle:function(e){e.labelPid2=this.labelPTitleToPid[e.labelPTitle2]},SaveLabel:function(e){console.log(e);e.labelId;var t=this;if(e.labelTitle2!=e.labelTitle||e.labelClass2!=e.labelClass||e.labelPid2!=e.labelPid){var a={lid:e.labelId.toString(),title:e.labelTitle2,class:e.labelClass2,pid:e.labelPid2.toString()};console.log(a),ca.post("/auth/labels/pmupdate",a,{responseType:"json"}).then(function(a){e.labelTitle=e.labelTitle2,e.labelClass=e.labelClass2,e.labelPid=e.labelPid2,e.labelPTitle=e.labelPTitle2,e.status=!1,t.$message({type:"success",message:"更新成功!"}),console.info(a.data)}).catch(function(e){console.log(e)})}else t.$message({type:"success",message:"修改前后未变化!"})}},created:function(){var e=this;ca.get("/auth/labels/pmlabels").then(function(t){var a=[];for(var o in t.data.forEach(function(t){a.push({labelId:t.Lid,labelTitle:t.Title,labelClass:t.Class,labelPid:t.Pid,labelPTitle:t.Ptitle,labelTitle2:t.Title,labelClass2:t.Class,labelPid2:t.Pid,labelPTitle2:t.Ptitle,status:!1,sortId:t.SortId}),e.labelPTitleToPid[t.Ptitle]=t.Pid,0==t.Pid&&(e.labelPTitleToPid[t.Title]=t.Lid)}),e.labelData=a,e.labelPTitleToPid)e.labelFatherList.push({labelFatherPid:e.labelPTitleToPid[o],labelFatherTitle:o})}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},ua={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("配置标签关联")]),e._v(" "),a("el-row",[a("div",[a("el-table",{ref:"labelTable",attrs:{data:e.labelData,"row-key":"labelId",stripe:""},on:{"selection-change":e.handleURLSelectionChange}},[a("el-table-column",{attrs:{prop:"labelTitle2",label:"标签名称",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.labelTitle2,callback:function(a){e.$set(t.row,"labelTitle2",a)},expression:"scope.row.labelTitle2"}}):a("span",[e._v(e._s(t.row.labelTitle2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"labelClass2",label:"标签图标"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("e-icon-picker",{model:{value:t.row.labelClass2,callback:function(a){e.$set(t.row,"labelClass2",a)},expression:"scope.row.labelClass2"}}):a("i",{class:t.row.labelClass2})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"上级标签名称",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-select",{on:{change:function(a){return e.choosePidTitle(t.row)}},model:{value:t.row.labelPTitle2,callback:function(a){e.$set(t.row,"labelPTitle2",a)},expression:"scope.row.labelPTitle2"}},e._l(e.labelFatherList,function(e){return a("el-option",{key:e.labelFatherPid,attrs:{label:e.labelFatherTitle,value:e.labelFatherTitle}})}),1):a("span",[e._v(e._s(t.row.labelPTitle))])]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"sortId",label:"排序ID",sortable:""},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input-number",{attrs:{min:1,max:1e4,size:"small"},on:{change:function(a){return e.changeCount(t.row)}},model:{value:t.row.sortId,callback:function(a){e.$set(t.row,"sortId",a)},expression:"scope.row.sortId"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.UpdateLabel(t.row)}}},[e._v("修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.CancelUpdateLabel(t.row)}}},[e._v("放弃修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.SaveLabel(t.row)}}},[e._v("保存")])]}}])})],1)],1)])],1)},staticRenderFns:[]},pa=a("VU/8")(da,ua,!1,null,null,null).exports,ma=a("mtWM"),fa={data:function(){return{labelData:[],newLabelTitle:"",newLabelIndex:"",newLabelNS:""}},methods:{onAddLabel:function(){var e=this,t={title:e.newLabelTitle,index:e.newLabelIndex,namespace:e.newLabelNS};ma.post("/auth/labels/rdadd",t,{responseType:"json"}).then(function(t){var a=t.data;console.log(a),console.log("=================="),e.labelData.push({labelId:a,labelTitle:e.newLabelTitle,labelIndex:e.newLabelIndex,labelNameSpace:e.newLabelNS,labelTitle2:e.newLabelTitle,labelIndex2:e.newLabelIndex,labelNameSpace2:e.newLabelNS,status:!1}),e.$message({type:"success",message:"添加成功,标签id"+a.toString()+"!"}),e.newLabelTitle="",e.newLabelIndex="",e.newLabelNS="",console.info(t.data)}).catch(function(e){console.log(e)})},UpdateLabel:function(e){e.status=!0},CancelUpdateLabel:function(e){e.labelTitle2=e.labelTitle,e.labelIndex2=e.labelIndex,e.labelNameSpace2=e.labelNameSpace,e.status=!1},SaveLabel:function(e){var t=this;if(e.labelIndex2!=e.labelIndex||e.labelNameSpace2!=e.labelNameSpace){var a={lid:e.labelId.toString(),index:e.labelIndex2,namespace:e.labelNameSpace2};ma.post("/auth/labels/rdupdate",a,{responseType:"json"}).then(function(a){e.labelIndex=e.labelIndex2,e.labelNameSpace=e.labelNameSpace2,e.status=!1,t.$message({type:"success",message:"更新成功!"}),console.info(a.data)}).catch(function(e){console.log(e)})}else t.$message({type:"success",message:"修改前后未变化!"})}},created:function(){var e=this;ma.get("/auth/labels/rdlabels").then(function(t){var a=[];t.data.forEach(function(e){a.push({labelId:e.Lid,labelTitle:e.Title,labelIndex:e.Index,labelNameSpace:e.NameSpace,labelTitle2:e.Title,labelIndex2:e.Index,labelNameSpace2:e.NameSpace,status:!1})}),e.labelData=a}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},ha={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("新增标签")]),e._v(" "),a("el-form",{attrs:{"label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入标签名"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newLabelTitle,callback:function(t){e.newLabelTitle=t},expression:"newLabelTitle"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"请输入URL索引"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newLabelIndex,callback:function(t){e.newLabelIndex=t},expression:"newLabelIndex"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{inline:"true",label:"请输入命名空间"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newLabelNS,callback:function(t){e.newLabelNS=t},expression:"newLabelNS"}})],1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onAddLabel()}}},[e._v("添加")])],1)],1),e._v(" "),a("h3",[e._v("配置标签关联")]),e._v(" "),a("el-row",[a("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[a("el-table",{ref:"labelTable",attrs:{data:e.labelData,"row-key":"labelId",stripe:""}},[a("el-table-column",{attrs:{property:"labelId",label:"标签id"}}),e._v(" "),a("el-table-column",{attrs:{prop:"labelTitle2",label:"标签名称"}}),e._v(" "),a("el-table-column",{attrs:{prop:"labelIndex2",label:"标签索引"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.labelIndex2,callback:function(a){e.$set(t.row,"labelIndex2",a)},expression:"scope.row.labelIndex2"}}):a("span",[e._v(e._s(t.row.labelIndex2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"labelNameSpace2",label:"标签命名空间"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.labelNameSpace2,callback:function(a){e.$set(t.row,"labelNameSpace2",a)},expression:"scope.row.labelNameSpace2"}}):a("span",[e._v(e._s(t.row.labelNameSpace2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.UpdateLabel(t.row)}}},[e._v("修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.CancelUpdateLabel(t.row)}}},[e._v("放弃修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.SaveLabel(t.row)}}},[e._v("保存")])]}}])})],1)],1)])],1)},staticRenderFns:[]},va=a("VU/8")(fa,ha,!1,null,null,null).exports,ba=a("Dd8w"),ga=a.n(ba),ya=a("woOf"),_a=a.n(ya),wa=a("G901").TopologicalSort,ka=a("mtWM"),xa={components:{editor:a("o4sT")},data:function(){return{internalVars:[],intervalVars:["Last7days","LastWeek","ThisWeek","LastMonth","ThisMonth"],momentVars:["yyyyMMdd","HH"],checkOutputMeta:{start:!1,success:!1,fail:!1},cmOptions:{tabSize:4,mode:"text/x-mysql",theme:"default",lineNumbers:!0,dragDrop:!1,line:!0,hintOptions:{tables:{},databases:{}},extraKeys:{Tab:"autocomplete",F12:function(e){console.log(e.getOption("fullScreen")),e.setOption("fullScreen",!e.getOption("fullScreen"))},Esc:function(e){e.getOption("fullScreen")&&e.setOption("fullScreen",!1)}}},dagId:0,helpContent:'自动数仓中和时间相关的变量请使用内置变量. 表示时间间隔的变量, 可以用.start和.end表示一段时间的开始和结束:[ "Last7days", "LastWeek", "ThisWeek", "LastMonth", "ThisMonth" ]\n表示时间点的变量, 分别用 "yyyyMMdd" 表示天; "HH" 表示小时]',taskType:[{label:"hive",id:"hive"},{label:"mysql",id:"mysql"},{label:"hdfs",id:"hdfs"},{label:"绿皮",id:"lvpi"},{label:"自定义类型",id:"custom"}],taskTypeDsidOptions:[],outType:[{label:"hive",id:"hive"},{label:"mail",id:"mail"},{label:"clickhouse",id:"clickhouse"},{label:"mysql",id:"mysql"},{label:"绿皮",id:"lvpi"}],imgOptions:[],dsOptions:[],options:{enableBasicAutocompletion:!0,enableSnippets:!0,enableLiveAutocompletion:!0},jsonshow:!1,dragBus:!1,busValue:{value:"name",pos_x:100,pos_y:100},defaultProps:{children:"children",label:"label"},DataAll:{edges:[],nodes:[]},jsonEditor:S()("//change JSON click left button show the change"),drawerVisible:!1,drawerDAGVisible:!1,drawerDAGLoading:!1,fieldDescription:!1,parsing:!1,nodeForm:{tmpName:"",taskDesc:"",tmpNodeId:"",taskType:"",taskTypeInfo:{dsid:0,hdfsLocation:"",splitter:"",validFieldCount:"0",schema:[{id:"",name:""}],extendSchema:[{id:"",name:""}],hasExtend:!1,hdfsDoneLocation:"",fileEncode:"GBK",isCheckDone:!1,downloadHdfsPath:"",cmd:"",hdfsAuthUser:"",hdfsAuthPassword:""},dockerImg:"",dockerCmd:"",param:"",originalSql:"",sqlFields:[],outTableType:"",outTableName:"",outTableDesc:"",outTableNameOptions:[],envs:[],storageEngine:"",storageEngineOptions:["orc/snappy","tsv"],newOrOldOutTable:"",email:{title:"",receiver:"",withAttachment:!1},clickhouse:{partitionStr:"",indexStr:""},lvpi:{jdbcStr:"",dsid:0}},dagForm:{name:"",exhibitName:"",startDate:Object(r.d)(new Date),mailList:"",cronExpression:"",dagType:"day",delay:"",retries:"",retryDelay:""},cronPlaceHolder:"",checkTaskName:{start:!1,success:!1,fail:!1},isCheck:!1,submitDialogVisible:!1,submitActivities:[{content:"创建DAG任务输出表",timestamp:"",type:"primary",icon:""},{content:"连通airflow",timestamp:"",type:"",icon:""},{content:"生成表层级血缘关系",timestamp:"",type:"",icon:""},{content:"等待完成",timestamp:"",type:"",icon:""}],filterText:"",treeData:"",sqlDialogVisible:!1,defaultSqlProps:{children:"children",label:"label",templateId:"templateId"},form:{name:"",sql:""},paramNames:[],paramTypes:[],paramValues:[],jsonParams:"",description:"",paramOptions:[{label:"一般类型",value:"string",defaultValue:""},{label:"日期类型",value:"date",defaultValue:"19990101"}]}},computed:{getInputTypeOptionByImg:function(){var e=this;console.log("调用计算了");var t="";this.imgOptions.forEach(function(a){a.Id==e.nodeForm.dockerImg&&(t=a.Img)}),-1===(t+"").indexOf("custom")?(console.log("不包含 custom"),this.taskType=[{label:"hive",id:"hive"},{label:"mysql",id:"mysql"},{label:"hdfs",id:"hdfs"},{label:"绿皮",id:"lvpi"}]):(console.log("包含 custom"),this.taskType=[{label:"自定义类型",id:"custom"}]);try{this.nodeForm.taskType=this.taskType[0].id}catch(e){console.error(e)}return this.taskType},onParsing:function(){return this.parsing},parseButtonIcon:function(){return this.parsing?"el-icon-loading":""},parseButtonText:function(){return this.parsing?"字段分析中":"配置表"},checkJobName:function(){return new RegExp("^[0-9a-z-]+$").test(this.nodeForm.tmpName)},codemirror:function(){return console.log("计算了"),this.$refs.cmEditor.codemirror},onProcessing:function(){return this.isProcessing()},buttonText:function(){return this.isProcessing()?"提交中":this.isSubmitSuccess()?"确定":"保存下次修改"},buttonIcon:function(){return this.isProcessing()?"el-icon-loading":""},getOutputType:function(){return this.nodeForm.outTableType},getNewOrOldOutTable:function(){return"mail"===this.nodeForm.outTableType?"":this.nodeForm.newOrOldOutTable}},watch:{filterText:function(e){this.$refs.tree.filter(e)}},methods:{delExtendSchema:function(e,t){"extendSchema"===t?this.nodeForm.taskTypeInfo.extendSchema.length>1&&this.nodeForm.taskTypeInfo.extendSchema.splice(e,1):this.nodeForm.taskTypeInfo.schema.length>1&&this.nodeForm.taskTypeInfo.schema.splice(e,1)},addExtendSchema:function(e,t){var a={id:"",name:""};"extendSchema"===t?this.nodeForm.taskTypeInfo.extendSchema.splice(e+1,0,a):this.nodeForm.taskTypeInfo.schema.splice(e+1,0,a)},exploreEmail:function(){this.parsing=!0;var e="",t={sql:this.nodeForm.originalSql,params:this.nodeForm.sqlParam,taskType:this.nodeForm.taskType},a=this;ka.post("/airflow/getSqlFields",t,{responseType:"json"}).then(function(t){var o=JSON.parse(t.data.Info);if(console.log(o),0===o.length)a.$notify({type:"info",duration:5e3,message:"未能静态解析出字段, 请确保配置了所有参数. 或是使用了特殊语法"});else{var s="",n="";o.forEach(function(e){s=s+'\n<th style="border: 1px solid black;"><span style="color: white">'+e+"</span></th>",n+='\n<td style="border: 1px solid black;"> - </td>'}),e='<table style="width:100%; border: 1px solid black; border-collapse: collapse; font-size: 11px; table-layout:fixed;"><tr bgcolor="#2561CF" margin="1" align="center" >'+s+'</tr><tr align="center">'+n+"</tr></table>",console.log(e),document.getElementById("emailExplore").innerHTML=e}a.parsing=!1}).catch(function(e){console.log(e),a.parsing=!1})},afterSubmitDag:function(){console.log("是否创建成功:"+this.isSubmitSuccess());var e=this;this.isSubmitSuccess()?this.submitDialogVisible=!1:ka.post("/airflow/saveDagWhenPostFail",e.DataAll,{responseType:"json"}).then(function(t){var a=t.data;a.Res?(e.submitDialogVisible=!1,e.$notify({message:"保存成功",type:"success"}),e.isCheck=!0):e.$notify({message:a.Info,type:"error"})}).catch(function(t){console.log(t),e.checkOutputMeta.start=!1})},checkMetaData:function(){if(""!==this.nodeForm.outTableName){var e=this,t={sql:this.nodeForm.originalSql,params:this.nodeForm.sqlParam,outTableName:this.nodeForm.outTableName,outTableType:this.nodeForm.outTableType,taskType:this.nodeForm.taskType};e.checkOutputMeta.start=!0,ka.post("/airflow/checkOutTable",t,{responseType:"json"}).then(function(t){e.checkOutputMeta.start=!1;var a=t.data;a.Res?(e.checkOutputMeta.success=!0,e.checkOutputMeta.fail=!1):(e.checkOutputMeta.fail=!0,e.checkOutputMeta.success=!1,e.$notify({message:a.Info,type:"error"}))}).catch(function(t){console.log(t),e.checkOutputMeta.start=!1})}},getOutTableNameOptions:function(){var e={tableType:this.nodeForm.outTableType,dsId:this.nodeForm.lvpi.dsid+""},t=this;ka.post("/airflow/getOutTables",e,{responseType:"json"}).then(function(e){t.nodeForm.outTableNameOptions=e.data}).catch(function(e){console.log(e)})},echoSqlParam:function(e){console.log("sqlParam: "+e);var t=this;(this.paramNames=[],this.paramTypes=[],this.paramValues=[],void 0!==e&&""!==e)&&JSON.parse(e).forEach(function(e){t.paramNames.push(e.name),t.paramTypes.push(e.type),t.paramValues.push(e.value)})},parseSql:function(){this.parsing=!0;var e=this.nodeForm.originalSql,t=this.nodeForm.sqlParam;this.echoSqlParam(t);var a={params:t,sql:e,taskType:this.nodeForm.taskType};console.log(a);var o=this;ka.post("/airflow/getSqlFields",a,{responseType:"json"}).then(function(e){var t=e.data,a=[];if(t.Res){a=JSON.parse(t.Info),console.log(a);var s=[];0===a.length?o.$notify({type:"info",duration:5e3,message:"未能静态解析出字段, 请确保配置了所有参数. 或是使用了特殊语法"}):(a.forEach(function(e){s.push({fieldName:e,description:""})}),o.nodeForm.sqlFields=s)}else o.$notify({type:"error",duration:5e3,message:t.Info}),o.nodeForm.sqlFields=[];o.parsing=!1}).catch(function(e){o.parsing=!1})},isProcessing:function(){var e=this.submitActivities.length-1;return""===this.submitActivities[e].type},isSubmitSuccess:function(){var e=this.submitActivities.length-1;return"danger"!==this.submitActivities[e].type},handleCloseSubmit:function(e){this.isProcessing()?this.$confirm("DAG在生成中,确认关闭吗?").then(function(t){e()}).catch(function(e){}):e()},closeFields:function(e){console.log(this.nodeForm.sqlFields),e()},getImageById:function(e){if(null!==this.imgOptions)for(var t=0;t<this.imgOptions.length;t++)if(this.imgOptions[t].Id===e)return this.imgOptions[t]},getImageIdByImageName:function(e){for(var t=0;t<this.imgOptions.length;t++)if(this.imgOptions[t].Img===e)return this.imgOptions[t].Id},onChangeImg:function(e){console.log(this.imgOptions),console.log(e);var t=this.getImageById(e);this.nodeForm.dockerCmd=t.Command},checkDuplicateName:function(){if(!new RegExp("^[0-9a-z-]+$").test(this.dagForm.name))return this.checkTaskName.start=!1,this.checkTaskName.success=!1,void(this.checkTaskName.fail=!0);this.checkTaskName={start:!0,success:!1,fail:!1};var e=this;ka.get("/airflow/checkDagName/"+this.dagForm.name).then(function(t){var a=t.data.Res;e.checkTaskName.start=!1,a?(e.checkTaskName.success=!1,e.checkTaskName.fail=!0):(e.checkTaskName.success=!0,e.checkTaskName.fail=!1)}).catch(function(t){e.checkTaskName.start=!1})},markActivityStatus:function(e,t,a,o){if(this.submitActivities[e].type=t,this.submitActivities[e].icon=a,this.submitActivities[e].timestamp=o,"danger"===t&&2!==e){var s=this.submitActivities.length-1;this.submitActivities[s].type="danger",this.submitActivities[s].icon="el-icon-error",this.submitActivities[s].timestamp="DAG创建失败"}},resetActivityStatus:function(){this.submitActivities=[{content:"创建DAG任务输出表",timestamp:"",type:"",icon:""},{content:"连通airflow",timestamp:"",type:"",icon:""},{content:"生成表层级血缘关系",timestamp:"",type:"",icon:""},{content:"等待完成",timestamp:"",type:"",icon:""}]},onUpdateDAG:function(){var e=this;this.checkCycle()?this.$alert("该DAG中存在环路, 请调整后提交","注意",{confirmButtonText:"确定"}):(this.DataAll.dagConfig=this.dagForm,this.submitDialogVisible=!0,this.resetActivityStatus(),this.markActivityStatus(0,"primary","el-icon-loading",""),ka.post("/airflow/preAddDag",e.DataAll,{responseType:"json"}).then(function(t){var a=t.data;a.Res?(e.markActivityStatus(0,"success","el-icon-success","success!"),ka.post("/airflow/updateDag?dagName="+e.dagId,e.DataAll,{responseType:"json"}).then(function(t){var a=t.data;a.Res?(e.markActivityStatus(1,"success","el-icon-success","success!"),ka.post("/airflow/afterPostDag",e.DataAll,{responseType:"json"}).then(function(t){t.data.Res?(e.isCheck=!0,e.markActivityStatus(2,"success","el-icon-success","success!")):e.markActivityStatus(2,"danger","el-icon-error",t.data.Info),e.markActivityStatus(3,"success","el-icon-success","DAG创建成功!")}).catch(function(t){console.error(t),e.markActivityStatus(2,"danger","el-icon-error",t),e.markActivityStatus(3,"success","el-icon-success","DAG创建成功!")})):e.markActivityStatus(1,"danger","el-icon-error",a.Info)}).catch(function(t){console.error(t),e.markActivityStatus(1,"danger","el-icon-error",t)})):e.markActivityStatus(0,"danger","el-icon-error",a.Info)}).catch(function(t){e.markActivityStatus(0,"danger","el-icon-error",t),console.error(t)}))},onSubmitDAG:function(){var e=this;if(this.checkTaskName.success&&!Object(r.a)(this.dagForm.name)&&-1===this.dagForm.name.indexOf("_")){for(var t=this.DataAll.nodes,a=0;a<t.length;++a)if(Object(r.a)(t[a].name))return void this.$alert("DAG任务的名称中含有中文, 请修改","注意",{confirmButtonText:"确定"});""!==this.dagForm.name?this.checkCycle()?this.$alert("该DAG中存在环路, 请调整后提交","注意",{confirmButtonText:"确定"}):(this.DataAll.dagConfig=this.dagForm,console.log(this.DataAll),e.submitDialogVisible=!0,this.resetActivityStatus(),this.markActivityStatus(0,"primary","el-icon-loading",""),ka.post("/airflow/preAddDag",e.DataAll,{responseType:"json"}).then(function(t){var a=t.data;a.Res?(e.markActivityStatus(0,"success","el-icon-success","success!"),ka.post("/airflow/addDag",e.DataAll,{responseType:"json"}).then(function(t){var a=t.data;a.Res?(e.markActivityStatus(1,"success","el-icon-success","success!"),ka.post("/airflow/afterPostDag",e.DataAll,{responseType:"json"}).then(function(t){t.data.Res?(e.isCheck=!0,e.markActivityStatus(2,"success","el-icon-success","success!")):e.markActivityStatus(2,"danger","el-icon-error",t.data.Info),e.markActivityStatus(3,"success","el-icon-success","DAG创建成功!")}).catch(function(t){console.error(t),e.markActivityStatus(2,"danger","el-icon-error",t),e.markActivityStatus(3,"success","el-icon-success","DAG创建成功!")})):e.markActivityStatus(1,"danger","el-icon-error",a.Info)}).catch(function(t){console.error(t),e.markActivityStatus(1,"danger","el-icon-error",t)})):e.markActivityStatus(0,"danger","el-icon-error",a.Info)}).catch(function(t){e.markActivityStatus(0,"danger","el-icon-error",t),console.error(t)})):this.$alert("请先配置DAG调度信息","注意",{confirmButtonText:"确定"})}else this.$alert("DAG名称重复或含有中文,下划线, 请更改","注意",{confirmButtonText:"确定"})},checkCycle:function(){for(var e=!1,t=this.DataAll.nodes,a=this.DataAll.edges,o=new T.a,s=0;s<t.length;s++)o.set(t[s].id+"",t[s].id);for(var n=new wa(o),i=0;i<a.length;i++)n.addEdge(a[i].src_node_id+"",a[i].dst_node_id+"");try{n.sort();console.log("没环"),e=!1}catch(t){console.log(t),console.log("有环"),e=!0}return e},resetForm:function(){this.nodeForm.tmpName="new-node",this.nodeForm.tmpNodeId=""},findIdAndUpdateJson:function(){for(var e=this.nodeForm.tmpNodeId,t=0;t<this.DataAll.nodes.length;t++)if(this.DataAll.nodes[t].id===e){this.DataAll.nodes[t].name=this.nodeForm.tmpName,this.DataAll.nodes[t].taskDesc=this.nodeForm.taskDesc;var a=this.getImageById(this.nodeForm.dockerImg);console.log("img: "+a),void 0!==a&&(this.DataAll.nodes[t].image=a.Img),this.DataAll.nodes[t].command=this.nodeForm.dockerCmd,this.DataAll.nodes[t].envs=this.nodeForm.envs,this.DataAll.nodes[t].param=this.nodeForm.param,this.DataAll.nodes[t].outTableType=this.nodeForm.outTableType,this.DataAll.nodes[t].outTableName=this.nodeForm.outTableName,this.DataAll.nodes[t].outTableDesc=this.nodeForm.outTableDesc,this.DataAll.nodes[t].taskType=this.nodeForm.taskType,this.DataAll.nodes[t].taskTypeInfo=this.nodeForm.taskTypeInfo,this.DataAll.nodes[t].originalSql=this.nodeForm.originalSql,this.DataAll.nodes[t].sqlParam=this.nodeForm.sqlParam,this.DataAll.nodes[t].sqlFields=this.nodeForm.sqlFields,this.DataAll.nodes[t].storageEngine=this.nodeForm.storageEngine,this.DataAll.nodes[t].newOrOldOutTable=this.nodeForm.newOrOldOutTable,this.DataAll.nodes[t].email=this.nodeForm.email,this.DataAll.nodes[t].lvpi=this.nodeForm.lvpi,this.DataAll.nodes[t].clickhouse=this.nodeForm.clickhouse}this.jsonEditor=S()(this.DataAll,null,4),this.saveChange()},handleDAGClose:function(e){this.drawerDAGVisible=!1},handleClose:function(e){this.findIdAndUpdateJson(),this.cancelForm(),console.log("json已更新"),console.log(this.DataAll)},cancelForm:function(){this.drawerVisible=!1,this.nodeForm={tmpName:"",taskDesc:"",tmpNodeId:"",taskType:"",taskTypeInfo:{dsid:0,hdfsLocation:"",splitter:"",validFieldCount:"0",schema:[{id:"",name:""}],extendSchema:[{id:"",name:""}],hasExtend:!1,hdfsDoneLocation:"",isCheckDone:!1},dockerImg:"",dockerCmd:"",param:"",originalSql:"",sqlFields:[],outTableType:"",outTableName:"",outTableDesc:"",outTableNameOptions:[],envs:[],storageEngine:"",storageEngineOptions:["orc/snappy","tsv"],newOrOldOutTable:"",email:{title:"",receiver:"",withAttachment:!1},clickhouse:{partitionStr:"",indexStr:""},lvpi:{jdbcStr:"",dsid:0}},this.resetForm()},dragIt:function(e){sessionStorage.dragDes=S()({drag:!0,name:e})},updateDAG:function(e,t,a){this.DataAll=e,this.jsonEditor=S()(this.DataAll,null,4)},saveChange:function(){this.DataAll=JSON.parse(this.jsonEditor)},startNodesBus:function(e){var t=null;if(sessionStorage.dragDes&&(t=JSON.parse(sessionStorage.dragDes)),t&&t.drag){var a=e.pageX,o=e.pageY;this.busValue=_a()({},this.busValue,{pos_x:a,pos_y:o,value:t.name}),this.dragBus=!1}},moveNodesBus:function(e){if(this.dragBus){var t=e.pageX,a=e.pageY;this.busValue=_a()({},this.busValue,{pos_x:t,pos_y:a})}},endNodesBus:function(e){var t=null;if(sessionStorage.dragDes&&(t=JSON.parse(sessionStorage.dragDes)),t&&t.drag&&"svgContent"===e.toElement.id){var a=t,o=(a.model_id,a.type),s=(e.offsetX-15-(sessionStorage.svg_left||0))/(sessionStorage.svgScale||1),n=(e.offsetY-15-(sessionStorage.svg_top||0))/(sessionStorage.svgScale||1),i={model_id:sessionStorage.newGraph,desp:{type:o,pos_x:s,pos_y:n,name:this.busValue.value,rightClickEvent:[{label:"配置DAG调度",eventName:"editDAG"},{label:"配置任务",eventName:"editTask"}]}};this.DataAll.nodes.push(ga()({},i.desp,{id:this.DataAll.nodes.length+100,in_ports:[0],out_ports:[0]}))}window.sessionStorage.dragDes=null,this.dragBus=!1},handleNodeClick:function(e){console.log("handleNodeClick");var t=e.value,a=e.url;if(a)return this.$router.push(a),!1;t&&(localStorage.currentExample=S()(t),this.DataAll=t,this.jsonEditor=S()(this.DataAll,null,"\t"),this.jsonshow=!0,this.svgScale=sessionStorage.svgScale=1.5)},editorInit:function(e){a("R3yc"),a("hCU/"),a("h636"),a("nP34"),a("Dukv"),a("A/fa"),a("NbQv"),a("rGxq")},editNodeDetails:function(e){alert("edit id "+e.id+" , info : "+S()(e.detail,null,4)+" ")},doSthPersonal:function(e,t){console.log(e+":"+t),"editTask"===e?(this.nodeForm.tmpNodeId=t,this.getNodeInfoById(t),this.drawerVisible=!0,console.log(this.nodeForm)):"editDAG"===e&&(this.nodeForm.tmpNodeId=t,this.drawerDAGVisible=!0)},getNodeInfoById:function(e){for(var t=this,a=0;a<this.DataAll.nodes.length;a++)if(this.DataAll.nodes[a].id===e){if(console.log("当前节点数据:"),console.log(this.DataAll.nodes[a]),this.nodeForm.tmpName=this.DataAll.nodes[a].name,this.nodeForm.taskDesc=this.DataAll.nodes[a].taskDesc,this.nodeForm.taskType=this.DataAll.nodes[a].taskType,ka.get("/airflow/GetConnByPrivilege/"+this.nodeForm.taskType).then(function(e){t.taskTypeDsidOptions=e.data}).catch(function(e){console.log(e)}),this.nodeForm.dockerImg=this.getImageIdByImageName(this.DataAll.nodes[a].image),this.nodeForm.dockerCmd=this.DataAll.nodes[a].command,this.nodeForm.envs=void 0===this.DataAll.nodes[a].envs?[]:this.DataAll.nodes[a].envs,this.nodeForm.param=this.DataAll.nodes[a].param,this.nodeForm.outTableType=this.DataAll.nodes[a].outTableType,this.nodeForm.outTableName=this.DataAll.nodes[a].outTableName,this.nodeForm.outTableDesc=this.DataAll.nodes[a].outTableDesc,this.nodeForm.originalSql=this.DataAll.nodes[a].originalSql,this.nodeForm.sqlParam=this.DataAll.nodes[a].sqlParam,this.nodeForm.sqlFields=this.DataAll.nodes[a].sqlFields,this.nodeForm.storageEngine=this.DataAll.nodes[a].storageEngine,this.nodeForm.storageEngineOptions=["orc/snappy","tsv"],this.nodeForm.newOrOldOutTable=this.DataAll.nodes[a].newOrOldOutTable,void 0!==this.DataAll.nodes[a].email&&(this.nodeForm.email={title:void 0===this.DataAll.nodes[a].email.title?"":this.DataAll.nodes[a].email.title,receiver:void 0===this.DataAll.nodes[a].email.receiver?"":this.DataAll.nodes[a].email.receiver,withAttachment:void 0!==this.DataAll.nodes[a].email.withAttachment&&this.DataAll.nodes[a].email.withAttachment}),console.log(this.DataAll.nodes[a].clickhouse),void 0!==this.DataAll.nodes[a].clickhouse&&(this.nodeForm.clickhouse={partitionStr:void 0===this.DataAll.nodes[a].clickhouse.partitionStr?"":this.DataAll.nodes[a].clickhouse.partitionStr,indexStr:void 0===this.DataAll.nodes[a].clickhouse.indexStr?"":this.DataAll.nodes[a].clickhouse.indexStr}),void 0!==this.DataAll.nodes[a].lvpi&&(this.nodeForm.lvpi={jdbcStr:void 0===this.DataAll.nodes[a].lvpi.jdbcStr?"":this.DataAll.nodes[a].lvpi.jdbcStr,dsid:void 0===this.DataAll.nodes[a].lvpi.dsid?0:this.DataAll.nodes[a].lvpi.dsid}),void 0!==this.DataAll.nodes[a].taskTypeInfo&&(this.nodeForm.taskTypeInfo=this.DataAll.nodes[a].taskTypeInfo),this.form.name="",this.paramNames=[],this.paramTypes=[],this.paramValues=[],this.form.sql=null==this.nodeForm.originalSql?"":this.nodeForm.originalSql,this.jsonParams=null==this.nodeForm.sqlParam?"":this.nodeForm.sqlParam,""!=this.jsonParams)for(var o=JSON.parse(this.jsonParams),s=0;s<o.length;s++)this.paramNames.push(o[s].name),this.paramTypes.push(o[s].type),this.paramValues.push(o[s].value);this.getConnection()}console.log()},onAddParams:function(){this.nodeForm.envs.push({env_key:"",env_val:""})},removeNewParam:function(e){var t=this.nodeForm.envs.indexOf(e);-1!==t&&this.nodeForm.envs.splice(t,1)},onChangeDAGType:function(e){"hour"===e?this.cronPlaceHolder="示例:55 * * * *":"day"===e&&(this.cronPlaceHolder="示例:00 15 * * *")},loadDagData:function(e){var t=this;null!=e&&ka.get("/airflow/getDag?dagName="+e).then(function(e){console.log(e.data);var a=e.data;t.dagForm=a.dagConfig,delete a.dagConfig,t.DataAll=a,t.isCheck=!0}).catch(function(e){console.log(e)})},CreateSQLByTemplate:function(){var e=this;this.form.sql=void 0===this.nodeForm.originalSql?"":this.nodeForm.originalSql;var t=e.nodeForm.taskType;ka.get("/airflow/template/getAllTemplate/"+t).then(function(t){e.treeData=t.data}).catch(function(e){console.log(e)}),e.sqlDialogVisible=!0,console.log(e.nodeForm)},filterNode:function(e,t){return!e||-1!==t.label.indexOf(e)},resetParam:function(){this.paramTypes=[],this.paramNames=[],this.paramValues=[],this.jsonParams=""},qyeryInfo:function(e){var t=this;"0"!=e.pid&&(this.resetParam(),t.curTmplateId=e.templateId,console.log("templateId:"+e.templateId),console.log("label:"+e.label),ka.get("/airflow/template/getById/"+e.templateId).then(function(e){console.log(e.data.Template),t.form.name=e.data.Title,t.form.sql=e.data.Template,t.description=e.data.Description,t.onParam("form")}).catch(function(e){console.log(e)}))},onParam:function(e){var t=this;this.resetParam();var a=this.form.sql.match(/\{\{(.+?)\}\}/g);console.log("originParams:"+a),a.forEach(function(e){var a=e.substring(2,e.length-2);console.log(a),console.log(t.internalVars.indexOf(a)),-1===t.internalVars.indexOf(a)&&(console.log("找到了:"+a),t.paramNames.push(a))}),console.log("paramNames:"+this.paramNames);for(var o=0;o<this.paramNames.length;o++)this.paramValues.push(""),this.paramTypes.push("")},makeParam:function(){for(var e=[],t=0;t<this.paramNames.length;t++)e.push({name:this.paramNames[t],type:this.paramTypes[t],value:this.paramValues[t]});console.log("paramsName:"+this.paramNames+"\nparamTypes:"+this.paramTypes+"\nparamValues:"+this.paramValues),this.jsonParams=S()(e),console.log("jsonParam:"+this.jsonParams)},CommitSQL:function(){this.makeParam(),this.nodeForm.originalSql=this.form.sql,this.nodeForm.sqlParam=this.jsonParams,this.sqlDialogVisible=!1},onChangeParamType:function(e){this.paramValues[e]="",console.log(this.paramTypes)},taskTypeChange:function(){this.nodeForm.taskTypeInfo.dsid=0;var e=this.nodeForm.taskType,t=this;ka.get("/airflow/GetConnByPrivilege/"+e).then(function(e){t.taskTypeDsidOptions=e.data}).catch(function(e){console.log(e)})},initInternalVars:function(){var e=[];this.intervalVars.forEach(function(t){e.push(t+".start"),e.push(t+".end")}),this.momentVars.forEach(function(t){e.push(t)}),this.internalVars=e,console.log(this.internalVars)},getConnection:function(){var e=this,t=this.nodeForm.outTableType;"lvpi"===t&&(t="mysql"),ka.get("/connMeta/get?connType="+t).then(function(t){e.dsOptions=t.data})}},created:function(){},mounted:function(){var e=this,t=sessionStorage.getItem("jones_airflow_dagId");console.log("需要回显的dag为: "+t),this.dagId=t,ka.get("/airflow/getAllDagImgs").then(function(t){e.imgOptions=t.data}).catch(function(e){console.log(e)}),this.loadDagData(t),sessionStorage.removeItem("jones_airflow_dagId"),this.initInternalVars(),this.onChangeDAGType("day")}},Ia={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"page-content",on:{mousedown:function(t){return e.startNodesBus(t)},mousemove:function(t){return e.moveNodesBus(t)},mouseup:function(t){return e.endNodesBus(t)}}},[a("el-button",{staticClass:"elbutton",attrs:{type:"primary",size:"small"},nativeOn:{mousedown:function(t){return e.dragIt("new-node")}}},[e._v("拖拽新建Node")]),e._v(" "),e.isCheck?a("el-button",{staticStyle:{position:"absolute",top:"10px",right:"10px"},attrs:{type:"primary",size:"small"},on:{click:e.onUpdateDAG}},[e._v("提交修改\n  ")]):e._e(),e._v(" "),e.isCheck?e._e():a("el-button",{staticStyle:{position:"absolute",top:"10px",right:"10px"},attrs:{type:"primary",size:"small"},on:{click:e.onSubmitDAG}},[e._v("提交创建\n  ")]),e._v(" "),a("DAGBoard",{attrs:{DataAll:e.DataAll},on:{updateDAG:e.updateDAG,editNodeDetails:e.editNodeDetails,doSthPersonal:e.doSthPersonal}}),e._v(" "),e.dragBus?a("node-bus",{attrs:{value:e.busValue.value,pos_x:e.busValue.pos_x,pos_y:e.busValue.pos_y}}):e._e(),e._v(" "),a("editor",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],ref:"myEditor",staticClass:"json-editor",attrs:{options:e.options,lang:"json",theme:"chrome",width:"400"},on:{init:e.editorInit},model:{value:e.jsonEditor,callback:function(t){e.jsonEditor=t},expression:"jsonEditor"}}),e._v(" "),a("el-drawer",{ref:"drawer",attrs:{title:"详情","with-header":!1,visible:e.drawerVisible,direction:"rtl","custom-class":"demo-drawer",size:"50%","before-close":e.handleClose},on:{"update:visible":function(t){e.drawerVisible=t}}},[a("div",{staticClass:"allDiv"},[a("div",{staticClass:"content"},[a("div",{staticClass:"content-inside",staticStyle:{"max-height":"720px",overflow:"auto"}},[a("el-form",{ref:"nodeForm",attrs:{model:e.nodeForm,"label-width":"130px"}},[a("el-form-item",{attrs:{label:"任务名称"}},[a("el-col",{attrs:{span:21}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.tmpName,callback:function(t){e.$set(e.nodeForm,"tmpName",t)},expression:"nodeForm.tmpName"}})],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[e.checkJobName?e._e():a("el-tooltip",{attrs:{content:"任务名称只能包含a-z,0-9和中划线",placement:"bottom",effect:"light"}},[e.checkJobName?e._e():a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"任务描述"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskDesc,callback:function(t){e.$set(e.nodeForm,"taskDesc",t)},expression:"nodeForm.taskDesc"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"镜像"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",clearable:""},on:{change:e.onChangeImg},model:{value:e.nodeForm.dockerImg,callback:function(t){e.$set(e.nodeForm,"dockerImg",t)},expression:"nodeForm.dockerImg"}},e._l(e.imgOptions,function(e){return a("el-option",{key:e.Img,attrs:{label:e.Img,value:e.Id}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"命令"}},[a("el-input",{attrs:{size:"small",disabled:!0},model:{value:e.nodeForm.dockerCmd,callback:function(t){e.$set(e.nodeForm,"dockerCmd",t)},expression:"nodeForm.dockerCmd"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"参数"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.param,callback:function(t){e.$set(e.nodeForm,"param",t)},expression:"nodeForm.param"}})],1),e._v(" "),a("el-divider",{attrs:{"content-position":"center"}},[e._v("输入")]),e._v(" "),a("el-form-item",{attrs:{label:"任务类型"}},[a("el-select",{attrs:{size:"small",filterable:""},on:{change:e.taskTypeChange},model:{value:e.nodeForm.taskType,callback:function(t){e.$set(e.nodeForm,"taskType",t)},expression:"nodeForm.taskType"}},e._l(e.getInputTypeOptionByImg,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"mysql"===e.nodeForm.taskType||"lvpi"===e.nodeForm.taskType,expression:"nodeForm.taskType==='mysql' || nodeForm.taskType==='lvpi'"}],attrs:{label:"任务数据源"}},[a("el-select",{attrs:{size:"small",filterable:"",clearable:""},model:{value:e.nodeForm.taskTypeInfo.dsid,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"dsid",t)},expression:"nodeForm.taskTypeInfo.dsid"}},e._l(e.taskTypeDsidOptions,function(e){return a("el-option",{key:e.DatasourceName,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"文件路径"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.hdfsLocation,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"hdfsLocation",t)},expression:"nodeForm.taskTypeInfo.hdfsLocation"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"文件编码"}},[a("el-select",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.fileEncode,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"fileEncode",t)},expression:"nodeForm.taskTypeInfo.fileEncode"}},[a("el-option",{attrs:{label:"GBK",value:"GBK"}}),e._v(" "),a("el-option",{attrs:{label:"UTF-8",value:"UTF-8"}})],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"文件分隔符"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.splitter,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"splitter",t)},expression:"nodeForm.taskTypeInfo.splitter"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"字段个数"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.validFieldCount,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"validFieldCount",t)},expression:"nodeForm.taskTypeInfo.validFieldCount"}})],1)],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"字段约束"}},e._l(e.nodeForm.taskTypeInfo.schema,function(t,o){return a("el-row",[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{size:"small"},model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"extendItem.id"}},[a("template",{slot:"prepend"},[e._v("文件中的第几列")])],2)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{size:"small"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"extendItem.name"}},[a("template",{slot:"prepend"},[e._v("字段名")])],2)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("el-button",{staticStyle:{"font-size":"18px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addExtendSchema(o,"schema")}}})],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("el-button",{staticStyle:{"font-size":"18px",color:"red"},attrs:{type:"text",icon:"el-icon-remove-outline"},on:{click:function(t){return e.delExtendSchema(o,"schema")}}})],1)],1)}),1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"custom"!==e.nodeForm.taskType,expression:"nodeForm.taskType!=='custom'"}],attrs:{label:"检测done"}},[a("el-radio-group",{model:{value:e.nodeForm.taskTypeInfo.isCheckDone&&"custom"!==e.nodeForm.taskType,callback:function(t){e.$set(e.nodeForm.taskTypeInfo.isCheckDone&&e.nodeForm,"taskType!=='custom'",t)},expression:"nodeForm.taskTypeInfo.isCheckDone && nodeForm.taskType!=='custom'"}},[a("el-radio",{attrs:{label:!0}},[e._v("是")]),e._v(" "),a("el-radio",{attrs:{label:!1}},[e._v("否")])],1)],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"custom"===e.nodeForm.taskType,expression:"nodeForm.taskType==='custom'"}]},[a("el-form-item",{attrs:{label:"程序包HDFS地址:"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.downloadHdfsPath,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"downloadHdfsPath",t)},expression:"nodeForm.taskTypeInfo.downloadHdfsPath"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"执行命令:"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.cmd,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"cmd",t)},expression:"nodeForm.taskTypeInfo.cmd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"HDFS授权账号:"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.hdfsAuthUser,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"hdfsAuthUser",t)},expression:"nodeForm.taskTypeInfo.hdfsAuthUser"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"HDFS授权密码:"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.hdfsAuthPassword,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"hdfsAuthPassword",t)},expression:"nodeForm.taskTypeInfo.hdfsAuthPassword"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:16}},[a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType&&e.nodeForm.taskTypeInfo.isCheckDone,expression:"nodeForm.taskType==='hdfs' && nodeForm.taskTypeInfo.isCheckDone"}],attrs:{label:"done位置:"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.taskTypeInfo.hdfsDoneLocation,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"hdfsDoneLocation",t)},expression:"nodeForm.taskTypeInfo.hdfsDoneLocation"}})],1)],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType,expression:"nodeForm.taskType==='hdfs'"}],attrs:{label:"扩展字段"}},[a("el-radio-group",{model:{value:e.nodeForm.taskTypeInfo.hasExtend,callback:function(t){e.$set(e.nodeForm.taskTypeInfo,"hasExtend",t)},expression:"nodeForm.taskTypeInfo.hasExtend"}},[a("el-radio",{attrs:{label:!0}},[e._v("包含")]),e._v(" "),a("el-radio",{attrs:{label:!1}},[e._v("不包含")])],1),e._v(" "),e._l(e.nodeForm.taskTypeInfo.extendSchema,function(t,o){return a("el-row",{directives:[{name:"show",rawName:"v-show",value:"hdfs"===e.nodeForm.taskType&&e.nodeForm.taskTypeInfo.hasExtend,expression:"nodeForm.taskType==='hdfs' && nodeForm.taskTypeInfo.hasExtend"}]},[a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{size:"small"},model:{value:t.id,callback:function(a){e.$set(t,"id",a)},expression:"extendItem.id"}},[a("template",{slot:"prepend"},[e._v("文件中的第几列")])],2)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:9}},[a("el-input",{attrs:{size:"small"},model:{value:t.name,callback:function(a){e.$set(t,"name",a)},expression:"extendItem.name"}},[a("template",{slot:"prepend"},[e._v("字段名")])],2)],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[a("el-button",{staticStyle:{"font-size":"18px"},attrs:{type:"text",icon:"el-icon-circle-plus-outline"},on:{click:function(t){return e.addExtendSchema(o,"extendSchema")}}})],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("el-button",{staticStyle:{"font-size":"18px",color:"red"},attrs:{type:"text",icon:"el-icon-remove-outline"},on:{click:function(t){return e.delExtendSchema(o,"extendSchema")}}})],1)],1)})],2),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hdfs"!==e.nodeForm.taskType&&"custom"!==e.nodeForm.taskType,expression:"nodeForm.taskType!=='hdfs'&&nodeForm.taskType!=='custom'"}],attrs:{label:"sql语句"}},[a("el-tooltip",{attrs:{content:e.helpContent,placement:"top"}},[a("el-link",{attrs:{type:"warning",underline:"false",icon:"el-icon-info"}},[e._v("DAG时间变量请使用内置变量")])],1),e._v(" "),a("el-input",{attrs:{size:"small",type:"textarea",rows:"5",readonly:!1},model:{value:e.nodeForm.originalSql,callback:function(t){e.$set(e.nodeForm,"originalSql",t)},expression:"nodeForm.originalSql"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.CreateSQLByTemplate()}}},[e._v("使用SQL模板")])],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{label:"sql参数"}},[a("el-input",{attrs:{size:"small",type:"textarea",rows:"4",readonly:!1},model:{value:e.nodeForm.sqlParam,callback:function(t){e.$set(e.nodeForm,"sqlParam",t)},expression:"nodeForm.sqlParam"}})],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"custom"!==e.nodeForm.taskType,expression:"nodeForm.taskType!=='custom'"}]},[a("el-divider",{attrs:{"content-position":"center"}},[e._v("输出")]),e._v(" "),a("el-form-item",{attrs:{label:"输出类型"}},[a("el-select",{attrs:{size:"small",filterable:"",clearable:""},on:{change:e.getConnection},model:{value:e.nodeForm.outTableType,callback:function(t){e.$set(e.nodeForm,"outTableType",t)},expression:"nodeForm.outTableType"}},e._l(e.outType,function(e){return a("el-option",{key:e.id,attrs:{label:e.label,value:e.id}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"mail"!==e.getOutputType,expression:"getOutputType!=='mail'"}],attrs:{label:""}},[a("el-radio-group",{model:{value:e.nodeForm.newOrOldOutTable,callback:function(t){e.$set(e.nodeForm,"newOrOldOutTable",t)},expression:"nodeForm.newOrOldOutTable"}},[a("el-radio",{attrs:{label:"newTable"}},[e._v("新创建")]),e._v(" "),a("el-radio",{attrs:{label:"oldTable"}},[e._v("选择")])],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"mysql"===e.getOutputType||"clickhouse"===e.getOutputType||"lvpi"===e.getOutputType||"hive"===e.getOutputType,expression:"getOutputType==='mysql' || getOutputType==='clickhouse' || getOutputType==='lvpi' ||  getOutputType==='hive'"}],attrs:{label:"数据源"}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:"small"},on:{change:e.getOutTableNameOptions},model:{value:e.nodeForm.lvpi.dsid,callback:function(t){e.$set(e.nodeForm.lvpi,"dsid",t)},expression:"nodeForm.lvpi.dsid"}},e._l(e.dsOptions,function(e){return a("el-option",{key:e.Dsid,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"newTable"===e.getNewOrOldOutTable,expression:"getNewOrOldOutTable==='newTable'"}],attrs:{label:"输出表名"}},[a("el-col",{attrs:{span:10}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.outTableName,callback:function(t){e.$set(e.nodeForm,"outTableName",t)},expression:"nodeForm.outTableName"}})],1),e._v(" "),a("el-col",{attrs:{span:10,offset:1}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:"hdfs"!==e.nodeForm.taskType,expression:"nodeForm.taskType!=='hdfs'"}],attrs:{type:"primary",icon:e.parseButtonIcon,disabled:e.onParsing},on:{click:e.parseSql}},[e._v(e._s(e.parseButtonText)+"\n                  ")])],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"hive"===e.getOutputType&&"newTable"===e.getNewOrOldOutTable,expression:"getOutputType==='hive' && getNewOrOldOutTable==='newTable'"}],attrs:{label:"存储格式"}},[a("el-select",{attrs:{placeholder:"请选择",size:"small"},model:{value:e.nodeForm.storageEngine,callback:function(t){e.$set(e.nodeForm,"storageEngine",t)},expression:"nodeForm.storageEngine"}},e._l(e.nodeForm.storageEngineOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"mail"!==e.getOutputType&&"newTable"===e.getNewOrOldOutTable,expression:"getOutputType!=='mail' && getNewOrOldOutTable==='newTable'"}],attrs:{label:"输出表描述"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.outTableDesc,callback:function(t){e.$set(e.nodeForm,"outTableDesc",t)},expression:"nodeForm.outTableDesc"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"mail"!==e.getOutputType&&"newTable"===e.getNewOrOldOutTable&&"hdfs"!==this.nodeForm.taskType,expression:"getOutputType!=='mail' && getNewOrOldOutTable==='newTable' &&\n                          this.nodeForm.taskType !== 'hdfs'"}],attrs:{label:"输出字段"}},[a("vxe-table",{ref:"fieldTable",attrs:{border:"inner","show-overflow":"","keep-source":"",stripe:"true",data:e.nodeForm.sqlFields,"edit-config":{trigger:"dblclick",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}}},[a("vxe-table-column",{attrs:{field:"fieldName",title:"字段名"}}),e._v(" "),a("vxe-table-column",{attrs:{field:"description",title:"描述","edit-render":{name:"input",immediate:!0,attrs:{type:"text"}}}})],1)],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"clickhouse"===e.getOutputType&&"newTable"===e.getNewOrOldOutTable,expression:"getOutputType==='clickhouse' &&  getNewOrOldOutTable==='newTable'"}],attrs:{label:"partitions"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.clickhouse.partitionStr,callback:function(t){e.$set(e.nodeForm.clickhouse,"partitionStr",t)},expression:"nodeForm.clickhouse.partitionStr"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"clickhouse"===e.getOutputType&&"newTable"===e.getNewOrOldOutTable,expression:"getOutputType==='clickhouse' &&  getNewOrOldOutTable==='newTable'"}],attrs:{label:"indices"}},[a("el-input",{attrs:{size:"small"},model:{value:e.nodeForm.clickhouse.indexStr,callback:function(t){e.$set(e.nodeForm.clickhouse,"indexStr",t)},expression:"nodeForm.clickhouse.indexStr"}})],1),e._v(" "),a("el-form-item",{directives:[{name:"show",rawName:"v-show",value:"oldTable"===e.getNewOrOldOutTable,expression:"getNewOrOldOutTable==='oldTable'"}],attrs:{label:"输出表名"}},[a("el-col",{attrs:{span:12}},[a("el-select",{attrs:{clearable:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.nodeForm.outTableName,callback:function(t){e.$set(e.nodeForm,"outTableName",t)},expression:"nodeForm.outTableName"}},e._l(e.nodeForm.outTableNameOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.checkMetaData}},[e._v("校验输出表")]),e._v(" "),e.checkOutputMeta.success?a("el-tooltip",{attrs:{content:"输出表schema和sql匹配",placement:"bottom",effect:"light"}},[e.checkOutputMeta.success?a("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini",readonly:e.isCheck}}):e._e()],1):e._e(),e._v(" "),e.checkOutputMeta.fail?a("el-tooltip",{attrs:{content:"输出表schema和sql不匹配,或未配置sql参数 请检查",placement:"bottom",effect:"light"}},[e.checkOutputMeta.fail?a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini",readonly:e.isCheck}}):e._e()],1):e._e(),e._v(" "),e.checkOutputMeta.start?a("i",{staticClass:"el-icon-loading"}):e._e()],1)],1),e._v(" "),a("div",{directives:[{name:"show",rawName:"v-show",value:"mail"===e.getOutputType,expression:"getOutputType==='mail'"}]},[a("el-form-item",{attrs:{label:"邮件标题"}},[a("el-col",{attrs:{span:18}},[a("el-input",{attrs:{placeholder:"",size:"small"},model:{value:e.nodeForm.email.title,callback:function(t){e.$set(e.nodeForm.email,"title",t)},expression:"nodeForm.email.title"}})],1),e._v(" "),a("el-col",{attrs:{span:5,offset:1}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.exploreEmail}},[e._v("预览表格")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"收件人"}},[a("el-input",{attrs:{placeholder:"多个用户用逗号隔开(不用配置邮箱后缀)",size:"small"},model:{value:e.nodeForm.email.receiver,callback:function(t){e.$set(e.nodeForm.email,"receiver",t)},expression:"nodeForm.email.receiver"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"附件发送"}},[a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949"},model:{value:e.nodeForm.email.withAttachment,callback:function(t){e.$set(e.nodeForm.email,"withAttachment",t)},expression:"nodeForm.email.withAttachment"}})],1),e._v(" "),a("div",{attrs:{id:"emailExplore"}})],1),e._v(" "),a("el-divider",{attrs:{"content-position":"center"}})],1)],1)],1)])])]),e._v(" "),a("el-drawer",{ref:"drawer",attrs:{title:"详情","with-header":!1,visible:e.drawerDAGVisible,direction:"rtl","custom-class":"demo-drawer","before-close":e.handleDAGClose},on:{"update:visible":function(t){e.drawerDAGVisible=t}}},[a("div",{staticClass:"allDiv"},[a("div",{staticClass:"content"},[a("div",{staticClass:"content-inside",staticStyle:{"max-height":"800px",overflow:"auto"}},[a("el-form",{attrs:{model:e.dagForm,"label-width":"120px"}},[a("el-form-item",{attrs:{label:"DAG ID"}},[a("el-col",{attrs:{span:22}},[e.isCheck?e._e():a("el-input",{attrs:{size:"mini",readonly:e.isCheck},on:{blur:e.checkDuplicateName},model:{value:e.dagForm.name,callback:function(t){e.$set(e.dagForm,"name",t)},expression:"dagForm.name"}}),e._v(" "),e.isCheck?a("el-input",{attrs:{size:"mini",readonly:e.isCheck},model:{value:e.dagForm.name,callback:function(t){e.$set(e.dagForm,"name",t)},expression:"dagForm.name"}}):e._e()],1),e._v(" "),a("el-col",{attrs:{span:1,offset:1}},[e.checkTaskName.success?a("el-tooltip",{attrs:{content:"ID可用",placement:"bottom",effect:"light"}},[e.checkTaskName.success?a("el-button",{attrs:{type:"success",icon:"el-icon-check",circle:"",size:"mini",readonly:e.isCheck}}):e._e()],1):e._e(),e._v(" "),e.checkTaskName.fail?a("el-tooltip",{attrs:{content:"ID重复或包含非法字符(只能是a-z, 0-9和中划线)",placement:"bottom",effect:"light"}},[e.checkTaskName.fail?a("el-button",{attrs:{type:"danger",icon:"el-icon-close",circle:"",size:"mini",readonly:e.isCheck}}):e._e()],1):e._e(),e._v(" "),e.checkTaskName.start?a("i",{staticClass:"el-icon-loading"}):e._e()],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"DAG名称"}},[a("el-input",{attrs:{size:"mini",readonly:e.isCheck},model:{value:e.dagForm.exhibitName,callback:function(t){e.$set(e.dagForm,"exhibitName",t)},expression:"dagForm.exhibitName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"开始时间"}},[a("el-date-picker",{staticStyle:{width:"80%"},attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyy-MM-dd","value-format":"yyyy-MM-dd"},model:{value:e.dagForm.startDate,callback:function(t){e.$set(e.dagForm,"startDate",t)},expression:"dagForm.startDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"邮件列表"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.dagForm.mailList,callback:function(t){e.$set(e.dagForm,"mailList",t)},expression:"dagForm.mailList"}})],1),e._v(" "),a("el-form-item",{attrs:{label:""}},[a("el-radio-group",{on:{change:e.onChangeDAGType},model:{value:e.dagForm.dagType,callback:function(t){e.$set(e.dagForm,"dagType",t)},expression:"dagForm.dagType"}},[a("el-radio",{attrs:{label:"day"}},[e._v("天级任务")]),e._v(" "),a("el-radio",{attrs:{label:"hour"}},[e._v("小时级任务")])],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"延时"}},[a("el-input-number",{attrs:{min:0,size:"mini"},model:{value:e.dagForm.delay,callback:function(t){e.$set(e.dagForm,"delay",t)},expression:"dagForm.delay"}}),e._v(" "),a("span",{staticStyle:{color:"rgb(189, 189, 189)","font-size":"12px"}},[e._v("(填1, 表示任务执行前1小时或前1天的数据)")])],1),e._v(" "),a("el-form-item",{attrs:{label:"cron表达式"}},[a("el-input",{attrs:{placeholder:e.cronPlaceHolder,size:"mini"},model:{value:e.dagForm.cronExpression,callback:function(t){e.$set(e.dagForm,"cronExpression",t)},expression:"dagForm.cronExpression"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"重试次数"}},[a("el-input-number",{attrs:{min:0,size:"mini"},model:{value:e.dagForm.retries,callback:function(t){e.$set(e.dagForm,"retries",t)},expression:"dagForm.retries"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"重试延时(分钟)"}},[a("el-input-number",{attrs:{min:0,size:"mini"},model:{value:e.dagForm.retryDelay,callback:function(t){e.$set(e.dagForm,"retryDelay",t)},expression:"dagForm.retryDelay"}})],1)],1)],1)])])]),e._v(" "),a("el-dialog",{attrs:{title:"请等待DAG生成完毕",visible:e.submitDialogVisible,width:"40%","before-close":e.handleCloseSubmit},on:{"update:visible":function(t){e.submitDialogVisible=t}}},[a("div",{staticStyle:{"margin-top":"25px"}},[a("el-timeline",e._l(e.submitActivities,function(t,o){return a("el-timeline-item",{key:o,attrs:{icon:t.icon,type:t.type,color:t.color,size:"large",timestamp:t.timestamp}},[e._v("\n          "+e._s(t.content)+"\n        ")])}),1)],1),e._v(" "),a("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[a("el-button",{attrs:{type:"primary",size:"small",icon:e.buttonIcon,disabled:e.onProcessing},on:{click:function(t){return e.afterSubmitDag()}}},[e._v(e._s(e.buttonText))])],1)]),e._v(" "),a("el-dialog",{attrs:{title:"SQL生成",visible:e.sqlDialogVisible,width:"80%"},on:{"update:visible":function(t){e.sqlDialogVisible=t}}},[a("div",{staticStyle:{height:"460px",width:"100%"}},[a("el-col",{attrs:{span:5}},[a("div",{staticStyle:{height:"460px",overflow:"auto"},attrs:{id:"treeDiv"}},[a("span",[e._v("库中的模板")]),e._v(" "),a("el-input",{attrs:{placeholder:"输入关键字过滤"},model:{value:e.filterText,callback:function(t){e.filterText=t},expression:"filterText"}}),e._v(" "),a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultSqlProps,"filter-node-method":e.filterNode,accordion:""},on:{"node-click":e.qyeryInfo}})],1)]),e._v(" "),a("el-col",{attrs:{span:13,offset:1}},[a("el-form",{ref:"form",attrs:{model:e.form}},[a("el-row",[a("el-input",{directives:[{name:"show",rawName:"v-show",value:!0,expression:"true"}],attrs:{placeholder:"工单描述",rows:1,"max-rows":3,readonly:!0},model:{value:e.description,callback:function(t){e.description=t},expression:"description"}},[a("template",{slot:"prepend"},[e._v("工单备注:")])],2)],1),e._v(" "),a("el-form-item",{attrs:{prop:"sql"}},[a("codemirror",{ref:"cmEditor",attrs:{options:e.cmOptions},model:{value:e.form.sql,callback:function(t){e.$set(e.form,"sql",t)},expression:"form.sql"}})],1),e._v(" "),a("el-form-item",[a("el-col",{attrs:{span:16}},[a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-button",{on:{click:function(t){return e.onParam("form")}}},[e._v("生成参数列表")])],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.CommitSQL()}}},[e._v("确定\n                ")])],1)],1)],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:4,offset:1}},[a("div",[a("el-row",[a("label",[e._v("DAG内置变量:")]),e._v(" "),a("el-tooltip",{attrs:{content:"表示时间间隔的变量, 后缀可以加上 .start 和 .end",placement:"top"}},[a("i",{staticClass:"el-icon-question"})]),e._v(" "),a("div",{staticStyle:{overflow:"auto","max-height":"150px","margin-left":"6px","line-height":"25px"}},[a("li",[e._v("时间间隔:")]),e._v(" "),a("span",{staticStyle:{"margin-left":"18px",color:"#c0ccda"}},[e._v(e._s(e.intervalVars))]),e._v(" "),a("li",[e._v("时间点:")]),e._v(" "),a("span",{staticStyle:{"margin-left":"18px",color:"#c0ccda"}},[e._v(e._s(e.momentVars))])])],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"15px"}},[a("label",[e._v("参数配置")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"参数用于提交的sql中",placement:"top-start"}},[a("i",{staticClass:"el-icon-question",on:{click:function(t){return e.makeParam()}}})]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],on:{click:function(t){return e.makeParam()}}},[e._v("替换参数模板")])],1),e._v(" "),a("div",{staticStyle:{overflow:"auto","max-height":"230px"}},[e._l(e.paramNames,function(t,o){return[a("el-row",[a("span",[e._v("参数名: "+e._s(t))])]),e._v(" "),a("el-row",[a("el-select",{attrs:{placeholder:"请选择参数类型",size:"mini"},on:{change:function(t){return e.onChangeParamType(o)}},model:{value:e.paramTypes[o],callback:function(t){e.$set(e.paramTypes,o,t)},expression:"paramTypes[index]"}},e._l(e.paramOptions,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-row",[a("el-input",{directives:[{name:"show",rawName:"v-show",value:"string"===e.paramTypes[o],expression:"paramTypes[index]==='string'"}],attrs:{placeholder:"请输入",size:"mini"},model:{value:e.paramValues[o],callback:function(t){e.$set(e.paramValues,o,t)},expression:"paramValues[index]"}}),e._v(" "),a("el-date-picker",{directives:[{name:"show",rawName:"v-show",value:"date"===e.paramTypes[o],expression:"paramTypes[index]==='date'"}],attrs:{size:"mini",type:"date",placeholder:"选择任务日期",format:"yyyyMMdd","value-format":"yyyyMMdd"},model:{value:e.paramValues[o],callback:function(t){e.$set(e.paramValues,o,t)},expression:"paramValues[index]"}})],1)]})],2)],1)])],1)])],1)},staticRenderFns:[]};var Ta=a("VU/8")(xa,Ia,!1,function(e){a("tMbY")},"data-v-7e259bd7",null).exports,Fa=a("q3lC"),Sa={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("h3",[e._v("连接管理")])]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:6}},[a("el-select",{attrs:{placeholder:"请选择数据库类型",size:"small",clearable:""},on:{change:e.onChangeConnType},model:{value:e.connSelectType,callback:function(t){e.connSelectType=t},expression:"connSelectType"}},[a("el-option",{attrs:{label:"hive",value:"hive"}}),e._v(" "),a("el-option",{attrs:{label:"mysql",value:"mysql"}}),e._v(" "),a("el-option",{attrs:{label:"clickhouse",value:"clickhouse"}}),e._v(" "),a("el-option",{attrs:{label:"kylin",value:"kylin"}})],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isReadOnly,expression:"!isReadOnly"}],attrs:{size:"small",type:"primary"},on:{click:e.triggerNew}},[e._v("新增")]),e._v(" "),a("div",{staticStyle:{"margin-top":"10px"}},[a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps,"filter-node-method":e.filterNode,accordion:""},on:{"node-click":e.onClickTree}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("el-divider",{attrs:{direction:"vertical"}})],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form",{ref:"connForm",attrs:{model:e.connForm,inline:!1,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"连接类型: ",prop:"connType"}},[a("el-select",{attrs:{placeholder:"请选择连接类型",readonly:e.isReadOnly,size:"small"},model:{value:e.connForm.ConnType,callback:function(t){e.$set(e.connForm,"ConnType",t)},expression:"connForm.ConnType"}},[a("el-option",{attrs:{label:"hive",value:"hive"}}),e._v(" "),a("el-option",{attrs:{label:"mysql",value:"mysql"}}),e._v(" "),a("el-option",{attrs:{label:"clickhouse",value:"clickhouse"}}),e._v(" "),a("el-option",{attrs:{label:"kylin",value:"kylin"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"连接名: ",prop:"DatasourceName"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.DatasourceName,callback:function(t){e.$set(e.connForm,"DatasourceName",t)},expression:"connForm.DatasourceName"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"主机: ",prop:"Host"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.Host,callback:function(t){e.$set(e.connForm,"Host",t)},expression:"connForm.Host"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"用户名: ",prop:"User"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.User,callback:function(t){e.$set(e.connForm,"User",t)},expression:"connForm.User"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"密码: ",prop:"Passwd"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.Passwd,callback:function(t){e.$set(e.connForm,"Passwd",t)},expression:"connForm.Passwd"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"数据库: ",prop:"Database"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.Database,callback:function(t){e.$set(e.connForm,"Database",t)},expression:"connForm.Database"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"端口: ",prop:"Port"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.Port,callback:function(t){e.$set(e.connForm,"Port",t)},expression:"connForm.Port"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"编码: ",prop:"Encode"}},[a("el-input",{attrs:{size:"small",readonly:e.isReadOnly},model:{value:e.connForm.Encode,callback:function(t){e.$set(e.connForm,"Encode",t)},expression:"connForm.Encode"}})],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{span:6,offset:2}},[a("el-button",{attrs:{size:"small"},on:{click:e.onTest}},[e._v("测试连接")]),e._v(" "),a("i",{directives:[{name:"show",rawName:"v-show",value:e.testLoading,expression:"testLoading"}],staticClass:"el-icon-loading"})],1),e._v(" "),a("el-col",{attrs:{span:2,offset:14}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isReadOnly&&""!==e.connSelectId,expression:"(!isReadOnly) && (connSelectId!=='')"}],attrs:{size:"small",type:"primary"},on:{click:e.onSaveUpdate}},[e._v("\n            保存修改\n          ")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isReadOnly&&""===e.connSelectId,expression:"(!isReadOnly) && (connSelectId==='')"}],attrs:{size:"small",type:"primary"},on:{click:e.onSaveNew}},[e._v("\n            提交新增\n          ")])],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"start"}},[a("el-col",{attrs:{offset:2}},[a("div",{staticStyle:{"line-height":"20px","margin-top":"2px"}},[a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.testShow&&e.testSuccess,expression:"testShow && testSuccess"}],attrs:{title:"测试成功",type:"success",effect:"light",closable:!1,"show-icon":""}}),e._v(" "),a("el-alert",{directives:[{name:"show",rawName:"v-show",value:e.testShow&&!e.testSuccess,expression:"testShow && !testSuccess"}],attrs:{title:e.testErrMsg,type:"error",effect:"light",closable:!1,"show-icon":""}})],1)])],1)],1),e._v(" "),a("el-col",{attrs:{span:6,offset:3}},[a("span",{staticStyle:{"font-size":"14px",color:"#606266"}},[e._v("有权使用的其它角色:")]),e._v(" "),a("el-checkbox-group",{attrs:{size:"mini"},model:{value:e.privilegeSelect,callback:function(t){e.privilegeSelect=t},expression:"privilegeSelect"}},e._l(e.roleOptions,function(t){return a("el-checkbox",{key:t,attrs:{label:t,border:""}},[e._v(e._s(t))])}),1)],1)],1)],1)},staticRenderFns:[]};var Da=function(e){a("Dykd")},Ca=a("VU/8")(Fa.a,Sa,!1,Da,"data-v-49ed0dd8",null).exports,Na=a("c/Tr"),Oa=a.n(Na),Ra=a("mtWM"),$a={data:function(){return{newRoleName:"",rolesData:[],curMetatableGroup:"",metatableReadVisible:!1,metatableExecVisible:!1,metatableData:[],curSelectTableIdList:[],expandTreeId:Oa()({length:1e3},function(e,t){return 1000001+t}),type:"read",treeDefaultProps:{children:"NodeChildren",label:"NodeName"}}},methods:{onCreateRole:function(){this.newRoleName;var e=this,t={role:this.newRoleName};Ra.post("/auth/roles/addRole",t,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},updateRoleMetatable:function(e){var t=this;this.curSelectTableIdList="read"==e?this.$refs.ReadTree.getCheckedKeys():this.$refs.ExecTree.getCheckedKeys();var a=this.curMetatableGroup,o=[];for(var s in this.curSelectTableIdList)this.curSelectTableIdList[s]>=1000001||o.push(this.curSelectTableIdList[s]+"");console.log(o);var n={role:[a],ids:o,type:[e]};Ra.post("/auth/metadata/changeMetaTableMapping",n,{responseType:"json"}).then(function(a){"read"==e?t.metatableReadVisible=!1:t.metatableExecVisible=!1,t.$message({type:"success",message:"数据源权限更新成功!"}),console.info(a.data)}).catch(function(e){t.$options.methods.saveUpdateNotify.bind(t)(),console.log(e)})},getCheckedMetaTable:function(){var e=l()(n.a.mark(function e(t,a){var o;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return(o=this).type=a,o.curSelectTableIdList=[],o.curMetatableGroup=t,e.next=6,Ra.get("/auth/metadata/GetMetaTableAccess/"+t).then(function(e){e.data.forEach(function(e){"read"==a&&1==e.ReadAccess&&o.curSelectTableIdList.push(e.Tid),"exec"==a&&1==e.ExecAccess&&o.curSelectTableIdList.push(e.Tid)})}).catch(function(e){console.log(e)});case 6:return e.next=8,Ra.get("/auth/metadata/GetAllMetaTableTreeAccess/"+t).then(function(e){o.metatableData=e.data,"read"==a?o.metatableReadVisible=!0:o.metatableExecVisible=!0}).catch(function(e){console.log(e)});case 8:case"end":return e.stop()}},e,this)}));return function(t,a){return e.apply(this,arguments)}}(),initGetRoles:function(){var e=this;Ra.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})}},created:function(){var e=this;Ra.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},Ea={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加新角色")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入角色名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newRoleName,callback:function(t){e.newRoleName=t},expression:"newRoleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateRole()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("角色与数据源的增删改查")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:""}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据源权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getCheckedMetaTable(t.row.roleName,"read")}}},[e._v("查询权限\n            ")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"表级查询权限配置",visible:e.metatableReadVisible},on:{"update:visible":function(t){e.metatableReadVisible=t}}},[a("el-row",[a("div",{staticStyle:{"max-height":"500px",overflow:"auto"}},[a("el-tree",{ref:"ReadTree",attrs:{data:e.metatableData,"show-checkbox":"","node-key":"Id","default-expanded-keys":e.expandTreeId,"default-checked-keys":e.curSelectTableIdList,props:e.treeDefaultProps}})],1)]),e._v(" "),a("el-row",[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateRoleMetatable("read")}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"表级执行权限配置",visible:e.metatableExecVisible},on:{"update:visible":function(t){e.metatableExecVisible=t}}},[a("el-row",[a("div",{staticStyle:{"max-height":"500px",overflow:"auto"}},[a("el-tree",{ref:"ExecTree",attrs:{data:e.metatableData,"show-checkbox":"","node-key":"Id","default-expanded-keys":e.expandTreeId,"default-checked-keys":e.curSelectTableIdList,props:e.treeDefaultProps}})],1)]),e._v(" "),a("el-row",[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateRoleMetatable("exec")}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]},Aa=a("VU/8")($a,Ea,!1,null,null,null).exports,La=a("mtWM"),Pa={data:function(){return{defaultModel:"",modelLog:"",triggerModelIds:[],logVisible:!1,readyData:[],readyCols:[],triggerForm:{startTime:"",endTime:""},dagData:[],assignUser:{visible:!1,name:""},curDagId:"",triggerVisible:!1,triggerUser:""}},methods:{checkModelLog:function(e){var t=e.label.split("_"),a=t[t.length-1];1===t.length&&(a=t[0]);var o=this,s={remoteId:a,userName:this.triggerUser};La.post("/airflow/getTriggerLog",s,{responseType:"json"}).then(function(e){o.modelLog=e.data}).catch(function(e){console.log(e)})},onClickLog:function(e){this.triggerUser=e.username,this.triggerModelIds=[];var t=[];JSON.parse(e.remote_ids).forEach(function(e){var a=e.modelName+"_"+e.remoteId;t.push(a)}),""!==t&&(this.triggerModelIds=t,this.logVisible=!0,this.defaultModel=this.triggerModelIds[0],console.log(this.triggerModelIds),console.log("defaultModel:"+this.defaultModel))},getTriggerHistory:function(){var e=this,t={dagName:this.curDagId};La.post("/airflow/getManualTriggerHistory",t,{responseType:"json"}).then(function(t){e.readyData=t.data.data,e.readyCols=t.data.cols}).catch(function(t){console.log(t),e.$message({type:"error",message:t})})},onTrigger:function(){if(console.log(this.triggerForm),console.log(this.curDagId),this.triggerForm.startTime>this.triggerForm.endTime)this.$alert("开始时间应该小于结束时间");else{var e=this,t={startTime:this.triggerForm.startTime,endTime:this.triggerForm.endTime,dagName:this.curDagId};La.post("/airflow/manualTrigger",t,{responseType:"json"}).then(function(t){e.$message({type:"success",message:"手动触发成功"}),e.triggerVisible=!1,e.triggerForm={startTime:"",endTime:""}}).catch(function(t){console.log(t),e.$message({type:"error",message:t})})}},onClickAssign:function(){console.log(this.assignUser.name);var e={user:this.assignUser.name,dagId:this.curDagId},t=this;La.post("/airflow/assignDag",e,{responseType:"json"}).then(function(e){t.$message({type:"success",message:"指派成功"}),t.assignUser.visible=!1,t.getDagList()}).catch(function(e){console.log(e),t.$message({type:"error",message:e})}),this.assignUser.name=""},dispatch:function(e){console.log(e),this.curDagId=e,this.assignUser.visible=!0},manualTrigger:function(e){console.log(e),this.curDagId=e,this.triggerVisible=!0,this.getTriggerHistory()},changeSwitchFlag:function(e){var t=this,a={name:e.name,isopen:e.is_open.toString()};La.post("/airflow/switchdag",a,{responseType:"json"}).then(function(e){0==e.data.flag&&t.$message({type:"error",message:"切换失败"})}).catch(function(e){console.log(e)})},DeleteDag:function(e,t){var a=this,o={name:t};console.log("delete index"+e.toString()),this.$confirm("此操作将永久删除该任务, 是否继续?","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(function(){La.post("/airflow/deletedag",o,{responseType:"json"}).then(function(e){!1===e.data.flag?a.$message({type:"error",message:"删除失败"}):(a.$message({type:"success",message:"操作成功, 请等待系统删除"}),a.getDagList())}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},MarkDagSheduleStatus:function(e,t,a){var o=this,s={name:t.name,run_time:t.lastrun,new_status:a};La.post("/airflow/markdag",s,{responseType:"json"}).then(function(t){0==t.data.flag?o.$message({type:"error",message:"更新失败"}):(this.dagData[e].lastrunstatus=a,o.$message({type:"success",message:"更新成功！"}))}).catch(function(e){console.log(e)})},DagTaskConfig:function(e){sessionStorage.setItem("jones_airflow_dagId",e.name),Ss.push({path:"dag"})},onClickNew:function(){Ss.push({path:"dag"})},DagTaskShow:function(e){console.log(e.name),sessionStorage.setItem("jones_airflow_dagId_show",e.name),Ss.push({path:"dagTaskTrace"})},getDagList:function(){var e=this;La.get("/airflow/airflowall").then(function(t){e.dagData=[],t.data.forEach(function(t){console.log("==================++"),console.log(t.IsOpen),e.dagData.push({name:t.Name,exhibitName:t.ExhibitName,is_open:t.IsOpen,schedule:t.Schedule,user:t.User,status:t.Status,state_suc:t.StateSuccess,state_failed:t.StateFailed,state_running:t.StateRunning,task_suc:t.TaskStateSuc,task_running:t.TaskStateRunning,task_failed:t.TaskStateFailed,task_up_failed:t.TaskStateUpFailed,task_skipped:t.TaskStateSkipped,task_up_for_retry:t.TaskStateUpForRetry,task_up_for_reshedule:t.TaskStateUpForReshedule,task_queued:t.TaskStateQueued,task_null:t.TaskStateNull,task_sheduled:t.TaskStateSheduled}),console.log(e.dagData)})}).catch(function(e){console.log(e)})}},created:function(){this.getDagList()},mounted:function(){console.log("mounted")}},Ma={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",{attrs:{align:"middle"}},[a("el-col",{attrs:{span:1}},[a("h3",[e._v("DAGs")])]),e._v(" "),a("el-col",{attrs:{offset:20,span:1}},[a("el-button",{staticStyle:{"margin-top":"15px"},attrs:{type:"primary"},on:{click:e.onClickNew}},[e._v("新建DAG\n      ")])],1)],1),e._v(" "),a("el-row",[a("div",[a("el-table",{ref:"dagTable",attrs:{data:e.dagData,"row-key":"name",stripe:""}},[a("el-table-column",{attrs:{label:"开关"},scopedSlots:e._u([{key:"default",fn:function(t){return[2===t.row.status?a("el-switch",{attrs:{"active-color":"#13ce66","inactive-color":"#ff4949","active-value":1,"inactive-value":0},on:{change:function(a){return e.changeSwitchFlag(t.row)}},model:{value:t.row.is_open,callback:function(a){e.$set(t.row,"is_open",a)},expression:"dag.row.is_open"}}):1===t.row.status?a("span",[e._v("Dag创建中")]):8===t.row.status?a("span",[e._v("Dag删除中")]):e._e()]}}])}),e._v(" "),a("el-table-column",{attrs:{property:"name",label:"DAG Id"}}),e._v(" "),a("el-table-column",{attrs:{property:"exhibitName",label:"DAG Name"}}),e._v(" "),a("el-table-column",{attrs:{prop:"schedule",label:"Schedule"}}),e._v(" "),a("el-table-column",{attrs:{prop:"user",label:"user"}}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"280"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"text",size:"small"},on:{click:function(a){return e.DeleteDag(t.$index,t.row.name)}}},[e._v("[删除]\n            ")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"small"},on:{click:function(a){return e.DagTaskShow(t.row)}}},[e._v("[调度]")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"small"},on:{click:function(a){return e.DagTaskConfig(t.row)}}},[e._v("[配置]\n            ")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"small"},on:{click:function(a){return e.manualTrigger(t.row.name)}}},[e._v("[手动触发]\n            ")]),e._v(" "),a("el-button",{attrs:{icon:"el-icon-thumb",type:"text",size:"small"},on:{click:function(a){return e.dispatch(t.row.name)}}},[e._v("[指派]")])]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"分发给用户",visible:e.assignUser.visible},on:{"update:visible":function(t){return e.$set(e.assignUser,"visible",t)}}},[a("el-form",[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.assignUser.name,callback:function(t){e.$set(e.assignUser,"name",t)},expression:"assignUser.name"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onClickAssign()}}},[e._v("确定")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"请选择调度的起始时间",visible:e.triggerVisible},on:{"update:visible":function(t){e.triggerVisible=t}}},[a("el-form",{staticStyle:{"margin-top":"8px"}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"开始日期: "}},[a("el-date-picker",{staticStyle:{width:"calc(100% - 100px)"},attrs:{format:"yyyy年MM月dd日","value-format":"yyyyMMdd",placeholder:"开始日期",type:"date",size:"small"},model:{value:e.triggerForm.startTime,callback:function(t){e.$set(e.triggerForm,"startTime",t)},expression:"triggerForm.startTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"结束日期: "}},[a("el-date-picker",{staticStyle:{width:"calc(100% - 100px)"},attrs:{format:"yyyy年MM月dd日","value-format":"yyyyMMdd",placeholder:"结束日期",type:"date",size:"small"},model:{value:e.triggerForm.endTime,callback:function(t){e.$set(e.triggerForm,"endTime",t)},expression:"triggerForm.endTime"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:1}},[a("el-form-item",[a("el-button",{staticStyle:{float:"right"},attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onTrigger()}}},[e._v("确定")])],1)],1)],1)],1),e._v(" "),a("div",{staticStyle:{"max-height":"500px","overflow-y":"scroll"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.readyData,stripe:""}},[e._l(e.readyCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-info",type:"text",size:"mini"},on:{click:function(a){return e.onClickLog(t.row)}}},[e._v("日志\n                  ")])]}}])})],2)],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"查看日志",visible:e.logVisible},on:{"update:visible":function(t){e.logVisible=t}}},[a("el-tabs",{staticStyle:{height:"600px"},attrs:{"tab-position":"left"},on:{"tab-click":e.checkModelLog},model:{value:e.defaultModel,callback:function(t){e.defaultModel=t},expression:"defaultModel"}},e._l(e.triggerModelIds,function(t){return a("el-tab-pane",{attrs:{label:t}},[a("div",{staticStyle:{"max-height":"600px","overflow-y":"auto"}},[a("span",{staticStyle:{"white-space":"pre-wrap"}},[e._v(e._s(e.modelLog))])])])}),1)],1)],1)])],1)},staticRenderFns:[]};var Ua=a("VU/8")(Pa,Ma,!1,function(e){a("7Hum")},"data-v-71a30478",null).exports,Va=a("mtWM"),ja={data:function(){return{stateOption:{success:"成功",danger:"失败",notrun:"等待执行"},taskCnt:1,baseDate:"",tableForm:{loading:!0,data:[],cols:[]},dagId:"",cnt:0,searchWord:"",tableFormData:[],taskStateOptVisible:!1,dagStateOptVisible:!1,curTask:{index:-1,taskId:"",dagName:"",execution_date:""},logUrl1:"",logUrl2:"",logVisible:!1}},methods:{checkLog:function(e){var t=e.execution_date,a=e.task_id,o="http://api.airflow.adtech.sogou:8282/"+this.dagId+"/"+a+"/"+encodeURIComponent(t),s="http://airflow.adtech.sogou:8282/"+this.dagId+"/"+a+"/"+encodeURIComponent(t);this.logUrl1=o,this.logUrl2=s,this.logVisible=!0},onChangeSearch:function(){var e=this;""!==this.searchWord?this.tableForm.data=this.tableFormData.filter(function(t){return t.task_id===e.searchWord}):this.tableForm.data=this.tableFormData},loadTaskData:function(){var e=this;this.searchWord="";var t={dagId:this.dagId,baseDate:this.baseDate,cnt:this.cnt+"",taskId:""};Va.post("airflow/getDetailByDagId/",t,{responseType:"json"}).then(function(t){e.tableForm.cols=t.data.cols,e.tableForm.data=t.data.data,e.tableFormData=t.data.data,e.tableForm.loading=!1}).catch(function(e){console.log(e)})},getTableRowClassName:function(e){var t=e.row;e.rowIndex;return t.epoch%2==1?"odd-row":"even-row"},getTaskState:function(e){return""===e?"running":e},MarkTaskSheduleStatus:function(e){var t=this,a={dag_name:t.curTask.dagName,task_id:t.curTask.taskId,execution_date:t.curTask.execution_date,new_status:e},o=t.curTask.index;Va.post("/airflow/markTaskState",a,{responseType:"json"}).then(function(a){0==a.data.flag?t.$message({type:"error",message:"更新失败"}):(t.tableForm.data[o].state=e,t.$message({type:"success",message:"更新成功！"})),t.taskStateOptVisible=!1}).catch(function(e){console.log(e),t.taskStateOptVisible=!1})},MarkDagSheduleStatus:function(e){var t=this,a={name:t.curTask.dagName,execution_date:t.curTask.execution_date,new_status:e};t.curTask.index;Va.post("/airflow/markdagstate",a,{responseType:"json"}).then(function(e){if(0==e.data.flag)t.$message({type:"error",message:"更新失败"});else{t.$message({type:"success",message:"更新成功！"});for(var a=0;a<t.tableForm.data.length;a++)t.tableForm.data[a].execution_date===t.curTask.execution_date&&(t.tableForm.data[a].state="")}t.dagStateOptVisible=!1}).catch(function(e){console.log(e),t.dagStateOptVisible=!1})},TaskStateOpt:function(e,t){this.curTask.taskId=t.task_id,this.curTask.dagName=this.dagId,this.curTask.execution_date=t.execution_date,this.curTask.index=e,this.taskStateOptVisible=!0},DagStateOpt:function(e,t){this.curTask.taskId=t.task_id,this.curTask.dagName=this.dagId,this.curTask.execution_date=t.execution_date,this.curTask.index=e,this.dagStateOptVisible=!0}},mounted:function(){var e=new Date;this.baseDate=e.getFullYear()+"-"+(e.getMonth()+1)+"-"+e.getDate(),this.dagId=sessionStorage.getItem("jones_airflow_dagId_show"),this.cnt=5,this.loadTaskData()}},Ba={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v(" "+e._s(e.dagId)+" 任务详情:")]),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"}},[a("el-form",{attrs:{inline:""}},[a("el-form-item",{attrs:{label:"基准日期:"}},[a("el-date-picker",{attrs:{format:"yyyy年MM月dd日","value-format":"yyyy-MM-dd",placeholder:"基准日期",type:"date"},on:{change:e.loadTaskData},model:{value:e.baseDate,callback:function(t){e.baseDate=t},expression:"baseDate"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"调度次数:"}},[a("el-select",{attrs:{placeholder:"选择调度次数"},on:{change:e.loadTaskData},model:{value:e.cnt,callback:function(t){e.cnt=t},expression:"cnt"}},[a("el-option",{attrs:{label:"5",value:"5"}}),e._v(" "),a("el-option",{attrs:{label:"25",value:"25"}}),e._v(" "),a("el-option",{attrs:{label:"50",value:"50"}}),e._v(" "),a("el-option",{attrs:{label:"100",value:"100"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"任务名称:"}},[a("el-input",{attrs:{clearable:""},on:{input:e.onChangeSearch},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}})],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.tableForm.data,"row-class-name":e.getTableRowClassName}},[e._l(e.tableForm.cols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"状态",width:"140"},scopedSlots:e._u([{key:"default",fn:function(t){return["success"===t.row.state?a("el-button",{attrs:{type:"success",size:"small"}},[e._v(e._s(e.stateOption.success)+"\n          ")]):"failed"===t.row.state?a("el-button",{attrs:{type:"danger",size:"small"}},[e._v(e._s(e.stateOption.danger)+"\n          ")]):"notrun"===t.row.state?a("el-button",{attrs:{size:"small"}},[e._v(e._s(e.stateOption.notrun))]):a("el-button",{attrs:{type:"info",size:"small"}},[e._v(e._s(e.getTaskState(t.row.state))+"\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-star-off",size:"small"},on:{click:function(a){return e.TaskStateOpt(t.$index,t.row)}}},[e._v("修改Task状态\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"状态操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-star-off",size:"small"},on:{click:function(a){return e.DagStateOpt(t.$index,t.row)}}},[e._v("修改所属Dag状态\n          ")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"日志",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.checkLog(t.row)}}})]}}])})],2),e._v(" "),a("el-dialog",{attrs:{title:"Task状态修改",visible:e.taskStateOptVisible},on:{"update:visible":function(t){e.taskStateOptVisible=t}}},[a("h3",[e._v(e._s(e.curTask.dagName)+" -- "+e._s(e.curTask.taskId)+" -- "+e._s(e.curTask.execution_date)+" 状态修改:")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small"},on:{click:function(t){return e.MarkTaskSheduleStatus("notrun")}}},[e._v("重跑")]),e._v(" "),a("el-button",{attrs:{type:"success",round:"",size:"small"},on:{click:function(t){return e.MarkTaskSheduleStatus("success")}}},[e._v("成功")]),e._v(" "),a("el-button",{attrs:{type:"danger",round:"",size:"small"},on:{click:function(t){return e.MarkTaskSheduleStatus("failed")}}},[e._v("失败")])],1),e._v(" "),a("el-dialog",{attrs:{title:"Dag状态修改",visible:e.dagStateOptVisible},on:{"update:visible":function(t){e.dagStateOptVisible=t}}},[a("h3",[e._v(e._s(e.curTask.dagName)+" -- "+e._s(e.curTask.execution_date)+" 状态修改:")]),e._v(" "),a("el-button",{attrs:{round:"",size:"small"},on:{click:function(t){return e.MarkDagSheduleStatus("notrun")}}},[e._v("重跑")])],1),e._v(" "),a("el-dialog",{attrs:{title:"查看日志",visible:e.logVisible,width:"80%"},on:{"update:visible":function(t){e.logVisible=t}}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("span",[e._v("域名:api.airflow.adtech.sogou")]),a("br"),e._v(" "),a("iframe",{staticStyle:{height:"660px",width:"100%"},attrs:{id:"show-iframe1",src:e.logUrl1,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}})]),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("span",[e._v("域名: airflow.adtech.sogou")]),a("br"),e._v(" "),a("iframe",{staticStyle:{height:"660px",width:"100%"},attrs:{id:"show-iframe2",src:e.logUrl2,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}})])],1)],1)],1)},staticRenderFns:[]};var qa=a("VU/8")(ja,Ba,!1,function(e){a("+yLs")},null,null).exports,Ha=a("mtWM"),za={data:function(){return{url_src:"",timestamp:0,sec186:0,isShowFrame:!1,rolesData:[],myHeighgt:"400"}},methods:{updateCookie:function(){var e=this;Ha.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1),e.isShowFrame=!0}).catch(function(e){console.log(e)}),console.log("++++++++++++++++++")}},created:function(){console.log("created"),Ha.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)});var e=this;e.isShowFrame=!1,this.url_src=e.$route.params.dashboardUrl,console.log("dashboardUrl:"+this.url_src),e.isShowFrame=!0},mounted:function(){console.log("mounted");var e=document.body.clientHeight;console.log(e),this.myHeighgt=e-80},beforeUpdate:function(){console.log("before update"),this.url_src=this.$route.params.dashboardUrl},updated:function(){console.log("updated")}},Ja={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"outDiv",style:{height:e.myHeighgt+"px"}},[e.isShowFrame?a("iframe",{staticStyle:{height:"100%"},attrs:{id:"show-iframe",src:e.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}}):e._e(),e._v(" "),a("h3",{staticStyle:{display:"none"}},[e._v("\n        This is dashboard/"+e._s(e.$route.params.dashboardname)+"\n    ")])])},staticRenderFns:[]};var Ga=a("VU/8")(za,Ja,!1,function(e){a("OzMU")},"data-v-7ea62972",null).exports,Ya=a("mtWM"),Wa={data:function(){return{redashData:[],redashURL:"",dashboardIndex:"",dashboardName:"",dashboardURL:"",dashboardRefresh:120,newLid:-1,privilegeRoles:[],roleOptions:[],parentNode:"数据图表",modifyNewName:"",modifyStatus:!1,modifyIdx:-1,showURl:!1,assignUserVisible:!1,assignIndex:"",assignUserName:""}},methods:{onInsertDashboard:function(){var e=l()(n.a.mark(function e(){var t,a,o=this;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this,"",""!=this.dashboardName){e.next=5;break}return this.$alert("名称不可为空"),e.abrupt("return");case 5:return a={dashboardname:this.dashboardName,usrid:Object(r.e)("_adtech_user")},e.next=8,Ya.post("/redash/dashboardinsert",a,{responseType:"json"}).then(function(e){t.newLid=e.data,-1!=t.newLid?(t.$message({message:"添加成功！",type:"success"}),sessionStorage.setItem(a.dashboardIndex,a.dashboardURL),o.GetAllDashboard()):t.$message({message:"添加失败！",type:"error"})}).catch(function(e){t.$message({message:"添加失败！"+e.toString(),type:"error"})});case 8:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}(),JumpDashBoard:function(e,t,a){this.$router.push({name:"dashboardshow",params:{dashboardname:t,dashboardUrl:a}})},GetAllDashboard:function(){var e=this;Ya.get("/redash/dashboardall").then(function(t){var a=[];t.data.forEach(function(e){console.log(e),a.push(e)}),e.redashData=a,console.log("------------------"),console.log(e.redashData)}).catch(function(e){console.log(e)})},ModifyDashBoard:function(e,t,a){1!=this.modifyStatus?(this.modifyNewName=a,this.modifyStatus=!0,this.modifyIdx=e):this.$message({message:"正在编辑...",type:"error"})},UpdateDashBoard:function(e,t){var a=this,o={dashboardIndex:t,dashboardName:this.modifyNewName};console.log("begin update this dashboard : "+t),Ya.post("/redash/dashboardupdate",o,{responseType:"json"}).then(function(e){a.$message({message:"更新成功！",type:"success"}),a.CancelUpdate(),a.GetAllDashboard()}).catch(function(e){a.$message({message:"更新失败！"+e.toString(),type:"error"})})},CancelUpdate:function(){this.modifyNewName="",this.modifyStatus=!1,this.modifyIdx=-1},DeleteDashBoard:function(e,t){var a=this,o={dashboardIndex:t};0!=confirm("确定删除吗?")&&(console.log("begin delete this redash : "+t),Ya.post("/redash/dashboarddel",o,{responseType:"json"}).then(function(t){a.$message({message:"删除成功！",type:"success"}),a.GetAllDashboard(),a.redashData.splice(e,1),console.log(a.redashData)}).catch(function(e){a.$message({message:"删除失败！"+e.toString(),type:"error"})}))},assignUser:function(e){console.log(e),this.assignUserVisible=!0,this.assignIndex=e.index},onClickAssign:function(){var e={assignUserName:this.assignUserName,assignIndex:this.assignIndex,assignType:"dashboard"};console.log(e);var t=this;Ya.post("/redash/user_change",e,{responseType:"json"}).then(function(e){var a=e.data;a.Res?(t.$message({message:"指派成功",type:"success"}),t.GetAllDashboard()):t.$message({message:a.Info,type:"error"})}).catch(function(e){console.error(e)}),this.assignUserVisible=!1}},created:function(){var e=this;Ya.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)}),Ya.get("/redash/write_access").then(function(t){e.showURl=t.data.dashboard_write}).catch(function(e){console.log(e)}),this.GetAllDashboard()},mounted:function(){console.log("mounted")}},Ka={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("DashBoard 新增")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"DashBoard名称 "}},[a("el-input",{attrs:{size:"small"},model:{value:e.dashboardName,callback:function(t){e.dashboardName="string"==typeof t?t.trim():t},expression:"dashboardName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onInsertDashboard()}}},[e._v("添加")])],1)],1),e._v(" "),a("el-form",{directives:[{name:"show",rawName:"v-show",value:!1,expression:"false"}],attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"DashboardURL"}},[a("el-input",{staticStyle:{width:"800px"},attrs:{size:"big"},model:{value:e.dashboardURL,callback:function(t){e.dashboardURL=t},expression:"dashboardURL"}})],1)],1),e._v(" "),a("h3",[e._v("DashBoard 管理")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.redashData,stripe:""}},[a("el-table-column",{attrs:{prop:"name",label:"DashBoard名称","min-width":"50%"},scopedSlots:e._u([{key:"default",fn:function(t){return[e.modifyStatus&&t.$index==e.modifyIdx?a("el-input",{model:{value:e.modifyNewName,callback:function(t){e.modifyNewName=t},expression:"modifyNewName"}}):a("span",[e._v(e._s(t.row.name))])]}}])}),e._v(" "),e.showURl?a("el-table-column",{attrs:{prop:"url",label:"DashBoard_URL","min-width":"50%"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"index",label:"DashBoard索引","min-width":"50%"}}),e._v(" "),a("el-table-column",{attrs:{prop:"creator",label:"Creator","min-width":"50%"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){return e.assignUser(t.row)}}},[e._v("指派")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.$index!=e.modifyIdx,expression:"(rdata.$index != modifyIdx)"}],attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.ModifyDashBoard(t.$index,t.row.index,t.row.name)}}},[e._v("修改")]),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.$index==e.modifyIdx,expression:"(rdata.$index == modifyIdx)"}],attrs:{type:"success",icon:"el-icon-check",circle:""},on:{click:function(a){return e.UpdateDashBoard(t.$index,t.row.index)}}}),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:t.$index==e.modifyIdx,expression:"(rdata.$index == modifyIdx)"}],attrs:{type:"info",icon:"el-icon-close",circle:""},on:{click:function(t){return e.CancelUpdate()}}}),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.DeleteDashBoard(t.$index,t.row.index)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.JumpDashBoard(t.$index,t.row.index,t.row.url)}}},[e._v("跳转")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分发给用户",visible:e.assignUserVisible},on:{"update:visible":function(t){e.assignUserVisible=t}}},[a("el-form",[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.assignUserName,callback:function(t){e.assignUserName=t},expression:"assignUserName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onClickAssign()}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]},Xa=a("VU/8")(Wa,Ka,!1,null,null,null).exports,Qa=a("mtWM"),Za={data:function(){return{url_src:"",timestamp:0,sec186:0,isShowFrame:!1,rolesData:[],myHeighgt:"400"}},methods:{updateCookie:function(){}},created:function(){console.log("created");var e=this;Qa.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)}),e.isShowFrame=!1,this.url_src=e.$route.params.queryUrl,console.log("redashQueryUrl:"+this.url_src),null==this.url_src||0==this.url_src.length?this.$router.push({name:"redashqueryoption"}):e.isShowFrame=!0},mounted:function(){console.log("mounted");var e=document.body.clientHeight;console.log(e),this.myHeighgt=e-80},beforeUpdate:function(){console.log("before update"),this.url_src=this.$route.params.queryUrl},updated:function(){console.log("updated")}},eo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"outDiv",style:{height:e.myHeighgt+"px"}},[e.isShowFrame?a("iframe",{staticStyle:{height:"100%"},attrs:{id:"show-iframe",src:e.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}}):e._e(),e._v(" "),a("h3",{staticStyle:{display:"none"}},[e._v("\n        This is redashQuery/"+e._s(e.$route.params.queryid)+"\n    ")])])},staticRenderFns:[]};var to=a("VU/8")(Za,eo,!1,function(e){a("V99l")},"data-v-72a2d156",null).exports,ao=a("mtWM"),oo={data:function(){return{redashData:[],redashURL:"",queryIndex:"",showURl:!1,assignUserVisible:!1,assignIndex:"",assignUserName:""}},methods:{DeleteRedashQuery:function(e,t){var a=this,o={queryIndex:t};0!=confirm("确定删除吗?")&&(console.log("begin delete this redash : "+t),ao.post("/redash/redashquerydel",o,{responseType:"json"}).then(function(t){a.$message({message:"删除成功！",type:"success"}),a.redashData.splice(e,1),console.log(a.redashData)}).catch(function(e){a.$message({message:"删除失败！"+e.toString(),type:"error"})}))},JumpQueryView:function(e,t,a){console.log(t);var o=t.split("/")[1];console.log(o),this.$router.push({name:"redashqueryshow",params:{queryid:o,queryUrl:a}})},GetAllQuery:function(){var e=this;ao.get("/redash/redashqueryall").then(function(t){var a=[];t.data.forEach(function(e){console.log(e),a.push(e)}),e.redashData=a,console.log("------------------"),console.log(e.redashData)}).catch(function(e){console.log(e)})},assignUser:function(e){console.log(e),this.assignUserVisible=!0,this.assignIndex=e.index},onClickAssign:function(){var e={assignUserName:this.assignUserName,assignIndex:this.assignIndex,assignType:"query"};console.log(e);var t=this;ao.post("/redash/user_change",e,{responseType:"json"}).then(function(e){var a=e.data;a.Res?(t.$message({message:"指派成功",type:"success"}),t.GetAllQuery()):t.$message({message:a.Info,type:"error"})}).catch(function(e){console.error(e)}),this.assignUserVisible=!1}},created:function(){var e=this;ao.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)}),ao.get("/redash/write_access").then(function(t){e.showURl=t.data.redashquery_write}).catch(function(e){console.log(e)}),e.GetAllQuery()},mounted:function(){console.log("mounted")}},so={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("Redash Query 管理")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.redashData,stripe:""}},[a("el-table-column",{attrs:{prop:"name",label:"RedashQuery名称"}}),e._v(" "),e.showURl?a("el-table-column",{attrs:{prop:"url",label:"RedashQuery_URL"}}):e._e(),e._v(" "),a("el-table-column",{attrs:{prop:"index",label:"RedashQuery索引"}}),e._v(" "),a("el-table-column",{attrs:{prop:"creator",label:"Creator"}}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"info",size:"mini"},on:{click:function(a){return e.assignUser(t.row)}}},[e._v("指派")]),e._v(" "),a("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(a){return e.DeleteRedashQuery(t.$index,t.row.index)}}},[e._v("删除")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(a){return e.JumpQueryView(t.$index,t.row.index,t.row.url)}}},[e._v("跳转")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"分发给用户",visible:e.assignUserVisible},on:{"update:visible":function(t){e.assignUserVisible=t}}},[a("el-form",[a("el-form-item",[a("el-input",{attrs:{placeholder:"请输入用户名"},model:{value:e.assignUserName,callback:function(t){e.assignUserName=t},expression:"assignUserName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary"},on:{click:function(t){return e.onClickAssign()}}},[e._v("确定")])],1)],1)],1)],1)},staticRenderFns:[]},no=a("VU/8")(oo,so,!1,null,null,null).exports,io=a("mtWM"),lo={data:function(){return{active:1,selected:"1",showChildOptions:!0,url_src:"",timer:null,myHeighgt:"",timestamp:0,sec186:0,firstBars:[],childOptions:[]}},methods:{onChooseContainer:function(e){console.log(e);var t=e.Url;if(""!=t)this.url_src=t,this.showChildOptions=!1;else{this.url_src="",this.showChildOptions=!0;var a=e.Mid,o=this;io.get("/bodong/getChildOptions/"+a).then(function(e){o.childOptions=e.data}).catch(function(e){console.error(e)})}},getFirstLevel:function(){var e=this;io.get("/bodong/getFirst").then(function(t){e.firstBars=t.data,e.url_src=e.firstBars[0].Url}).catch(function(e){console.error(e)})},showIframe:function(e){console.log(e.Url),this.url_src=e.Url,this.showChildOptions=!1},setTestTime:function(){var e=this;io.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1),e.isShowFrame=!0}).catch(function(e){console.log(e)})}},created:function(){this.setTestTime(),this.timer=setInterval(this.setTestTime,18e4)},mounted:function(){var e=Object(r.e)("_adtech_user"),t=Object(r.e)("_adtech_user_name");console.log("uid:"+e+",username:"+t+",");var a=document.body.clientHeight;console.log(a),this.myHeighgt=a-15,this.getFirstLevel(),this.showChildOptions=!1},beforeDestroy:function(){clearInterval(this.timer)}},ro={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.showChildOptions?e._e():a("div",[a("div",{staticClass:"outDiv",style:{height:e.myHeighgt+"px"}},[a("iframe",{attrs:{id:"show-iframe",src:e.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}}),e._v(" "),a("h3",{staticStyle:{display:"none"}},[e._v("\n        This is redashshow\n      ")])])]),e._v(" "),e.showChildOptions?a("div",[a("mt-tab-container",{model:{value:e.selected,callback:function(t){e.selected=t},expression:"selected"}},[a("mt-tab-container-item",{attrs:{id:"1"}},e._l(e.childOptions,function(t){return a("mt-cell",{attrs:{title:t.Label,"is-link":"",value:""},nativeOn:{click:function(a){return e.showIframe(t)}}})}),1)],1)],1):e._e(),e._v(" "),a("h3",{staticStyle:{"margin-bottom":"50px",display:"none"}},[e._v("\n    This is redashshow\n  ")]),e._v(" "),a("mt-tabbar",{model:{value:e.active,callback:function(t){e.active=t},expression:"active"}},e._l(e.firstBars,function(t){return a("mt-tab-item",{attrs:{id:t.Mid},nativeOn:{click:function(a){return e.onChooseContainer(t)}}},[a("i",{class:t.Img,staticStyle:{display:"block","font-size":"22px","margin-bottom":"5px"}}),e._v("\n      "+e._s(t.Label)+"\n    ")])}),1)],1)},staticRenderFns:[]};var co=a("VU/8")(lo,ro,!1,function(e){a("iqCl")},"data-v-65c87f05",null).exports,uo=a("mtWM"),po={name:"MobileDashBoardShow",data:function(){return{url_src:"",myHeighgt:""}},methods:{refreshTimeStamp:function(){uo.get("/redash/timestamp").then(function(e){var t=3*(e.data+7482952);Object(r.m)("sec186",t.toString(),1)}).catch(function(e){console.log(e)})},getRedashUrl:function(e){var t=this;uo.get("/mobileDashboard/getDashboardUrl/"+e).then(function(e){var a=e.data;t.url_src=a}).catch(function(e){console.log(e)})}},created:function(){var e=this.$route.path;console.log(e),Object(r.l)("_adtech_path",encodeURI(e),1)},beforeDestroy:function(){Object(r.b)("_adtech_path")},mounted:function(){var e=Object(r.e)("_adtech_user"),t=Object(r.e)("_adtech_user_name");console.log("uid:"+e+",username:"+t+",");var a=document.body.clientHeight;console.log(a),this.myHeighgt=a-15,this.refreshTimeStamp();var o=this.$route.params.redashname;this.getRedashUrl(o),console.log(this.$route)}},mo={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"outDiv",style:{height:this.myHeighgt+"px"}},[t("iframe",{attrs:{id:"show-iframe",src:this.url_src,frameborder:"no",marginheight:"0",marginwidth:"0",scrolling:"yes"}}),this._v(" "),t("h3",{staticStyle:{display:"none"}},[this._v("\n    This is redashshow/"+this._s(this.$route.params.redashname)+"\n  ")])])},staticRenderFns:[]};var fo=a("VU/8")(po,mo,!1,function(e){a("mmKP")},"data-v-9d68b8de",null).exports,ho=a("mtWM"),vo={name:"Udf",data:function(){return{curUDFModifyFlag:!1,cmOptions:{tabSize:4,mode:"text/x-mysql",theme:"default",lineNumbers:!0,dragDrop:!1,readOnly:!0,lineWrapping:!0,line:!0,hintOptions:{tables:{},databases:{}},extraKeys:{Tab:"autocomplete"}},dataList:[],tableColumn:[],newDataList:[],newTableColumn:[],curUDF:{},funcVisible:!1,showcode:"",topLabelReadOnly:!1}},methods:{deleteById:function(e){var t=this;this.$confirm("确认删除该UDF记录吗","注意",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){ho.get("/udf/delete/"+e).then(function(e){t.getUdfList(),t.$message({type:"success",message:"保存修改"})}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},modifyUdfDesc:function(){this.curUDFModifyFlag=!0,this.cmOptions.readOnly=!1},closeDialog:function(){this.curUDFModifyFlag=!1,this.cmOptions.readOnly=!0,this.curUDF={},this.showcode=""},openedDialog:function(){this.showcode=Prism.highlight(this.curUDF.example,Prism.languages.sql,"sql")},updateUdfDesc:function(){var e=[this.curUDF],t=this;ho.post("/udf/update/description",e,{responseType:"json"}).then(function(e){e.data.Res?t.$message({message:e.data.Info,type:"success"}):t.$message.error(e.data.Info),t.getUdfList(),t.getNewUdfList(),t.funcVisible=!1}).catch(function(e){console.log(e)})},getNewUdfList:function(){var e=this;ho.post("/udf/getList",{known:!1},{responseType:"json"}).then(function(t){e.newTableColumn=t.data.tableColumn,e.newDataList=t.data.dataList}).catch(function(e){console.log(e)})},getUdfList:function(){var e=this;ho.post("/udf/getList",{known:!0},{responseType:"json"}).then(function(t){e.tableColumn=t.data.tableColumn,e.dataList=t.data.dataList}).catch(function(e){console.log(e)})},ShowUDFDetail:function(e){this.curUDF=_a()({},e),console.log(this.curUDF),this.funcVisible=!0},getEdit:function(){var e=this;ho.get("/udf/getEdit").then(function(t){e.topLabelReadOnly=t.data.readOnly,console.log("顶栏标签配置的udf只读权限:"+e.topLabelReadOnly)}).catch(function(e){console.log(e)})}},computed:{descriptionWidth:function(e){return"description"===e?"60%":""}},mounted:function(){this.getUdfList(),this.getNewUdfList(),this.getEdit()}},bo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h4",[e._v("UDF函数预览")]),e._v(" "),a("vxe-table",{ref:"existTable",staticStyle:{"margin-left":"200px","margin-right":"200px"},attrs:{border:"","show-overflow":"","keep-source":"",data:e.dataList,"edit-config":{trigger:"dblclick",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}}},[a("vxe-table-column",{attrs:{align:"center",field:"funcName",title:"函数名",visible:!0,width:"330"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.ShowUDFDetail(t.row)}}},[e._v(e._s(t.row.funcName))])]}}])}),e._v(" "),a("vxe-table-column",{attrs:{align:"center",field:"description",title:"功能描述",visible:!0}}),e._v(" "),a("vxe-table-column",{attrs:{align:"center",field:"operation",title:"操作",visible:!0,width:"100"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini",icon:"el-icon-delete"},on:{click:function(a){return e.deleteById(t.row.funcId)}}})]}}])})],1),e._v(" "),a("h4",[e._v("本次启动新增的UDF")]),e._v(" "),a("vxe-table",{ref:"newTable",staticStyle:{"margin-left":"150px","margin-right":"150px"},attrs:{border:"","show-overflow":"","keep-source":"",data:e.newDataList,"edit-config":{trigger:"click",mode:"cell",showStatus:!0,icon:"fa fa-pencil-square-o"}}},[a("vxe-table-column",{attrs:{align:"center",field:"funcName",title:"函数名",visible:!0},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text"},on:{click:function(a){return e.ShowUDFDetail(t.row)}}},[e._v(e._s(t.row.funcName))])]}}])}),e._v(" "),a("vxe-table-column",{attrs:{align:"center",field:"description",title:"功能描述",visible:!0}})],1),e._v(" "),a("el-dialog",{attrs:{height:"600px",width:"70%",title:"函数详情",visible:e.funcVisible},on:{"update:visible":function(t){e.funcVisible=t},opened:e.openedDialog,close:e.closeDialog}},[a("el-container",[a("el-header",{attrs:{height:"120px"}},[a("p",{staticStyle:{"font-size":"30px",lineHeight:"5px","margin-left":"30px"}},[e._v(e._s(e.curUDF.funcName))]),e._v(" "),e.curUDFModifyFlag?a("el-input",{model:{value:e.curUDF.description,callback:function(t){e.$set(e.curUDF,"description",t)},expression:"curUDF.description"}}):a("span",{staticStyle:{"margin-top":"10px","margin-left":"50px"}},[e._v(e._s(e.curUDF.description))])],1),e._v(" "),a("el-container",[a("el-main",[a("h4",[e._v("参数说明")]),e._v(" "),a("el-input",{attrs:{type:"textarea",autosize:{minRows:7,maxRows:7},readOnly:!e.curUDFModifyFlag},model:{value:e.curUDF.parameters,callback:function(t){e.$set(e.curUDF,"parameters",t)},expression:"curUDF.parameters"}})],1),e._v(" "),a("el-main",[a("h4",[e._v("Hive Usage")]),e._v(" "),a("codemirror",{ref:"cmEditor",attrs:{options:e.cmOptions},model:{value:e.curUDF.example,callback:function(t){e.$set(e.curUDF,"example",t)},expression:"curUDF.example"}})],1)],1),e._v(" "),a("el-footer",[e.topLabelReadOnly?e._e():a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"small"},on:{click:function(t){return e.modifyUdfDesc()}}},[e._v("修改")]),e._v(" "),a("el-button",{staticStyle:{"margin-top":"10px"},attrs:{size:"small"},on:{click:function(t){return e.updateUdfDesc()}}},[e._v("提交")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var go=a("VU/8")(vo,bo,!1,function(e){a("t5wq")},"data-v-c9aa7630",null).exports,yo=a("mtWM"),_o={data:function(){return{dataList:[],tableColumn:[],newTagDialog:!1,editTagDialog:!1,tagForm:{name:"",desc:""},topLabelReadOnly:!1,editTagId:0,tagFormRules:{name:[{required:!0,message:"请输入标签名",trigger:"blur"}]}}},methods:{getEdit:function(){var e=this;yo.get("/indicator/getEdit").then(function(t){e.topLabelReadOnly=t.data.readOnly,console.log("顶栏标签配置的serviceTag只读权限:"+e.topLabelReadOnly)}).catch(function(e){console.log(e)})},onClickEditServiceTag:function(e){var t=this;this.editTagDialog=!0,console.log(e),this.$nextTick(function(){t.tagForm.name=e.tag_name,t.tagForm.desc=e.description,t.editTagId=e.tid})},closeTagDialog:function(){var e=this;console.log(this.$refs.tagForm),this.$refs.tagForm.resetFields(),this.$nextTick(function(){e.newTagDialog=!1,e.editTagDialog=!1})},getColumnWidth:function(e){return"description"===e?"60%":"tid"===e?"20%":void 0},getAllServiceTag:function(){var e=this;yo.get("/indicator/serviceTag/getAll").then(function(t){e.tableColumn=t.data.cols,e.dataList=t.data.data}).catch(function(e){console.log(e)})},makeEditServiceTag:function(){var e=this,t=this;this.$refs.tagForm.validate(function(a){if(a){var o={tagName:e.tagForm.name,description:e.tagForm.desc,tid:e.editTagId};yo.post("/indicator/serviceTag/editServiceTag",o,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"编辑成功"}),t.getAllServiceTag()):t.$message({type:"error",message:e.data.Info}),t.editTagDialog=!1}).catch(function(e){console.log(e)})}})},makeNewServiceTag:function(){var e=this,t=this;this.$refs.tagForm.validate(function(a){if(a){var o={name:e.tagForm.name,desc:e.tagForm.desc};yo.post("/indicator/serviceTag/putServiceTag",o,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"创建成功"}),t.getAllServiceTag()):t.$message({type:"error",message:e.data.Info}),t.newTagDialog=!1}).catch(function(e){console.log(e)})}})}},mounted:function(){this.getAllServiceTag(),this.getEdit()}},wo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-row",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px",display:"inline"}},[e._v("业务标签")]),e._v(" "),a("el-tooltip",{attrs:{content:"将指标按照业务逻辑进行分类管理，分类会展示在指标配置中",placement:"top"}},[a("i",{staticClass:"el-icon-warning-outline"})])],1),e._v(" "),a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.topLabelReadOnly,expression:"!topLabelReadOnly"}],staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"medium"},on:{click:function(t){e.newTagDialog=!0}}},[e._v("创建业务标签")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:"",border:!1,"header-cell-style":{background:"#eee",color:"#606266"}}},[a("el-table-column",{key:"tag_name",attrs:{prop:"tag_name",label:"业务标签名"}}),e._v(" "),a("el-table-column",{key:"description",attrs:{prop:"description",label:"描述"}}),e._v(" "),a("el-table-column",{key:"create_time",attrs:{prop:"create_time",label:"创建时间",sortable:!0}}),e._v(" "),a("el-table-column",{key:"modify_time",attrs:{prop:"modify_time",label:"最后修改时间",sortable:!0}}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.onClickEditServiceTag(t.row)}}})]}}])})],1),e._v(" "),a("el-dialog",{attrs:{title:"新建业务标签",visible:e.newTagDialog,width:"600px",center:"true","show-close":!1,"before-close":e.closeTagDialog},on:{"update:visible":function(t){e.newTagDialog=t}}},[a("el-form",{ref:"tagForm",attrs:{model:e.tagForm,"label-width":"80px",rules:e.tagFormRules}},[a("el-form-item",{attrs:{label:"标签名称",prop:"name"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.tagForm.name,callback:function(t){e.$set(e.tagForm,"name",t)},expression:"tagForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述(选填)",prop:"desc"}},[a("el-input",{attrs:{size:"mini",type:"textarea",rows:10},model:{value:e.tagForm.desc,callback:function(t){e.$set(e.tagForm,"desc",t)},expression:"tagForm.desc"}})],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{size:"small",type:"primary"},on:{click:e.makeNewServiceTag}},[e._v("创建")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.closeTagDialog}},[e._v("取消")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"编辑业务标签",visible:e.editTagDialog,width:"700px",center:"true","show-close":!1,"before-close":e.closeTagDialog},on:{"update:visible":function(t){e.editTagDialog=t}}},[a("el-form",{ref:"tagForm",attrs:{model:e.tagForm,"label-width":"80px",rules:e.tagFormRules}},[a("el-form-item",{attrs:{label:"标签名称",prop:"name"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.tagForm.name,callback:function(t){e.$set(e.tagForm,"name",t)},expression:"tagForm.name"}})],1),e._v(" "),a("el-form-item",{attrs:{label:"描述(选填)",prop:"desc"}},[a("el-input",{attrs:{size:"mini",type:"textarea",rows:10},model:{value:e.tagForm.desc,callback:function(t){e.$set(e.tagForm,"desc",t)},expression:"tagForm.desc"}})],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.topLabelReadOnly,expression:"!topLabelReadOnly"}],attrs:{size:"small",type:"primary"},on:{click:e.makeEditServiceTag}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:e.closeTagDialog}},[e._v("取消")])],1)],1)],1)},staticRenderFns:[]};var ko=a("VU/8")(_o,wo,!1,function(e){a("Wjsk")},"data-v-236f3dbd",null).exports,xo=a("mtWM"),Io={data:function(){return{editId:0,dataList:[],tableColumn:[],indicatorForm:{name:"",aggregation:"",meaning:"",serviceTagIds:[]},indicatorFormRules:{name:[{required:!0,message:"请输入标签名",trigger:"blur"}],serviceTagIds:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}]},serviceTagList:[],serviceTagMap:{},factRelationList:[],facTableForm:{tableType:"",factTable:"",foreignKey:""},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],factTableOptions:[],foreignKeyOptions:[],topLabelReadOnly:!1,fromDictionary:!1}},methods:{onClickNew:function(){sessionStorage.setItem("preIndicatorId",""),Ss.push({path:"preDefineIndicatorCreate"})},postFactRelation:function(){var e=this,t={indicatorId:this.editId,factId:this.facTableForm.factTable,associatedField:this.facTableForm.foreignKey};xo.post("/indicator/predefine/addIndicatorFactRelation",t).then(function(t){t.data.Res?(e.$notify({message:"创建成功",type:"success"}),e.getFactRelation()):e.$notify({message:t.data.Info,type:"error"})}).catch(function(e){console.log(e)})},onDeleteFactRelation:function(e){var t=this,a=e.ifid;xo.post("/indicator/predefine/delIndicatorFactRelation/"+a).then(function(e){e.data.Res?(t.$notify({message:"删除成功",type:"success"}),t.getFactRelation()):t.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})},genTableIdentifier:function(e,t){return e+"."+t},onChangeFactTable:function(){var e=this,t={tableId:e.facTableForm.factTable+"",version:"latest"};xo.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.foreignKeyOptions=t.data.dataList}).catch(function(e){console.log(e)})},onChangeFactType:function(){var e=this.facTableForm.tableType;this.facTableForm.factTable="",this.foreignKeyOptions=[];var t=this,a={curPage:"1",pageSize:"9999",table_type:e};xo.post("metaData/getTableByConditions",a,{responseType:"json"}).then(function(e){t.factTableOptions=e.data.data}).catch(function(e){console.log(e)})},getFactRelation:function(){var e=this;xo.get("indicator/getIndicatorFactRelation/"+this.editId).then(function(t){e.factRelationList=t.data.data}).catch(function(e){console.log(e)})},onDeleteIndicator:function(e){var t=this;this.$confirm("确定删除吗",{confirmButtonText:"删除",cancelButtonText:"取消"}).then(function(){t.editId=e.id;var a=t;xo.post("/indicator/delIndicator/"+t.editId).then(function(e){e.data.Res?(a.$message({type:"success",message:"删除成功"}),a.getAllPredefineIndicator()):a.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})})},onClickEditIndicator:function(e){sessionStorage.setItem("preIndicatorId",e.id),Ss.push({path:"preDefineIndicatorCreate"})},closeIndicatorDialog:function(){this.$refs.indicatorForm.resetFields()},browseTableInfo:function(e){var t={tableId:e};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},getColumnWidth:function(e){return"meaning"===e?"50%":"tid"===e?"20%":void 0},getAllPredefineIndicator:function(){var e=this;xo.get("/indicator/getAllIndicator").then(function(t){e.tableColumn=t.data.cols,e.dataList=t.data.data}).catch(function(e){console.log(e)})},makeEditPredefineIndicator:function(){var e=this,t={name:this.indicatorForm.name,meaning:this.indicatorForm.meaning,BusinessLabels:this.indicatorForm.serviceTagIds,aggregation:this.indicatorForm.aggregation,id:this.editId};xo.post("/indicator/editPreIndicator",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$message({type:"success",message:"修改成功"}),e.getAllPredefineIndicator()):e.$message({type:"error",message:t.data.Info})}).catch(function(e){console.log(e)})},makeNewPredefineIndicator:function(){var e=this;if(this.editId>0)this.makeEditPredefineIndicator();else{var t=this;this.$refs.indicatorForm.validate(function(a){if(a){var o={name:e.indicatorForm.name,meaning:e.indicatorForm.meaning,BusinessLabels:e.indicatorForm.serviceTagIds,aggregation:e.indicatorForm.aggregation};xo.post("/indicator/postPreIndicator",o,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"创建成功"}),t.getAllPredefineIndicator()):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})}})}},getAllServiceTag:function(e){var t=this;xo.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},getEdit:function(){var e=this;xo.get("/indicator/getEdit").then(function(t){e.topLabelReadOnly=t.data.readOnly,console.log("顶栏标签配置的indicator只读权限:"+e.topLabelReadOnly)}).catch(function(e){console.log(e)})}},mounted:function(){this.getAllServiceTag(this.getAllPredefineIndicator)}},To={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-row",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px",display:"inline"}},[e._v("原子指标")])]),e._v(" "),a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"medium"},on:{click:e.onClickNew}},[e._v("新建原子指标")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:"",border:!1,"header-cell-style":{background:"#eee",color:"#606266"}}},[a("el-table-column",{key:"name",attrs:{prop:"name",label:"指标名","min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"meaning",attrs:{prop:"meaning",label:"指标含义","min-width":"52%"}}),e._v(" "),a("el-table-column",{key:"aggregation",attrs:{prop:"aggregation",label:"聚合方式","min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"modify_time",attrs:{prop:"modify_time",label:"最后修改时间",sortable:!0,"min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"business_label",attrs:{prop:"business_label",label:"业务标签","min-width":"12%"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.business_label.split(","),function(t,o){return a("el-tag",{staticStyle:{"margin-right":"5px"}},[e._v("\n            "+e._s(e.serviceTagMap[t])+"\n          ")])})}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.onClickEditIndicator(t.row)}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.onDeleteIndicator(t.row)}}})]}}])})],1)],1)])},staticRenderFns:[]};var Fo=a("VU/8")(Io,To,!1,function(e){a("WhcK")},"data-v-39f822c9",null).exports,So=a("mtWM"),Do={data:function(){return{editId:-1,dataList:[],tableColumn:[],newCombineIndicator:!1,editCombineIndicator:!1,topLabelReadOnly:!1,indicatorForm:{name:"",meaning:"",expression:"",serviceTagIds:[],predictItems:[],qualifiers:[]},indicatorFormRules:{name:[{required:!0,message:"请输入标签名",trigger:"blur"}],serviceTagIds:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}]},serviceTagList:[],serviceTagMap:{},preIndicators:[],indexDependencies:[],inputVisible:!1,inputValue:"",fromDictionary:!1}},methods:{handleClose:function(e){this.indicatorForm.qualifiers.splice(this.indicatorForm.qualifiers.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.indicatorForm.qualifiers.push(e),this.inputVisible=!1,this.inputValue=""},insertToExpression:function(e){console.log(),this.indicatorForm.expression+=e},addDependencies:function(){var e=this.indicatorForm.predictItems;this.transStrToIndexDependencies(e),this.indicatorForm.predictItems=[]},transStrToIndexDependencies:function(e){var t=this;this.preIndicators.forEach(function(a){-1!==e.indexOf(a.id)&&t.indexDependencies.push(a)})},deleteDependencies:function(e){this.indexDependencies.splice(e,1)},onDeleteIndicator:function(e){this.editId=e.id;var t=this;So.post("/indicator/delIndicator/"+this.editId).then(function(e){e.data.Res?(t.$message({type:"success",message:"删除成功"}),t.getAllCombineIndicator()):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})},onClickEditIndicator:function(e){var t=e.id;sessionStorage.setItem("combineIndicatorId",t),Ss.push({path:"combineIndicatorCreate"})},closeIndicatorDialog:function(){var e=this;this.$refs.indicatorForm.resetFields(),this.$nextTick(function(){e.newCombineIndicator=!1,e.editCombineIndicator=!1})},getColumnWidth:function(e){return"meaning"===e?"50%":"tid"===e?"20%":void 0},getAllCombineIndicator:function(){var e=this;So.get("/indicator/getAllCombineIndicator").then(function(t){e.tableColumn=t.data.cols,e.dataList=t.data.data}).catch(function(e){console.log(e)})},onClickNewIndex:function(){sessionStorage.setItem("combineIndicatorId",""),this.$router.push({path:"combineIndicatorCreate"})},getAllServiceTag:function(e){var t=this;So.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})}},mounted:function(){this.getAllServiceTag(this.getAllCombineIndicator)}},Co={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-row",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px",display:"inline"}},[e._v("计算指标")])]),e._v(" "),a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{type:"primary",size:"medium"},on:{click:function(t){return e.onClickNewIndex()}}},[e._v("新建计算指标\n    ")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:"",border:!1,"header-cell-style":{background:"#eee",color:"#606266"}}},[a("el-table-column",{key:"name",attrs:{prop:"name",label:"指标名","min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"meaning",attrs:{prop:"meaning",label:"指标含义","min-width":"26%"}}),e._v(" "),a("el-table-column",{key:"expression",attrs:{prop:"expression",label:"指标计算方式","min-width":"26%"}}),e._v(" "),a("el-table-column",{key:"create_time",attrs:{prop:"create_time",label:"创建时间",sortable:!0,"min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"modify_time",attrs:{prop:"modify_time",label:"最后修改时间",sortable:!0,"min-width":"12%"}}),e._v(" "),a("el-table-column",{key:"business_label",attrs:{prop:"business_label",label:"业务标签","min-width":"12%"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.business_label.split(","),function(t,o){return a("el-tag",{staticStyle:{"margin-right":"5px"}},[e._v("\n            "+e._s(e.serviceTagMap[t])+"\n          ")])})}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.onClickEditIndicator(t.row)}}}),e._v(" "),a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.onDeleteIndicator(t.row)}}})]}}])})],1)],1)])},staticRenderFns:[]};var No=a("VU/8")(Do,Co,!1,function(e){a("/1J+")},"data-v-50b45100",null).exports,Oo=a("mtWM"),Ro={data:function(){return{isDerivative:!1,name:"Dimension",dataList:[],createDimension:!1,serviceTagList:[],serviceTagMap:{},dimensionForm:{id:0,name:"",dataSourceType:"",dataSource:"",primaryTableId:"",primaryTableName:"",pkField:"",serviceTagIds:[],businessLabel:""},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],dsOptions:[],tableOptions:[],pkOptions:[],rules:{name:[{required:!0,message:"请输入维度名",trigger:"blur"}],dataSource:[{required:!0,message:"请选择数据源",trigger:"blur"}],primaryTableId:[{required:!0,message:"请学则维度主表",trigger:"blur"}],pkField:[{required:!0,message:"请选择维度主键",trigger:"blur"}]},facTableForm:{tableType:"",factTable:"",foreignKey:""},factTableOptions:[],foreignKeyOptions:[],factRelationList:[],topLabelReadOnly:!1,fromDictionary:!1}},methods:{onClickCreate:function(e){e?(sessionStorage.setItem("dimensionId",""),Ss.push({path:"dimensionCreateDerivative"})):(sessionStorage.setItem("dimensionId",""),Ss.push({path:"dimensionCreate"}))},onDeleteFactRelation:function(e){var t=this,a={dfid:e.dfid};this.$confirm("确定删除这个事实表关系吗",{confirmButtonText:"删除",cancelButtonText:"取消"}).then(function(){Oo.post("/indicator/dimension/postDimFactRelation",a,{responseType:"json"}).then(function(e){e.data.Res?(t.$notify({message:"删除成功",type:"success"}),t.$refs.facTableForm.resetFields(),t.getFactRelationByDimId()):t.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})})},getFactRelationByDimId:function(){var e="/indicator/dimension/getDimFactRelations/"+this.dimensionForm.id,t=this;Oo.get(e).then(function(e){t.$nextTick(function(){t.factRelationList=e.data.data})}).catch(function(e){console.log(e)})},postFactRelation:function(){var e=this,t={dimId:this.dimensionForm.id,factId:this.facTableForm.factTable,foreignKey:this.facTableForm.foreignKey};Oo.post("/indicator/dimension/postDimFactRelation",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$notify({message:"更新成功",type:"success"}),e.$refs.facTableForm.resetFields(),e.getFactRelationByDimId()):e.$notify({message:t.data.Info,type:"error"})}).catch(function(e){console.log(e)})},onChangeFactTable:function(){var e=this,t={tableId:e.facTableForm.factTable+"",version:"latest"};Oo.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.foreignKeyOptions=t.data.dataList}).catch(function(e){console.log(e)})},genTableIdentifier:function(e,t){return e+"."+t},onChangeFactType:function(){var e=this.facTableForm.tableType;this.facTableForm.factTable="",this.foreignKeyOptions=[];var t=this,a={curPage:"1",pageSize:"9999",table_type:e};Oo.post("metaData/getTableByConditions",a,{responseType:"json"}).then(function(e){t.factTableOptions=e.data.data}).catch(function(e){console.log(e)})},getAllDimensions:function(){var e=this;Oo.get("/indicator/dimension/getAll?isDerivative="+this.isDerivative).then(function(t){e.dataList=t.data.data}).catch(function(e){console.log(e)})},onEditDimension:function(e){e.is_derivative?(sessionStorage.setItem("dimensionId",e.id),Ss.push({path:"dimensionCreateDerivative"})):(sessionStorage.setItem("dimensionId",e.id),Ss.push({path:"dimensionCreate"}))},closeCreate:function(){var e=this;this.$refs.dimensionForm.resetFields(),this.$refs.facTableForm.resetFields(),this.dimensionForm.id=0,this.$nextTick(function(){e.createDimension=!1})},browseTableInfo:function(e){var t={tableId:e};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},onChangeDSType:function(){var e=this;Oo.get("/dw/GetConnByPrivilege/"+this.dimensionForm.dataSourceType).then(function(t){e.dsOptions=t.data,e.dimensionForm.dataSource=e.dsOptions[0].Dsid,e.onChangeDataSource()}).catch(function(e){console.log(e)})},onChangeDataSource:function(){var e=this;console.log(this.dimensionForm.dataSource);var t={dsType:this.dimensionForm.dataSourceType,dsId:this.dimensionForm.dataSource+""};Oo.post("/dw/meta/get",t,{responseType:"json"}).then(function(t){var a=[];t.data.children.forEach(function(e){try{e.children.forEach(function(e){a.push({tableId:e.tid,tableName:e.tableName})})}catch(e){console.log(e)}}),e.tableOptions=a}).catch(function(e){console.log(e)})},onChangeTableName:function(){var e=this;this.findTableNameInOptions();var t={tableId:e.dimensionForm.primaryTableId+"",version:"latest"};Oo.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.pkOptions=t.data.dataList,e.foreignKeyOptions=t.data.dataList}).catch(function(e){console.log(e)})},findTableNameInOptions:function(){var e=this,t=this.dimensionForm.primaryTableId;this.tableOptions.forEach(function(a){a.tableId==t&&(e.dimensionForm.primaryTableName=a.tableName)})},getAllServiceTag:function(e){var t=this;Oo.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),e()}).catch(function(e){console.log(e)})}},mounted:function(){this.getAllServiceTag(this.getAllDimensions)}},$o={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px"}},[e._v("维度管理")]),e._v(" "),a("el-select",{attrs:{placeholder:"请选择",size:"small"},on:{change:e.getAllDimensions},model:{value:e.isDerivative,callback:function(t){e.isDerivative=t},expression:"isDerivative"}},[a("el-option",{attrs:{label:"主维度",value:!1}}),e._v(" "),a("el-option",{attrs:{label:"衍生维度",value:!0}})],1),e._v(" "),a("el-popconfirm",{attrs:{"confirm-button-text":"衍生维度","cancel-button-text":"主维度","cancel-button-type":"success","confirm-button-type":"info",title:"请选择要创建的维度类型?"},on:{confirm:function(t){return e.onClickCreate(!0)},cancel:function(t){return e.onClickCreate(!1)}}},[a("el-button",{staticStyle:{"margin-bottom":"10px"},attrs:{slot:"reference",type:"primary",size:"medium"},slot:"reference"},[e._v("创建维度")])],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:"",border:!1,"header-cell-style":{background:"#eee",color:"#606266"}}},[a("el-table-column",{key:"name",attrs:{prop:"name",label:"中文名称"}}),e._v(" "),a("el-table-column",{key:"alias_name",attrs:{prop:"alias_name",label:"英文名称"}}),e._v(" "),!1===e.isDerivative?a("el-table-column",{key:"pk_field",attrs:{prop:"pk_field",label:"维度主键"}}):e._e(),e._v(" "),!1===e.isDerivative?a("el-table-column",{key:"primary_table_data_source",attrs:{prop:"primary_table_data_source",label:"主表数据源",sortable:!0}}):e._e(),e._v(" "),!1===e.isDerivative?a("el-table-column",{key:"primary_table_name",attrs:{prop:"primary_table_name",label:"维度主表"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{cursor:"pointer","text-decoration":"underline"},on:{click:function(a){return e.browseTableInfo(t.row.primary_table_id)}}},[e._v("\n          "+e._s(t.row.primary_database_name)+"."+e._s(t.row.primary_table_name)+"\n        ")])]}}],null,!1,637206684)}):e._e(),e._v(" "),a("el-table-column",{key:"business_label",attrs:{prop:"business_label",label:"业务标签"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.business_label.split(","),function(o,s){return a("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.row.business_label.split(",").length>0&&""!==t.row.business_label.split(",")[0],expression:"scope.row.business_label.split(',').length>0 && scope.row.business_label.split(',')[0]!==''"}],staticStyle:{"margin-right":"5px"}},[e._v("\n            "+e._s(e.serviceTagMap[o])+"\n          ")])})}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-edit",type:"text"},on:{click:function(a){return e.onEditDimension(t.row)}}})]}}])})],1)],1)])},staticRenderFns:[]};var Eo=a("VU/8")(Ro,$o,!1,function(e){a("Fyu2")},"data-v-4656cdec",null).exports,Ao=a("mtWM"),Lo={data:function(){return{dataList:[],tableColumn:[],serviceTagList:[],serviceTagMap:{},searchWord:"",businessLabel:"",assetType:"",assetList:[{id:"predefine",name:"原子指标"},{id:"combine",name:"计算指标"},{id:"dimension",name:"维度"}]}},methods:{browseTableInfo:function(e,t){switch(console.log(t+"::"+e),t){case"原子指标":sessionStorage.setItem("preIndicatorId",e),sessionStorage.setItem("preIndicatorCheck","true"),Ss.push({path:"preDefineIndicatorCreate"});break;case"计算指标":sessionStorage.setItem("combineIndicatorId",e),sessionStorage.setItem("combineIndicatorCheck","true"),Ss.push({path:"combineIndicatorCreate"});break;case"维度":sessionStorage.setItem("dimensionId",e),sessionStorage.setItem("dimensionCreate","true"),Ss.push({path:"dimensionCreate"})}},getAllServiceTag:function(e){var t=this;Ao.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},searchItems:function(){var e=this,t={searchWord:this.searchWord,businessLabel:this.businessLabel,assetType:this.assetType};Ao.post("/indicator/dictionary/search",t,{responseType:"json"}).then(function(t){e.dataList=t.data.data}).catch(function(e){console.log(e)})},getAllDictionary:function(){var e=this;Ao.get("/indicator/dictionary/getAll").then(function(t){e.dataList=t.data.data}).catch(function(e){console.log(e)})}},mounted:function(){this.getAllServiceTag(this.getAllDictionary())}},Po={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px"}},[e._v("数据资产")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:8}},[a("span",{staticClass:"el-form-item__label"},[e._v("模糊查询:")]),e._v(" "),a("el-input",{staticStyle:{width:"50%","margin-bottom":"5px"},attrs:{size:"mini",clearable:"",placeholder:"输入关键词"},on:{input:e.searchItems},model:{value:e.searchWord,callback:function(t){e.searchWord=t},expression:"searchWord"}})],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",{staticClass:"el-form-item__label"},[e._v("资产类型:")]),e._v(" "),a("el-select",{staticStyle:{width:"50%"},attrs:{filterable:"",placeholder:"请选择",clearable:"",size:"mini"},on:{change:e.searchItems},model:{value:e.assetType,callback:function(t){e.assetType=t},expression:"assetType"}},e._l(e.assetList,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("span",{staticClass:"el-form-item__label"},[e._v("业务标签:")]),e._v(" "),a("el-select",{staticStyle:{width:"50%"},attrs:{filterable:"",placeholder:"请选择",clearable:"",size:"mini"},on:{change:e.searchItems},model:{value:e.businessLabel,callback:function(t){e.businessLabel=t},expression:"businessLabel"}},e._l(e.serviceTagList,function(e){return a("el-option",{key:e.tid,attrs:{label:e.tagName,value:e.tid}})}),1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.dataList,stripe:"",border:!1,"header-cell-style":{background:"#eee",color:"#606266"}}},[a("el-table-column",{key:"type_name",attrs:{prop:"type_name",label:"资产类型","min-width":"18%"}}),e._v(" "),a("el-table-column",{key:"item_name",attrs:{prop:"item_name",label:"资产名","min-width":"18%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{cursor:"pointer","text-decoration":"underline"},on:{click:function(a){return e.browseTableInfo(t.row.origin_id,t.row.type_name)}}},[e._v(e._s(t.row.item_name))])]}}])}),e._v(" "),a("el-table-column",{key:"description",attrs:{prop:"description",label:"描述","min-width":"46%"}}),e._v(" "),a("el-table-column",{key:"business_label",attrs:{prop:"business_label",label:"业务标签","min-width":"18%"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.business_label.split(","),function(o,s){return a("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.row.business_label.split(",").length>0&&""!==t.row.business_label.split(",")[0],expression:"scope.row.business_label.split(',').length>0 && scope.row.business_label.split(',')[0]!==''"}],staticStyle:{"margin-right":"5px"}},[e._v("\n          "+e._s(e.serviceTagMap[o])+"\n        ")])})}}])})],1)],1)},staticRenderFns:[]};var Mo=a("VU/8")(Lo,Po,!1,function(e){a("ef38")},null,null).exports,Uo=a("mtWM"),Vo={name:"DemandRequirement",data:function(){return{isdisabled:!0,commentStr:"",commentVisible:!1,editorOption:{placeholder:"此处编辑需求说明",theme:"snow"},drawer:!0,criticalItems:[{userName:"zhangsan",content:"嘿嘿嘿"},{userName:"lisi",content:"后水水水水是是是"},{userName:"lisi",content:"后水水水水是是是"},{userName:"lisi",content:"后水水水水是是是"},{userName:"lisi",content:"后水水水水是是是"}],activeTab:"first",dialogTableVisible:!1,activeStep:2,newDemand:"rtl",serviceTagList:[],serviceTagMap:{},apartmentOptions:["营销事业部/商业产品-搜索","营销事业部/商业产品-投放平台","营销事业部/商业产品-产品运营","营销事业部/商业产品-品牌-银河","营销事业部/商业产品-网盟-信息流","营销事业部/商业产品-创新","营销事业部/商业产品-阅读","营销事业部/商业产品-反作弊","营销事业部/商业产品-数据","营销事业部/战略合作部","营销事业部/商业分析中心","营销事业部/广告营销中心","营销事业部/风控","营销事业部/ADM","搜索事业部","输入法事业部","商业平台事业部"],assetList:[],demandId:"",userDefineIndicatorForm:{name:"",description:""},userDefineIndicatorSet:[],basicInfoForm:{projectName:"",expectTime:"",startTime:"",endTime:"",priority:"",developer:"",document:'<h2><span style="color: rgb(230, 0, 0);">*</span>1.背景（或项目链接）。</h2><p><span style="color: rgb(230, 0, 0);"> 必填</span></p><p><br></p><h2><span style="color: rgb(230, 0, 0);">*</span>2.价值。</h2><p><span style="color: rgb(230, 0, 0);"> 必填</span></p><p><br></p><h2><span style="color: rgb(230, 0, 0);">*</span>3.需求详情（指标、维度、口径等）。&nbsp;</h2><p><span style="color: rgb(230, 0, 0);"> 必填</span></p><p><br></p><h2><span style="color: rgb(230, 0, 0);">*</span>4.实现形式（如接口、报表、固定SQL、工单、数据表等）。&nbsp;</h2><p><span style="color: rgb(230, 0, 0);"> 必填</span></p><p><br></p><h2>5.需求PRD（链接、附件等）。&nbsp;</h2><p>选填</p><p><br></p><h2>6.历史数据回溯时间。&nbsp;</h2><p>选填</p><p><br></p><h2>7.埋点文档。</h2><p>选填</p>',status:"1",apartment:""},fileList:[],basicInfoFormRules:{projectName:[{required:!0,message:"请输入需求名",trigger:"blur"}],expectTime:[{required:!0,message:"请输入期望时间",trigger:"blur"}],priority:[{required:!0,message:"请选择优先级",trigger:"blur"}],apartment:[{required:!0,message:"请选来源部门",trigger:"blur"}]},developer:"",documentList:[],multipleSelection:[],devStatusMapping:{},addIndicatorVisible:!1,historyData:[],historyCols:[]}},methods:{checkHistory:function(e){this.basicInfoForm.projectName=e.project_name,this.basicInfoForm.expectTime=e.expect_time,this.basicInfoForm.startTime=e.start_time,this.basicInfoForm.endTime=e.end_time,this.basicInfoForm.priority=e.priority,this.basicInfoForm.developer=e.developer,this.basicInfoForm.document=e.demand_text,this.basicInfoForm.status=e.status+"",this.basicInfoForm.apartment=e.apartment,this.$refs.historyTable.setCurrentRow(e),this.$message({type:"success",message:"显示历史"+e.hid})},getComments:function(){var e=this;Uo.get("/requirement/indicator/getDataRequirement?demandId="+e.demandId).then(function(t){e.criticalItems=t.data}).catch(function(e){console.log(e)})},uploadComment:function(){var e=this,t=this;if(""!==this.demandId&&0!==this.demandId){var a={demandId:parseInt(this.demandId),comment:this.commentStr};Uo.post("/requirement/indicator/addDataRequirement",a,{responseType:"json"}).then(function(a){a.data.Res?(t.$message({message:"评论成功",type:"success"}),e.commentVisible=!1,t.getComments()):t.$message({message:"评论失败:"+a.data.Info,type:"xxx"})}).catch(function(e){console.log(e)})}else this.$alert("请先提交基本信息")},onDeleteUdI:function(e){var t=this.userDefineIndicatorSet.indexOf(e);t>-1&&this.userDefineIndicatorSet.splice(t,1)},onAddUdIndicator:function(){this.userDefineIndicatorSet.push({item_name:this.userDefineIndicatorForm.name,description:this.userDefineIndicatorForm.description}),this.userDefineIndicatorForm={name:"",description:""},this.addIndicatorVisible=!1},axiosDownload:function(e,t){if(e){var a=window.URL.createObjectURL(new Blob([e])),o=document.createElement("a");o.style.display="none",o.href=a,o.setAttribute("download",t),document.body.appendChild(o),o.click()}},delAttachment:function(e){var t=e.Aid,a=this;this.$confirm("确定删除附件吗","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){Uo.get("/requirement/attachment/delete/"+t).then(function(e){a.getUploadFileList()}).catch(function(e){console.log(e)})})},dowloadAttachment:function(e){var t=e.Aid,a=e.Filename,o=this;Uo({method:"post",url:"/requirement//attachment/download/"+t,responseType:"blob"}).then(function(e){console.log("下载请求完毕"),o.axiosDownload(e.data,a)}).catch(function(e){console.log(e)})},getAllStatusMapping:function(){var e=this;Uo.get("/requirement/GetDevStatusMapping").then(function(t){e.devStatusMapping=t.data}).catch(function(e){console.log(e)})},getDevStatus:function(e){return this.devStatusMapping[e]},onImportDataset:function(){this.dialogTableVisible=!0;var e=this;setTimeout(function(){e.multipleSelection.forEach(function(t){e.$refs.assetTable.toggleRowSelection(t,!0)})},200)},handleClose:function(){this.drawer=!1},saveDoc:function(e,t){var a={content:e,html:t};console.log(a)},onExceed:function(e,t){this.$set(t[0],"raw",e[0]),this.$set(t[0],"name",e[0].name),this.$refs.upload.clearFiles(),this.$refs.upload.handleStart(e[0])},submitFile:function(){var e=this,t=this,a={projectName:this.basicInfoForm.projectName,expectTime:this.basicInfoForm.expectTime,proposer:"",developer:this.basicInfoForm.developer,developTime:"",status:parseInt(this.basicInfoForm.status,10),demandText:this.basicInfoForm.document,priority:this.basicInfoForm.priority};this.$confirm("确定上传文件吗","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){"new"===e.arbitrateUpdateOrInsert()?Uo.post("/requirement/post",a,{responseType:"json"}).then(function(e){e.data.Res?(t.demandId=e.data.Info,t.postUserDefineIndicator(t.demandId),t.uploadDemandAssetRelation(),t.$notify({message:"提交成功, 需求id:"+e.data.Info,type:"success",duration:2e3}),t.demandId=e.data.Info,t.$refs.upload.submit()):t.$notify({message:"提交失败: "+e.data.Info,type:"error",duration:2e3})}).catch(function(e){console.log(e)}):t.$refs.upload.submit()})},getUploadFileList:function(){var e=this.demandId,t=this;Uo.get("/requirement/attachment/get/"+e).then(function(e){t.documentList=e.data}).catch(function(e){console.log(e)})},beforeUpload:function(e){var t=this,a=new FormData;return a.append("file",e),Uo.post("/requirement/attachment/upload/"+this.demandId,a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){var a=e.data;a.Res?(t.$notify({message:"附件上传成功",type:"success",duration:2e3}),t.getUploadFileList()):t.$notify({title:"附件上传失败",message:a.Info,type:"error",duration:3e3})}).catch(function(e){console.log(e)}),!1},getAllServiceTag:function(e){var t=this;Uo.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},getAllDictionary:function(e){var t=this;Uo.get("/indicator/dictionary/getAll").then(function(a){t.assetList=a.data.data,null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},handleSelectionChange:function(e){this.multipleSelection=e},uploadDemandAssetRelation:function(){var e=this,t=[];try{this.multipleSelection.forEach(function(e){var a=e.origin_id+"",o=e.type_name;t.push({origin_id:a,type_name:o})}),Uo.post("/requirement/postRequireAssetRelation/"+this.demandId,t,{responseType:"json"}).then(function(t){t.data.Res?e.$notify({message:"数据资产绑定成功",type:"success",duration:2e3}):e.$notify({title:"数据资产关系绑定失败",message:t.data.Info,type:"error",duration:2e3})}).catch(function(t){e.$message({message:"数据资产关系绑定失败: "+t.toString(),type:"error"})})}catch(e){console.log(e)}},arbitrateUpdateOrInsert:function(){return""===this.demandId||"0"===this.demandId||0===this.demandId||void 0===this.demandId||null===this.demandId?"new":"update"},getHistory:function(){var e=this;Uo.get("/requirement/getHistory/"+this.demandId).then(function(t){e.historyData=t.data.data,e.historyCols=t.data.cols}).catch(function(e){console.log(e)})},uploadDataRequest:function(){var e=this.arbitrateUpdateOrInsert(),t=this,a={projectName:this.basicInfoForm.projectName,expectTime:this.basicInfoForm.expectTime,proposer:"",developer:this.basicInfoForm.developer,developTime:"",status:parseInt(this.basicInfoForm.status,10),demandText:this.basicInfoForm.document,priority:this.basicInfoForm.priority,startTime:this.basicInfoForm.startTime,endTime:this.basicInfoForm.endTime,apartment:this.basicInfoForm.apartment};"update"===e?(t.postUserDefineIndicator(this.demandId),Uo.post("/requirement/update/"+this.demandId,a,{responseType:"json"}).then(function(e){e.data.Res?(t.uploadDemandAssetRelation(),t.$notify({message:"更新成功",type:"success",duration:2e3}),t.isdisabled=!0,Ss.push({path:"demandList"})):t.$notify({message:"提交失败: "+e.data.Info,type:"error",duration:2e3})}).catch(function(e){console.log(e)})):Uo.post("/requirement/post",a,{responseType:"json"}).then(function(e){e.data.Res?(t.demandId=e.data.Info,t.postUserDefineIndicator(t.demandId),t.uploadDemandAssetRelation(),t.$notify({message:"提交成功, 需求id:"+e.data.Info,type:"success",duration:2e3}),t.demandId=e.data.Info,Ss.push({path:"demandList"})):t.$notify({message:"提交失败: "+e.data.Info,type:"error",duration:2e3})}).catch(function(e){console.log(e)}),this.getHistory()},postUserDefineIndicator:function(e){var t=this,a=[];this.userDefineIndicatorSet.forEach(function(t){a.push({Rid:parseInt(e+""),AssetName:t.item_name,Description:t.description})}),Uo.post("/requirement/indicator/userDefine/post/"+e,a,{responseType:"json"}).then(function(e){}).catch(function(e){t.$message({message:"提交失败！"+e.toString(),type:"error"})})},getDemandById:function(){var e=this;Uo.get("/requirement/getDemandById/"+this.demandId).then(function(t){var a=t.data;e.basicInfoForm.projectName=a.ProjectName,e.basicInfoForm.expectTime=a.ExpectTime,e.basicInfoForm.priority=a.Priority,e.basicInfoForm.developer=a.Developer,e.basicInfoForm.document=a.DemandText,e.basicInfoForm.status=a.Status+"",e.basicInfoForm.startTime=a.StartTime,e.basicInfoForm.endTime=a.EndTime,e.basicInfoForm.apartment=a.Apartment}).catch(function(e){console.log(e)}),this.getUploadFileList()},getUserDefineIndicators:function(){var e=this;Uo.get("/requirement/indicator/userDefine/get/"+this.demandId).then(function(t){t.data.forEach(function(t){e.userDefineIndicatorSet.push({item_name:t.AssetName,description:t.Description})})}).catch(function(e){console.log(e)})},getDemandRelationById:function(){var e=this;Uo.get("/requirement/getAssetRelationById/"+this.demandId).then(function(t){var a=[];t.data.forEach(function(t){var o=e.findAssetInList(t);a.push(o)}),e.multipleSelection=a}).catch(function(e){console.log(e)})},findAssetInList:function(e){var t=null,a="";return"predefine"===e.Atype?a="原子指标":"combine"===e.Atype?a="计算指标":"dimension"===e.Atype&&(a="维度"),this.assetList.forEach(function(o){o.origin_id===e.Assetid&&o.type_name===a&&(t=o)}),t}},computed:{canEditDoc:function(){var e=this.devStatusMapping[this.basicInfoForm.status];return-1===e.indexOf("开发")&&-1===e.indexOf("完成")&&-1===e.indexOf("验收")},unionIndicator:function(){try{var e=this.multipleSelection,t=this.userDefineIndicatorSet,a=[];return console.log(e),console.log(t),null!=t&&t.forEach(function(e){a.push({description:e.description,item_name:e.item_name,type_name:"手动添加"})}),null!=e&&e.forEach(function(e){a.push({description:null==e.description?"":e.description,item_name:e.item_name,type_name:e.type_name})}),console.log("合并指标完成"),a}catch(e){return[]}}},mounted:function(){this.getAllStatusMapping(),this.demandId=this.$route.params.demandId,console.log("获取的需求Id:"+this.demandId),null!=this.demandId&&""!==this.demandId&&void 0!==this.demandId&&"new"!==this.demandId&&(this.getDemandById(),this.getUserDefineIndicators()),"new"===this.demandId&&(this.demandId=""),this.getAllServiceTag(this.getAllDictionary(this.getDemandRelationById)),this.getComments(),this.getHistory()}},jo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[e.newDemand?e._e():a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.drawer=!0}}},[e._v("新建")])],1),e._v(" "),e.newDemand?a("div",[a("el-card",{staticStyle:{"margin-bottom":"2px"}},[a("div",{staticClass:"clearfix",attrs:{slot:"header"},slot:"header"},[a("span",[e._v("基本信息")])]),e._v(" "),a("el-form",{ref:"basicInfoForm",attrs:{model:e.basicInfoForm,"label-width":"120px",rules:e.basicInfoFormRules}},[a("el-form-item",{staticStyle:{width:"80%"},attrs:{label:"需求名称",prop:"projectName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.basicInfoForm.projectName,callback:function(t){e.$set(e.basicInfoForm,"projectName",t)},expression:"basicInfoForm.projectName"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"来源部门",prop:"apartment"}},[a("el-select",{staticStyle:{width:"60%"},attrs:{filterable:"",placeholder:"请选择",size:"small"},model:{value:e.basicInfoForm.apartment,callback:function(t){e.$set(e.basicInfoForm,"apartment",t)},expression:"basicInfoForm.apartment"}},e._l(e.apartmentOptions,function(e){return a("el-option",{key:e,attrs:{label:e,value:e}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"优先级",prop:"priority"}},[a("el-radio-group",{staticStyle:{width:"100%"},attrs:{size:"small"},model:{value:e.basicInfoForm.priority,callback:function(t){e.$set(e.basicInfoForm,"priority",t)},expression:"basicInfoForm.priority"}},[a("el-radio-button",{attrs:{label:"P0"}}),e._v(" "),a("el-radio-button",{attrs:{label:"P1"}}),e._v(" "),a("el-radio-button",{attrs:{label:"P2"}}),e._v(" "),a("el-radio-button",{attrs:{label:"P3"}})],1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"处理人",prop:"developer",size:"small"}},[a("el-input",{staticStyle:{width:"60%"},model:{value:e.basicInfoForm.developer,callback:function(t){e.$set(e.basicInfoForm,"developer",t)},expression:"basicInfoForm.developer"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"需求阶段",prop:"status",size:"small"}},[a("el-select",{staticStyle:{width:"60%"},attrs:{filterable:"",placeholder:"请选择"},model:{value:e.basicInfoForm.status,callback:function(t){e.$set(e.basicInfoForm,"status",t)},expression:"basicInfoForm.status"}},e._l(e.devStatusMapping,function(e,t){return a("el-option",{key:e,attrs:{label:e,value:t}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"期望时间",prop:"expectTime"}},[a("el-date-picker",{staticStyle:{width:"60%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期",size:"small"},model:{value:e.basicInfoForm.expectTime,callback:function(t){e.$set(e.basicInfoForm,"expectTime",t)},expression:"basicInfoForm.expectTime"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"预计开始时间",prop:"startTime",size:"small"}},[a("el-date-picker",{staticStyle:{width:"60%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期",size:"small"},model:{value:e.basicInfoForm.startTime,callback:function(t){e.$set(e.basicInfoForm,"startTime",t)},expression:"basicInfoForm.startTime"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"45%",display:"inline-block"},attrs:{label:"预计结束时间",prop:"endTime",size:"small"}},[a("el-date-picker",{staticStyle:{width:"60%"},attrs:{type:"date","value-format":"yyyy-MM-dd",placeholder:"选择日期",size:"small"},model:{value:e.basicInfoForm.endTime,callback:function(t){e.$set(e.basicInfoForm,"endTime",t)},expression:"basicInfoForm.endTime"}})],1)],1)],1),e._v(" "),a("el-card",[a("el-tabs",{attrs:{type:"card"},model:{value:e.activeTab,callback:function(t){e.activeTab=t},expression:"activeTab"}},[a("el-tab-pane",{attrs:{label:"需求文档",name:"first"}},[a("div",{staticStyle:{"min-height":"460px","max-height":"598px","overflow-y":"auto"}},[a("quill-editor",{ref:"myQuillEditor",attrs:{id:"editor",disabled:e.isdisabled,options:e.editorOption},model:{value:e.basicInfoForm.document,callback:function(t){e.$set(e.basicInfoForm,"document",t)},expression:"basicInfoForm.document"}})],1),e._v(" "),a("div",{staticStyle:{position:"absolute",top:"70px",right:"10px","z-index":"1000"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:e.canEditDoc,expression:"canEditDoc"}],attrs:{type:"primary",plain:""},on:{click:function(t){e.isdisabled=!1}}},[e._v("进入编辑")])],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"指标说明",name:"second"}},[a("div",{staticStyle:{"margin-left":"10px","min-height":"400px"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.onImportDataset}},[e._v("导入指标")]),e._v(" "),a("el-button",{attrs:{type:"success",size:"small"},on:{click:function(t){e.addIndicatorVisible=!0}}},[e._v("添加指标")]),e._v(" "),a("el-dialog",{attrs:{title:"添加指标",visible:e.addIndicatorVisible},on:{"update:visible":function(t){e.addIndicatorVisible=t}}},[a("el-form",{ref:"userDefineIndicatorForm",attrs:{model:e.userDefineIndicatorForm,"label-width":"80px"}},[a("el-form-item",{attrs:{label:"资产名称"}},[a("el-input",{staticStyle:{width:"60%"},attrs:{size:"small"},model:{value:e.userDefineIndicatorForm.name,callback:function(t){e.$set(e.userDefineIndicatorForm,"name",t)},expression:"userDefineIndicatorForm.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"100%"},attrs:{label:"资产描述"}},[a("el-input",{attrs:{size:"mini",type:"textarea",rows:5},model:{value:e.userDefineIndicatorForm.description,callback:function(t){e.$set(e.userDefineIndicatorForm,"description",t)},expression:"userDefineIndicatorForm.description"}})],1),e._v(" "),a("el-form-item",[a("el-button",{staticStyle:{float:"right"},attrs:{type:"success",size:"small"},on:{click:e.onAddUdIndicator}},[e._v("添加描述\n                  ")])],1)],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"99%","margin-bottom":"10px"},attrs:{data:e.unionIndicator,stripe:"","show-header":!0}},[a("el-table-column",{key:"type_name",attrs:{prop:"type_name",label:"资产类型"}}),e._v(" "),a("el-table-column",{key:"item_name",attrs:{prop:"item_name",label:"资产名"}}),e._v(" "),a("el-table-column",{key:"description",attrs:{prop:"description",label:"描述"}})],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"需求附件",name:"third"}},[a("div",{staticStyle:{"margin-left":"10px","min-height":"400px"}},[a("el-col",{attrs:{span:12}},[a("el-upload",{ref:"upload",staticClass:"upload-demo",attrs:{action:"dummyUrl",limit:1,"file-list":e.fileList,"auto-upload":!1,"before-upload":e.beforeUpload,"on-exceed":e.onExceed}},[a("el-button",{attrs:{slot:"trigger",size:"small",type:"primary"},slot:"trigger"},[e._v("选择需求文档")]),e._v(" "),a("el-button",{staticStyle:{"margin-left":"10px"},attrs:{size:"small",type:"success"},on:{click:e.submitFile}},[e._v("上传")]),e._v(" "),a("span",{staticStyle:{color:"#BDBDBD","font-size":"12px"}},[e._v(e._s(e.uploadTableName))])],1),e._v(" "),a("div",{staticStyle:{height:"360px",overflow:"scroll"}},[a("span",[e._v("评论区:")]),e._v(" "),a("el-button",{attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.commentVisible=!0}}},[e._v("添加评论")]),e._v(" "),a("el-timeline",{staticStyle:{"margin-left":"-30px","margin-top":"5px"}},e._l(e.criticalItems,function(t){return a("el-timeline-item",{attrs:{timestamp:t.Time+" ("+t.Commentator+")",placement:"top"}},[a("el-card",[a("p",[e._v(e._s(t.Comment))])])],1)}),1)],1)],1),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-table",{staticStyle:{width:"99%","margin-bottom":"10px"},attrs:{data:e.documentList,stripe:"","show-header":!1}},[a("el-table-column",{key:"filename",attrs:{prop:"filename",label:"文件名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("sapn",{staticStyle:{cursor:"pointer"},on:{click:function(a){return e.dowloadAttachment(t.row)}}},[e._v(e._s(t.row.Filename)+"\n                    ")])]}}],null,!1,3480550626)}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"small",icon:"el-icon-close"},on:{click:function(a){return e.delAttachment(t.row)}}})]}}],null,!1,2810285602)})],1)],1)],1)]),e._v(" "),a("el-tab-pane",{attrs:{label:"历史记录",name:"fourth"}},[a("el-table",{ref:"historyTable",staticStyle:{width:"100%"},attrs:{data:e.historyData,stripe:"","highlight-current-row":""}},[e._l(e.historyCols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:t.sortable}})}),e._v(" "),a("el-table-column",{attrs:{fixed:"right",label:"操作",width:"110"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.checkHistory(t.row)}}},[e._v("查看数据")])]}}],null,!1,412515509)})],2)],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px"},attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.uploadDataRequest}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small",type:"danger"},on:{click:function(t){return e.$router.push({name:"demandList"})}}},[e._v("取消")])],1)],1):e._e(),e._v(" "),a("el-dialog",{attrs:{title:"选择数据资产",visible:e.dialogTableVisible,width:"80%"},on:{"update:visible":function(t){e.dialogTableVisible=t}}},[a("span",[e._v("请在第一列勾选")]),e._v(" "),a("div",{staticStyle:{"max-height":"500px",overflow:"scroll"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("el-table",{ref:"assetTable",staticStyle:{width:"100%"},attrs:{data:e.assetList,stripe:"",border:!1},on:{"selection-change":e.handleSelectionChange}},[a("el-table-column",{attrs:{type:"selection",width:"55"}}),e._v(" "),a("el-table-column",{key:"type_name",attrs:{prop:"type_name",label:"资产类型","min-width":"18%"}}),e._v(" "),a("el-table-column",{key:"item_name",attrs:{prop:"item_name",label:"资产名","min-width":"18%"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.item_name))])]}}])}),e._v(" "),a("el-table-column",{key:"description",attrs:{prop:"description",label:"描述","min-width":"46%"}}),e._v(" "),a("el-table-column",{key:"business_label",attrs:{prop:"business_label",label:"业务标签","min-width":"18%"},scopedSlots:e._u([{key:"default",fn:function(t){return e._l(t.row.business_label.split(","),function(o,s){return a("el-tag",{directives:[{name:"show",rawName:"v-show",value:t.row.business_label.split(",").length>0&&""!==t.row.business_label.split(",")[0],expression:"scope.row.business_label.split(',').length>0 && scope.row.business_label.split(',')[0]!==''"}],staticStyle:{"margin-right":"5px"}},[e._v("\n                "+e._s(e.serviceTagMap[o])+"\n              ")])})}}])})],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px","margin-bottom":"-5px"},attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){e.dialogTableVisible=!1}}},[e._v("确定")])],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"上传评论",visible:e.commentVisible,width:"600px"},on:{"update:visible":function(t){e.commentVisible=t}}},[a("span",[e._v("请在下面书写评论")]),e._v(" "),a("el-input",{attrs:{size:"mini",type:"textarea",rows:10},model:{value:e.commentStr,callback:function(t){e.commentStr=t},expression:"commentStr"}}),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px","margin-bottom":"-5px"},attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.uploadComment}},[e._v("提交")])],1)],1)],1)},staticRenderFns:[]};var Bo=a("VU/8")(Vo,jo,!1,function(e){a("iwfV")},"data-v-66657f62",null).exports,qo=a("mtWM"),Ho={name:"DemandList",data:function(){return{demandList:[],cols:[],devStatusMapping:{}}},methods:{createDemand:function(){this.showDemandInfo("new")},getAllDemand:function(){var e=this;qo.get("/requirement/getAllDemand").then(function(t){e.demandList=t.data.data,e.cols=t.data.cols}).catch(function(e){console.log(e)})},getAllStatusMapping:function(){var e=this;qo.get("/requirement/GetDevStatusMapping").then(function(t){e.devStatusMapping=t.data}).catch(function(e){console.log(e)})},getDevStatus:function(e){return this.devStatusMapping[e]},showDemandInfo:function(e){sessionStorage.setItem("demandId",e+""),Ss.push({name:"demand",params:{demandId:e+""}})}},mounted:function(){this.getAllDemand(),this.getAllStatusMapping()}},zo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:e.createDemand}},[e._v("创建需求")]),e._v(" "),a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.demandList,stripe:""}},[e._l(e.cols,function(t){return t.hidden?e._e():a("el-table-column",{key:t.prop,attrs:{prop:t.prop,label:t.label,sortable:!0},scopedSlots:e._u([{key:"default",fn:function(o){return["status"===t.prop?a("span",[e._v(e._s(e.getDevStatus(o.row.status)))]):a("span",[e._v(e._s(o.row[t.prop]))])]}}],null,!0)})}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-setting",type:"text",size:"mini"},on:{click:function(a){return e.showDemandInfo(t.row.rid)}}},[e._v("查看\n        ")])]}}])})],2)],1)},staticRenderFns:[]};var Jo=a("VU/8")(Ho,zo,!1,function(e){a("saz5")},"data-v-c8c0ad98",null).exports,Go=a("mtWM"),Yo={data:function(){return{name:"Dimension",isCheck:!1,dataList:[],serviceTagList:[],serviceTagMap:{},dimensionForm:{id:0,name:"",aliasName:"",dataSourceType:"",dataSource:"",primaryTableId:"",primaryTableName:"",description:"",pkField:"",valField:"",assistInfo:"",assistInfoArr:[],serviceTagIds:[],businessLabel:""},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],dsOptions:[],tableOptions:[],pkOptions:[],foreignKeyOptions:[],rules:{name:[{required:!0,message:"请输入维度名",trigger:"blur"}],aliasName:[{required:!0,message:"请输入英文别名",trigger:"blur"}],dataSource:[{required:!0,message:"请选择数据源",trigger:"blur"}],primaryTableId:[{required:!0,message:"请学则维度主表",trigger:"blur"}],pkField:[{required:!0,message:"请选择维度主键",trigger:"blur"}],valField:[{required:!0,message:"请选择维度值字段",trigger:"blur"}]},facTableForm:{tableType:"",factTable:"",foreignKey:""},factTableOptions:[],factRelationList:[],fromDictionary:!1}},methods:{onDeleteFactRelation:function(e){var t=this,a={dfid:e.dfid};this.$confirm("确定删除这个事实表关系吗",{confirmButtonText:"删除",cancelButtonText:"取消"}).then(function(){Go.post("/indicator/dimension/postDimFactRelation",a,{responseType:"json"}).then(function(e){e.data.Res?(t.$notify({message:"删除成功",type:"success"}),t.$refs.facTableForm.resetFields(),t.getFactRelationByDimId()):t.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})})},getFactRelationByDimId:function(){var e="/indicator/dimension/getDimFactRelations/"+this.dimensionForm.id,t=this;Go.get(e).then(function(e){t.$nextTick(function(){t.factRelationList=e.data.data})}).catch(function(e){console.log(e)})},postFactRelation:function(){var e=this;if(console.log("id为"+this.dimensionForm.id),""!==this.dimensionForm.id&&void 0!==this.dimensionForm.id&&null!==this.dimensionForm.id&&0!=this.dimensionForm.id){var t={dimId:this.dimensionForm.id,factId:this.facTableForm.factTable,foreignKey:this.facTableForm.foreignKey};Go.post("/indicator/dimension/postDimFactRelation",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$notify({message:"更新成功",type:"success"}),e.getFactRelationByDimId()):e.$notify({message:t.data.Info,type:"error"})}).catch(function(e){console.log(e)})}else this.$alert("请先提交维度主表配置")},onChangeFactTable:function(){var e=this,t={tableId:e.facTableForm.factTable+"",version:"latest"};Go.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.foreignKeyOptions=t.data.dataList,e.foreignKeyOptions.map(function(e){return e.fieldName}).indexOf(e.dimensionForm.pkField)>-1?e.facTableForm.foreignKey=e.dimensionForm.pkField:e.facTableForm.foreignKey=""}).catch(function(e){console.log(e)})},genTableIdentifier:function(e,t){return e+"."+t},onChangeFactType:function(){var e=this.facTableForm.tableType;this.facTableForm.factTable="",this.foreignKeyOptions=[];var t=this,a={curPage:"1",pageSize:"9999",table_type:e};Go.post("metaData/getTableByConditions",a,{responseType:"json"}).then(function(e){t.factTableOptions=e.data.data}).catch(function(e){console.log(e)})},onEditDimension:function(e){var t=this;this.$nextTick(function(){console.log(e),t.dimensionForm.id=e.id,t.dimensionForm.name=e.name,t.dimensionForm.aliasName=e.aliasName,t.dimensionForm.dataSourceType=e.data_source_type,t.dimensionForm.valField=e.val_field,t.getFactRelationByDimId(),t.onChangeDSType(),t.dimensionForm.dataSource=e.primary_table_data_source,t.onChangeDataSource(),t.dimensionForm.primaryTableId=e.primary_table_id,t.dimensionForm.primaryTableName=e.primary_table_name,t.onChangeTableName(),t.dimensionForm.pkField=e.pk_field,t.dimensionForm.description=e.description,""!==e.assist_info&&(t.dimensionForm.assistInfoArr=e.assist_info.split(",")),""!==e.business_label&&(t.dimensionForm.serviceTagIds=e.business_label.split(","))})},onCreateDimension:function(){var e=this;console.log(this.dimensionForm);var t=this;this.$refs.dimensionForm.validate(function(a){a&&(e.dimensionForm.businessLabel=e.dimensionForm.serviceTagIds.join(","),e.dimensionForm.assistInfo=e.dimensionForm.assistInfoArr.join(","),Go.post("/indicator/dimension/postNew",e.dimensionForm,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"创建成功"}),t.dimensionForm.id=parseInt(e.data.Info)):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)}))})},browseTableInfo:function(e){var t={tableId:e};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},onChangeDSType:function(){var e=this;Go.get("/dw/GetConnByPrivilege/"+this.dimensionForm.dataSourceType).then(function(t){e.dsOptions=t.data,e.dimensionForm.dataSource=e.dsOptions[0].Dsid,e.onChangeDataSource()}).catch(function(e){console.log(e)})},onChangeDataSource:function(){var e=this;console.log(this.dimensionForm.dataSource);var t={dsType:this.dimensionForm.dataSourceType,dsId:this.dimensionForm.dataSource+""};Go.post("/dw/meta/get",t,{responseType:"json"}).then(function(t){var a=[];t.data.children.forEach(function(e){try{e.children.forEach(function(e){a.push({tableId:e.tid,tableName:e.tableName})})}catch(e){console.log(e)}}),e.tableOptions=a}).catch(function(e){console.log(e)})},onChangeTableName:function(){var e=this;this.findTableNameInOptions();var t={tableId:e.dimensionForm.primaryTableId+"",version:"latest"};Go.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.pkOptions=t.data.dataList,e.pkOptions=t.data.dataList}).catch(function(e){console.log(e)})},findTableNameInOptions:function(){var e=this,t=this.dimensionForm.primaryTableId;this.tableOptions.forEach(function(a){a.tableId==t&&(e.dimensionForm.primaryTableName=a.tableName)})},getAllServiceTag:function(e){var t=this;Go.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),e()}).catch(function(e){console.log(e)})},getDimensionById:function(e){var t=this,a={originId:e+"",assetType:"dimension"};this.fromDictionary=!0,Go.post("/indicator/dictionary/searchById",a,{responseType:"json"}).then(function(e){var a={id:e.data.Id,name:e.data.Name,aliasName:e.data.AliasName,data_source_type:e.data.DataSourceType,primary_table_data_source:e.data.PrimaryTableDataSource,primary_table_id:e.data.PrimaryTableId,primary_table_name:e.data.PrimaryTableName,pk_field:e.data.PkField,val_field:e.data.ValField,assist_info:e.data.AssistInfo,business_label:e.data.BusinessLabel,description:e.data.Description};t.onEditDimension(a)}).catch(function(e){console.log(e)})}},mounted:function(){var e=sessionStorage.getItem("dimensionId");this.isCheck="true"===sessionStorage.getItem("dimensionCreate"),sessionStorage.removeItem("dimensionCreate"),console.log("收到的dimensionId: "+e),this.getAllServiceTag(),null!==e&&void 0!==e&&""!==e&&this.getDimensionById(e)}},Wo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px"}},[e._v("维度主表配置")]),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px",width:"100%"}},[a("el-form",{ref:"dimensionForm",attrs:{model:e.dimensionForm,"label-width":"110px",rules:e.rules}},[a("el-row",[a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"中文名称:",prop:"name"}},[a("el-input",{attrs:{size:"small"},model:{value:e.dimensionForm.name,callback:function(t){e.$set(e.dimensionForm,"name",t)},expression:"dimensionForm.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"英文名称:",prop:"aliasName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.dimensionForm.aliasName,callback:function(t){e.$set(e.dimensionForm,"aliasName",t)},expression:"dimensionForm.aliasName"}})],1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"60%"},attrs:{label:"主表数据源:",prop:"dataSource"}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择数据源类型:",size:"small"},on:{change:e.onChangeDSType},model:{value:e.dimensionForm.dataSourceType,callback:function(t){e.$set(e.dimensionForm,"dataSourceType",t)},expression:"dimensionForm.dataSourceType"}},e._l(e.dsTypeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1),e._v(" "),a("el-col",{staticStyle:{"text-align":"center"},attrs:{span:1}},[e._v("-")]),e._v(" "),a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"请选择数据源:",size:"small"},on:{change:e.onChangeDataSource},model:{value:e.dimensionForm.dataSource,callback:function(t){e.$set(e.dimensionForm,"dataSource",t)},expression:"dimensionForm.dataSource"}},e._l(e.dsOptions,function(e){return a("el-option",{key:e.Dsid,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1)],1)],1)],1),e._v(" "),a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"维度表表名:",prop:"primaryTableId"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",clearable:"",placeholder:"请选择表名:",size:"small"},on:{change:e.onChangeTableName},model:{value:e.dimensionForm.primaryTableId,callback:function(t){e.$set(e.dimensionForm,"primaryTableId",t)},expression:"dimensionForm.primaryTableId"}},e._l(e.tableOptions,function(e){return a("el-option",{key:e.tableId,attrs:{label:e.tableName,value:e.tableId}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"主键(ID):",prop:"pkField"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{filterable:"",placeholder:"维度主键:",size:"small"},model:{value:e.dimensionForm.pkField,callback:function(t){e.$set(e.dimensionForm,"pkField",t)},expression:"dimensionForm.pkField"}},e._l(e.pkOptions,function(e){return a("el-option",{key:e.fieldName,attrs:{label:e.fieldName,value:e.fieldName}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"维度描述:",prop:"description"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:3}},model:{value:e.dimensionForm.description,callback:function(t){e.$set(e.dimensionForm,"description",t)},expression:"dimensionForm.description"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"90%"},attrs:{label:"业务标签:",prop:"serviceTagIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.dimensionForm.serviceTagIds,callback:function(t){e.$set(e.dimensionForm,"serviceTagIds",t)},expression:"dimensionForm.serviceTagIds"}},e._l(e.serviceTagList,function(e){return a("el-option",{key:e.tid,attrs:{label:e.tagName,value:e.tid}})}),1)],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{width:"90%"},attrs:{type:"flex",justify:"end"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"primary"},on:{click:e.onCreateDimension}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.back(-1)}}},[e._v("返回")])],1),e._v(" "),a("h3",{staticStyle:{"margin-bottom":"10px","margin-top":"5px",display:"inline-block"}},[e._v("关联事实表配置")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"事实表外键与维度表主键相同则符合规范",placement:"top-start"}},[a("el-button",{staticStyle:{color:"#E6A23C","font-size":"16px"},attrs:{icon:"el-icon-question",type:"text"}})],1),e._v(" "),a("el-form",{ref:"facTableForm",attrs:{model:e.facTableForm,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"事实表:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表类型",size:"small"},on:{change:e.onChangeFactType},model:{value:e.facTableForm.tableType,callback:function(t){e.$set(e.facTableForm,"tableType",t)},expression:"facTableForm.tableType"}},e._l(e.dsTypeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1),e._v(" "),a("i",{staticClass:"el-icon-right"}),e._v(" "),a("el-select",{attrs:{placeholder:"请选择事实表",filterable:"",size:"small",clearable:""},on:{change:e.onChangeFactTable},model:{value:e.facTableForm.factTable,callback:function(t){e.$set(e.facTableForm,"factTable",t)},expression:"facTableForm.factTable"}},e._l(e.factTableOptions,function(t){return a("el-option",{key:t.tid,attrs:{label:e.genTableIdentifier(t.database_name,t.table_name),value:t.tid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"关联外键:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表的关联外键",size:"small",clearable:""},model:{value:e.facTableForm.foreignKey,callback:function(t){e.$set(e.facTableForm,"foreignKey",t)},expression:"facTableForm.foreignKey"}},e._l(e.foreignKeyOptions,function(e){return a("el-option",{key:e.fieldName,attrs:{label:e.fieldName,value:e.fieldName}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"success"},on:{click:e.postFactRelation}},[e._v("提交")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"85%","margin-left":"30px"},attrs:{data:e.factRelationList,stripe:"",border:!0}},[a("el-table-column",{key:"fact_database",attrs:{prop:"fact_database",label:"事实表库"}}),e._v(" "),a("el-table-column",{key:"fac_table_name",attrs:{prop:"fac_table_name",label:"事实表名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{cursor:"pointer","text-decoration":"underline"},on:{click:function(a){return e.browseTableInfo(t.row.fact_id)}}},[e._v(e._s(t.row.fac_table_name))])]}}])}),e._v(" "),a("el-table-column",{key:"foreign_key",attrs:{prop:"foreign_key",label:"关联外键"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.foreign_key))])]}}])}),e._v(" "),a("el-table-column",{key:"foreign_key",attrs:{prop:"foreign_key_valid",label:"规范符合",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.foreign_key===e.dimensionForm.pkField?a("el-button",{staticStyle:{color:"green","font-size":"22px"},attrs:{icon:"el-icon-s-flag",type:"text"}}):a("el-button",{staticStyle:{color:"red","font-size":"22px"},attrs:{icon:"el-icon-warning",type:"text"}})]}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.onDeleteFactRelation(t.row)}}})]}}])})],1)],1)])},staticRenderFns:[]};var Ko=a("VU/8")(Yo,Wo,!1,function(e){a("hQKG")},"data-v-07811b01",null).exports,Xo=a("mtWM"),Qo={data:function(){return{editId:0,dataList:[],isCheck:!1,tableColumn:[],indicatorForm:{name:"",fieldName:"",aggregation:"",meaning:"",serviceTagIds:[],predictItems:[],expression:""},expressionVisible:!1,preIndicatorOptions:[],indexDependencies:[],indicatorFormRules:{name:[{required:!0,message:"请输入指标名",trigger:"blur"}],fieldName:[{required:!0,message:"请输入指标字段",trigger:"blur"}],serviceTagIds:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}]},serviceTagList:[],serviceTagMap:{},factRelationList:[],facTableForm:{tableType:"",factTable:"",foreignKey:""},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],factTableOptions:[],foreignKeyOptions:[],fromDictionary:!1}},computed:{omitExpression:function(){return this.indicatorForm.expression.length>40?this.indicatorForm.expression.substr(0,40)+"...":this.indicatorForm.expression}},methods:{postFactRelation:function(){if("new"!==this.arbitrateNewOrUpdate()){var e=this,t={indicatorId:this.editId,factId:this.facTableForm.factTable,associatedField:this.facTableForm.foreignKey};Xo.post("/indicator/predefine/addIndicatorFactRelation",t).then(function(t){t.data.Res?(e.$notify({message:"创建成功",type:"success"}),e.getFactRelation()):e.$notify({message:t.data.Info,type:"error"})}).catch(function(e){console.log(e)})}else this.$alert("请先保存上方的基本信息")},deleteDependencies:function(e){this.indexDependencies.splice(e,1)},addDependencies:function(){var e=this,t=this.indicatorForm.predictItems;this.transStrToIndexDependencies(t),this.indexDependencies.forEach(function(t){e.indicatorForm.expression=e.indicatorForm.expression+"\n"+t.name})},transStrToIndexDependencies:function(e){var t=this;this.indexDependencies=[],this.preIndicatorOptions.forEach(function(a){-1!==e.indexOf(a.id)&&t.indexDependencies.push(a)}),this.indicatorForm.predictItems=e},onDeleteFactRelation:function(e){var t=this;this.$confirm("确定删除吗",{confirmButtonText:"删除",cancelButtonText:"取消"}).then(function(){var a=t,o=e.ifid;Xo.post("/indicator/predefine/delIndicatorFactRelation/"+o).then(function(e){e.data.Res?(a.$notify({message:"删除成功",type:"success"}),a.getFactRelation()):a.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})})},genTableIdentifier:function(e,t){return e+"."+t},onChangeFactTable:function(){var e=this,t={tableId:e.facTableForm.factTable+"",version:"latest"};Xo.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.foreignKeyOptions=t.data.dataList,e.foreignKeyOptions.map(function(e){return e.fieldName}).indexOf(e.indicatorForm.fieldName)>-1?e.facTableForm.foreignKey=e.indicatorForm.fieldName:e.facTableForm.foreignKey=""}).catch(function(e){console.log(e)})},onChangeFactType:function(){var e=this.facTableForm.tableType;this.facTableForm.factTable="",this.foreignKeyOptions=[];var t=this,a={curPage:"1",pageSize:"9999",table_type:e};Xo.post("metaData/getTableByConditions",a,{responseType:"json"}).then(function(e){t.factTableOptions=e.data.data}).catch(function(e){console.log(e)})},getFactRelation:function(){var e=this;Xo.get("indicator/getIndicatorFactRelation/"+this.editId).then(function(t){e.factRelationList=t.data.data}).catch(function(e){console.log(e)})},onDeleteIndicator:function(e){this.editId=e.id;var t=this;Xo.post("/indicator/delIndicator/"+this.editId).then(function(e){e.data.Res?(t.$message({type:"success",message:"删除成功"}),t.getAllIndicator()):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})},getAllPreDefineIndex:function(){var e=this;Xo.get("/indicator/getAllIndicator").then(function(t){e.preIndicatorOptions=t.data.data}).catch(function(e){console.log(e)})},closeIndicatorDialog:function(){Ss.push({path:"preIndicator"})},browseTableInfo:function(e){var t={tableId:e};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},getColumnWidth:function(e){return"meaning"===e?"50%":"tid"===e?"20%":void 0},makeEditPredefineIndicator:function(){var e=this,t=[];this.indexDependencies.forEach(function(e){t.push(e.id)});var a={name:this.indicatorForm.name,FieldName:this.indicatorForm.fieldName,meaning:this.indicatorForm.meaning,BusinessLabels:this.indicatorForm.serviceTagIds,aggregation:this.indicatorForm.aggregation,id:this.editId,expression:this.indicatorForm.expression,dependencies:t};Xo.post("/indicator/editPreIndicator",a,{responseType:"json"}).then(function(t){t.data.Res?e.$message({type:"success",message:"修改成功"}):e.$message({type:"error",message:t.data.Info})}).catch(function(e){console.log(e)})},submitIndicator:function(){this.checkDuplicateIndicator(this.makeNewPredefineIndicator)},checkDuplicateIndicator:function(e){var t={name:this.indicatorForm.name,fieldName:this.indicatorForm.fieldName,id:this.editId+""},a=this;Xo.post("/indicator/dictionary/checkIndicatorDuplicate",t,{responseType:"json"}).then(function(t){var o=t.data;o.length>0?a.$message({type:"error",message:"指标重复: "+o[0].name+" 指标字段: "+o[0].fieldName}):e()}).catch(function(e){console.log(e)})},makeNewPredefineIndicator:function(){var e=this;this.$refs.indicatorForm.validate(function(t){if(t)if("update"===e.arbitrateNewOrUpdate())e.makeEditPredefineIndicator();else{var a=e;e.$refs.indicatorForm.validate(function(t){if(t){var o=[];e.indexDependencies.forEach(function(e){o.push(e.id)});var s={name:e.indicatorForm.name,meaning:e.indicatorForm.meaning,BusinessLabels:e.indicatorForm.serviceTagIds,aggregation:e.indicatorForm.aggregation,fieldName:e.indicatorForm.fieldName,expression:e.indicatorForm.expression,dependencies:o};Xo.post("/indicator/postPreIndicator",s,{responseType:"json"}).then(function(e){e.data.Res?(a.$message({type:"success",message:"创建成功, id:"+e.data.Info}),a.editId=parseInt(e.data.Info)):a.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})}})}})},getAllServiceTag:function(e){var t=this;Xo.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},arbitrateNewOrUpdate:function(){var e=this.editId;return void 0===e||null===e||""==e||"0"==e?"new":"update"},getDependencies:function(){var e=this;Xo.get("/indicator/getIndicatorDependenciesById/"+this.editId).then(function(t){e.transStrToIndexDependencies(t.data)}).catch(function(e){console.log(e)})},getPreIndicatorById:function(e){var t=this,a={originId:e+"",assetType:"predefine"};this.fromDictionary=!0,Xo.post("/indicator/dictionary/searchById",a,{responseType:"json"}).then(function(e){t.editId=parseInt(e.data.id),t.getDependencies(),t.indicatorForm.name=e.data.name,t.indicatorForm.meaning=e.data.meaning,t.indicatorForm.aggregation=e.data.aggregation,t.indicatorForm.fieldName=e.data.fieldName,t.indicatorForm.expression=e.data.expression,t.getFactRelation(),""!==e.data.businessLabel&&(t.indicatorForm.serviceTagIds=e.data.businessLabel.split(","))}).catch(function(e){console.log(e)})}},mounted:function(){var e=sessionStorage.getItem("preIndicatorId");this.isCheck="true"===sessionStorage.getItem("preIndicatorCheck"),sessionStorage.removeItem("preIndicatorCheck"),this.getAllServiceTag(),null!==e&&void 0!==e&&""!==e&&this.getPreIndicatorById(e),this.getAllPreDefineIndex()}},Zo={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",{staticStyle:{width:"80%"}},[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px"}},[e._v("原子指标")]),e._v(" "),a("el-form",{ref:"indicatorForm",attrs:{model:e.indicatorForm,"label-width":"80px",rules:e.indicatorFormRules}},[a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"中文名称",prop:"name"}},[a("el-input",{attrs:{size:"small"},model:{value:e.indicatorForm.name,callback:function(t){e.$set(e.indicatorForm,"name",t)},expression:"indicatorForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("el-form-item",{attrs:{label:"英文名称",prop:"fieldName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.indicatorForm.fieldName,callback:function(t){e.$set(e.indicatorForm,"fieldName",t)},expression:"indicatorForm.fieldName"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:11}},[a("el-form-item",{attrs:{label:"聚合方式",prop:"aggregate"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{size:"small",filterable:"",placeholder:"请选择"},model:{value:e.indicatorForm.aggregation,callback:function(t){e.$set(e.indicatorForm,"aggregation",t)},expression:"indicatorForm.aggregation"}},[a("el-option",{attrs:{label:"sum",value:"sum"}}),e._v(" "),a("el-option",{attrs:{label:"min",value:"min"}}),e._v(" "),a("el-option",{attrs:{label:"max",value:"max"}}),e._v(" "),a("el-option",{attrs:{label:"avg",value:"avg"}})],1)],1)],1),e._v(" "),a("el-col",{attrs:{span:11,offset:1}},[a("el-form-item",{attrs:{label:"业务标签",prop:"serviceTagIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.indicatorForm.serviceTagIds,callback:function(t){e.$set(e.indicatorForm,"serviceTagIds",t)},expression:"indicatorForm.serviceTagIds"}},e._l(e.serviceTagList,function(e){return a("el-option",{key:e.tid,attrs:{label:e.tagName,value:e.tid}})}),1)],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"计算公式"}},[a("el-button",{staticClass:"button-new-expression",attrs:{size:"mini",type:"primary",plain:""},on:{click:function(t){e.expressionVisible=!0}}},[e._v("+\n          计算公式\n        ")]),e._v(" "),a("span",{staticStyle:{"margin-left":"10px",color:"#b3b3b3"}},[e._v(e._s(e.omitExpression))])],1),e._v(" "),a("el-form-item",{attrs:{label:"指标含义",prop:"meaning"}},[a("el-input",{attrs:{size:"small",type:"textarea",rows:3},model:{value:e.indicatorForm.meaning,callback:function(t){e.$set(e.indicatorForm,"meaning",t)},expression:"indicatorForm.meaning"}})],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"primary"},on:{click:e.submitIndicator}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.back(-1)}}},[e._v("返回")])],1),e._v(" "),a("h3",{staticStyle:{display:"inline-block"}},[e._v("关联表配置")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"事实表的'关联字段名称'和原子指标的'指标字段名'相同则符合规范",placement:"top-start"}},[a("el-button",{staticStyle:{color:"#E6A23C","font-size":"16px"},attrs:{icon:"el-icon-question",type:"text"}})],1),e._v(" "),a("el-form",{ref:"facTableForm",attrs:{model:e.facTableForm,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"事实表:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表类型",size:"small"},on:{change:e.onChangeFactType},model:{value:e.facTableForm.tableType,callback:function(t){e.$set(e.facTableForm,"tableType",t)},expression:"facTableForm.tableType"}},e._l(e.dsTypeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1),e._v(" "),a("i",{staticClass:"el-icon-right"}),e._v(" "),a("el-select",{attrs:{placeholder:"请选择事实表",filterable:"",size:"small",clearable:""},on:{change:e.onChangeFactTable},model:{value:e.facTableForm.factTable,callback:function(t){e.$set(e.facTableForm,"factTable",t)},expression:"facTableForm.factTable"}},e._l(e.factTableOptions,function(t){return a("el-option",{key:t.tid,attrs:{label:e.genTableIdentifier(t.database_name,t.table_name),value:t.tid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"关联值字段:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表的关联值字段",size:"small",clearable:""},model:{value:e.facTableForm.foreignKey,callback:function(t){e.$set(e.facTableForm,"foreignKey",t)},expression:"facTableForm.foreignKey"}},e._l(e.foreignKeyOptions,function(e){return a("el-option",{key:e.fieldName,attrs:{label:e.fieldName,value:e.fieldName}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"primary"},on:{click:e.postFactRelation}},[e._v("提交")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"100%","margin-left":"30px"},attrs:{data:e.factRelationList,stripe:"",border:!0}},[a("el-table-column",{key:"fact_name",attrs:{prop:"fact_name",label:"事实表名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{cursor:"pointer","text-decoration":"underline"},on:{click:function(a){return e.browseTableInfo(t.row.fact_id)}}},[e._v(e._s(t.row.fact_name))])]}}])}),e._v(" "),a("el-table-column",{key:"database_name",attrs:{prop:"database_name",label:"事实表库名"}}),e._v(" "),a("el-table-column",{key:"associated_field",attrs:{prop:"associated_field",label:"关联值字段"}}),e._v(" "),a("el-table-column",{key:"fact_type",attrs:{prop:"fact_type",width:"150",align:"center",label:"事实表类型"}}),e._v(" "),a("el-table-column",{key:"associated_field_valid",attrs:{prop:"associated_field_valid",label:"规范符合",width:"150",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.associated_field===e.indicatorForm.fieldName?a("el-button",{staticStyle:{color:"green","font-size":"22px"},attrs:{icon:"el-icon-s-flag",type:"text"}}):a("el-button",{staticStyle:{color:"red","font-size":"22px"},attrs:{icon:"el-icon-warning",type:"text"}})]}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.onDeleteFactRelation(t.row)}}})]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"配置计算公式",visible:e.expressionVisible,width:"60%"},on:{"update:visible":function(t){e.expressionVisible=t}}},[a("div",{staticStyle:{"margin-right":"10px"}},[a("div",{staticStyle:{border:"1px solid #DCDFE6",height:"400px"}},[a("el-scrollbar",{staticStyle:{height:"100%"}},[a("div",{attrs:{id:"添加的指标"}},[a("el-col",{attrs:{span:12}},[a("el-select",{staticStyle:{"margin-left":"5px",width:"80%"},attrs:{multiple:"",filterable:"",placeholder:"请选择需要组合的原子指标",size:"mini"},model:{value:e.indicatorForm.predictItems,callback:function(t){e.$set(e.indicatorForm,"predictItems",t)},expression:"indicatorForm.predictItems"}},e._l(e.preIndicatorOptions,function(e){return a("el-option",{key:e.id,attrs:{label:e.name,value:e.id}})}),1),e._v(" "),a("el-button",{staticStyle:{"margin-left":"2px"},attrs:{size:"mini",type:"primary",plain:""},on:{click:e.addDependencies}},[e._v("添加\n              ")]),e._v(" "),e._l(e.indexDependencies,function(t,o){return a("el-row",[a("el-col",{attrs:{span:22}},[a("el-row",{staticStyle:{"margin-left":"15px",border:"1px solid #DCDFE6","margin-bottom":"5px","background-color":"#FAFAFA"}},[a("el-col",{attrs:{span:4}},[a("div",{staticClass:"indexIcon"},[e._v(e._s(o+1))])]),e._v(" "),a("el-col",{attrs:{span:20}},[a("span",[e._v(e._s(t.name))])])],1)],1)],1)}),e._v(" "),a("span",{directives:[{name:"show",rawName:"v-show",value:0===e.indexDependencies.length,expression:"indexDependencies.length===0"}],staticClass:"expressionPlaceHolder"},[e._v("添加指标到这里将进行组合")])],2),e._v(" "),a("el-col",{staticStyle:{"margin-top":"17px"},attrs:{span:12}},[a("el-input",{staticStyle:{width:"97%"},attrs:{id:"expressionTextarea",type:"textarea",rows:17,placeholder:"请输入计算表达式",size:"medium"},model:{value:e.indicatorForm.expression,callback:function(t){e.$set(e.indicatorForm,"expression",t)},expression:"indicatorForm.expression"}})],1)],1)])],1)])])],1)},staticRenderFns:[]};var es=a("VU/8")(Qo,Zo,!1,function(e){a("fweS")},"data-v-9d7b14c2",null).exports,ts=a("mtWM"),as={data:function(){return{editId:0,dataList:[],isCheck:!1,tableColumn:[],editCombineIndicator:!1,indicatorForm:{name:"",fieldName:"",meaning:"",expression:"",serviceTagIds:[],predictItems:[],qualifiers:[],timeQualifier:""},indicatorFormRules:{name:[{required:!0,message:"请输入中文名",trigger:"blur"}],serviceTagIds:[{required:!0,message:"请选择业务类型",trigger:["blur","change"]}],fieldName:[{required:!0,message:"请输入英文名",trigger:"blur"}]},timeQualifierForm:{cName:"",eName:"",qualifierType:""},timeQualifierFormRules:{cName:[{required:!0,message:"请输入中文名",trigger:"blur"}],eName:[{required:!0,message:"请输入英文名",trigger:["blur","change"]}]},qualifierVisible:!1,serviceTagList:[],serviceTagMap:{},preIndicatorOptions:[],timeQualifierOption:[],indexDependencies:[],inputVisible:!1,inputValue:"",fromDictionary:!1}},methods:{handleClose:function(e){this.indicatorForm.qualifiers.splice(this.indicatorForm.qualifiers.indexOf(e),1)},showInput:function(){var e=this;this.inputVisible=!0,this.$nextTick(function(t){e.$refs.saveTagInput.$refs.input.focus()})},handleInputConfirm:function(){var e=this.inputValue;e&&this.indicatorForm.qualifiers.push(e),this.inputVisible=!1,this.inputValue=""},insertToExpression:function(e){console.log(),this.indicatorForm.expression+=e},addDependencies:function(){var e=this;return l()(n.a.mark(function t(){var a;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:a=e.indicatorForm.predictItems,e.transStrToIndexDependencies(a),e.indexDependencies.forEach(function(t){e.indicatorForm.expression=e.indicatorForm.expression+"\n"+t.name});case 3:case"end":return t.stop()}},t,e)}))()},transStrToIndexDependencies:function(e){var t=this;this.indexDependencies=[],this.preIndicatorOptions.forEach(function(a){-1!==e.indexOf(a.id)&&t.indexDependencies.push(a)}),this.indicatorForm.predictItems=e},onSubmitQualifier:function(){var e=this;this.$refs.timeQualifierForm.validate(function(t){if(t){var a=e,o=e.timeQualifierForm;o.qualifierType="时间周期",ts.post("/indicator/qualifier/add",o).then(function(e){e.data.Res?(a.$message({type:"success",message:"修饰词添加成功"}),a.getAllIndicator(),a.timeQualifierForm={cName:"",eName:"",qualifierType:""},a.qualifierVisible=!1):a.$message({type:"error",message:e.data.Info})}).catch(function(e){console.error(e)})}})},deleteDependencies:function(e){this.indexDependencies.splice(e,1)},onDeleteIndicator:function(e){var t=this;this.editId=e.id;var a=this;this.$confirm("确认删除该UDF记录吗","注意",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){ts.post("/indicator/delIndicator/"+t.editId).then(function(e){e.data.Res?(a.$message({type:"success",message:"删除成功"}),a.getAllIndicator()):a.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})})},onClickEditIndicator:function(e){this.indexDependencies=[],this.editId=e.id,this.indicatorForm.name=e.name,this.indicatorForm.meaning=e.meaning,this.indicatorForm.expression=e.expression,this.indicatorForm.serviceTagIds=e.business_label.split(","),this.indicatorForm.qualifiers=""===e.qualifiers?[]:e.qualifiers.split(","),console.log(e);var t=this;ts.get("/indicator/getIndicatorDependenciesById/"+this.editId).then(function(e){t.transStrToIndexDependencies(e.data)}).catch(function(e){console.log(e)})},closeIndicatorDialog:function(){this.$router.back(-1)},getColumnWidth:function(e){return"meaning"===e?"50%":"tid"===e?"20%":void 0},getAllIndicator:function(){var e=this;ts.get("/indicator/getAllCombineIndicator").then(function(t){e.tableColumn=t.data.cols,e.dataList=t.data.data}).catch(function(e){console.log(e)})},onClickNewIndex:function(){this.indexDependencies=[],this.indicatorForm.name="",this.indicatorForm.meaning="",this.indicatorForm.expression="",this.indicatorForm.serviceTagIds=[],this.indicatorForm.predictItems=[],this.editId=0},makeNewCombineIndicator:function(){var e=this,t=this;this.$refs.indicatorForm.validate(function(a){if(a){var o=[];e.indexDependencies.forEach(function(e){o.push(e.id)});var s={name:e.indicatorForm.name,meaning:e.indicatorForm.meaning,expression:e.indicatorForm.expression,BusinessLabels:e.indicatorForm.serviceTagIds,dependencies:o,qualifiers:e.indicatorForm.qualifiers,fieldName:e.indicatorForm.fieldName,timeQualifier:e.indicatorForm.timeQualifier};"update"===e.arbitrateNewOrUpdate()?(s.id=e.editId,ts.post("/indicator/postCombineIndicator",s,{responseType:"json"}).then(function(e){e.data.Res?t.$message({type:"success",message:"更新成功"}):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})):ts.post("/indicator/postCombineIndicator",s,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"创建成功, id:"+e.data.Info}),t.editId=parseInt(e.data.Info)):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})}})},getAllServiceTag:function(e){var t=this;ts.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},getAllPreDefineIndex:function(){var e=this;ts.get("/indicator/getAllIndicator").then(function(t){e.preIndicatorOptions=t.data.data}).catch(function(e){console.log(e)})},arbitrateNewOrUpdate:function(){var e=this.editId;return void 0===e||null===e||""==e||"0"==e?"new":"update"},getDependencies:function(){var e=this;ts.get("/indicator/getIndicatorDependenciesById/"+this.editId).then(function(t){e.transStrToIndexDependencies(t.data)}).catch(function(e){console.log(e)})},getCombineIndicatorById:function(e){var t=this,a={originId:e+"",assetType:"combine"};this.fromDictionary=!0,ts.post("/indicator/dictionary/searchById",a,{responseType:"json"}).then(function(e){t.editId=parseInt(e.data.id),t.getDependencies(),t.indicatorForm.name=e.data.name,t.indicatorForm.meaning=e.data.meaning,t.indicatorForm.aggregation=e.data.aggregation,t.indicatorForm.expression=e.data.expression,t.indicatorForm.fieldName=e.data.fieldName,t.fieldName=e.data.fieldName,t.indicatorForm.timeQualifier=e.data.timeQualifier,""!==e.data.qualifiers&&(t.indicatorForm.qualifiers=e.data.qualifiers.split(",")),""!==e.data.businessLabel&&(t.indicatorForm.serviceTagIds=e.data.businessLabel.split(","))}).catch(function(e){console.log(e)})},getTimeQualifierOption:function(){var e=this;ts.get("/indicator/qualifier/time/get").then(function(t){e.timeQualifierOption=t.data}).catch(function(e){console.error(e)})},onMounted:function(){var e=sessionStorage.getItem("combineIndicatorId");this.isCheck="true"===sessionStorage.getItem("combineIndicatorCheck"),sessionStorage.removeItem("combineIndicatorCheck"),null!==e&&void 0!==e&&""!==e&&this.getCombineIndicatorById(e)}},mounted:function(){this.getAllPreDefineIndex(),this.getAllServiceTag(this.onMounted),this.getTimeQualifierOption()}},os={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("el-row",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px",display:"inline"}},[e._v("派生指标")])]),e._v(" "),a("el-row",[a("el-form",{ref:"indicatorForm",attrs:{model:e.indicatorForm,"label-width":"100px",rules:e.indicatorFormRules}},[a("el-row",[a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"中文名称:",prop:"name"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.indicatorForm.name,callback:function(t){e.$set(e.indicatorForm,"name",t)},expression:"indicatorForm.name"}})],1)],1),e._v(" "),a("el-col",{attrs:{span:8}},[a("el-form-item",{attrs:{label:"英文名称:",prop:"fieldName"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.indicatorForm.fieldName,callback:function(t){e.$set(e.indicatorForm,"fieldName",t)},expression:"indicatorForm.fieldName"}})],1)],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"时间修饰词"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.indicatorForm.timeQualifier,callback:function(t){e.$set(e.indicatorForm,"timeQualifier",t)},expression:"indicatorForm.timeQualifier"}},e._l(e.timeQualifierOption,function(e){return a("el-option",{key:e.EName,attrs:{label:e.CName,value:e.Qid}})}),1),e._v(" "),a("el-button",{attrs:{type:"primary",plain:"",size:"small"},on:{click:function(t){e.qualifierVisible=!0}}},[e._v("+ 新增时间修饰词")])],1),e._v(" "),a("el-form-item",{attrs:{label:"其它修饰词"}},[e._l(e.indicatorForm.qualifiers,function(t){return a("el-tag",{key:t,attrs:{closable:"","disable-transitions":!1},on:{close:function(a){return e.handleClose(t)}}},[e._v("\n            "+e._s(t)+"\n          ")])}),e._v(" "),e.inputVisible?a("el-input",{ref:"saveTagInput",staticClass:"input-new-tag",attrs:{size:"small"},on:{blur:e.handleInputConfirm},nativeOn:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.handleInputConfirm(t)}},model:{value:e.inputValue,callback:function(t){e.inputValue=t},expression:"inputValue"}}):a("el-button",{staticClass:"button-new-tag",attrs:{size:"small"},on:{click:e.showInput}},[e._v("+ 新修饰词")])],2),e._v(" "),a("el-form-item",{attrs:{label:"业务标签",prop:"serviceTagIds"}},[a("el-select",{staticStyle:{width:"40%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"mini"},model:{value:e.indicatorForm.serviceTagIds,callback:function(t){e.$set(e.indicatorForm,"serviceTagIds",t)},expression:"indicatorForm.serviceTagIds"}},e._l(e.serviceTagList,function(e){return a("el-option",{key:e.tid,attrs:{label:e.tagName,value:e.tid}})}),1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:19}},[a("el-form-item",{attrs:{label:"指标含义",prop:"meaning"}},[a("el-input",{attrs:{size:"small",type:"textarea",rows:4},model:{value:e.indicatorForm.meaning,callback:function(t){e.$set(e.indicatorForm,"meaning",t)},expression:"indicatorForm.meaning"}})],1)],1)],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{width:"80%"},attrs:{type:"flex",justify:"end"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"primary"},on:{click:e.makeNewCombineIndicator}},[e._v("提交\n      ")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.back(-1)}}},[e._v("返回")])],1),e._v(" "),a("div")],1),e._v(" "),a("el-dialog",{attrs:{title:"添加时间修饰词",visible:e.qualifierVisible,width:"400px"},on:{"update:visible":function(t){e.qualifierVisible=t}}},[a("el-form",{ref:"timeQualifierForm",attrs:{model:e.timeQualifierForm,"label-width":"100px",rules:e.timeQualifierFormRules}},[a("el-row",[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"中文名称",prop:"cName"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.timeQualifierForm.cName,callback:function(t){e.$set(e.timeQualifierForm,"cName",t)},expression:"timeQualifierForm.cName"}})],1)],1)],1),e._v(" "),a("el-row",[a("el-col",{attrs:{span:22}},[a("el-form-item",{attrs:{label:"英文名称",prop:"eName"}},[a("el-input",{attrs:{size:"mini"},model:{value:e.timeQualifierForm.eName,callback:function(t){e.$set(e.timeQualifierForm,"eName",t)},expression:"timeQualifierForm.eName"}})],1)],1)],1),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-col",{attrs:{span:4}},[a("el-button",{attrs:{type:"primary",plain:"",size:"mini"},on:{click:e.onSubmitQualifier}},[e._v("提交")])],1)],1)],1)],1)],1)},staticRenderFns:[]};var ss=a("VU/8")(as,os,!1,function(e){a("gW4k")},"data-v-282fed16",null).exports,ns=a("mtWM"),is={data:function(){return{name:"Dimension",isCheck:!1,dataList:[],serviceTagList:[],serviceTagMap:{},dimensionForm:{id:0,name:"",isDerivative:!0,aliasName:"",dataSourceType:"",dataSource:"",primaryTableId:"",primaryTableName:"",description:"",pkField:"",valField:"",assistInfo:"",assistInfoArr:[],serviceTagIds:[],businessLabel:"",mainDimensionId:""},dsTypeOptions:[{name:"mysql"},{name:"hive"},{name:"clickhouse"}],dsOptions:[],tableOptions:[],pkOptions:[],foreignKeyOptions:[],mainDimensionList:[],rules:{name:[{required:!0,message:"请输入维度名",trigger:"blur"}],aliasName:[{required:!0,message:"请输入英文别名",trigger:"blur"}],dataSource:[{required:!0,message:"请选择数据源",trigger:"blur"}],primaryTableId:[{required:!0,message:"请学则维度主表",trigger:"blur"}],pkField:[{required:!0,message:"请选择维度主键",trigger:"blur"}],valField:[{required:!0,message:"请选择维度值字段",trigger:"blur"}]},facTableForm:{tableType:"",factTable:"",foreignKey:""},factTableOptions:[],factRelationList:[],fromDictionary:!1,mainDimensionVisible:!1}},computed:{getMainDimensionName:function(){var e=this.dimensionForm.mainDimensionId,t="";return this.mainDimensionList.forEach(function(a){a.Id==e&&(console.log(a.Name),t=a.Name)}),t}},methods:{onDeleteFactRelation:function(e){var t=this,a={dfid:e.dfid};this.$confirm("确定删除这个事实表关系吗",{confirmButtonText:"删除",cancelButtonText:"取消"}).then(function(){ns.post("/indicator/dimension/postDimFactRelation",a,{responseType:"json"}).then(function(e){e.data.Res?(t.$notify({message:"删除成功",type:"success"}),t.$refs.facTableForm.resetFields(),t.getFactRelationByDimId()):t.$notify({message:e.data.Info,type:"error"})}).catch(function(e){console.log(e)})})},getFactRelationByDimId:function(){var e="/indicator/dimension/getDimFactRelations/"+this.dimensionForm.id,t=this;ns.get(e).then(function(e){t.$nextTick(function(){t.factRelationList=e.data.data})}).catch(function(e){console.log(e)})},postFactRelation:function(){var e=this;if(console.log("id为"+this.dimensionForm.id),""!==this.dimensionForm.id&&void 0!==this.dimensionForm.id&&null!==this.dimensionForm.id&&0!=this.dimensionForm.id){var t={dimId:this.dimensionForm.id,factId:this.facTableForm.factTable,foreignKey:this.facTableForm.foreignKey};ns.post("/indicator/dimension/postDimFactRelation",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$notify({message:"更新成功",type:"success"}),e.getFactRelationByDimId()):e.$notify({message:t.data.Info,type:"error"})}).catch(function(e){console.log(e)})}else this.$alert("请先提交维度主表配置")},onChangeFactTable:function(){var e=this,t={tableId:e.facTableForm.factTable+"",version:"latest"};ns.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.foreignKeyOptions=t.data.dataList,e.foreignKeyOptions.map(function(e){return e.fieldName}).indexOf(e.dimensionForm.pkField)>-1?e.facTableForm.foreignKey=e.dimensionForm.pkField:e.facTableForm.foreignKey=""}).catch(function(e){console.log(e)})},genTableIdentifier:function(e,t){return e+"."+t},onChangeFactType:function(){var e=this.facTableForm.tableType;this.facTableForm.factTable="",this.foreignKeyOptions=[];var t=this,a={curPage:"1",pageSize:"9999",table_type:e};ns.post("metaData/getTableByConditions",a,{responseType:"json"}).then(function(e){t.factTableOptions=e.data.data}).catch(function(e){console.log(e)})},onEditDimension:function(e){var t=this;this.$nextTick(function(){console.log(e),t.dimensionForm.id=e.id,t.dimensionForm.name=e.name,t.dimensionForm.aliasName=e.aliasName,t.dimensionForm.dataSourceType=e.data_source_type,t.dimensionForm.valField=e.val_field,t.getFactRelationByDimId(),t.dimensionForm.dataSource=e.primary_table_data_source,t.dimensionForm.primaryTableId=e.primary_table_id,t.dimensionForm.primaryTableName=e.primary_table_name,t.dimensionForm.mainDimensionId=e.mainDimensionId,t.dimensionForm.pkField=e.pk_field,t.dimensionForm.description=e.description,""!==e.assist_info&&(t.dimensionForm.assistInfoArr=e.assist_info.split(",")),""!==e.business_label&&(t.dimensionForm.serviceTagIds=e.business_label.split(","))})},onCreateDimension:function(){var e=this;console.log(this.dimensionForm);var t=this;this.$refs.dimensionForm.validate(function(a){a&&(e.dimensionForm.businessLabel=e.dimensionForm.serviceTagIds.join(","),e.dimensionForm.assistInfo=e.dimensionForm.assistInfoArr.join(","),ns.post("/indicator/dimension/postNew",e.dimensionForm,{responseType:"json"}).then(function(e){e.data.Res?(t.$message({type:"success",message:"创建成功"}),t.dimensionForm.id=parseInt(e.data.Info)):t.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)}))})},browseTableInfo:function(e){var t={tableId:e};sessionStorage.setItem("metaData_table_id",S()(t)),Ss.push({path:"tableInfo"})},onMainDimensionChange:function(e){var t=this;this.$confirm('确认选择<span style="color:red">'+e.Name+"</span>作为主维度吗?","注意",{distinguishCancelAndClose:!0,dangerouslyUseHTMLString:!0,confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){t.mainDimensionVisible=!1,t.dimensionForm.mainDimensionId=e.Id})},onChangeDataSource:function(){var e=this;console.log(this.dimensionForm.dataSource);var t={dsType:this.dimensionForm.dataSourceType,dsId:this.dimensionForm.dataSource+""};ns.post("/dw/meta/get",t,{responseType:"json"}).then(function(t){var a=[];t.data.children.forEach(function(e){try{e.children.forEach(function(e){a.push({tableId:e.tid,tableName:e.tableName})})}catch(e){console.log(e)}}),e.tableOptions=a}).catch(function(e){console.log(e)})},onChangeTableName:function(){var e=this;this.findTableNameInOptions();var t={tableId:e.dimensionForm.primaryTableId+"",version:"latest"};ns.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.pkOptions=t.data.dataList,e.pkOptions=t.data.dataList}).catch(function(e){console.log(e)})},findTableNameInOptions:function(){var e=this,t=this.dimensionForm.primaryTableId;this.tableOptions.forEach(function(a){a.tableId==t&&(e.dimensionForm.primaryTableName=a.tableName)})},getAllServiceTag:function(e){var t=this;ns.get("/indicator/serviceTag/getAll").then(function(a){var o=[];a.data.data.forEach(function(e){o.push({tagName:e.tag_name,tid:e.tid+""}),t.serviceTagMap[e.tid]=e.tag_name}),t.serviceTagList=o,console.log(t.serviceTagMap),null!==e&&void 0!==e&&""!==e&&e()}).catch(function(e){console.log(e)})},getDimensionById:function(e){var t=this,a={originId:e+"",assetType:"dimension"};this.fromDictionary=!0,ns.post("/indicator/dictionary/searchById",a,{responseType:"json"}).then(function(e){var a={id:e.data.Id,name:e.data.Name,aliasName:e.data.AliasName,data_source_type:e.data.DataSourceType,primary_table_data_source:e.data.PrimaryTableDataSource,primary_table_id:e.data.PrimaryTableId,primary_table_name:e.data.PrimaryTableName,pk_field:e.data.PkField,val_field:e.data.ValField,assist_info:e.data.AssistInfo,business_label:e.data.BusinessLabel,description:e.data.Description,mainDimensionId:e.data.MainDimensionId};t.onEditDimension(a)}).catch(function(e){console.log(e)})},getAllMainDimension:function(){var e=this;ns.get("/indicator/dimension/getAllMainDimension").then(function(t){e.mainDimensionList=t.data}).catch(function(e){console.log(e)})}},mounted:function(){var e=sessionStorage.getItem("dimensionId");this.isCheck="true"===sessionStorage.getItem("dimensionCreate"),sessionStorage.removeItem("dimensionCreate"),console.log("收到的dimensionId: "+e),this.getAllServiceTag(),null!==e&&void 0!==e&&""!==e&&this.getDimensionById(e),this.getAllMainDimension()}},ls={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("div",[a("h3",{staticStyle:{"margin-bottom":"0px","margin-top":"5px"}},[e._v("衍生维度配置")]),e._v(" "),a("el-row",{staticStyle:{"margin-top":"10px",width:"100%"}},[a("el-form",{ref:"dimensionForm",attrs:{model:e.dimensionForm,"label-width":"110px",rules:e.rules}},[a("el-row",[a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"中文名称:",prop:"name"}},[a("el-input",{attrs:{size:"small"},model:{value:e.dimensionForm.name,callback:function(t){e.$set(e.dimensionForm,"name",t)},expression:"dimensionForm.name"}})],1),e._v(" "),a("el-form-item",{staticStyle:{display:"inline-block",width:"30%"},attrs:{label:"英文名称:",prop:"aliasName"}},[a("el-input",{attrs:{size:"small"},model:{value:e.dimensionForm.aliasName,callback:function(t){e.$set(e.dimensionForm,"aliasName",t)},expression:"dimensionForm.aliasName"}})],1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"60%"},attrs:{label:"主维度选择",prop:"mainDimension"}},[a("el-input",{staticStyle:{width:"400px"},attrs:{readonly:"readonly",size:"small"},model:{value:e.getMainDimensionName,callback:function(t){e.getMainDimensionName=t},expression:"getMainDimensionName"}}),e._v(" "),a("el-button",{attrs:{size:"small",type:"primary",plain:""},on:{click:function(t){e.mainDimensionVisible=!0}}},[e._v("选择主维度")])],1),e._v(" "),a("el-form-item",{staticStyle:{width:"70%"},attrs:{label:"维度描述:",prop:"description"}},[a("el-input",{staticStyle:{width:"100%"},attrs:{type:"textarea",autosize:{minRows:2,maxRows:3}},model:{value:e.dimensionForm.description,callback:function(t){e.$set(e.dimensionForm,"description",t)},expression:"dimensionForm.description"}})],1),e._v(" "),a("el-form-item",{staticStyle:{width:"70%"},attrs:{label:"业务标签:",prop:"serviceTagIds"}},[a("el-select",{staticStyle:{width:"100%"},attrs:{multiple:"",filterable:"",placeholder:"请选择",size:"small"},model:{value:e.dimensionForm.serviceTagIds,callback:function(t){e.$set(e.dimensionForm,"serviceTagIds",t)},expression:"dimensionForm.serviceTagIds"}},e._l(e.serviceTagList,function(e){return a("el-option",{key:e.tid,attrs:{label:e.tagName,value:e.tid}})}),1)],1),e._v(" "),a("el-form-item",{staticStyle:{width:"70%"}},[a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"primary"},on:{click:e.onCreateDimension}},[e._v("提交")]),e._v(" "),a("el-button",{attrs:{size:"small"},on:{click:function(t){return e.$router.back(-1)}}},[e._v("返回")])],1)],1)],1)],1),e._v(" "),a("h3",{staticStyle:{"margin-bottom":"10px","margin-top":"5px",display:"inline-block"}},[e._v("关联事实表配置")]),e._v(" "),a("el-tooltip",{staticClass:"item",attrs:{effect:"dark",content:"事实表外键与维度表主键相同则符合规范",placement:"top-start"}},[a("el-button",{staticStyle:{color:"#E6A23C","font-size":"16px"},attrs:{icon:"el-icon-question",type:"text"}})],1),e._v(" "),a("el-form",{ref:"facTableForm",attrs:{model:e.facTableForm,inline:!0,"label-width":"100px"}},[a("el-form-item",{attrs:{label:"事实表:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表类型",size:"small"},on:{change:e.onChangeFactType},model:{value:e.facTableForm.tableType,callback:function(t){e.$set(e.facTableForm,"tableType",t)},expression:"facTableForm.tableType"}},e._l(e.dsTypeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1),e._v(" "),a("i",{staticClass:"el-icon-right"}),e._v(" "),a("el-select",{attrs:{placeholder:"请选择事实表",filterable:"",size:"small",clearable:""},on:{change:e.onChangeFactTable},model:{value:e.facTableForm.factTable,callback:function(t){e.$set(e.facTableForm,"factTable",t)},expression:"facTableForm.factTable"}},e._l(e.factTableOptions,function(t){return a("el-option",{key:t.tid,attrs:{label:e.genTableIdentifier(t.database_name,t.table_name),value:t.tid}})}),1)],1),e._v(" "),a("el-form-item",{attrs:{label:"关联外键:"}},[a("el-select",{attrs:{filterable:"",placeholder:"请选择事实表的关联外键",size:"small",clearable:""},model:{value:e.facTableForm.foreignKey,callback:function(t){e.$set(e.facTableForm,"foreignKey",t)},expression:"facTableForm.foreignKey"}},e._l(e.foreignKeyOptions,function(e){return a("el-option",{key:e.fieldName,attrs:{label:e.fieldName,value:e.fieldName}})}),1)],1),e._v(" "),a("el-form-item",[a("el-button",{directives:[{name:"show",rawName:"v-show",value:!e.isCheck,expression:"!isCheck"}],attrs:{size:"small",type:"success"},on:{click:e.postFactRelation}},[e._v("提交")])],1)],1),e._v(" "),a("el-table",{staticStyle:{width:"85%","margin-left":"30px"},attrs:{data:e.factRelationList,stripe:"",border:!0}},[a("el-table-column",{key:"fact_database",attrs:{prop:"fact_database",label:"事实表库"}}),e._v(" "),a("el-table-column",{key:"fac_table_name",attrs:{prop:"fac_table_name",label:"事实表名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",{staticStyle:{cursor:"pointer","text-decoration":"underline"},on:{click:function(a){return e.browseTableInfo(t.row.fact_id)}}},[e._v(e._s(t.row.fac_table_name))])]}}])}),e._v(" "),a("el-table-column",{key:"foreign_key",attrs:{prop:"foreign_key",label:"关联外键"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("span",[e._v(e._s(t.row.foreign_key))])]}}])}),e._v(" "),a("el-table-column",{key:"foreign_key",attrs:{prop:"foreign_key_valid",label:"规范符合",width:"200",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.foreign_key===e.dimensionForm.aliasName?a("el-button",{staticStyle:{color:"green","font-size":"22px"},attrs:{icon:"el-icon-s-flag",type:"text"}}):a("el-button",{staticStyle:{color:"red","font-size":"22px"},attrs:{icon:"el-icon-warning",type:"text"}})]}}])}),e._v(" "),a("el-table-column",{key:"operate",attrs:{prop:"operate",label:"操作",width:"100px",align:"center"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{icon:"el-icon-delete",type:"text"},on:{click:function(a){return e.onDeleteFactRelation(t.row)}}})]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"选择主维度",visible:e.mainDimensionVisible},on:{"update:visible":function(t){e.mainDimensionVisible=t}}},[a("div",{staticStyle:{"max-height":"500px",overflow:"auto"}},[a("el-table",{ref:"mainDimensionTable",staticStyle:{width:"100%"},attrs:{data:e.mainDimensionList,"highlight-current-row":""},on:{"current-change":e.onMainDimensionChange}},[a("el-table-column",{attrs:{type:"index"}}),e._v(" "),a("el-table-column",{attrs:{property:"Name",label:"维度名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"AliasName",label:"英文名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"Description",label:"描述"}})],1)],1)])],1)},staticRenderFns:[]};var rs=a("VU/8")(is,ls,!1,function(e){a("m4JD")},"data-v-64dd9df7",null).exports,cs=a("mtWM"),ds={data:function(){return{redashData:[],redashURL:"",dashboardIndex:"",dashboardName:"",dashboardURL:"",dashboardRefresh:120,newLid:-1,privilegeRoles:[],roleOptions:[],parentNode:"数据图表",modifyNewName:"",modifyStatus:!1,modifyIdx:-1,showURl:!1,assignUserVisible:!1,assignIndex:"",assignUserName:"",treeData:"",datasource:{selectValue:"",options:[],mysqlOptions:[],typeOptions:[{name:"mysql"},{name:"clickhouse"}],typeSelectValue:""},defaultProps:{children:"children",label:"label"},explorerTable:{tableId:"",tableName:""},exploreTableName:"",date_pianyi_1:!1,encode_options:[{value:"UTF8",label:"UTF8"},{value:"LATIN1",label:"LATIN1"}],encode_value:"LATIN1",lvpi_name:""}},methods:{JumpDashBoard:function(e,t,a){this.$router.push({name:"dashboardshow",params:{dashboardname:t,dashboardUrl:a}})},GetAllDashboard:function(){var e=this;cs.get("/redash/dashboardall").then(function(t){var a=[];t.data.forEach(function(e){console.log(e),a.push(e)}),e.redashData=a,console.log("------------------"),console.log(e.redashData)}).catch(function(e){console.log(e)})},ModifyDashBoard:function(e,t,a){1!=this.modifyStatus?(this.modifyNewName=a,this.modifyStatus=!0,this.modifyIdx=e):this.$message({message:"正在编辑...",type:"error"})},UpdateDashBoard:function(e,t){var a=this,o={dashboardIndex:t,dashboardName:this.modifyNewName};console.log("begin update this dashboard : "+t),cs.post("/redash/dashboardupdate",o,{responseType:"json"}).then(function(e){a.$message({message:"更新成功！",type:"success"}),a.CancelUpdate(),a.GetAllDashboard()}).catch(function(e){a.$message({message:"更新失败！"+e.toString(),type:"error"})})},CancelUpdate:function(){this.modifyNewName="",this.modifyStatus=!1,this.modifyIdx=-1},DeleteDashBoard:function(e,t){var a=this,o={dashboardIndex:t};0!=confirm("确定删除吗?")&&(console.log("begin delete this redash : "+t),cs.post("/redash/dashboarddel",o,{responseType:"json"}).then(function(t){a.$message({message:"删除成功！",type:"success"}),a.GetAllDashboard(),a.redashData.splice(e,1),console.log(a.redashData)}).catch(function(e){a.$message({message:"删除失败！"+e.toString(),type:"error"})}))},assignUser:function(e){console.log(e),this.assignUserVisible=!0,this.assignIndex=e.index},onClickAssign:function(){var e={assignUserName:this.assignUserName,assignIndex:this.assignIndex,assignType:"dashboard"};console.log(e);var t=this;cs.post("/redash/user_change",e,{responseType:"json"}).then(function(e){var a=e.data;a.Res?(t.$message({message:"指派成功",type:"success"}),t.GetAllDashboard()):t.$message({message:a.Info,type:"error"})}).catch(function(e){console.error(e)}),this.assignUserVisible=!1},onChangeDSType:function(){var e=this;this.treeData="",cs.get("/dw/GetConnByPrivilege/"+this.datasource.typeSelectValue).then(function(t){e.datasource.selectValue="",e.datasource.options=t.data,e.datasource.selectValue=e.datasource.options[0].Dsid,e.onChangeDataSource()}).catch(function(t){e.datasource.selectValue="",e.datasource.options=[],console.log(t)})},onChangeDataSource:function(){var e=this.datasource.typeSelectValue,t=this.datasource.selectValue,a=this;console.log(e+":"+t);var o={dsType:e,dsId:t+""};cs.post("/dw/meta/get",o,{responseType:"json"}).then(function(e){a.treeData=e.data.children}).catch(function(e){console.log(e)})},onClickTree:function(e){""!==e.tableName&&(this.explorerTable.tableName=e.label,this.explorerTable.tableId=e.tid,this.exploreTableName=e.tableName)},onCreateSqlView:function(){var e=this;if(console.log(e.exploreTableName),""!==e.exploreTableName)if(""!==e.lvpi_name.trim()){for(var t=new URLSearchParams,a="",o=0;o<e.datasource.options.length;o++){var s=e.datasource.options[o];e.datasource.selectValue==s.Dsid&&(a=s.DatasourceName.split("(")[0])}console.log(a),console.log(e.explorerTable),console.log("1232222222222222222222222"),t.append("tablename",e.exploreTableName),t.append("tableid",e.explorerTable.tableId),t.append("encode",this.encode_value),t.append("date_pianyi",this.date_pianyi_1),t.append("sqlType",this.datasource.typeSelectValue),t.append("dsId",this.datasource.selectValue),t.append("name",e.lvpi_name),e.$message({type:"info",message:"绿皮创建中..."}),cs.post("/jdbc/sql/createLvpiView",t,{responseType:"json"}).then(function(t){if(t.data.msg.indexOf("成功")>=0){e.curRedashQueryId=t.data.redash_query_id;var a="http://inner-redash.adtech.sogou/queries/"+e.curRedashQueryId+"/";e.$router.push({name:"redashqueryshow",params:{queryid:e.curRedashQueryId,queryUrl:a}})}else e.$message({type:"error",message:t.data.msg})}).catch(function(e){console.log(e)})}else e.$message({type:"error",message:"请输入绿皮名称!"});else e.$message({type:"error",message:"请点击表名文字选中表!"})}},created:function(){var e=this;cs.get("/redash/timestamp").then(function(t){e.timestamp=t.data,e.sec186=3*(e.timestamp+7482952),Object(r.m)("sec186",e.sec186.toString(),1)}).catch(function(e){console.log(e)}),cs.get("/redash/write_access").then(function(t){e.showURl=t.data.dashboard_write}).catch(function(e){console.log(e)}),this.GetAllDashboard()},mounted:function(){console.log("mounted")}},us={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("新增绿皮")]),e._v(" "),a("el-form",{ref:"form"},[a("el-row",{staticStyle:{"margin-bottom":"-10px"}},[a("el-form-item",{attrs:{prop:"name"}},[a("el-col",{attrs:{span:4}},[a("div",{staticStyle:{"margin-left":"5px"}},[a("el-select",{attrs:{placeholder:"请选择数据源类型",size:"small",clearable:"",filterable:""},on:{change:e.onChangeDSType},model:{value:e.datasource.typeSelectValue,callback:function(t){e.$set(e.datasource,"typeSelectValue",t)},expression:"datasource.typeSelectValue"}},e._l(e.datasource.typeOptions,function(e){return a("el-option",{key:e.name,attrs:{label:e.name,value:e.name}})}),1)],1)]),e._v(" "),a("el-col",{attrs:{span:6,offset:1}},[a("el-select",{attrs:{placeholder:"请选择数据源",size:"small",clearable:"",filterable:""},on:{change:e.onChangeDataSource},model:{value:e.datasource.selectValue,callback:function(t){e.$set(e.datasource,"selectValue",t)},expression:"datasource.selectValue"}},e._l(e.datasource.options,function(e){return a("el-option",{key:e.dsid,attrs:{label:e.DatasourceName,value:e.Dsid}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:6}},[a("span",[e._v("编码")]),e._v(" "),a("el-select",{attrs:{placeholder:"编码"},model:{value:e.encode_value,callback:function(t){e.encode_value=t},expression:"encode_value"}},e._l(e.encode_options,function(e){return a("el-option",{key:e.value,attrs:{label:e.label,value:e.value}})}),1)],1),e._v(" "),a("el-col",{attrs:{span:4}},[a("el-checkbox",{model:{value:e.date_pianyi_1,callback:function(t){e.date_pianyi_1=t},expression:"date_pianyi_1"}},[e._v("日期偏移+1")])],1)],1)],1),e._v(" "),a("el-row",{staticStyle:{"margin-bottom":"50px"}},[a("el-tree",{ref:"tree",attrs:{data:e.treeData,props:e.defaultProps},scopedSlots:e._u([{key:"default",fn:function(t){var o=t.node,s=t.data;return a("span",{staticClass:"el-tree-node__content"},[a("span",{on:{click:function(t){return e.onClickTree(s)}}},[e._v(e._s(o.label))])])}}])})],1),e._v(" "),a("el-row",{staticStyle:{"margin-left":"40%"}},[a("span",[e._v("绿皮名称")]),e._v(" "),a("el-input",{staticStyle:{width:"300px"},attrs:{size:"big"},model:{value:e.lvpi_name,callback:function(t){e.lvpi_name=t},expression:"lvpi_name"}}),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateSqlView()}}},[e._v("创建绿皮")])],1)],1)],1)},staticRenderFns:[]},ps=a("VU/8")(ds,us,!1,null,null,null).exports,ms=a("lHA8"),fs=a.n(ms),hs=a("mtWM"),vs={data:function(){return{newRoleName:"",rolesData:[],curRole:"",bodongTreeVisible:!1,curCheckedIds:[],expandTreeId:Oa()({length:1e3},function(e,t){return 1000001+t}),type:"read",treeDefaultProps:{children:"children",label:"label"},demoData:[]}},methods:{handleFirstLevelCheck:function(e,t,a){if(0===e.pid){var o=[];if(t){void 0!==e.children&&e.children.forEach(function(e){o.push(e.menuId)});var s=new fs.a(o);s.add(e.menuId),this.curCheckedIds.forEach(function(e){s.add(e)}),this.$refs.bodongTree.setCheckedKeys(Oa()(s))}}console.log(e),console.log(t),console.log(a)},closeTree:function(){this.curCheckedIds=[]},onCreateRole:function(){var e=this,t={role:this.newRoleName};hs.post("/auth/roles/addRole",t,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({message:"创建成功！",type:"success"}),e.initGetRoles()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},updateBodongMapping:function(){var e=this.$refs.bodongTree.getCheckedNodes(),t=this.curRole,a=new fs.a;e.forEach(function(e){a.add(e.menuId),0!==e.pid&&a.add(e.pid)}),this.curCheckedIds=Oa()(a),console.log(a);var o=this,s={role:t,ids:this.curCheckedIds.join(",")};console.log(s),hs.post("/auth/bodong/UpdateCheckedBodongNode",s,{responseType:"json"}).then(function(e){e.data.Res?(o.$message({type:"success",message:"波动图表权限更新成功!"}),o.bodongTreeVisible=!1):o.$message({type:"error",message:e.data.Info})}).catch(function(e){console.log(e)})},getCheckedBodongMenu:function(e){var t=this;this.curRole=e,this.bodongTreeVisible=!0,hs.get("/auth/bodong/GetAllBodongTree").then(function(e){t.demoData=e.data}).catch(function(e){console.log(e)}),this.setCheckedKeys()},setCheckedKeys:function(){var e=this;hs.get("/auth/bodong/GetCheckedBodongNode?role="+this.curRole).then(function(t){e.$refs.bodongTree.setCheckedKeys(t.data)}).catch(function(e){console.log(e)})},initGetRoles:function(){var e=this;hs.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})}},created:function(){var e=this;hs.get("/auth/roles").then(function(t){var a=[];t.data.forEach(function(e){a.push({roleName:e})}),e.rolesData=a}).catch(function(e){console.log(e)})},mounted:function(){console.log("mounted")}},bs={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加新角色")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入角色名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newRoleName,callback:function(t){e.newRoleName=t},expression:"newRoleName"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateRole()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("波动图标权限配置")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.rolesData,stripe:""}},[a("el-table-column",{attrs:{prop:"roleName",label:"角色名称"}}),e._v(" "),a("el-table-column",{attrs:{label:"数据源权限"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getCheckedBodongMenu(t.row.roleName,"read")}}},[e._v("查询权限\n          ")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"表级查询权限配置",visible:e.bodongTreeVisible},on:{"update:visible":function(t){e.bodongTreeVisible=t}}},[a("el-row",[a("div",{staticStyle:{height:"500px","max-height":"500px",overflow:"auto"}},[a("el-tree",{ref:"bodongTree",attrs:{data:e.demoData,"show-checkbox":"","node-key":"menuId","default-expand-all":"","check-strictly":!0,"default-expanded-keys":e.expandTreeId,"default-checked-keys":e.curCheckedIds,props:e.treeDefaultProps},on:{close:e.closeTree}})],1)]),e._v(" "),a("el-row",{attrs:{type:"flex",justify:"end"}},[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateBodongMapping()}}},[e._v("确定")])],1)],1)],1)},staticRenderFns:[]},gs=a("VU/8")(vs,bs,!1,null,null,null).exports,ys=a("mtWM"),_s={data:function(){return{newDomainAdministrator:"",newDomainName:"",curDomain:"",domainData:[],labelPTitleToPidPM:{},renameAdministratorVisible:!1,onRenameAdministratorName:"",urlData:[],checkedURL:[],curURLGroup:"",writableURL:[],lvpiOptionVisable:!1,curDomainId:""}},methods:{onCreateDomain:function(){var e=this,t={name:this.newDomainName,administrator:this.newDomainAdministrator};ys.post("/auth/lvpiDomain/postFirstDomain",t,{responseType:"json"}).then(function(t){e.$message({message:"创建成功！",type:"success"}),e.initGetDomains()}).catch(function(t){e.$message({message:"创建失败！"+t.toString(),type:"error"})})},onChangeUserWatch:function(e){console.log("输入用户中"),this.$refs.lvpiOptionTable.toggleRowSelection(e,!1),this.$refs.lvpiOptionTable.toggleRowSelection(e,!0)},renameAdministrator:function(e){this.curDomain=e,this.onRenameAdministratorName=e.Administrator,this.renameAdministratorVisible=!0},onRenameAdministrator:function(){var e=this,t={administrator:this.onRenameAdministratorName,did:this.curDomain.Did};ys.post("/auth/lvpiDomain/postAdministrator",t,{responseType:"json"}).then(function(t){e.$message({message:"修改成功！",type:"success"}),e.initGetDomains(),e.renameAdministratorVisible=!1}).catch(function(t){e.$message({message:"修改失败！"+t.toString(),type:"error"})})},getCheckedURL:function(e,t){var a=this;a.curURLGroup=t+"("+e+")",a.curDomainId=e,a.lvpiOptionVisable=!0;try{a.$refs.lvpiOptionTable.clearSelection()}catch(e){console.log(e)}ys.get(Object(r.j)("/getLvpis/")).then(function(t){var o={};for(var s in t.data.forEach(function(e){o[e.Did]=e}),o)for(var n=o[s],i=0;i<a.lvpiOptions.length;i++)a.lvpiOptions[i].lid==n.Lid&&(a.lvpiOptions[i].userCanWatch=n.UserCanWatch,a.lvpiOptions[i].pid=o[n.Pid].Name,a.lvpiOptions[i].valid=n.Valid,n.Pid==e&&a.$refs.lvpiOptionTable.toggleRowSelection(a.lvpiOptions[i]));console.log(a.lvpiOptions)}).catch(function(e){console.error(e)})},toggleSelection:function(e){this.$nextTick(function(){var t=this;e?e.forEach(function(e){t.$refs.lvpiOptionTable.toggleRowSelection(e)}):this.$refs.lvpiOptionTable.clearSelection()})},updateLvpiChecked:function(){console.log("已选中lvpi:");var e=this,t=this.checkedURL;console.log(this.checkedURL),ys.post(Object(r.j)("/postSecondLvpi"),t).then(function(t){e.lvpiOptionVisable=!1,e.$message("修改成功"),e.toggleSelection()}).catch(function(e){console.error(e)})},handleLvpiSelectionChange:function(e){var t=this,a=[];e.forEach(function(e){var o={lid:e.lid,pid:t.curDomainId,name:e.title,index:e.index,info:e.info,userCanWatch:e.userCanWatch,valid:e.valid};a.push(o)}),this.checkedURL=a},initGetDomains:function(){var e=this;ys.get(Object(r.j)("/getAllDomain")).then(function(t){e.domainData=t.data,console.log(e.domainData)}).catch(function(e){console.log(e)})},changeCountPM:function(e){console.log(e);var t={labelId:e.labelId+"",sortId:e.sortId+""},a=this;ys.post("/auth/label/updateSortId",t,{responseType:"json"}).then(function(e){a.$message({message:"排序ID更新成功！",type:"success"})}).catch(function(e){console.log(e)})},UpdateLabelPM:function(e){e.status=!0},CancelUpdateLabelPM:function(e){e.labelTitle2=e.labelTitle,e.labelClass2=e.labelClass,e.labelPid2=e.labelPid,e.labelPTitle2=e.labelPTitle,e.status=!1},choosePidTitlePM:function(e){e.labelPid2=this.labelPTitleToPidPM[e.labelPTitle2]},SaveLabelPM:function(e){console.log(e);e.labelId;var t=this;if(e.labelTitle2!=e.labelTitle||e.labelClass2!=e.labelClass||e.labelPid2!=e.labelPid){var a={lid:e.labelId.toString(),title:e.labelTitle2,class:e.labelClass2,pid:e.labelPid2.toString()};console.log(a),ys.post("/auth/labels/pmupdate",a,{responseType:"json"}).then(function(a){e.labelTitle=e.labelTitle2,e.labelClass=e.labelClass2,e.labelPid=e.labelPid2,e.labelPTitle=e.labelPTitle2,e.status=!1,t.$message({type:"success",message:"更新成功!"}),console.info(a.data)}).catch(function(e){console.log(e)})}else t.$message({type:"success",message:"修改前后未变化!"})},getAllLvpi:function(){var e=this;ys.get("/redash/redashall").then(function(t){var a=[];t.data.forEach(function(e){a.push({lid:e.lid,pid:"",title:e.title,index:e.index,info:e.info,userCanWatch:"",valid:""})}),e.lvpiOptions=a}).catch(function(e){console.log(e)})}},created:function(){console.log("mounted"),this.getAllLvpi(),this.initGetDomains()},mounted:function(){console.log("mounted")}},ws={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("增加一级域")]),e._v(" "),a("el-form",{attrs:{inline:"true","label-width":"120px"}},[a("el-form-item",{attrs:{label:"请输入域名"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newDomainName,callback:function(t){e.newDomainName=t},expression:"newDomainName"}})],1),e._v(" "),a("br"),e._v(" "),a("el-form-item",{staticStyle:{"margin-top":"-20px"},attrs:{label:"管理员(逗号分隔)"}},[a("el-input",{attrs:{size:"small"},model:{value:e.newDomainAdministrator,callback:function(t){e.newDomainAdministrator=t},expression:"newDomainAdministrator"}})],1),e._v(" "),a("el-form-item",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onCreateDomain()}}},[e._v("创建")])],1)],1),e._v(" "),a("h3",[e._v("配置域名管理员")]),e._v(" "),a("el-row",[a("el-table",{staticStyle:{width:"100%"},attrs:{data:e.domainData,stripe:""}},[a("el-table-column",{attrs:{prop:"Name",label:"域名"}}),e._v(" "),a("el-table-column",{attrs:{label:"用户操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.renameAdministrator(t.row)}}},[e._v("修改管理员")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"绿皮配置"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.getCheckedURL(t.row.Did,t.row.Name)}}},[e._v("查看包含绿皮")])]}}])})],1)],1),e._v(" "),a("el-dialog",{attrs:{title:e.curURLGroup+" 域包含的绿皮配置",visible:e.lvpiOptionVisable},on:{"update:visible":function(t){e.lvpiOptionVisable=t}}},[a("el-row",[a("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[a("el-table",{ref:"lvpiOptionTable",attrs:{data:e.lvpiOptions,"row-key":"Lid"},on:{"selection-change":e.handleLvpiSelectionChange}},[a("el-table-column",{attrs:{property:"title",label:"图表名称"}}),e._v(" "),a("el-table-column",{attrs:{property:"pid",label:"图表所属域"}}),e._v(" "),a("el-table-column",{staticStyle:{width:"80%"},attrs:{prop:"userCanWatch",label:"请输入有权查看的用户"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-input",{attrs:{size:"small"},on:{input:function(a){return e.onChangeUserWatch(t.row)}},model:{value:t.row.userCanWatch,callback:function(a){e.$set(t.row,"userCanWatch",a)},expression:"scope.row.userCanWatch"}})]}}])}),e._v(" "),a("el-table-column",{attrs:{type:"selection",width:"85",label:"请选择"}})],1)],1)]),e._v(" "),a("el-row",[a("el-col",[a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.updateLvpiChecked()}}},[e._v("提交")])],1)],1)],1),e._v(" "),a("el-dialog",{attrs:{title:"修改管理员",visible:e.renameAdministratorVisible},on:{"update:visible":function(t){e.renameAdministratorVisible=t}}},[a("el-row",[a("span",[e._v(e._s(e.curDomain.Did)+"-"+e._s(e.curDomain.Name)+"的管理员")]),e._v(" "),a("br")]),e._v(" "),a("el-row",[a("el-col",{attrs:{span:16}},[a("el-input",{attrs:{placeholder:"请输入添加的用户名",size:"mini"},model:{value:e.onRenameAdministratorName,callback:function(t){e.onRenameAdministratorName=t},expression:"onRenameAdministratorName"}}),e._v(" "),a("span",{staticStyle:{"margin-top":"-20px",color:"red"}},[e._v("管理员用逗号分隔")])],1),e._v(" "),a("el-col",{attrs:{span:2,offset:1}},[a("el-button",{attrs:{type:"success",size:"mini"},on:{click:function(t){return e.onRenameAdministrator()}}},[e._v("修改")])],1)],1)],1)],1)},staticRenderFns:[]},ks=a("VU/8")(_s,ws,!1,null,null,null).exports,xs=a("mtWM"),Is={data:function(){return{labelData:[],newAdStyleId:"",newFirstStyleName:"",newSecondStyleName:"",newThirdStyleName:""}},methods:{onAddLabel:function(){var e=this,t={AdStyleId:parseInt(this.newAdStyleId),ThirdStyleName:this.newThirdStyleName,SecondStyleName:this.newSecondStyleName,FirstStyleName:this.newFirstStyleName};xs.post("/single/addDim",t,{responseType:"json"}).then(function(t){e.$message({type:"success",message:"添加成功"}),e.initTable(),e.newAdStyleId="",e.newFirstStyleName="",e.newSecondStyleName="",e.newThirdStyleName=""}).catch(function(e){console.log(e)})},UpdateLabel:function(e){console.log("更改状态"+e.status),e.status=!0},CancelUpdateLabel:function(e){e.AdStyleId2=e.AdStyleId,e.FirstStyleName2=e.FirstStyleName,e.SecondStyleName2=e.SecondStyleName,e.ThirdStyleName2=e.ThirdStyleName,e.status=!1},DelLabel:function(e){var t=this;xs.get("/single/delDim/"+e.Id,{responseType:"json"}).then(function(a){e.status=!1,t.$message({type:"success",message:"删除成功!"}),console.info(a.data),t.initTable()}).catch(function(e){console.log(e)})},SaveLabel:function(e){var t=this,a={Id:e.Id,AdStyleId:parseInt(e.AdStyleId2),FirstStyleName:e.FirstStyleName2,SecondStyleName:e.SecondStyleName2,ThirdStyleName:e.ThirdStyleName2};xs.post("/single/updateDim",a,{responseType:"json"}).then(function(a){e.status=!1,t.$message({type:"success",message:"更新成功!"}),console.info(a.data),t.initTable()}).catch(function(e){console.log(e)})},initTable:function(){var e=this;xs.get("/single/getDims").then(function(t){e.labelData=t.data;var a=[];t.data.forEach(function(e){a.push({Id:e.Id,AdStyleId:e.AdStyleId,FirstStyleName:e.FirstStyleName,SecondStyleName:e.SecondStyleName,ThirdStyleName:e.ThirdStyleName,AdStyleId2:e.AdStyleId,FirstStyleName2:e.FirstStyleName,SecondStyleName2:e.SecondStyleName,ThirdStyleName2:e.ThirdStyleName,status:!1})}),e.labelData=a}).catch(function(e){console.log(e)})}},created:function(){this.initTable()},mounted:function(){console.log("mounted")}},Ts={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",[a("h3",[e._v("新增dim")]),e._v(" "),a("el-form",{attrs:{"label-width":"150px"}},[a("el-form-item",{attrs:{label:"广告样式ID"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newAdStyleId,callback:function(t){e.newAdStyleId=t},expression:"newAdStyleId"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{label:"一级广告样式名称"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newFirstStyleName,callback:function(t){e.newFirstStyleName=t},expression:"newFirstStyleName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{inline:"true",label:"二级广告样式名称"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newSecondStyleName,callback:function(t){e.newSecondStyleName=t},expression:"newSecondStyleName"}})],1)],1),e._v(" "),a("el-form-item",{attrs:{inline:"true",label:"三级广告样式名称"}},[a("el-col",{attrs:{span:8}},[a("el-input",{attrs:{size:"small"},model:{value:e.newThirdStyleName,callback:function(t){e.newThirdStyleName=t},expression:"newThirdStyleName"}})],1),e._v(" "),a("el-button",{attrs:{type:"primary",size:"small"},on:{click:function(t){return e.onAddLabel()}}},[e._v("添加")])],1)],1),e._v(" "),a("h3",[e._v("配置dim")]),e._v(" "),a("el-row",[a("div",{staticStyle:{"max-height":"600px",overflow:"auto"}},[a("el-table",{ref:"labelTable",attrs:{data:e.labelData,"row-key":"id",stripe:""}},[a("el-table-column",{attrs:{property:"Id",label:"Id"}}),e._v(" "),a("el-table-column",{attrs:{prop:"AdStyleId2",label:"一级广告样式名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.AdStyleId2,callback:function(a){e.$set(t.row,"AdStyleId2",a)},expression:"scope.row.AdStyleId2"}}):a("span",[e._v(e._s(t.row.AdStyleId2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"FirstStyleName2",label:"一级广告样式名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.FirstStyleName2,callback:function(a){e.$set(t.row,"FirstStyleName2",a)},expression:"scope.row.FirstStyleName2"}}):a("span",[e._v(e._s(t.row.FirstStyleName2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"SecondStyleName2",label:"二级广告样式名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.SecondStyleName2,callback:function(a){e.$set(t.row,"SecondStyleName2",a)},expression:"scope.row.SecondStyleName2"}}):a("span",[e._v(e._s(t.row.SecondStyleName2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{prop:"ThirdStyleName2",label:"三级广告样式名称"},scopedSlots:e._u([{key:"default",fn:function(t){return[t.row.status?a("el-input",{model:{value:t.row.ThirdStyleName2,callback:function(a){e.$set(t.row,"ThirdStyleName2",a)},expression:"scope.row.ThirdStyleName2"}}):a("span",[e._v(e._s(t.row.ThirdStyleName2))])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.UpdateLabel(t.row)}}},[e._v("修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.CancelUpdateLabel(t.row)}}},[e._v("放弃修改")])]}}])}),e._v(" "),a("el-table-column",{attrs:{label:"操作"},scopedSlots:e._u([{key:"default",fn:function(t){return[a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.SaveLabel(t.row)}}},[e._v("保存")]),e._v(" "),a("el-button",{attrs:{type:"text",size:"mini"},on:{click:function(a){return e.DelLabel(t.row)}}},[e._v("删除")])]}}])})],1)],1)])],1)},staticRenderFns:[]},Fs=a("VU/8")(Is,Ts,!1,null,null,null).exports;o.default.use(m.a);var Ss=new m.a({routes:[{path:"/",name:"",component:ae,children:[{path:"jdbc",name:"jdbc",component:ot},{path:"sql",name:"sql",component:E},{path:"wap",name:"wap",component:X},{path:"pc",name:"pc",component:de},{path:"wapTotal",name:"wapTotal",component:ie},{path:"pcTotal",name:"pcTotal",component:fe},{path:"gala",name:"gala",component:ge},{path:"que",name:"que",component:H},{path:"role",name:"role",component:_e},{path:"roleuser",name:"roleuser",component:Mt},{path:"roleworksheet",name:"roleworksheet",component:Bt},{path:"rolemetatable",name:"rolemetatable",component:Aa},{path:"roletoplable",name:"roletoplable",component:Jt},{path:"labelpm",name:"labelpm",component:pa},{path:"labelrd",name:"labelrd",component:va},{path:"airflow",name:"airflow",component:Ua},{path:"redashwxrealtimecost",name:"redashwxrealtimecost",component:Kt},{path:"redashinsert",name:"redashinsert",component:ea},{path:"redashdelete",name:"redashdelete",component:ra},{path:"bodonginsert",name:"bodonginsert",component:ea},{path:"bodongdelete",name:"bodongdelete",component:ra},{path:"redashshow/:redashname",name:"redashshow",component:sa},{path:"dashboardoption",name:"dashboardoption",component:Xa},{path:"dashboardshow/:dashboardname",name:"dashboardshow",component:Ga},{path:"redashlvpi",name:"redashlvpi",component:ps},{path:"redashqueryoption",name:"redashqueryoption",component:no},{path:"redashqueryshow",name:"redashqueryshow",component:to},{path:"trans",name:"trans",component:Ie},{path:"abwap",name:"abwap",component:Re},{path:"abpc",name:"abpc",component:Le},{path:"abproject",name:"abproject",component:Ve},{path:"abdata",name:"abdata",component:He},{path:"god",name:"god",component:De},{path:"docedit",name:"docedit",component:Ze},{path:"doc",name:"doc",component:Ye},{path:"tableMetaData",name:"tableMetaData",component:lt},{path:"tableGraph",name:"tableGraph",component:St},{path:"tableInfo",name:"tableInfo",component:Ot},{path:"test",name:"test",component:Et},{path:"dag",name:"dag",component:Ta},{path:"connMetaData",name:"connMetaData",component:Ca},{path:"dagTaskTrace",name:"dagTaskTrace",component:qa},{path:"mobileDashBoard",name:"mobileDashBoard",component:co},{path:"mobileDashBoardShow/:redashname",name:"mobileDashBoardShow",component:fo},{path:"udf",name:"udf",component:go},{path:"serviceLabel",name:"serviceLabel",component:ko},{path:"preIndicator",name:"preIndicator",component:Fo},{path:"preDefineIndicatorCreate",name:"preDefineIndicatorCreate",component:es},{path:"combineIndicator",name:"combineIndicator",component:No},{path:"combineIndicatorCreate",name:"combineIndicatorCreate",component:ss},{path:"dimension",name:"dimension",component:Eo},{path:"dimensionCreate",name:"dimensionCreate",component:Ko},{path:"dimensionCreateDerivative",name:"dimensionCreateDerivative",component:rs},{path:"dictionary",name:"dictionary",component:Mo},{path:"demand/:demandId",name:"demand",component:Bo},{path:"demandList",name:"demandList",component:Jo},{path:"roleMobileBodong",name:"roleMobileBodong",component:gs},{path:"roleDomain",name:"roleDomain",component:ks},{path:"dimsc",name:"dimsc",component:Fs}]},{path:"/403",component:h,name:"",hidden:!1},{path:"/404",component:b,name:"",hidden:!1}]}),Ds=(a("Oq2I"),a("miEh"),a("tvR6"),a("Tqaz")),Cs=(a("9M+g"),a("NjHZ")),Ns=a.n(Cs),Os=(a("UWDK"),a("bT2e"),a("Au9i")),Rs=a.n(Os),$s=(a("d8/S"),a("//Fk")),Es=a.n($s);Z.a.defaults.baseURL="BASE_API_REPLACE",Z.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded",Z.a.interceptors.request.use(function(e){var t=Object(r.e)("_adtech_user"),a=Object(r.e)("_adtech_local_token");return Object(r.k)(),t&&(e.headers.Authorization="Basic "+btoa(t+":"+a)),e},function(e){return Es.a.reject(e)}),Z.a.interceptors.response.use(function(e){return e},function(e){if(e.response)switch(e.response.status){case 403:Ss.replace({path:"/403",query:{redirect:Ss.currentRoute.fullPath}})}return Es.a.reject(e.response.data)});Z.a;var As=a("wvfG"),Ls=a.n(As),Ps={props:{DataAll:{type:Object},each:{type:Object},index:{type:Number}},computed:{svgScale:function(){return sessionStorage.svgScale||1}},data:function(){return{isHover:!1,r_click_menu:!1,menu_style:{position:"absolute",left:"358px",top:"264px"}}},methods:{pathHover:function(){this.isHover=!0},pathOut:function(){this.isHover=!1},click_menu_cover:function(e){this.r_click_menu=!1,e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0},delEdges:function(){var e={id:this.each.id};this.$emit("delEdge",e)},r_click:function(e){console.log(this.svgScale);var t=e.offsetX,a=e.offsetY;this.menu_style=_a()({},this.menu_style,{left:(t-(sessionStorage.svg_left||0))/this.svgScale+"px",top:(a-(sessionStorage.svg_top||0))/this.svgScale+"px"}),this.r_click_menu=!0,e.stopPropagation(),e.preventDefault(),e.cancelBubble=!0},computedLink:function(){var e=void 0,t=void 0,a=void 0,o=void 0;if(this.DataAll){var s=this.each,n=s.dst_input_idx,i=s.dst_node_id,l=s.src_node_id,r=s.src_output_idx,c=this.DataAll.nodes.find(function(e){return e.id===l}),d=this.DataAll.nodes.find(function(e){return e.id===i});return c&&d||alert(l),this.isVertical()?"M "+(e=c.pos_x+180/(c.out_ports.length+1)*(r+1))+" "+(t=c.pos_y+30)+"  Q "+e+" "+(t+50)+" "+((a=d.pos_x+180/(d.in_ports.length+1)*(n+1))+e)/2+" "+((o=d.pos_y)+t)/2+" T "+a+" "+o:"M "+(e=c.pos_x+180)+" "+(t=c.pos_y+15)+"  Q "+(e+30)+" "+t+" "+((a=d.pos_x)+e)/2+" "+((o=d.pos_y+15)+t)/2+" T "+a+" "+o}return"M 0 0 T 0 0"},computedText:function(){if(this.DataAll){var e=this.each,t=e.dst_input_idx,a=e.dst_node_id,o=e.src_node_id,s=e.src_output_idx,n=this.DataAll.nodes.find(function(e){return e.id===o}),i=this.DataAll.nodes.find(function(e){return e.id===a});n||alert(o),i||alert(a);var l=n.pos_x+180/(n.out_ports.length+1)*(s+1),r=n.pos_y+30,c=i.pos_x+180/(i.in_ports.length+1)*(t+1),d=i.pos_y;return ga()({transform:"translate("+(l+c)/2+"px, "+(r+d)/2+"px)",stroke:"#fff"},this.each.textStyle)}return"M 0 0 T 0 0"},computedArrow:function(){if(this.DataAll){var e=this.each,t=e.dst_input_idx,a=e.dst_node_id,o=(e.src_node_id,e.src_output_idx,this.DataAll.nodes.find(function(e){return e.id===a})),s=o.pos_x+180/(o.in_ports.length+1)*(t+1),n=o.pos_y;if(this.isVertical())return s+" "+(n+3)+" "+(s-3)+" "+(n-3)+" "+(s+3)+" "+(n-3);var i=o.pos_x,l=o.pos_y+15;return i-2+" "+(l+3)+" "+(i-3)+" "+(l-3)+" "+(i+3)+" "+(l-1)}return"0,0 0,0 0,0"},computedCx:function(){var e=this.each,t=e.src_node_id,a=e.src_output_idx,o=this.DataAll.nodes.find(function(e){return e.id===t});return""+(this.isVertical()?o.pos_x+180/(o.out_ports.length+1)*(a+1):o.pos_x+180)},computedCy:function(){var e=this.each.src_node_id,t=this.DataAll.nodes.find(function(t){return t.id===e});return""+(this.isVertical()?t.pos_y+30:t.pos_y+15)},isVertical:function(){var e={isVertical:!0},t=localStorage.getItem("GlobalConfig");return t&&t.length>0&&(e=_a()(e,JSON.parse(t))),e.isVertical}},mounted:function(){var e=this;this.$nextTick(function(){e.$refs.edgeText&&console.log(e.$refs.edgeText.style.width)})}},Ms={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return this.DataAll?a("g",[a("path",{class:e.isHover||e.r_click_menu?"connector-hl":e.each.type&&"active"==e.each.type?"connector-active":e.each.type&&"success"==e.each.type?"connector":"defaultArrow",style:e.each.style,attrs:{d:e.computedLink()},on:{mouseover:e.pathHover,mouseout:e.pathOut,contextmenu:function(t){return e.r_click(t)}}}),e._v(" "),e.each.edgesText?a("text",{ref:"edgeText",style:e.computedText()},[e._v(e._s(e.each.edgesText))]):e._e(),e._v(" "),a("polyline",{staticClass:"only-watch-el",staticStyle:{stroke:"#006600"},attrs:{points:e.computedArrow()}}),e._v(" "),a("circle",{staticClass:"only-watch-el",staticStyle:{stroke:"#006600","stroke-width":"2",fill:"#FFFFFF"},attrs:{cx:e.computedCx(),cy:e.computedCy(),r:"5"}}),e._v(" "),e.r_click_menu?a("g",[a("foreignObject",{staticStyle:{position:"relative"},attrs:{width:"100%",height:"100%"},on:{click:function(t){return e.click_menu_cover(t)}}},[a("body",{style:e.menu_style,attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[a("div",{staticClass:"menu_contain"},[a("span",{on:{click:e.delEdges}},[e._v("删除")])])])])],1):e._e()]):e._e()},staticRenderFns:[]};var Us=a("VU/8")(Ps,Ms,!1,function(e){a("AnPN")},"data-v-31775aa8",null).exports,Vs={props:{dragLink:{type:Object}},methods:{dragLinkPath:function(){var e=this.dragLink,t=e.fromX,a=e.fromY,o=e.toX,s=e.toY;return this.isVertical()?"M "+t+" "+a+"  Q "+t+" "+(a+50)+" "+(o+t)/2+" "+(a+s)/2+" T "+o+" "+s:"M "+t+" "+a+" Q "+(t+30)+" "+a+"  "+(o+t)/2+" "+(a+s)/2+" T "+o+" "+s},computedArrow:function(){var e=this.dragLink,t=e.toX,a=e.toY;return this.isVertical()?t+" "+a+" "+(t-3)+" "+(a-6)+" "+(t+3)+" "+(a-6):t-3+" "+(a+3)+" "+t+" "+a+" "+(t-3)+" "+(a-3)},isVertical:function(){var e={isVertical:!0},t=localStorage.getItem("GlobalConfig");return t&&t.length>0&&(e=_a()(e,JSON.parse(t))),e.isVertical}}},js={render:function(){var e=this.$createElement,t=this._self._c||e;return t("g",[t("path",{staticClass:"connector only-watch-el",attrs:{d:this.dragLinkPath()}}),this._v(" "),t("circle",{staticStyle:{stroke:"#006600","stroke-width":"2",fill:"#CCCCCC"},attrs:{cx:this.dragLink.fromX,cy:this.dragLink.fromY,r:"5"}}),this._v(" "),t("polyline",{staticClass:"only-watch-el",staticStyle:{stroke:"#006600"},attrs:{points:this.computedArrow()}})])},staticRenderFns:[]};var Bs=a("VU/8")(Vs,js,!1,function(e){a("3ms8")},"data-v-6c5d9ca2",null).exports,qs={props:{dragFrame:{type:Object}},methods:{}},Hs={render:function(){var e=this.$createElement,t=this._self._c||e;return t("g",{staticClass:"dragFrame",attrs:{transform:"translate("+this.dragFrame.posX+", "+this.dragFrame.posY+")"}},[t("foreignObject",{attrs:{width:"180",height:"30"}},[t("body",{staticStyle:{margin:"0"},attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[t("div",{staticClass:"dragFrameArea"})])])],1)},staticRenderFns:[]};var zs=a("VU/8")(qs,Hs,!1,function(e){a("DZ6j")},"data-v-3a9e61b9",null).exports,Js={props:{isEditAreaShow:{type:Object,default:function(){return{value:!1,x:-9999,y:-9999,id:null}}}},mounted:function(){console.log("isEditAreaShow",this.isEditAreaShow)},methods:{click_menu_cover:function(e){this.$emit("close_click_nodes"),e.preventDefault(),e.cancelBubble=!0,e.stopPropagation()},get_menu_style:function(){return{position:"absolute",left:this.isEditAreaShow.x+"px",top:this.isEditAreaShow.y+"px"}},delEdges:function(){var e={model_id:sessionStorage.newGraph,id:this.isEditAreaShow.id};this.$emit("delNode",e),this.$emit("close_click_nodes")},changePort:function(e){this.$emit("changePort",e,this.isEditAreaShow.id)},editNode:function(){this.$emit("editNodeDetails",this.isEditAreaShow)},handlePersonalThs:function(e){this.$emit("nodesPersonalEvent",e,this.isEditAreaShow.id)}}},Gs={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isEditAreaShow.value?a("g",[a("foreignObject",{staticStyle:{position:"relative"},attrs:{width:"100%",height:"100%"},on:{click:function(t){return e.click_menu_cover(t)}}},[a("body",{style:e.get_menu_style(),attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[a("div",{staticClass:"menu_contain"},[a("span",{on:{click:e.delEdges}},[e._v("删除节点")]),e._v(" "),a("span",{on:{click:function(t){return e.changePort("in_ports")}}},[e._v("增加入口点")]),e._v(" "),a("span",{on:{click:function(t){return e.changePort("out_ports")}}},[e._v("增加出口点")]),e._v(" "),e.isEditAreaShow.detail?a("span",{on:{click:e.editNode}},[e._v("EDIT IT")]):e._e(),e._v(" "),e._l(e.isEditAreaShow.rightClickEvent,function(t){return a("span",{key:t.label,on:{click:function(a){return e.handlePersonalThs(t.eventName)}}},[e._v(e._s(t.label))])})],2)])])],1):e._e()},staticRenderFns:[]};var Ys=a("VU/8")(Js,Gs,!1,function(e){a("Bjd3")},"data-v-32df409d",null).exports,Ws=(a("mDQ2"),{props:{currentEvent:{type:String,default:function(){""}},modelRunningStatus:{type:Boolean,default:function(){return!1}}},data:function(){return{changeScreen:"full"}},methods:{dragIt:function(e){sessionStorage.dragDes=S()({drag:!0,name:e})},sizeExpend:function(){this.$emit("sizeExpend")},sizeShrink:function(){this.$emit("sizeShrink")},sizeInit:function(){this.$emit("sizeInit")},sel_area:function(e){this.$emit("sel_area"),e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0},fullScreen:function(){"full"===this.changeScreen?(this.changeScreen="mini",document.getElementById("svgContent").webkitRequestFullScreen()):(this.changeScreen="full",document.webkitExitFullscreen())},changeModelRunningStatus:function(){this.$emit("changeModelRunningStatus",!this.modelRunningStatus)}}}),Ks={render:function(){var e=this.$createElement,t=this._self._c||e;return t("g",[t("foreignObject",{staticStyle:{position:"relative"},attrs:{width:"200px",height:"30px"}},[t("body",{attrs:{xmlns:"http://www.w3.org/1999/xhtml"}})])],1)},staticRenderFns:[]};var Xs=a("VU/8")(Ws,Ks,!1,function(e){a("bD6q")},"data-v-e91be516",null).exports,Qs={props:{simulate_sel_area:{type:Object,default:function(){return{left:0,top:0,width:0,height:0}}}},methods:{getSimulateSelArea:function(){var e=this.simulate_sel_area,t=e.left,a=e.top;return"width: "+e.width+"px; height: "+e.height+"px; left: "+t+"px; top: "+a+"px; border: 3px dashed #289de9;position: absolute;"}}},Zs={render:function(){var e=this.$createElement,t=this._self._c||e;return t("g",[t("foreignObject",{staticStyle:{position:"abolute"},attrs:{width:"100%",height:"100%"}},[t("body",{style:this.getSimulateSelArea(),attrs:{xmlns:"http://www.w3.org/1999/xhtml",id:"simulate_sel_area"}})])],1)},staticRenderFns:[]};var en=a("VU/8")(Qs,Zs,!1,function(e){a("90S2")},"data-v-0a747c76",null).exports,tn={props:{item:{type:Object,default:function(){}},choice:{type:Object,default:function(){}},currentEvent:{type:String,default:function(){return""}},i:{type:Number,default:function(){return 0}}},data:function(){return{}},methods:{isVertical:function(){var e={isVertical:!0},t=localStorage.getItem("GlobalConfig");return t&&t.length>0&&(e=_a()(e,JSON.parse(t))),e.isVertical}}},an={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.isVertical()?a("foreignObject",{attrs:{width:"180",height:"30"}},[a("body",{staticStyle:{margin:"0"},attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[a("div",[a("div",{class:-1!==e.choice.paneNode.indexOf(e.item.id)?"pane-node-content selected":"pane-node-content",style:e.item.nodeStyle},[a("i",{class:(e.item.iconClassName||"el-icon-coin")+" icon icon-data",style:e.item.iconStyle,on:{dblclick:function(t){return e.$emit("nodesPersonalEvent","dbClickNodeIcon",e.item.name)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.item.name,expression:"item.name"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.item.name},on:{change:function(t){return e.$emit("changeNodeName",e.item)},input:function(t){t.target.composing||e.$set(e.item,"name",t.target.value)}}})]),e._v(" "),a("div",{class:"dragLink"===e.currentEvent?"pane-node-parent-hl":"pane-node-parent"},e._l(e.item.in_ports,function(t,o){return a("div",{key:"__"+o,style:{width:100/(e.item.in_ports.length+1)+"%"}},[a("span",{staticClass:"space",on:{mouseup:function(t){return e.$emit("linkEnd",e.i,o)}}})])}),0),e._v(" "),a("div",{staticClass:"pane-node-children"},e._l(e.item.out_ports,function(t,o){return a("div",{key:"___"+o,style:{width:100/(e.item.out_ports.length+1)+"%"}},[a("span",{staticClass:"space",on:{mousedown:function(t){return e.$emit("linkPre",t,e.i,o)}}})])}),0)])])]):a("foreignObject",{attrs:{width:"180",height:"30"}},[a("body",{staticStyle:{margin:"0"},attrs:{xmlns:"http://www.w3.org/1999/xhtml"}},[a("div",[a("div",{class:-1!==e.choice.paneNode.indexOf(e.item.id)?"pane-node-content selected":"pane-node-content",style:e.item.nodeStyle},[a("i",{class:(e.item.iconClassName||"el-icon-coin")+" icon icon-data",style:e.item.iconStyle,on:{dblclick:function(t){return e.$emit("nodesPersonalEvent","dbClickNodeIcon",e.item.id)}}}),e._v(" "),a("input",{directives:[{name:"model",rawName:"v-model",value:e.item.name,expression:"item.name"}],staticClass:"input",attrs:{type:"text"},domProps:{value:e.item.name},on:{change:function(t){return e.$emit("changeNodeName",e.item)},input:function(t){t.target.composing||e.$set(e.item,"name",t.target.value)}}})]),e._v(" "),-1!==e.choice.paneNode.indexOf(e.item.id)?a("p",{staticClass:"node-pop"},[e._v(e._s(e.item.nameDescribe||e.item.name))]):e._e(),e._v(" "),a("div",{class:"dragLink"===e.currentEvent?"pane-node-parent-hl":"pane-node-parent",attrs:{id:"parent-cross"}},e._l(e.item.in_ports,function(t,o){return a("div",{key:"__"+o,style:{width:100/(e.item.in_ports.length+1)+"%"}},[a("span",{staticClass:"space",on:{mouseup:function(t){return e.$emit("linkEnd",e.i,o)}}})])}),0),e._v(" "),a("div",{staticClass:"pane-node-children",attrs:{id:"children-cross"}},e._l(e.item.out_ports,function(t,o){return a("div",{key:"___"+o,style:{width:100/(e.item.out_ports.length+1)+"%"}},[a("span",{staticClass:"space",on:{mousedown:function(t){return e.$emit("linkPre",t,e.i,o)}}})])}),0)])])])},staticRenderFns:[]};var on=a("VU/8")(tn,an,!1,function(e){a("1OoD")},"data-v-b34aab58",null).exports,sn=this,nn={name:"DAGBoard",props:{DataAll:{type:Object,default:function(){return[]}}},computed:{svgScale:function(){return this.svg_scale||sessionStorage.svgScale?sessionStorage.svgScale:1}},created:function(){var e=this;this.$nextTick(function(){e.setMouseWheelEvent()})},mounted:function(){sessionStorage.svg_left=0,sessionStorage.svg_top=0},methods:{startActive:function(){var e=this,t=this.step;if(t===this.historyList.length||t>this.historyList.length||!this.modelRunningStatus)return!1;this.activeGraph(t),this.nextStep&&clearTimeout(this.nextStep),this.nextStep=setTimeout(function(){e.step++,e.startActive()},1e3*(this.historyList[t+1].time-this.historyList[t].time))},atMouseOut:function(){this.currentEvent=null},dragPre:function(e,t,a){this.multipleSelectNodes=JSON.parse(S()(this.choice)),this.multipleSelectNodes&&this.multipleSelectNodes.paneNode.length&&(this.initMultiplePosition=JSON.parse(S()(this.DataAll.nodes))),this.setInitRect(),this.currentEvent="dragPane",sessionStorage.offsetX=e.offsetX,sessionStorage.offsetY=e.offsetY,this.choice.index=t,this.timeStamp=e.timeStamp,this.selPaneNode(a.id),this.setDragFramePosition(e),e.preventDefault(),e.stopPropagation(),e.cancelBubble=!0},dragIng:function(e){switch(this.currentEvent){case"dragPane":this.paneDragIng(e);break;case"dragLink":this.setDragLinkPostion(e);break;case"sel_area_ing":this.setSelAreaPostion(e);break;case"move_graph":this.graphMoveIng(e)}},dragEnd:function(e){switch(this.currentEvent){case"sel_area_ing":this.getSelNodes(this.simulate_sel_area)}this.currentEvent=null},svgMouseDown:function(e){this.setInitRect(),"sel_area"===this.currentEvent?this.selAreaStart(e):(this.currentEvent="move_graph",this.graphMovePre(e))},linkPre:function(e,t,a){this.setInitRect(),this.currentEvent="dragLink",this.choice=_a()({},this.choice,{index:t,point:a}),this.setDragLinkPostion(e,!0),e.preventDefault(),e.stopPropagation()},linkEnd:function(e,t){if("dragLink"===this.currentEvent){var a={desp:{src_node_id:this.DataAll.nodes[this.choice.index].id,src_output_idx:this.choice.point,dst_node_id:this.DataAll.nodes[e].id,dst_input_idx:t}};this.addEdge(a,this)}this.currentEvent=null},sizeInit:function(){this.changeSize("init"),this.svg_left=0,this.svg_top=0,sessionStorage.svg_left=0,sessionStorage.svg_top=0},sizeExpend:function(){this.changeSize("expend")},sizeShrink:function(){this.changeSize("shrink")},onMouseWheel:function(e){var t=this;if(!e)return!1;var a=e.wheelDelta/10;this.canMouseWheelUse&&a*a>1&&(a>0?this.sizeExpend():this.sizeShrink(),this.canMouseWheelUse=!1,setTimeout(function(){t.canMouseWheelUse=!0},50))},setMouseWheelEvent:function(){var e=function(e,t,a){e.attachEvent?e.attachEvent("on"+t,a):e.addEventListener(t,a,!1)},t=document.getElementById("svgContent");e(t,"mousewheel",this.onMouseWheel),e(t,"DOMMouseScroll",this.onMouseWheel)},sel_area:function(){this.currentEvent="sel_area",this.simulate_sel_area={left:0,top:0,width:0,height:0}},paneDragIng:function(e){var t=sessionStorage.offsetX||0,a=sessionStorage.offsetY||0,o=(e.x-this.initPos.left-(sessionStorage.svg_left||0))/this.svgScale-30-t,s=(e.y-this.initPos.top-(sessionStorage.svg_top||0))/this.svgScale-a,n={model_id:sessionStorage.newGraph,id:this.DataAll.nodes[this.choice.index].id,pos_x:o,pos_y:s};this.multipleMoveNode&&this.multipleSelectNodes.paneNode.length>1?this.multipleMoveNode(n):this.moveNode(n)},paneDragEnd:function(e){this.multipleSelectNodes={},this.initMultiplePosition=null,this.dragFrame={dragFrame:!1,posX:0,posY:0};e.x,this.initPos.left,sessionStorage.svg_left,this.svgScale,e.y,this.initPos.top,sessionStorage.svg_top,this.svgScale,sessionStorage.newGraph,this.DataAll.nodes[this.choice.index].id},selPaneNode:function(e){this.choice.paneNode.length=[],e&&(this.choice.paneNode.push(e),this.$emit("updateDAG",this.DataAll,"selectNode",e))},selAreaStart:function(e){this.currentEvent="sel_area_ing";var t=(e.x-this.initPos.left-(sessionStorage.svg_left||0))/this.svgScale,a=(e.y-this.initPos.top-(sessionStorage.svg_top||0))/this.svgScale;this.simulate_sel_area={left:t,top:a,width:0,height:0}},setSelAreaPostion:function(e){var t=(e.x-this.initPos.left-(sessionStorage.svg_left||0))/this.svgScale,a=(e.y-this.initPos.top-(sessionStorage.svg_top||0))/this.svgScale,o=t-this.simulate_sel_area.left,s=a-this.simulate_sel_area.top;this.simulate_sel_area.width=o,this.simulate_sel_area.height=s},getSelNodes:function(e){var t=this,a=e.left,o=e.top,s=e.width,n=e.height;this.choice.paneNode.length=0,this.DataAll.nodes.forEach(function(e){e.pos_x>a&&e.pos_x<a+s&&e.pos_y>o&&e.pos_y<o+n&&t.choice.paneNode.push(e.id)}),this.simulate_sel_area={left:0,top:0,width:0,height:0}},focusInput:function(e){e&&e.focus()},graphMovePre:function(e){var t=e.x,a=e.y;this.svg_trans_init={x:t,y:a},this.svg_trans_pre={x:this.svg_left,y:this.svg_top}},graphMoveIng:function(e){var t=this.svg_trans_init,a=t.x,o=t.y;this.svg_left=e.x-a+this.svg_trans_pre.x,this.svg_top=e.y-o+this.svg_trans_pre.y,sessionStorage.svg_left=this.svg_left,sessionStorage.svg_top=this.svg_top},setDragFramePosition:function(e){var t=e.x-this.initPos.left-(sessionStorage.svg_left||0),a=e.y-this.initPos.top-(sessionStorage.svg_top||0);this.dragFrame={posX:t/this.svgScale-90,posY:a/this.svgScale-15}},setDragLinkPostion:function(e,t){var a=(e.x-this.initPos.left-(sessionStorage.svg_left||0))/this.svgScale,o=(e.y-this.initPos.top-(sessionStorage.svg_top||0))/this.svgScale;t&&(this.dragLink=_a()({},this.dragLink,{fromX:a,fromY:o})),this.dragLink=_a()({},this.dragLink,{toX:a,toY:o})},close_click_nodes:function(){this.is_edit_area={value:!1,x:-9999,y:-9999}},r_click_nodes:function(e,t){this.setInitRect();var a=this.DataAll.nodes[t].id,o=this.DataAll.nodes[t].detail||null,s=this.DataAll.nodes[t].rightClickEvent||null,n=e.x-this.initPos.left,i=e.y-this.initPos.top;this.is_edit_area={value:!0,x:n,y:i,id:a,detail:o,rightClickEvent:s},e.stopPropagation(),e.cancelBubble=!0,e.preventDefault()},setInitRect:function(){var e=document.getElementById("svgContent").getBoundingClientRect(),t=e.left,a=e.top;this.initPos={left:t,top:a}},changeModelRunningStatus:function(e){this.$emit("updateDAG",this.DataAll,"startRunning")},activeGraph:function(e,t){e.commit,e.state},stopGraph:function(e){e.commit,e.state},addEdge:function(e,t){var a=t.DataAll;a.edges.push(ga()({},e.desp,{id:a.edges.length+10})),t.$emit("updateDAG",a,"addEdge")},delEdge:function(e){var t=e.id;console.log("id",t);var a=[];this.DataAll.edges.forEach(function(e,o){e.id!==t&&a.push(e)}),this.DataAll.edges=a,this.$emit("updateDAG",this.DataAll,"delEdge")},moveNode:function(e){e.id,e.pos_x,e.pos_y;var t=this.DataAll;t.nodes.forEach(function(t,a){t.id===e.id&&(t.pos_x=e.pos_x,t.pos_y=e.pos_y)}),this.$emit("updateDAG",t,"moveNode")},multipleMoveNode:function(e){var t=this,a=e.id,o=e.pos_x,s=e.pos_y,n=0,i=0,l=this.initMultiplePosition,r=this.DataAll;l.map(function(e){e.id===a&&(n=o-e.pos_x,i=s-e.pos_y)}),l.forEach(function(e){t.multipleSelectNodes.paneNode.indexOf(e.id)>-1&&(e.pos_x+=n,e.pos_y+=i)}),r.nodes=l,this.$emit("updateDAG",r,"moveNode")},addNode:function(e){sn.DataAll.nodes.push(ga()({},e.desp,{id:sn.DataAll.nodes.length+100,in_ports:[0],out_ports:[0]})),sn.$emit("updateDag",sn.DataAll,"addNode")},delNode:function(e){e.model_id;var t=e.id,a=[],o=[];this.DataAll.edges.forEach(function(e){e.dst_node_id!==t&&e.src_node_id!==t&&a.push(e)}),this.DataAll.nodes.forEach(function(e){e.id!==t&&o.push(e)}),this.DataAll.edges=a,this.DataAll.nodes=o,this.$emit("updateDAG",this.DataAll,"delNode")},changeSize:function(e){var t="string"==typeof sessionStorage.svgScale?Number(sessionStorage.svgScale):1,a=window.innerWidth,o=window.innerHeight;switch(e){case"shrink":t-=.05,this.svg_left=sessionStorage.svg_left=this.svg_left+.01*a,this.svg_top=sessionStorage.svg_top=this.svg_top+.01*o;break;case"expend":t+=.05,this.svg_top=sessionStorage.svg_top=this.svg_top-.01*o,this.svg_left=sessionStorage.svg_left=this.svg_left-.01*a;break;case"init":t=1}this.svg_scale=sessionStorage.svgScale=t},changeNodeName:function(e){this.DataAll.nodes.forEach(function(t){t.id===e.id&&(t.name=e.name)}),this.$emit("updateDAG",this.DataAll,"changeNodeName")},changePort:function(e,t){this.DataAll.nodes.forEach(function(a){a.id===t&&(a[e]?a[e].push(a[e].length):a[e]=["0"])}),this.$emit("updateDAG",this.DataAll,"changePort")},editNodeDetails:function(e){this.$emit("editNodeDetails",e)},nodesPersonalEvent:function(e,t){this.$emit("doSthPersonal",e,t)}},data:function(){return{svg_scale:null,choice:{paneNode:[],index:-1,point:-1},dragFrame:{posX:9999,posY:9999},dragLink:{fromX:0,fromY:0,toX:0,toY:0},currentEvent:null,initPos:{left:-1,top:-1},timeStamp:"",is_edit_area:{value:!1,x:-9999,y:-9999},simulate_sel_area:{left:10,top:50,width:0,height:0},svg_left:0,svg_top:0,svg_trans_init:{x:0,y:0},canMouseWheelUse:!0,step:0,modelRunningStatus:!1,nextStep:null,multipleSelectNodes:{},initMultiplePosition:{}}},components:{Arrow:Us,SimulateArrow:Bs,SimulateFrame:zs,EditArea:Ys,Control:Xs,SimulateSelArea:en,mainBody:on}},ln={render:function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("svg",{style:{cursor:"move_graph"===this.currentEvent?"grabbing":"grab"},attrs:{id:"svgContent",xmlns:"http://www.w3.org/2000/svg","xmlns:xlink":"http://www.w3.org/1999/xlink",version:"1.1",width:"100%",height:"100%","data-spm-anchor-id":"TODO.11007039.0.i6.12b64a9bcbXQmm"},on:{mousedown:e.svgMouseDown,mousemove:function(t){return e.dragIng(t)},mouseleave:e.atMouseOut,mouseup:function(t){return e.dragEnd(t)}}},[a("g",{attrs:{transform:" translate("+e.svg_left+", "+e.svg_top+") scale("+e.svgScale+")"}},[e._l(e.DataAll.nodes,function(t,o){return a("g",{key:"_"+o,staticClass:"svgEach",attrs:{transform:"translate("+t.pos_x+", "+t.pos_y+")"},on:{contextmenu:function(t){return e.r_click_nodes(t,o)},dblclick:function(t){return e.focusInput(t.path[0])},mousedown:function(a){return e.dragPre(a,o,t)}}},[a("main-body",{attrs:{item:t,i:o,choice:e.choice,currentEvent:e.currentEvent},on:{nodesPersonalEvent:e.nodesPersonalEvent,changeNodeName:e.changeNodeName,linkEnd:e.linkEnd,linkPre:e.linkPre}})],1)}),e._v(" "),e._l(e.DataAll.edges,function(t,o){return a("Arrow",{key:"____"+o,attrs:{DataAll:e.DataAll,each:t,index:o},on:{delEdge:e.delEdge}})}),e._v(" "),"dragLink"===e.currentEvent?a("SimulateArrow",{attrs:{dragLink:e.dragLink}}):e._e(),e._v(" "),-1!==["sel_area","sel_area_ing"].indexOf(e.currentEvent)?a("SimulateSelArea",{attrs:{simulate_sel_area:e.simulate_sel_area}}):e._e()],2),e._v(" "),a("EditArea",{attrs:{isEditAreaShow:e.is_edit_area},on:{editNodeDetails:e.editNodeDetails,nodesPersonalEvent:e.nodesPersonalEvent,delNode:e.delNode,changePort:e.changePort,close_click_nodes:e.close_click_nodes}}),e._v(" "),a("Control",{attrs:{modelRunningStatus:e.modelRunningStatus,currentEvent:e.currentEvent},on:{changeModelRunningStatus:e.changeModelRunningStatus,sizeInit:e.sizeInit,sizeExpend:e.sizeExpend,sizeShrink:e.sizeShrink,sel_area:e.sel_area}})],1)},staticRenderFns:[]};var rn=a("VU/8")(nn,ln,!1,function(e){a("oDrH")},"data-v-44c9be91",null).exports,cn={name:"NodeBus",props:{value:{type:String,default:"传入内容"},pos_x:{type:Number},pos_y:{type:Number}},data:function(){return{name:this.value,left:this.pos_x,top:this.pos_y}}},dn={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"nodesBus-contain",style:{left:this.pos_x+90+"px",top:this.pos_y+30+"px"}},[t("div",{staticClass:"nodesBus"},[t("span",{staticClass:"icon"}),this._v(" "),t("span",{staticClass:"name"},[this._v(this._s(this.value))])])])},staticRenderFns:[]};var un=a("VU/8")(cn,dn,!1,function(e){a("WWw0")},"data-v-71a78927",null).exports,pn={install:function(e,t){e.component(rn.name,rn),e.component(un.name,un)}};"undefined"!=typeof window&&window.Vue&&window.Vue.use(pn);var mn=pn,fn=a("qJdI"),hn=a.n(fn),vn=a("E5Az"),bn=a.n(vn),gn=(a("4/hK"),a("8sJK"),a("81Pc")),yn=a.n(gn),_n=a("c6tU"),wn=a.n(_n),kn=(a("0eb/"),a("ByB+"),a("ZHXk"),a("Ynfa")),xn=a.n(kn),In=(a("0OYy"),a("G0J2")),Tn=a.n(In);a("3f40"),a("4qOc"),a("+cgv");o.default.component("v-chart",xt),o.default.use(Ds.a),o.default.use(L.a),o.default.config.productionTip=!1,o.default.use(Ns.a),o.default.use(Rs.a),o.default.use(Ls.a),o.default.use(mn),o.default.use(hn.a),o.default.use(bn.a),o.default.use(yn.a),o.default.use(wn.a),o.default.use(xn.a),o.default.prototype.$XModal=xn.a.modal,o.default.use(Tn.a),new o.default({el:"#app",router:Ss,render:function(e){return e(p)},components:{App:p},template:"<App/>"})},NPEC:function(e,t){},OzMU:function(e,t){},PsxY:function(e,t){},QDfD:function(e,t){e.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},RYcG:function(e,t){e.exports={O_RDONLY:0,O_WRONLY:1,O_RDWR:2,S_IFMT:61440,S_IFREG:32768,S_IFDIR:16384,S_IFCHR:8192,S_IFBLK:24576,S_IFIFO:4096,S_IFLNK:40960,S_IFSOCK:49152,O_CREAT:512,O_EXCL:2048,O_NOCTTY:131072,O_TRUNC:1024,O_APPEND:8,O_DIRECTORY:1048576,O_NOFOLLOW:256,O_SYNC:128,O_SYMLINK:2097152,O_NONBLOCK:4,S_IRWXU:448,S_IRUSR:256,S_IWUSR:128,S_IXUSR:64,S_IRWXG:56,S_IRGRP:32,S_IWGRP:16,S_IXGRP:8,S_IRWXO:7,S_IROTH:4,S_IWOTH:2,S_IXOTH:1,E2BIG:7,EACCES:13,EADDRINUSE:48,EADDRNOTAVAIL:49,EAFNOSUPPORT:47,EAGAIN:35,EALREADY:37,EBADF:9,EBADMSG:94,EBUSY:16,ECANCELED:89,ECHILD:10,ECONNABORTED:53,ECONNREFUSED:61,ECONNRESET:54,EDEADLK:11,EDESTADDRREQ:39,EDOM:33,EDQUOT:69,EEXIST:17,EFAULT:14,EFBIG:27,EHOSTUNREACH:65,EIDRM:90,EILSEQ:92,EINPROGRESS:36,EINTR:4,EINVAL:22,EIO:5,EISCONN:56,EISDIR:21,ELOOP:62,EMFILE:24,EMLINK:31,EMSGSIZE:40,EMULTIHOP:95,ENAMETOOLONG:63,ENETDOWN:50,ENETRESET:52,ENETUNREACH:51,ENFILE:23,ENOBUFS:55,ENODATA:96,ENODEV:19,ENOENT:2,ENOEXEC:8,ENOLCK:77,ENOLINK:97,ENOMEM:12,ENOMSG:91,ENOPROTOOPT:42,ENOSPC:28,ENOSR:98,ENOSTR:99,ENOSYS:78,ENOTCONN:57,ENOTDIR:20,ENOTEMPTY:66,ENOTSOCK:38,ENOTSUP:45,ENOTTY:25,ENXIO:6,EOPNOTSUPP:102,EOVERFLOW:84,EPERM:1,EPIPE:32,EPROTO:100,EPROTONOSUPPORT:43,EPROTOTYPE:41,ERANGE:34,EROFS:30,ESPIPE:29,ESRCH:3,ESTALE:70,ETIME:101,ETIMEDOUT:60,ETXTBSY:26,EWOULDBLOCK:35,EXDEV:18,SIGHUP:1,SIGINT:2,SIGQUIT:3,SIGILL:4,SIGTRAP:5,SIGABRT:6,SIGIOT:6,SIGBUS:10,SIGFPE:8,SIGKILL:9,SIGUSR1:30,SIGSEGV:11,SIGUSR2:31,SIGPIPE:13,SIGALRM:14,SIGTERM:15,SIGCHLD:20,SIGCONT:19,SIGSTOP:17,SIGTSTP:18,SIGTTIN:21,SIGTTOU:22,SIGURG:16,SIGXCPU:24,SIGXFSZ:25,SIGVTALRM:26,SIGPROF:27,SIGWINCH:28,SIGIO:23,SIGSYS:12,SSL_OP_ALL:2147486719,SSL_OP_ALLOW_UNSAFE_LEGACY_RENEGOTIATION:262144,SSL_OP_CIPHER_SERVER_PREFERENCE:4194304,SSL_OP_CISCO_ANYCONNECT:32768,SSL_OP_COOKIE_EXCHANGE:8192,SSL_OP_CRYPTOPRO_TLSEXT_BUG:2147483648,SSL_OP_DONT_INSERT_EMPTY_FRAGMENTS:2048,SSL_OP_EPHEMERAL_RSA:0,SSL_OP_LEGACY_SERVER_CONNECT:4,SSL_OP_MICROSOFT_BIG_SSLV3_BUFFER:32,SSL_OP_MICROSOFT_SESS_ID_BUG:1,SSL_OP_MSIE_SSLV2_RSA_PADDING:0,SSL_OP_NETSCAPE_CA_DN_BUG:536870912,SSL_OP_NETSCAPE_CHALLENGE_BUG:2,SSL_OP_NETSCAPE_DEMO_CIPHER_CHANGE_BUG:1073741824,SSL_OP_NETSCAPE_REUSE_CIPHER_CHANGE_BUG:8,SSL_OP_NO_COMPRESSION:131072,SSL_OP_NO_QUERY_MTU:4096,SSL_OP_NO_SESSION_RESUMPTION_ON_RENEGOTIATION:65536,SSL_OP_NO_SSLv2:16777216,SSL_OP_NO_SSLv3:33554432,SSL_OP_NO_TICKET:16384,SSL_OP_NO_TLSv1:67108864,SSL_OP_NO_TLSv1_1:268435456,SSL_OP_NO_TLSv1_2:134217728,SSL_OP_PKCS1_CHECK_1:0,SSL_OP_PKCS1_CHECK_2:0,SSL_OP_SINGLE_DH_USE:1048576,SSL_OP_SINGLE_ECDH_USE:524288,SSL_OP_SSLEAY_080_CLIENT_DH_BUG:128,SSL_OP_SSLREF2_REUSE_CERT_TYPE_BUG:0,SSL_OP_TLS_BLOCK_PADDING_BUG:512,SSL_OP_TLS_D5_BUG:256,SSL_OP_TLS_ROLLBACK_BUG:8388608,ENGINE_METHOD_DSA:2,ENGINE_METHOD_DH:4,ENGINE_METHOD_RAND:8,ENGINE_METHOD_ECDH:16,ENGINE_METHOD_ECDSA:32,ENGINE_METHOD_CIPHERS:64,ENGINE_METHOD_DIGESTS:128,ENGINE_METHOD_STORE:256,ENGINE_METHOD_PKEY_METHS:512,ENGINE_METHOD_PKEY_ASN1_METHS:1024,ENGINE_METHOD_ALL:65535,ENGINE_METHOD_NONE:0,DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6,F_OK:0,R_OK:4,W_OK:2,X_OK:1,UV_UDP_REUSEADDR:4}},UWDK:function(e,t){},V99l:function(e,t){},WWw0:function(e,t){},WhcK:function(e,t){},Wjsk:function(e,t){},XhJX:function(e,t){},bD6q:function(e,t){},bT2e:function(e,t){},"d8/S":function(e,t){},ef38:function(e,t){},ejIc:function(e,t){e.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},fweS:function(e,t){},gOld:function(module,__webpack_exports__,__webpack_require__){"use strict";var __WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__=__webpack_require__("mvHQ"),__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default=__webpack_require__.n(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify__),__WEBPACK_IMPORTED_MODULE_1__conf_utils__=__webpack_require__("J+EJ"),axios=__webpack_require__("mtWM");__webpack_exports__.a={data:function(){return{newFieldRules:{fieldName:[{required:!0,message:"请输入字段名称"}],fieldType:[{required:!0,message:"请输入字段类型"}]},readOnly:!0,roleOptions:[],partitionDataList:"",form:{tableName:"",tableType:"",database:"",location:"",compressMode:"",description:"",tid:"",creator:"",createTime:"",privilegeRoles:[]},curTid:"",info:"csv内容形如: mysql,default_database,table1,field1,v0,我是描述",taskSwitch:!1,tableColumn:[],dataList:[],taskForm:{session:"",date:Object(__WEBPACK_IMPORTED_MODULE_1__conf_utils__.d)(new Date),status:""},contentCols:[],contentData:[],contentFiled:"",dialogTableVisible:!1,fieldLoading:!1,dataLoading:!1,dataPathRoot:"",dataPathRootPaga:"",dialogVisible:!1,errMsg:"",versions:[],curVersion:"",curVersionDesc:"",versionDescList:{},userName:"",tableId:2,tableName:"",newField:{fieldName:"",fieldType:"",description:""},totallyNew:!1,newVersion:"",newVersionForm:{Version:"",Fields:[{fieldName:"",fieldType:"",description:""}]},isUpdateFieldNow:!1,relationTable:{loading:!1,data:[],cols:[]},relationOptions:{tableTypes:[],databases:[],tables:[],versions:[],fields:[]},relationSelect:{typeSelect:"",dataBaseSelect:"",tableSelect:"",versionSelect:"",fieldSelect:"",relationDesc:""},curFieldId:"",relationRules:{label:[{required:!0,message:"请输入关系描述",trigger:"blur"}]},file:""}},computed:{buttonIcon:function(){return this.isUpdateFieldNow?"el-icon-loading":"el-icon-upload"},buttonText:function(){return this.isUpdateFieldNow?"更新中":"更新当前版本"}},methods:{updateCurVersionField:function(){var e=this.curVersion,t=this.tableId;this.isUpdateFieldNow=!0;var a={version:e,tableId:t+""},o=this;axios.post("/metaData/updateTableByVersion",a,{responseType:"json"}).then(function(e){e.data.Res?(o.$message({message:"元数据更新成功",type:"success"}),o.loadFieldMetaData()):o.$message({message:e.data.Info,type:"error"}),o.isUpdateFieldNow=!1}).catch(function(e){o.isUpdateFieldNow=!1,o.$options.methods.saveUpdateNotify.bind(o)(),console.log(e)})},updatePartitionField:function(e){var t=e.row,a=e.column,o=this.$refs.partitionTable,s=a.property,n=this;t[s];o.isUpdateByRow(t,s)&&axios.post("/metaData/field/updatePartition",t,{responseType:"json"}).then(function(e){e.data.Res?(n.$message({message:e.data.Info,type:"success"}),n.$refs.partitionTable.reloadRow(t,null,s)):n.$message({message:e.data.Info,type:"error"})}).catch(function(e){n.$options.methods.saveUpdateNotify.bind(n)(),console.log(e)})},submitUpdate:function(){console.log(this.form.tid);var e={tid:parseInt(this.form.tid),tableName:this.form.tableName,tableType:this.form.tableType,databaseName:this.form.database,description:this.form.description,location:this.form.location,compressMode:this.form.compressMode,creator:this.form.creator,createTime:this.form.createTime,privilegeRoles:this.form.privilegeRoles.join(",")},t=this;axios.post("metaData/table/update",e,{responseType:"json"}).then(function(e){t.$message({message:"修改成功!",type:"success"})}).catch(function(e){console.log(e)})},updateVersionDesc:function(){console.log(this.tableId+":"+this.curVersion);var e={Description:this.curVersionDesc,Version:this.curVersion,TableId:this.tableId},t=this;axios.post("/metaData/version/update",e,{responseType:"json"}).then(function(e){t.$message({message:"更新成功!",type:"success"})}).catch(function(e){console.log(e)})},onClickNewVersion:function(){var e=this;axios.get("metaData/fields/version/getNewVersion/"+this.tableId).then(function(t){e.newVersionForm.Version=t.data,console.log(e.versions[0]);var a={tableId:e.tableId+"",version:e.versions[0]};axios.post("/metaData/fields/getListByVersion",a,{responseType:"json"}).then(function(t){console.log(t.data),null!==t.data&&(e.newVersionForm.Fields=t.data)}).catch(function(e){console.log(e)}),e.totallyNew=!e.totallyNew}).catch(function(e){console.log(e)})},handleFileUpload:function(){this.file=this.$refs.file.files[0],console.log(this.file)},submitFile:function(){var e=this,t=this;this.file?this.$confirm("请确保提交的文件中包含6列:关联的表类型,关联的数据库, 关联的表名,关联的字段名,关联的版本号,关系描述","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){var a=new FormData;a.append("file",e.file),a.append("tableAId",e.tableId),a.append("fieldAId",e.curFieldId),a.append("tableAVersion",e.curVersion),axios.post("/metaData/upload/relation/file",a,{headers:{"Content-Type":"multipart/form-data"}}).then(function(e){console.log(e.data),t.$message({type:"success",message:e.data}),t.getRelation()}).catch(function(e){console.log("失败"),console.log(e),t.$message({type:"success",message:"提交失败"+e})})}):this.$confirm("请先选择带查询词的csv文件, 第一行为表头, 字段用半角逗号分隔","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning",center:!0}).then(function(){})},deleteRelation:function(e){console.log(e.rid);var t=this,a={rid:e.rid};axios.post("metaData/fields/relation/delete",a,{responseType:"json"}).then(function(e){t.getRelation()}).catch(function(e){console.log(e)})},addRelation:function(e){var t=this,a={tableAId:this.tableId+"",fieldAId:this.curFieldId+"",versionA:this.curVersion,tableBId:this.relationSelect.tableSelect+"",fieldBId:this.relationSelect.fieldSelect+"",versionB:this.relationSelect.versionSelect,description:this.relationSelect.relationDesc};return console.log(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(a)),axios.post("metaData/fields/relation/update",a,{responseType:"json"}).then(function(e){t.getRelation()}).catch(function(e){console.log(e)}),!0},onChangeRelationVersion:function(){var e=this,t={tableId:this.relationSelect.tableSelect+"",version:this.relationSelect.versionSelect};axios.post("metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.relationOptions.fields=t.data.dataList}).catch(function(e){console.log(e)})},onChangeRelationTable:function(){var e=this,t=this.relationSelect.tableSelect;axios.get("metaData/fields/version/get/"+t).then(function(t){e.relationOptions.versions=t.data.Versions}).catch(function(e){console.log(e)})},onChangeRelationDataBase:function(){var e=this,t={tableType:e.relationSelect.typeSelect,database:e.relationSelect.dataBaseSelect};axios.post("metaData/getTablesByDataBase",t,{responseType:"json"}).then(function(t){e.relationOptions.tables=t.data}).catch(function(e){console.log(e)})},onChangeRelationTableType:function(){var e=this;axios.get("metaData/getDataBaseByType/"+this.relationSelect.typeSelect).then(function(t){e.relationOptions.databases=t.data,e.relationSelect.dataBaseSelect="",e.relationSelect.tableSelect="",e.relationSelect.fieldSelect=""}).catch(function(e){console.log(e)})},getRelation:function(){var e=this;axios.get("metaData/fields/relation/get/"+e.curFieldId).then(function(t){e.relationTable.data=t.data.data,e.relationTable.cols=t.data.cols,e.relationTable.loading=!1}).catch(function(e){console.log(e)})},editRelation:function(e){this.dialogVisible=!0,this.relationTable.loading=!0;var t=this;this.curFieldId=e.fid+"",axios.get("metaData/tableTypes/get").then(function(e){t.relationOptions.tableTypes=e.data}).catch(function(e){console.log(e)}),t.getRelation()},onSubmitTotallyNewField:function(){this.newVersionForm.TableId=this.tableId+"",this.newVersionForm.Fields=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(this.newVersionForm.Fields)+"",this.newVersionForm.TotallyNew="true";var e=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(this.newVersionForm);console.log(e);var t=this;axios.post("/metaData/fields/newVersion/put",e,{responseType:"json"}).then(function(e){t.getAllVersion(),t.clearNewField(),t.totallyNew=!1}).catch(function(e){t.$options.methods.saveUpdateNotify.bind(t)(),console.log(e)})},resetTotallyNewField:function(e){this.$refs[e].resetFields(),this.newVersionForm={Version:"",Fields:[{fieldName:"",fieldType:"",description:""}]}},removeTotallyNewField:function(e){var t=this.newVersionForm.Fields.indexOf(e);-1!==t&&this.newVersionForm.Fields.splice(t,1)},addTotallyNewField:function(){this.newVersionForm.Fields.push({fieldName:"",fieldType:"",description:""})},onChangeVersion:function(){console.log("curVersion:"+this.curVersion+", versions:"+this.versions),this.curVersionDesc=this.versionDescList[this.curVersion],this.loadFieldMetaData()},deleteField:function(e){var t=e.fid,a=this;console.log("fid:"+t),this.$confirm("确定删除该字段吗?","提示",{distinguishCancelAndClose:!0,confirmButtonText:"确定",cancelButtonText:"取消",type:"info",center:!0}).then(function(){var e={fieldId:t+""};console.log(e),axios.post("/metaData/fields/delete",e,{responseType:"json"}).then(function(e){console.info(e.data),a.$message({type:"success",message:"字段已删除!"}),a.loadFieldMetaData()}).catch(function(e){a.$options.methods.saveUpdateNotify.bind(a)(),console.log(e)})})},getAllVersion:function(){var e=this,t=e.tableId;axios.get("metaData/getTableById/"+t).then(function(t){e.form.tableName=t.data.TableName,e.form.tableType=t.data.TableType,e.form.database=t.data.DatabaseName,e.form.location=t.data.Location,e.form.compressMode=t.data.CompressMode,e.form.description=t.data.Description,e.form.tid=t.data.Tid,e.form.creator=t.data.Creator,e.form.createTime=t.data.CreateTime}).catch(function(e){console.log(e)}),axios.get("metaData/fields/version/get/"+t).then(function(t){var a=[],o={},s=[];t.data.Versions.forEach(function(e){s.push(e.Version),o[e.Version]=e.Description,a.push(e.Description)}),console.log(e.versions),e.curVersionDesc=a[0],e.versions=s,e.versionDescList=o,e.tableName=t.data.TableName,e.curVersion=e.versions[0],console.log("versions:"+e.versions+";curVersion:"+e.curVersion),e.userName=Object(__WEBPACK_IMPORTED_MODULE_1__conf_utils__.e)("_adtech_user"),e.fieldLoading=!0;var n={tableId:e.tableId+"",version:e.curVersion};console.log(n),axios.post("/metaData/fields/getByVersion",n,{responseType:"json"}).then(function(t){e.fieldLoading=!1,e.tableColumn=t.data.tableColumn,e.dataList=t.data.dataList}).catch(function(e){console.log(e)}),axios.post("/metaData/fields/getPartitionByVersion",n,{responseType:"json"}).then(function(t){e.partitionDataList=t.data}).catch(function(e){console.log(e)})}).catch(function(e){console.log(e)})},loadFieldMetaData:function(){var e=this;e.fieldLoading=!0;var t={tableId:e.tableId+"",version:e.curVersion};console.log(t),axios.post("/metaData/fields/getByVersion",t,{responseType:"json"}).then(function(t){e.fieldLoading=!1,e.tableColumn=t.data.tableColumn,e.dataList=t.data.dataList}).catch(function(e){console.log(e)}),axios.post("/metaData/fields/getPartitionByVersion",t,{responseType:"json"}).then(function(t){e.partitionDataList=t.data}).catch(function(e){console.log(e)})},addFieldInCurrentVersion:function(){console.log(this.newField);var e=this,t={TableId:e.tableId+"",Version:e.curVersion,TotallyNew:"false",Fields:'[{"fieldName":"'+e.newField.fieldName+'","fieldType":"'+e.newField.fieldType+'","description":"'+e.newField.description+'"}]'};console.log(this.$refs.newFieldForm),this.$refs.newFieldForm.validate(function(a){if(!a)return console.log("没验证通过啊"),!1;axios.post("/metaData/fields/newVersion/put",t,{responseType:"json"}).then(function(t){console.info(t.data),e.$message({type:"success",message:"元数据添加成功!"}),e.clearNewField(),e.loadFieldMetaData()}).catch(function(t){e.$options.methods.saveUpdateNotify.bind(e)(),console.log(t)})})},clearNewField:function(){this.newField.fieldName="",this.newField.fieldType="",this.newField.description="",this.resetTotallyNewField("newVersionForm")},getUpdateEvent:function(){var e=this.$refs.xTable.getUpdateRecords();console.log(__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e));var t=__WEBPACK_IMPORTED_MODULE_0_babel_runtime_core_js_json_stringify___default()(e),a=this;this.$confirm("确定提交修改吗? (提交过程较长,请等待提示后再退出页面)","提交修改",{confirmButtonText:"确定",cancelButtonText:"取消"}).then(function(){axios.post("/metaData/field/update",t,{responseType:"json"}).then(function(e){e.data.Res?(a.$message({message:e.data.Info,type:"success"}),a.loadFieldMetaData()):a.$message({message:e.data.Info,type:"error"})}).catch(function(e){a.$options.methods.saveUpdateNotify.bind(a)(),console.log(e)})}).catch(function(){})},getRoleOptions:function getRoleOptions(){var self=this;axios.get("/auth/roles").then(function(e){self.roleOptions=e.data}).catch(function(e){console.log(e)}),axios.get("/metaData/getTablePrivilegeByTid/"+this.tableId).then(function(response){var res=eval(response.data);self.form.privilegeRoles=res,console.log(res)}).catch(function(e){console.log(e)})}},mounted:function(){var e=JSON.parse(sessionStorage.getItem("metaData_table_id"));console.log("tableId:"+e.tableId+" versions:"+this.versions),this.tableId=e.tableId;var t=this;axios.get("/metaData/getOwnerEdit?tid="+this.tableId).then(function(e){t.readOnly=e.data.readOnly,console.log(t.readOnly)}).catch(function(e){console.log(e)}),this.getAllVersion(),this.getRoleOptions()}}},gW4k:function(e,t){},hQKG:function(e,t){},i5fM:function(e,t){},iqCl:function(e,t){},iwfV:function(e,t){},jGSh:function(e,t){},kLPt:function(e,t){},m4JD:function(e,t){},mDQ2:function(e,t){!function(e){var t,a='<svg><symbol id="icon-quanping" viewBox="0 0 1025 1024"><path d="M1014.331575 1013.87659C1009.09925 1020.075757 1001.421383 1024 991.98045 1024L703.975118 1024C686.287587 1024 671.955568 1009.667981 671.955568 991.98045 671.955568 974.292919 686.287587 960.017773 703.975118 960.017773L914.348681 960.984615 569.185893 615.821827 614.4 570.550847 959.9609 916.111747 959.9609 704.031991C959.9609 686.34446 974.292919 672.012441 991.98045 672.012441 1009.611108 672.012441 1023.943127 686.34446 1023.943127 704.031991L1024 991.07048C1024 1000.056429 1020.246376 1008.075535 1014.331575 1013.87659ZM991.98045 352.044432C974.292919 352.044432 959.9609 337.712413 959.9609 320.024882L960.984615 109.651319 615.764954 454.814107 570.550847 409.543127 916.054874 64.0391 703.975118 64.0391C686.287587 64.0391 671.955568 49.707081 671.955568 32.01955 671.955568 14.332019 686.287587 0 703.975118 0L991.07048 0C999.999556 0 1008.075535 3.753624 1013.87659 9.668425 1020.018884 14.90075 1023.943127 22.521744 1023.943127 32.01955L1023.943127 320.024882C1023.943127 337.712413 1009.611108 352.044432 991.98045 352.044432ZM409.543127 453.449153 63.982227 107.888253 63.982227 320.024882C63.982227 337.712413 49.650208 352.044432 32.01955 352.044432 14.332019 352.044432 0 337.712413 0 320.024882L0 32.92952C0 24.000444 3.696751 15.924465 9.611552 10.12341 14.843877 3.924243 22.521744 0 32.01955 0L319.968009 0C337.65554 0 351.987559 14.332019 351.987559 32.01955 351.987559 49.707081 337.65554 64.0391 319.968009 64.0391L109.594446 63.015385 454.814107 408.235046 409.543127 453.449153ZM32.01955 672.012441C49.650208 672.012441 63.982227 686.34446 63.982227 704.031991L63.015385 914.405554 408.178173 569.185893 453.449153 614.456873 107.888253 960.017773 319.968009 960.017773C337.65554 960.017773 351.987559 974.349792 351.987559 991.98045 351.987559 1009.667981 337.65554 1024 319.968009 1024L32.92952 1024C23.943571 1024 15.924465 1020.303249 10.12341 1014.388448 3.924243 1009.09925 0 1001.478256 0 991.98045L0 704.031991C0 686.34446 14.332019 672.012441 32.01955 672.012441Z"  ></path></symbol><symbol id="icon-fangda" viewBox="0 0 1024 1024"><path d="M801.895 481.895h-259.79v-259.79C542.105 205.479 528.627 192 512 192s-30.105 13.479-30.105 30.105v259.789h-259.79C205.479 481.895 192 495.373 192 512c0 16.627 13.479 30.105 30.105 30.105h259.789v259.789C481.895 818.521 495.373 832 512 832s30.105-13.479 30.105-30.105v-259.79h259.789C818.521 542.105 832 528.627 832 512c0-16.627-13.479-30.105-30.105-30.105z"  ></path></symbol><symbol id="icon-suoxiao" viewBox="0 0 1024 1024"><path d="M801.895 542.105h-579.79C205.479 542.105 192 528.627 192 512c0-16.627 13.479-30.105 30.105-30.105h579.789C818.521 481.895 832 495.373 832 512c0 16.627-13.479 30.105-30.105 30.105z"  ></path></symbol><symbol id="icon-icon-test" viewBox="0 0 1024 1024"><path d="M945.4 485.8h-53.9c-12.9-189-164.4-340.4-353.3-353.3v-42c0-14.4-11.8-26.2-26.2-26.2-14.4 0-26.2 11.8-26.2 26.2v42c-188.9 12.9-340.4 164.4-353.3 353.3H78.6c-14.4 0-26.2 11.8-26.2 26.2s11.8 26.2 26.2 26.2h53.9c12.9 188.9 164.4 340.4 353.3 353.3v42c0 14.4 11.8 26.2 26.2 26.2 14.4 0 26.2-11.8 26.2-26.2v-42c188.9-12.9 340.4-164.4 353.3-353.3h53.9c14.4 0 26.2-11.8 26.2-26.2s-11.8-26.2-26.2-26.2zM538.2 838.9V671.1c0-14.4-11.8-26.2-26.2-26.2-14.4 0-26.2 11.8-26.2 26.2v167.8c-160-12.7-287.9-140.7-300.7-300.7h156c14.4 0 26.2-11.8 26.2-26.2s-11.8-26.2-26.2-26.2h-156c12.7-160 140.7-287.9 300.7-300.7v167.8c0 14.4 11.8 26.2 26.2 26.2 14.4 0 26.2-11.8 26.2-26.2V185.1c160 12.7 287.9 140.7 300.7 300.7H683c-14.4 0-26.2 11.8-26.2 26.2s11.8 26.2 26.2 26.2h156c-12.8 160-140.8 288-300.8 300.7z" fill="#666666" ></path></symbol><symbol id="icon-duoxuankuang" viewBox="0 0 1024 1024"><path d="M140.8 140.8v742.4h742.4V140.8zM76.8 128a51.2 51.2 0 0 1 51.2-51.2h768a51.2 51.2 0 0 1 51.2 51.2v768a51.2 51.2 0 0 1-51.2 51.2h-768a51.2 51.2 0 0 1-51.2-51.2z" fill="#B9B9CF" ></path></symbol></svg>',o=function(e,t){t.firstChild?function(e,t){t.parentNode.insertBefore(e,t)}(e,t.firstChild):t.appendChild(e)};if((t=document.getElementsByTagName("script"))[t.length-1].getAttribute("data-injectcss")&&!e.__iconfont__svg__cssinject__){e.__iconfont__svg__cssinject__=!0;try{document.write("<style>.svgfont {display: inline-block;width: 1em;height: 1em;fill: currentColor;vertical-align: -0.1em;font-size:16px;}</style>")}catch(e){console&&console.log(e)}}!function(t){document.addEventListener?~["complete","loaded","interactive"].indexOf(document.readyState)?setTimeout(t,0):document.addEventListener("DOMContentLoaded",function e(){document.removeEventListener("DOMContentLoaded",e,!1),t()},!1):document.attachEvent&&function(e,t){var a=e.document,o=!1,s=function(){o||(o=!0,t())};(function e(){try{a.documentElement.doScroll("left")}catch(t){return void setTimeout(e,50)}s()})(),a.onreadystatechange=function(){"complete"==a.readyState&&(a.onreadystatechange=null,s())}}(e,t)}(function(){var e,t;(e=document.createElement("div")).innerHTML=a,a=null,(t=e.getElementsByTagName("svg")[0])&&(t.setAttribute("aria-hidden","true"),t.style.position="absolute",t.style.width=0,t.style.height=0,t.style.overflow="hidden",o(t,document.body))})}(window)},mmKP:function(e,t){},oDrH:function(e,t){},pw1w:function(e,t){},q3lC:function(module,__webpack_exports__,__webpack_require__){"use strict";var axios=__webpack_require__("mtWM");__webpack_exports__.a={data:function(){return{defaultProps:{children:"children",label:"DatasourceName"},connSelectType:"",connSelectId:"",treeData:[],connForm:{ConnType:"",DatasourceName:"",Host:"",User:"",Passwd:"",Database:"",Port:"",Encode:"",PrivilegeRoles:[]},testLoading:!1,testShow:!1,testSuccess:!1,testErrMsg:"",isReadOnly:!1,roleOptions:[],privilegeSelect:[]}},methods:{onSaveUpdate:function(){var e=this,t={Dsid:this.connSelectId,ConnType:this.connForm.ConnType,DatasourceName:this.connForm.DatasourceName,Host:this.connForm.Host,User:this.connForm.User,Passwd:this.connForm.Passwd,Database:this.connForm.Database,Port:this.connForm.Port,Encode:this.connForm.Encode,PrivilegeRoles:this.privilegeSelect.join(",")};axios.post("/connMeta/updateConn",t,{responseType:"json"}).then(function(t){t.data.Res?(e.$message({message:"修改成功！",type:"success"}),e.privilegeSelect=[]):e.$message({message:t.data.Info,type:"error"}),e.getConnTree(),e.$refs.connForm.resetFields()}).catch(function(e){console.error(e)})},onSaveNew:function(){var e=this;console.log(this.connForm.PrivilegeRoles),this.connForm.PrivilegeRoles=this.privilegeSelect.join(",");var t=this.connForm;axios.post("/connMeta/addConn",t,{responseType:"json"}).then(function(t){t.data.Res?e.$message({message:"创建成功！",type:"success"}):e.$message({message:t.data.Info,type:"error"}),e.getConnTree()}).catch(function(e){console.error(e)})},onTest:function(){this.testLoading=!0,this.testShow=!1;var e=this,t={connType:this.connSelectType,user:this.connForm.User,passwd:this.connForm.Passwd,database:this.connForm.Database,host:this.connForm.Host,port:this.connForm.Port};axios.post("/connMeta/testConn",t,{responseType:"json"}).then(function(t){e.testLoading=!1;var a=t.data.Res;e.testSuccess=a,e.testErrMsg=t.data.Info,e.testShow=!0}).catch(function(e){console.error(e)})},triggerNew:function(){this.connSelectId="",this.connSelectType="",this.privilegeSelect=[],this.$refs.connForm.resetFields()},onChangeConnType:function(){console.log(this.connSelectType),console.log(this.$refs.connForm),this.$refs.connForm.resetFields(),this.testShow=!1,this.getConnTree()},getConnTree:function(){var e=this;axios.get("/connMeta/getByOwner?connType="+this.connSelectType).then(function(t){e.treeData=t.data}).catch(function(e){console.log(e)})},onClickTree:function onClickTree(node){this.testShow=!1,this.connSelectId=node.Dsid,this.connSelectType=node.ConnType,this.testLoading=!1,this.privilegeSelect=[],console.log("当前数据源头id: "+this.connSelectType+"-"+this.connSelectId);var self=this;axios.get("/connMeta/getById/"+node.Dsid).then(function(e){self.connForm.DatasourceName=e.data.DatasourceName,self.connForm.Host=e.data.Host,self.connForm.User=e.data.User,self.connForm.Passwd=e.data.Passwd,self.connForm.Database=e.data.Database,self.connForm.Port=e.data.Port,self.connForm.Encode=e.data.Encode,self.connForm.ConnType=e.data.ConnType}).catch(function(e){console.log(e)}),axios.get("/connMeta/getPrivilegeRolesById/"+node.Dsid).then(function(response){var res=eval(response.data);self.privilegeSelect=res,console.log(res)}).catch(function(e){console.log(e)})},checkReadOnly:function(){},getRoleOptions:function(){var e=this;axios.get("/auth/roles").then(function(t){e.roleOptions=t.data}).catch(function(e){console.log(e)})}},mounted:function(){this.checkReadOnly(),this.getConnTree(),this.getRoleOptions()}}},qCpH:function(e,t){},rcGG:function(e,t){},saz5:function(e,t){},t5wq:function(e,t){},tMbY:function(e,t){},tvR6:function(e,t){},uP3G:function(e,t){},vPQN:function(e,t){},w5xR:function(e,t){},wLEb:function(e,t){},y82h:function(e,t){},yPeS:function(e,t,a){e.exports=a.p+"static/img/xiaopForm.42d0e16.png"},zIQl:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.566711d21366f476522f.js.map